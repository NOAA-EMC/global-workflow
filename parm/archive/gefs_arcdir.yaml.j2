{% set cycle_HH = current_cycle | strftime("%H") %}
{% set cycle_YMDH = current_cycle | to_YMDH %}
{% set cycle_YMD = current_cycle | to_YMD %}
{% set head = RUN + ".t" + cycle_HH + "z." %}

# Declare the GEFS_ARCH where atmos data will be sent
{% set GEFS_ARCH = ROTDIR ~"/gefsarch" %}

{% set file_set = [] %}

# test files
{% if RUN == "gefs" %}
    {% set ensstat_files = [] %}
    {% if path_exists(COMIN_ATMOS_GRIB_1p00) %}
        {% for fhr in range(FHMIN_GFS, FHMIN_GFS + FHOUT_GFS, FHMAX_GFS) %}
            {% do ensstat_files.append([COMIN_ATMOS_GRIB_1p00 ~ "/" ~ head ~ "mean.pres_." ~ "/" ~
                                        grid ~ ".f" ~ '%03d'|format(fhr) ~ ".grib2",
                                        GEFS_ARCH]) %}
        {% endfor %}
    {% endif %}
{% endif %}
{% set file_set = ensstat_files %}
# Actually write the yaml
mkdir:
    - "{{ GEFS_ARCH }}"
copy:
   {% for source_dest_pair in file_set %}
   - {{ source_dest_pair }}
   {% endfor %}
