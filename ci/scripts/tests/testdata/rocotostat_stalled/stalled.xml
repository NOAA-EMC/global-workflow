<?xml version="1.0"?>
<!DOCTYPE workflow
[
	<!--
	PROGRAM
		Main workflow manager for Global Forecast System

	NOTES:
		This workflow was automatically generated at 2024-05-08 19:53:07.741175
	-->
	<!ENTITY PSLOT "C48_S2SWA_gefs">
	<!ENTITY ROTDIR "/RUNTESTS/COMROOT/C48_S2SWA_gefs">
	<!ENTITY JOBS_DIR "/gefs/jobs/rocoto">
	<!ENTITY MAXTRIES "2">
]>

<workflow realtime="F" scheduler="slurm" cyclethrottle="3" taskthrottle="25">

	<log verbosity="10"><cyclestr>/RUNTESTS/EXPDIR/C48_S2SWA_gefs/logs/@Y@m@d@H.log</cyclestr></log>

	<!-- Define the cycles -->
	<cycledef group="gefs">202103231200 202103231200 24:00:00</cycledef>

<task name="stage_ic" cycledefs="gefs" maxtries="&MAXTRIES;">

	<command>/gefs/jobs/rocoto/stage_ic.sh</command>

	<jobname><cyclestr>C48_S2SWA_gefs_stage_ic_@H</cyclestr></jobname>
	<account>nems</account>
	<queue>batch</queue>
	<partition>orion</partition>
	<walltime>00:15:00</walltime>
	<nodes>1:ppn=1:tpp=1</nodes>
	<native>--export=NONE</native>

	<join><cyclestr>/RUNTESTS/COMROOT/C48_S2SWA_gefs/logs/@Y@m@d@H/stage_ic.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>/gefs</value></envar>
	<envar><name>EXPDIR</name><value>/RUNTESTS/EXPDIR/C48_S2SWA_gefs</value></envar>
	<envar><name>NET</name><value>gefs</value></envar>
	<envar><name>CDUMP</name><value>gefs</value></envar>
	<envar><name>RUN</name><value>gefs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>/RUNTESTS/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/work/noaa/stmp/mterry/RUNDIRS/C48_S2SWA_gefs</value></envar>

	<dependency>
		<and>
			<datadep><cyclestr>/work/noaa/global/glopara/data/ICSDIR/prototype_ICs/gefs_test/@Y@m@d@H/mem000/atmos/gfs_ctrl.nc</cyclestr></datadep>
			<datadep><cyclestr>/work/noaa/global/glopara/data/ICSDIR/prototype_ICs/gefs_test/@Y@m@d@H/mem000/wave/@Y@m@d.@H0000.restart.glo_500</cyclestr></datadep>
		</and>
	</dependency>

</task>

<task name="wave_init" cycledefs="gefs" maxtries="&MAXTRIES;">

	<command>/gefs/jobs/rocoto/waveinit.sh</command>

	<jobname><cyclestr>C48_S2SWA_gefs_wave_init_@H</cyclestr></jobname>
	<account>nems</account>
	<queue>batch</queue>
	<partition>orion</partition>
	<walltime>00:10:00</walltime>
	<nodes>1:ppn=40:tpp=1</nodes>
	<memory>2GB</memory>
	<native>--export=NONE</native>

	<join><cyclestr>/RUNTESTS/COMROOT/C48_S2SWA_gefs/logs/@Y@m@d@H/wave_init.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>/gefs</value></envar>
	<envar><name>EXPDIR</name><value>/RUNTESTS/EXPDIR/C48_S2SWA_gefs</value></envar>
	<envar><name>NET</name><value>gefs</value></envar>
	<envar><name>CDUMP</name><value>gefs</value></envar>
	<envar><name>RUN</name><value>gefs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>/RUNTESTS/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/work/noaa/stmp/mterry/RUNDIRS/C48_S2SWA_gefs</value></envar>

</task>

<task name="fcst_mem000" cycledefs="gefs" maxtries="&MAXTRIES;">

	<command>/gefs/jobs/rocoto/fcst.sh</command>

	<jobname><cyclestr>C48_S2SWA_gefs_fcst_mem000_@H</cyclestr></jobname>
	<account>nems</account>
	<queue>batch</queue>
	<partition>orion</partition>
	<walltime>03:00:00</walltime>
	<nodes>1:ppn=40:tpp=1</nodes>
	<native>--export=NONE</native>

	<join><cyclestr>/RUNTESTS/COMROOT/C48_S2SWA_gefs/logs/@Y@m@d@H/fcst_mem000.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>/gefs</value></envar>
	<envar><name>EXPDIR</name><value>/RUNTESTS/EXPDIR/C48_S2SWA_gefs</value></envar>
	<envar><name>NET</name><value>gefs</value></envar>
	<envar><name>CDUMP</name><value>gefs</value></envar>
	<envar><name>RUN</name><value>gefs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>/RUNTESTS/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/work/noaa/stmp/mterry/RUNDIRS/C48_S2SWA_gefs</value></envar>

	<dependency>
		<and>
			<taskdep task="stage_ic"/>
			<taskdep task="wave_init"/>
		</and>
	</dependency>

</task>

<metatask name="fcst_ens">

	<var name="member">001 002</var>

	<task name="fcst_mem#member#" cycledefs="gefs" maxtries="&MAXTRIES;">

		<command>/gefs/jobs/rocoto/fcst.sh</command>

		<jobname><cyclestr>C48_S2SWA_gefs_fcst_mem#member#_@H</cyclestr></jobname>
		<account>nems</account>
		<queue>batch</queue>
		<partition>orion</partition>
		<walltime>03:00:00</walltime>
		<nodes>1:ppn=40:tpp=1</nodes>
		<native>--export=NONE</native>

		<join><cyclestr>/RUNTESTS/COMROOT/C48_S2SWA_gefs/logs/@Y@m@d@H/fcst_mem#member#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>/gefs</value></envar>
		<envar><name>EXPDIR</name><value>/RUNTESTS/EXPDIR/C48_S2SWA_gefs</value></envar>
		<envar><name>NET</name><value>gefs</value></envar>
		<envar><name>CDUMP</name><value>gefs</value></envar>
		<envar><name>RUN</name><value>gefs</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>/RUNTESTS/COMROOT</value></envar>
		<envar><name>DATAROOT</name><value>/work/noaa/stmp/mterry/RUNDIRS/C48_S2SWA_gefs</value></envar>
		<envar><name>ENSMEM</name><value>#member#</value></envar>
		<envar><name>MEMDIR</name><value>mem#member#</value></envar>

		<dependency>
			<and>
				<taskdep task="stage_ic"/>
				<taskdep task="wave_init"/>
			</and>
		</dependency>

	</task>

</metatask>

<metatask name="atmos_prod">

	<var name="member">000 001 002</var>

	<metatask name="atmos_prod_#member#">

		<var name="fhr">000 006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120</var>

		<task name="atmos_prod_mem#member#_f#fhr#" cycledefs="gefs" maxtries="&MAXTRIES;">

			<command>/gefs/jobs/rocoto/atmos_products.sh</command>

			<jobname><cyclestr>C48_S2SWA_gefs_atmos_prod_mem#member#_f#fhr#_@H</cyclestr></jobname>
			<account>nems</account>
			<queue>batch</queue>
			<partition>orion</partition>
			<walltime>00:15:00</walltime>
			<nodes>1:ppn=24:tpp=1</nodes>
			<native>--export=NONE</native>

			<join><cyclestr>/RUNTESTS/COMROOT/C48_S2SWA_gefs/logs/@Y@m@d@H/atmos_prod_mem#member#_f#fhr#.log</cyclestr></join>

			<envar><name>RUN_ENVIR</name><value>emc</value></envar>
			<envar><name>HOMEgfs</name><value>/gefs</value></envar>
			<envar><name>EXPDIR</name><value>/RUNTESTS/EXPDIR/C48_S2SWA_gefs</value></envar>
			<envar><name>NET</name><value>gefs</value></envar>
			<envar><name>CDUMP</name><value>gefs</value></envar>
			<envar><name>RUN</name><value>gefs</value></envar>
			<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
			<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
			<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
			<envar><name>COMROOT</name><value>/RUNTESTS/COMROOT</value></envar>
			<envar><name>DATAROOT</name><value>/work/noaa/stmp/mterry/RUNDIRS/C48_S2SWA_gefs</value></envar>
			<envar><name>ENSMEM</name><value>#member#</value></envar>
			<envar><name>MEMDIR</name><value>mem#member#</value></envar>
			<envar><name>FHRLST</name><value>#fhr#</value></envar>
			<envar><name>COMPONENT</name><value>atmos</value></envar>

			<dependency>
				<datadep age="120"><cyclestr>&ROTDIR;/gefs.@Y@m@d/@H/mem#member#/model_data/atmos/master/gefs.t@Hz.master.grb2f#fhr#</cyclestr></datadep>
			</dependency>

		</task>

	</metatask>

</metatask>

<metatask name="atmos_ensstat">

	<var name="fhr">000 006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120</var>

	<task name="atmos_ensstat_f#fhr#" cycledefs="gefs" maxtries="&MAXTRIES;">

		<command>/gefs/jobs/rocoto/atmos_ensstat.sh</command>

		<jobname><cyclestr>C48_S2SWA_gefs_atmos_ensstat_f#fhr#_@H</cyclestr></jobname>
		<account>nems</account>
		<queue>batch</queue>
		<partition>orion</partition>
		<walltime>00:30:00</walltime>
		<nodes>1:ppn=6:tpp=1</nodes>
		<native>--export=NONE</native>

		<join><cyclestr>/RUNTESTS/COMROOT/C48_S2SWA_gefs/logs/@Y@m@d@H/atmos_ensstat_f#fhr#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>/gefs</value></envar>
		<envar><name>EXPDIR</name><value>/RUNTESTS/EXPDIR/C48_S2SWA_gefs</value></envar>
		<envar><name>NET</name><value>gefs</value></envar>
		<envar><name>CDUMP</name><value>gefs</value></envar>
		<envar><name>RUN</name><value>gefs</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>/RUNTESTS/COMROOT</value></envar>
		<envar><name>DATAROOT</name><value>/work/noaa/stmp/mterry/RUNDIRS/C48_S2SWA_gefs</value></envar>
		<envar><name>FHRLST</name><value>#fhr#</value></envar>

		<dependency>
			<and>
				<taskdep task="atmos_prod_mem000_f#fhr#"/>
				<taskdep task="atmos_prod_mem001_f#fhr#"/>
				<taskdep task="atmos_prod_mem002_f#fhr#"/>
			</and>
		</dependency>

	</task>

</metatask>

<metatask name="ocean_prod">

	<var name="member">000 001 002</var>

	<metatask name="ocean_prod_#member#">

		<var name="fhr">006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120</var>

		<task name="ocean_prod_mem#member#_f#fhr#" cycledefs="gefs" maxtries="&MAXTRIES;">

			<command>/gefs/jobs/rocoto/oceanice_products.sh</command>

			<jobname><cyclestr>C48_S2SWA_gefs_ocean_prod_mem#member#_f#fhr#_@H</cyclestr></jobname>
			<account>nems</account>
			<queue>batch</queue>
			<partition>orion</partition>
			<walltime>00:15:00</walltime>
			<nodes>1:ppn=1:tpp=1</nodes>
			<memory>96GB</memory>
			<native>--export=NONE</native>

			<join><cyclestr>/RUNTESTS/COMROOT/C48_S2SWA_gefs/logs/@Y@m@d@H/ocean_prod_mem#member#_f#fhr#.log</cyclestr></join>

			<envar><name>RUN_ENVIR</name><value>emc</value></envar>
			<envar><name>HOMEgfs</name><value>/gefs</value></envar>
			<envar><name>EXPDIR</name><value>/RUNTESTS/EXPDIR/C48_S2SWA_gefs</value></envar>
			<envar><name>NET</name><value>gefs</value></envar>
			<envar><name>CDUMP</name><value>gefs</value></envar>
			<envar><name>RUN</name><value>gefs</value></envar>
			<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
			<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
			<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
			<envar><name>COMROOT</name><value>/RUNTESTS/COMROOT</value></envar>
			<envar><name>DATAROOT</name><value>/work/noaa/stmp/mterry/RUNDIRS/C48_S2SWA_gefs</value></envar>
			<envar><name>ENSMEM</name><value>#member#</value></envar>
			<envar><name>MEMDIR</name><value>mem#member#</value></envar>
			<envar><name>FHRLST</name><value>#fhr#</value></envar>
			<envar><name>COMPONENT</name><value>ocean</value></envar>

			<dependency>
				<and>
					<datadep age="120"><cyclestr>&ROTDIR;/gefs.@Y@m@d/@H/mem#member#/model_data/ocean/history/gefs.ocean.t@Hz.24hr_avg.f#fhr#.nc</cyclestr></datadep>
					<sh shell="/bin/sh"><cyclestr>/gefs/ush/check_netcdf.sh &ROTDIR;/gefs.@Y@m@d/@H/mem#member#/model_data/ocean/history/gefs.ocean.t@Hz.24hr_avg.f#fhr#.nc</cyclestr></sh>
				</and>
			</dependency>

		</task>

	</metatask>

</metatask>

<metatask name="ice_prod">

	<var name="member">000 001 002</var>

	<metatask name="ice_prod_#member#">

		<var name="fhr">006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120</var>

		<task name="ice_prod_mem#member#_f#fhr#" cycledefs="gefs" maxtries="&MAXTRIES;">

			<command>/gefs/jobs/rocoto/oceanice_products.sh</command>

			<jobname><cyclestr>C48_S2SWA_gefs_ice_prod_mem#member#_f#fhr#_@H</cyclestr></jobname>
			<account>nems</account>
			<queue>batch</queue>
			<partition>orion</partition>
			<walltime>00:15:00</walltime>
			<nodes>1:ppn=1:tpp=1</nodes>
			<memory>96GB</memory>
			<native>--export=NONE</native>

			<join><cyclestr>/RUNTESTS/COMROOT/C48_S2SWA_gefs/logs/@Y@m@d@H/ice_prod_mem#member#_f#fhr#.log</cyclestr></join>

			<envar><name>RUN_ENVIR</name><value>emc</value></envar>
			<envar><name>HOMEgfs</name><value>/gefs</value></envar>
			<envar><name>EXPDIR</name><value>/RUNTESTS/EXPDIR/C48_S2SWA_gefs</value></envar>
			<envar><name>NET</name><value>gefs</value></envar>
			<envar><name>CDUMP</name><value>gefs</value></envar>
			<envar><name>RUN</name><value>gefs</value></envar>
			<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
			<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
			<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
			<envar><name>COMROOT</name><value>/RUNTESTS/COMROOT</value></envar>
			<envar><name>DATAROOT</name><value>/work/noaa/stmp/mterry/RUNDIRS/C48_S2SWA_gefs</value></envar>
			<envar><name>ENSMEM</name><value>#member#</value></envar>
			<envar><name>MEMDIR</name><value>mem#member#</value></envar>
			<envar><name>FHRLST</name><value>#fhr#</value></envar>
			<envar><name>COMPONENT</name><value>ice</value></envar>

			<dependency>
				<datadep age="120"><cyclestr>&ROTDIR;/gefs.@Y@m@d/@H/mem#member#/model_data/ice/history/gefs.ice.t@Hz.24hr_avg.f#fhr#.nc</cyclestr></datadep>
			</dependency>

		</task>

	</metatask>

</metatask>

<metatask name="wave_post_grid">

	<var name="member">000 001 002</var>

	<task name="wave_post_grid_mem#member#" cycledefs="gefs" maxtries="&MAXTRIES;">

		<command>/gefs/jobs/rocoto/wavepostsbs.sh</command>

		<jobname><cyclestr>C48_S2SWA_gefs_wave_post_grid_mem#member#_@H</cyclestr></jobname>
		<account>nems</account>
		<queue>batch</queue>
		<partition>orion</partition>
		<walltime>03:00:00</walltime>
		<nodes>1:ppn=40:tpp=1</nodes>
		<memory>10GB</memory>
		<native>--export=NONE</native>

		<join><cyclestr>/RUNTESTS/COMROOT/C48_S2SWA_gefs/logs/@Y@m@d@H/wave_post_grid_mem#member#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>/gefs</value></envar>
		<envar><name>EXPDIR</name><value>/RUNTESTS/EXPDIR/C48_S2SWA_gefs</value></envar>
		<envar><name>NET</name><value>gefs</value></envar>
		<envar><name>CDUMP</name><value>gefs</value></envar>
		<envar><name>RUN</name><value>gefs</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>/RUNTESTS/COMROOT</value></envar>
		<envar><name>DATAROOT</name><value>/work/noaa/stmp/mterry/RUNDIRS/C48_S2SWA_gefs</value></envar>
		<envar><name>ENSMEM</name><value>#member#</value></envar>
		<envar><name>MEMDIR</name><value>mem#member#</value></envar>

		<dependency>
			<and>
				<datadep><cyclestr>&ROTDIR;/gefs.@Y@m@d/@H/mem#member#/model_data/wave/history/gefswave.out_grd.glo_500.@Y@m@d.@H0000</cyclestr></datadep>
			</and>
		</dependency>

	</task>

</metatask>

<metatask name="wave_post_pnt">

	<var name="member">000 001 002</var>

	<task name="wave_post_pnt_mem#member#" cycledefs="gefs" maxtries="&MAXTRIES;">

		<command>/gefs/jobs/rocoto/wavepostpnt.sh</command>

		<jobname><cyclestr>C48_S2SWA_gefs_wave_post_pnt_mem#member#_@H</cyclestr></jobname>
		<account>nems</account>
		<queue>batch</queue>
		<partition>orion</partition>
		<walltime>04:00:00</walltime>
		<nodes>5:ppn=40:tpp=1</nodes>
		<native>--export=NONE</native>

		<join><cyclestr>/RUNTESTS/COMROOT/C48_S2SWA_gefs/logs/@Y@m@d@H/wave_post_pnt_mem#member#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>/gefs</value></envar>
		<envar><name>EXPDIR</name><value>/RUNTESTS/EXPDIR/C48_S2SWA_gefs</value></envar>
		<envar><name>NET</name><value>gefs</value></envar>
		<envar><name>CDUMP</name><value>gefs</value></envar>
		<envar><name>RUN</name><value>gefs</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>/RUNTESTS/COMROOT</value></envar>
		<envar><name>DATAROOT</name><value>/work/noaa/stmp/mterry/RUNDIRS/C48_S2SWA_gefs</value></envar>
		<envar><name>ENSMEM</name><value>#member#</value></envar>
		<envar><name>MEMDIR</name><value>mem#member#</value></envar>

		<dependency>
			<and>
				<taskdep task="fcst_mem#member#"/>
			</and>
		</dependency>

	</task>

</metatask>

</workflow>
