<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GFS Physics Documentation: radsw_main.f Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ccpp_dox_extra_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ncep.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GFS Physics Documentation
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('radsw__main_8f_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">radsw_main.f</div>  </div>
</div><!--header-->
<div class="contents">
<a href="radsw__main_8f.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">!  ==============================================================  !!!!!</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">!             sw-rrtm3 radiation package description              !!!!!</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">!  ==============================================================  !!!!!</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">!   this package includes ncep&#39;s modifications of the rrtm-sw radiation    !</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">!   code from aer inc.                                                     !</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">!   the sw-rrtm3 package includes these parts:                             !</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">!      &#39;radsw_rrtm3_param.f&#39;                                               !</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">!      &#39;radsw_rrtm3_datatb.f&#39;                                              !</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">!      &#39;radsw_rrtm3_main.f&#39;                                                !</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">!   the &#39;radsw_rrtm3_param.f&#39; contains:                                    !</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">!      &#39;module_radsw_parameters&#39;  -- band parameters set up                !</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">!   the &#39;radsw_rrtm3_datatb.f&#39; contains:                                   !</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">!      &#39;module_radsw_ref&#39;         -- reference temperature and pressure    !</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">!      &#39;module_radsw_cldprtb&#39;     -- cloud property coefficients table     !</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">!      &#39;module_radsw_sflux&#39;       -- spectral distribution of solar flux   !</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">!      &#39;module_radsw_kgbnn&#39;       -- absorption coeffients for 14          !</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">!                                    bands, where nn = 16-29               !</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">!   the &#39;radsw_rrtm3_main.f&#39; contains:                                     !</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">!      &#39;module_radsw_main&#39;        -- main sw radiation transfer            !</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">!   in the main module &#39;module_radsw_main&#39; there are only two              !</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">!   externally callable subroutines:                                       !</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">!      &#39;swrad&#39;      -- main sw radiation routine                           !</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">!         inputs:                                                          !</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">!           (plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr,                         !</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">!            clouds,icseed,aerosols,sfcalb,                                !</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">!            cosz,solcon,NDAY,idxday,                                      !</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">!            npts, nlay, nlp1, lprnt,                                      !</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">!         outputs:                                                         !</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">!            hswc,topflx,sfcflx,                                           !</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">!!        optional outputs:                                                !</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">!            HSW0,HSWB,FLXPRF,FDNCMP)                                      !</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">!           )                                                              !</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">!      &#39;rswinit&#39;    -- initialization routine                              !</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">!         inputs:                                                          !</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">!           ( me )                                                         !</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">!         outputs:                                                         !</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">!           (none)                                                         !</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">!   all the sw radiation subprograms become contained subprograms          !</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">!   in module &#39;module_radsw_main&#39; and many of them are not directly        !</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">!   accessable from places outside the module.                             !</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">!    derived data type constructs used:                                    !</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">!     1. radiation flux at toa: (from module &#39;module_radsw_parameters&#39;)    !</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">!          topfsw_type   -  derived data type for toa rad fluxes           !</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">!            upfxc              total sky upward flux at toa               !</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">!            dnfxc              total sky downward flux at toa             !</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">!            upfx0              clear sky upward flux at toa               !</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">!     2. radiation flux at sfc: (from module &#39;module_radsw_parameters&#39;)    !</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">!          sfcfsw_type   -  derived data type for sfc rad fluxes           !</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">!            upfxc              total sky upward flux at sfc               !</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">!            dnfxc              total sky downward flux at sfc             !</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">!            upfx0              clear sky upward flux at sfc               !</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">!            dnfx0              clear sky downward flux at sfc             !</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">!     3. radiation flux profiles(from module &#39;module_radsw_parameters&#39;)    !</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">!          profsw_type    -  derived data type for rad vertical prof       !</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">!            upfxc              level upward flux for total sky            !</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">!            dnfxc              level downward flux for total sky          !</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">!            upfx0              level upward flux for clear sky            !</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">!            dnfx0              level downward flux for clear sky          !</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">!     4. surface component fluxes(from module &#39;module_radsw_parameters&#39;    !</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">!          cmpfsw_type    -  derived data type for component sfc flux      !</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">!            uvbfc              total sky downward uv-b flux at sfc        !</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">!            uvbf0              clear sky downward uv-b flux at sfc        !</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">!            nirbm              surface downward nir direct beam flux      !</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">!            nirdf              surface downward nir diffused flux         !</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">!            visbm              surface downward uv+vis direct beam flx    !</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">!            visdf              surface downward uv+vis diffused flux      !</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">!   external modules referenced:                                           !</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">!       &#39;module physparam&#39;                                                 !</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">!       &#39;module physcons&#39;                                                  !</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">!       &#39;mersenne_twister&#39;                                                 !</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">!   compilation sequence is:                                               !</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">!      &#39;radsw_rrtm3_param.f&#39;                                               !</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">!      &#39;radsw_rrtm3_datatb.f&#39;                                              !</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">!      &#39;radsw_rrtm3_main.f&#39;                                                !</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">!   and all should be put in front of routines that use sw modules         !</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">!==========================================================================!</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">!   the original program declarations:                                     !</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">!  Copyright 2002-2007, Atmospheric &amp; Environmental Research, Inc. (AER).  !</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">!  This software may be used, copied, or redistributed as long as it is    !</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">!  not sold and this copyright notice is reproduced on each copy made.     !</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">!  This model is provided as is without any express or implied warranties. !</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">!                       (http://www.rtweb.aer.com/)                        !</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">! ************************************************************************ !</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">!                              rrtmg_sw                                    !</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">!                   a rapid radiative transfer model                       !</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">!                    for the solar spectral region                         !</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">!            atmospheric and environmental research, inc.                  !</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">!                        131 hartwell avenue                               !</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">!                        lexington, ma 02421                               !</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">!                           eli j. mlawer                                  !</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">!                        jennifer s. delamere                              !</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">!                         michael j. iacono                                !</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">!                         shepard a. clough                                !</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">!                       email:  miacono@aer.com                            !</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">!                       email:  emlawer@aer.com                            !</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">!                       email:  jdelamer@aer.com                           !</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">!        the authors wish to acknowledge the contributions of the          !</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">!        following people:  steven j. taubman, patrick d. brown,           !</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">!        ronald e. farren, luke chen, robert bergstrom.                    !</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">! ************************************************************************ !</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">!    references:                                                           !</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">!    (rrtm_sw/rrtmg_sw):                                                   !</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">!      clough, s.a., m.w. shephard, e.j. mlawer, j.s. delamere,            !</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">!      m.j. iacono, k. cady-pereira, s. boukabara, and p.d. brown:         !</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">!      atmospheric radiative transfer modeling: a summary of the aer       !</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">!      codes, j. quant. spectrosc. radiat. transfer, 91, 233-244, 2005.    !</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">!    (mcica):                                                              !</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">!      pincus, r., h. w. barker, and j.-j. morcrette: a fast, flexible,    !</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">!      approximation technique for computing radiative transfer in         !</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">!      inhomogeneous cloud fields, j. geophys. res., 108(d13), 4376,       !</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">!      doi:10.1029/2002jd003322, 2003.                                     !</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">! ************************************************************************ !</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">!    aer&#39;s revision history:                                               !</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">!     this version of rrtmg_sw has been modified from rrtm_sw to use a     !</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">!     reduced set of g-point intervals and a two-stream model for          !</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">!     application to gcms.                                                 !</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">! --  original version (derived from rrtm_sw)                              !</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">!        2002: aer. inc.                                                   !</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">! --  conversion to f90 formatting; addition of 2-stream radiative transfer!</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">!        feb 2003: j.-j. morcrette, ecmwf                                  !</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">! --  additional modifications for gcm application                         !</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">!        aug 2003: m. j. iacono, aer inc.                                  !</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">! --  total number of g-points reduced from 224 to 112.  original          !</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">!     set of 224 can be restored by exchanging code in module parrrsw.f90  !</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">!     and in file rrtmg_sw_init.f90.                                       !</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">!        apr 2004: m. j. iacono, aer, inc.                                 !</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">! --  modifications to include output for direct and diffuse               !</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">!     downward fluxes.  there are output as &quot;true&quot; fluxes without          !</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">!     any delta scaling applied.  code can be commented to exclude         !</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">!     this calculation in source file rrtmg_sw_spcvrt.f90.                 !</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">!        jan 2005: e. j. mlawer, m. j. iacono, aer, inc.                   !</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">! --  revised to add mcica capability.                                     !</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">!        nov 2005: m. j. iacono, aer, inc.                                 !</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">! --  reformatted for consistency with rrtmg_lw.                           !</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">!        feb 2007: m. j. iacono, aer, inc.                                 !</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">! --  modifications to formatting to use assumed-shape arrays.             !</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">!        aug 2007: m. j. iacono, aer, inc.                                 !</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">! ************************************************************************ !</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">!   ncep modifications history log:                                        !</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">!       sep 2003,  yu-tai hou        -- received aer&#39;s rrtm-sw gcm version !</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">!                    code (v224)                                           !</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">!       nov 2003,  yu-tai hou        -- corrected errors in direct/diffuse !</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">!                    surface alabedo components.                           !</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">!       jan 2004,  yu-tai hou        -- modified code into standard modular!</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">!                    f9x code for ncep models. the original three cloud    !</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">!                    control flags are simplified into two: iflagliq and   !</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">!                    iflagice. combined the org subr sw_224 and setcoef    !</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">!                    into radsw (the main program); put all kgb##together  !</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">!                    and reformat into a separated data module; combine    !</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">!                    reftra and vrtqdr as swflux; optimized taumol and all !</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">!                    taubgs to form a contained subroutines.               !</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">!       jun 2004,  yu-tai hou        -- modified code based on aer&#39;s faster!</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">!                    version rrtmg_sw (v2.0) with 112 g-points.            !</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">!       mar 2005,  yu-tai hou        -- modified to aer v2.3, correct cloud!</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">!                    scaling error, total sky properties are delta scaled  !</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">!                    after combining clear and cloudy parts. the testing   !</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">!                    criterion of ssa is saved before scaling. added cloud !</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">!                    layer rain and snow contributions. all cloud water    !</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">!                    partical contents are treated the same way as other   !</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">!                    atmos particles.                                      !</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">!       apr 2005,  yu-tai hou        -- modified on module structures (this!</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">!                    version of code was given back to aer in jun 2006)    !</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">!       nov 2006,  yu-tai hou        -- modified code to include the       !</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">!                    generallized aerosol optical property scheme for gcms.!</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">!       apr 2007,  yu-tai hou        -- added spectral band heating as an  !</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">!                    optional output to support the 500km model&#39;s upper    !</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">!                    stratospheric radiation calculations. restructure     !</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">!                    optional outputs for easy access by different models. !</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">!       oct 2008,  yu-tai hou        -- modified to include new features   !</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">!                    from aer&#39;s newer release v3.5-v3.61, including mcica  !</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">!                    sub-grid cloud option and true direct/diffuse fluxes  !</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">!                    without delta scaling. added rain/snow opt properties !</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">!                    support to cloudy sky calculations. simplified and    !</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">!                    unified sw and lw sub-column cloud subroutines into   !</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">!                    one module by using optional parameters.              !</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">!       mar 2009,  yu-tai hou        -- replaced the original random number!</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">!                    generator coming with the original code with ncep w3  !</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">!                    library to simplify the program and moved sub-column  !</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">!                    cloud subroutines inside the main module. added       !</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">!                    option of user provided permutation seeds that could  !</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">!                    be randomly generated from forecast time stamp.       !</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">!       mar 2009,  yu-tai hou        -- replaced random number generator   !</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">!                    programs coming from the original code with the ncep  !</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">!                    w3 library to simplify the program and moved sub-col  !</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">!                    cloud subroutines inside the main module. added       !</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">!                    option of user provided permutation seeds that could  !</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">!                    be randomly generated from forecast time stamp.       !</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">!       nov 2009,  yu-tai hou        -- updated to aer v3.7-v3.8 version.  !</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">!                    notice the input cloud ice/liquid are assumed as      !</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">!                    in-cloud quantities, not grid average quantities.     !</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">!       aug 2010,  yu-tai hou        -- uptimized code to improve efficiency</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">!                    splited subroutine spcvrt into two subs, spcvrc and   !</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">!                    spcvrm, to handling non-mcica and mcica type of calls.!</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">!       apr 2012,  b. ferrier and y. hou -- added conversion factor to fu&#39;s!</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">!                    cloud-snow optical property scheme.                   !</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">!       jul 2012,  s. moorthi and Y. hou  -- eliminated the pointer array  !</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">!                     in subr &#39;spcvrt&#39; for multi-threading issue running   !</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">!                     under intel&#39;s fortran compiler.                      !</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">!       nov 2012,  yu-tai hou        -- modified control parameters thru   !</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">!                     module &#39;physparam&#39;.                                  !</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">!       jun 2013,  yu-tai hou        -- moving band 9 surface treatment    !</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">!                     back as in the rrtm2 version, spliting surface flux  !</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">!                     into two spectral regions (vis &amp; nir), instead of    !</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">!                     designated it in nir region only.                    !</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">!       may 2016   yu-tai hou        --reverting swflux name back to vrtqdr!</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">!!!!!  ==============================================================  !!!!!</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">!!!!!                         end descriptions                         !!!!!</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">!!!!!  ==============================================================  !!!!!</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">!     FEB 2017    A.Cheng   - add odpth output, effective radius input !</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">!========================================!</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="keyword">module</span> module_radsw_main           <span class="comment">!</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">!........................................!</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="keywordtype">use </span>physparam<span class="keywordtype">,        only</span> : iswrate, iswrgas, iswcliq, iswcice,  &amp;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;     &amp;                             isubcsw, icldflg, iovrsw,  ivflip,   &amp;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;     &amp;                             iswmode, kind_phys</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordtype">use </span>physcons<span class="keywordtype">,         only</span> : con_g, con_cp, con_avgd, con_amd,    &amp;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;     &amp;                             con_amw, con_amo3</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__parameters.html">module_radsw_parameters</a></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keywordtype">use </span>mersenne_twister<span class="keywordtype">, only</span> : random_setseed, random_number,       &amp;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;     &amp;                             random_stat</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__ref.html">module_radsw_ref</a><span class="keywordtype">, only</span> : <a class="code" href="namespacemodule__radsw__ref.html#afb71559d084ca709bd134e6c489035e2">preflog</a>, <a class="code" href="namespacemodule__radsw__ref.html#a449fffa7047caa0fba6c166c26f7dbbd">tref</a></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__sflux.html">module_radsw_sflux</a></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="keywordtype">private</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">!  ---  version tag and last revision date</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="keywordtype">character(40)</span>, <span class="keywordtype">parameter</span> ::                                       &amp;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;     &amp;   VTAGSW=<span class="stringliteral">&#39;NCEP SW v5.1  Nov 2012 -RRTMG-SW v3.8   &#39;</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">!    &amp;   VTAGSW=&#39;NCEP SW v5.0  Aug 2012 -RRTMG-SW v3.8   &#39;</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">!    &amp;   VTAGSW=&#39;RRTMG-SW v3.8   Nov 2009&#39;</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">!    &amp;   VTAGSW=&#39;RRTMG-SW v3.7   Nov 2009&#39;</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">!    &amp;   VTAGSW=&#39;RRTMG-SW v3.61  Oct 2008&#39;</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">!    &amp;   VTAGSW=&#39;RRTMG-SW v3.5   Oct 2008&#39;</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">!    &amp;   VTAGSW=&#39;RRTM-SW 112v2.3 Apr 2007&#39;</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">!    &amp;   VTAGSW=&#39;RRTM-SW 112v2.3 Mar 2005&#39;</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">!    &amp;   VTAGSW=&#39;RRTM-SW 112v2.0 Jul 2004&#39;</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: eps     = 1.0e-6</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: oneminus= 1.0 - eps</div><div class="line"><a name="l00443"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">  443</a></span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a>   = 1.0/0.278</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: stpfac  = 296.0/1013.0</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: ftiny   = 1.0e-12</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: flimit  = 1.0e-20</div><div class="line"><a name="l00448"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#ga244c149eb05c0675a7e040dbf7e2bc4b">  448</a></span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="group__module__radsw__main.html#ga244c149eb05c0675a7e040dbf7e2bc4b">s0</a>      = 1368.22</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: f_zero  = 0.0</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: f_one   = 1.0</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: amdw    = con_amd/con_amw</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: amdo3   = con_amd/con_amo3</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nblow:nbhgh)</span> :: nspa, nspb</div><div class="line"><a name="l00460"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#gad295d723dd7d269cb51c73923a4cbb94">  460</a></span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nblow:nbhgh)</span> :: <a class="code" href="group__module__radsw__main.html#gad295d723dd7d269cb51c73923a4cbb94">idxsfc</a></div><div class="line"><a name="l00462"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#gaa20102786f7e7f8c71fb2783082eac1b">  462</a></span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nblow:nbhgh)</span> :: <a class="code" href="group__module__radsw__main.html#gaa20102786f7e7f8c71fb2783082eac1b">idxebc</a></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keyword">data</span> nspa(:) /  9, 9, 9, 9, 1, 9, 9, 1, 9, 1, 0, 1, 9, 1 /</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keyword">data</span> nspb(:) /  1, 5, 1, 1, 1, 5, 1, 0, 1, 0, 0, 1, 5, 1 /</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">!     data idxsfc(:) / 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 1 /  ! band index for sfc flux</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="keyword">data</span> <a class="code" href="group__module__radsw__main.html#gad295d723dd7d269cb51c73923a4cbb94">idxsfc</a>(:) / 1, 1, 1, 1, 1, 1, 1, 1, 0, 2, 2, 2, 2, 1 /  <span class="comment">! band index for sfc flux</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <span class="keyword">data</span> <a class="code" href="group__module__radsw__main.html#gaa20102786f7e7f8c71fb2783082eac1b">idxebc</a>(:) / 5, 5, 4, 4, 3, 3, 2, 2, 1, 1, 1, 1, 1, 5 /  <span class="comment">! band index for cld prop</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">!  ---  band wavenumber intervals</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">!     real (kind=kind_phys), dimension(nblow:nbhgh):: wavenum1,wavenum2</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">!     data wavenum1(:)  /                                               &amp;</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">!    &amp;         2600.0, 3250.0, 4000.0, 4650.0, 5150.0, 6150.0, 7700.0,  &amp;</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">!    &amp;         8050.0,12850.0,16000.0,22650.0,29000.0,38000.0,  820.0 /</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">!     data wavenum2(:)  /                                               &amp;</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">!              3250.0, 4000.0, 4650.0, 5150.0, 6150.0, 7700.0, 8050.0,  &amp;</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">!    &amp;        12850.0,16000.0,22650.0,29000.0,38000.0,50000.0, 2600.0 /</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">!     real (kind=kind_phys), dimension(nblow:nbhgh) :: delwave</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">!     data delwave(:)   /                                               &amp;</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">!    &amp;          650.0,  750.0,  650.0,  500.0, 1000.0, 1550.0,  350.0,  &amp;</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">!    &amp;         4800.0, 3150.0, 6650.0, 6350.0, 9000.0,12000.0, 1780.0 /</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#ga177282b3087dce2f54f1233ee8631231">  485</a></span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="group__module__radsw__main.html#ga177282b3087dce2f54f1233ee8631231">nuvb</a> = 27</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="keywordtype">logical</span> :: lhswb  = .false.</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="keywordtype">logical</span> :: lhsw0  = .false.</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordtype">logical</span> :: lflxprf= .false.</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="keywordtype">logical</span> :: lfdncmp= .false.</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">  495</a></span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(0:<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>)</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#gaad60e753cdda20d4e84d063280f0dfcc">  500</a></span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: <a class="code" href="group__module__radsw__main.html#gaad60e753cdda20d4e84d063280f0dfcc">heatfac</a></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#gae1f88a0b60d69b892cfae83bb9ab67df">  504</a></span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="group__module__radsw__main.html#gae1f88a0b60d69b892cfae83bb9ab67df">ipsdsw0</a> = 1</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">!  ---  public accessable subprograms</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <span class="keywordtype">public</span> <a class="code" href="group__module__radsw__main.html#ga784397878835a8cdd0b14a7b9eafb4e3">swrad</a>, <a class="code" href="group__module__radsw__main.html#ga5b0d35149515607d94f42b6ee5a40665">rswinit</a></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">! =================</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="keyword">contains</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">! =================</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radsw__main.html#ga784397878835a8cdd0b14a7b9eafb4e3">swrad</a>                                                  &amp;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;     &amp;     ( plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr,                      &amp;    <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;     &amp;       clouds,icseed,aerosols,sfcalb,                             &amp;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;     &amp;       cosz,solcon,nday,idxday,                                   &amp;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;     &amp;       npts, nlay, nlp1, lprnt,                                   &amp;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;     &amp;       hswc,topflx,sfcflx,                                        &amp;   <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;     &amp;       hsw0,hswb,flxprf,fdncmp                                    &amp;   <span class="comment">! ---  optional</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;     &amp;     )</div><div class="line"><a name="l00594"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#ga784397878835a8cdd0b14a7b9eafb4e3">  594</a></span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">!  input variables:                                                     !</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">!   plyr (npts,nlay) : model layer mean pressure in mb                  !</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">!   plvl (npts,nlp1) : model level pressure in mb                       !</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">!   tlyr (npts,nlay) : model layer mean temperature in k                !</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">!   tlvl (npts,nlp1) : model level temperature in k    (not in use)     !</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">!   qlyr (npts,nlay) : layer specific humidity in gm/gm   *see inside   !</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">!   olyr (npts,nlay) : layer ozone concentration in gm/gm               !</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">!   gasvmr(npts,nlay,:): atmospheric constent gases:                    !</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment">!                      (check module_radiation_gases for definition)    !</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">!      gasvmr(:,:,1)  - co2 volume mixing ratio                         !</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">!      gasvmr(:,:,2)  - n2o volume mixing ratio                         !</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">!      gasvmr(:,:,3)  - ch4 volume mixing ratio                         !</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">!      gasvmr(:,:,4)  - o2  volume mixing ratio                         !</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">!      gasvmr(:,:,5)  - co  volume mixing ratio        (not used)       !</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">!      gasvmr(:,:,6)  - cfc11 volume mixing ratio      (not used)       !</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">!      gasvmr(:,:,7)  - cfc12 volume mixing ratio      (not used)       !</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment">!      gasvmr(:,:,8)  - cfc22 volume mixing ratio      (not used)       !</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">!      gasvmr(:,:,9)  - ccl4  volume mixing ratio      (not used)       !</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">!   clouds(npts,nlay,:): cloud profile                                  !</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">!                      (check module_radiation_clouds for definition)   !</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">!                ---  for  iswcliq &gt; 0  ---                             !</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment">!       clouds(:,:,1)  -   layer total cloud fraction                   !</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment">!       clouds(:,:,2)  -   layer in-cloud liq water path   (g/m**2)     !</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">!       clouds(:,:,3)  -   mean eff radius for liq cloud   (micron)     !</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">!       clouds(:,:,4)  -   layer in-cloud ice water path   (g/m**2)     !</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">!       clouds(:,:,5)  -   mean eff radius for ice cloud   (micron)     !</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">!       clouds(:,:,6)  -   layer rain drop water path      (g/m**2)     !</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">!       clouds(:,:,7)  -   mean eff radius for rain drop   (micron)     !</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">!       clouds(:,:,8)  -   layer snow flake water path     (g/m**2)     !</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">!       clouds(:,:,9)  -   mean eff radius for snow flake  (micron)     !</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">!                ---  for  iswcliq = 0  ---                             !</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">!       clouds(:,:,1)  -   layer total cloud fraction                   !</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">!       clouds(:,:,2)  -   layer cloud optical depth                    !</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">!       clouds(:,:,3)  -   layer cloud single scattering albedo         !</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">!       clouds(:,:,4)  -   layer cloud asymmetry factor                 !</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">!     icseed(npts)   : auxiliary special cloud related array            !</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">!                      when module variable isubcsw=2, it provides      !</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">!                      permutation seed for each column profile that    !</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">!                      are used for generating random numbers.          !</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">!                      when isubcsw /=2, it will not be used.           !</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">!   aerosols(npts,nlay,nbdsw,:) : aerosol optical properties            !</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">!                      (check module_radiation_aerosols for definition) !</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">!         (:,:,:,1)   - optical depth                                   !</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">!         (:,:,:,2)   - single scattering albedo                        !</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">!         (:,:,:,3)   - asymmetry parameter                             !</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">!   sfcalb(npts, : ) : surface albedo in fraction                       !</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">!                      (check module_radiation_surface for definition)  !</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">!         ( :, 1 )    - near ir direct beam albedo                      !</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">!         ( :, 2 )    - near ir diffused albedo                         !</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">!         ( :, 3 )    - uv+vis direct beam albedo                       !</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">!         ( :, 4 )    - uv+vis diffused albedo                          !</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">!   cosz  (npts)     : cosine of solar zenith angle                     !</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">!   solcon           : solar constant                      (w/m**2)     !</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">!   NDAY             : num of daytime points                            !</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">!   idxday(npts)     : index array for daytime points                   !</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">!   npts             : number of horizontal points                      !</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment">!   nlay,nlp1        : vertical layer/lavel numbers                     !</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">!   lprnt            : logical check print flag                         !</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment">!  output variables:                                                    !</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment">!   hswc  (npts,nlay): total sky heating rates (k/sec or k/day)         !</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">!   topflx(npts)     : radiation fluxes at toa (w/m**2), components:    !</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">!                      (check module_radsw_parameters for definition)   !</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">!     upfxc            - total sky upward flux at toa                   !</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">!     dnflx            - total sky downward flux at toa                 !</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">!     upfx0            - clear sky upward flux at toa                   !</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">!   sfcflx(npts)     : radiation fluxes at sfc (w/m**2), components:    !</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">!                      (check module_radsw_parameters for definition)   !</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">!     upfxc            - total sky upward flux at sfc                   !</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">!     dnfxc            - total sky downward flux at sfc                 !</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">!     upfx0            - clear sky upward flux at sfc                   !</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment">!     dnfx0            - clear sky downward flux at sfc                 !</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">!!optional outputs variables:                                           !</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">!   hswb(npts,nlay,nbdsw): spectral band total sky heating rates        !</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">!   hsw0  (npts,nlay): clear sky heating rates (k/sec or k/day)         !</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">!   flxprf(npts,nlp1): level radiation fluxes (w/m**2), components:     !</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">!                      (check module_radsw_parameters for definition)   !</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">!     dnfxc            - total sky downward flux at interface           !</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment">!     upfxc            - total sky upward flux at interface             !</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">!     dnfx0            - clear sky downward flux at interface           !</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">!     upfx0            - clear sky upward flux at interface             !</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">!   fdncmp(npts)     : component surface downward fluxes (w/m**2):      !</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">!                      (check module_radsw_parameters for definition)   !</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">!     uvbfc            - total sky downward uv-b flux at sfc            !</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">!     uvbf0            - clear sky downward uv-b flux at sfc            !</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">!     nirbm            - downward surface nir direct beam flux          !</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">!     nirdf            - downward surface nir diffused flux             !</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">!     visbm            - downward surface uv+vis direct beam flux       !</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">!     visdf            - downward surface uv+vis diffused flux          !</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">!  external module variables:  (in physparam)                           !</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">!   iswrgas - control flag for rare gases (ch4,n2o,o2, etc.)            !</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">!           =0: do not include rare gases                               !</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment">!           &gt;0: include all rare gases                                  !</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">!   iswcliq - control flag for liq-cloud optical properties             !</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment">!           =0: input cloud optical depth, fixed ssa, asy               !</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment">!           =1: use hu and stamnes(1993) method for liq cld             !</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">!           =2: not used                                                !</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment">!   iswcice - control flag for ice-cloud optical properties             !</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment">!           *** if iswcliq==0, iswcice is ignored                       !</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">!           =1: use ebert and curry (1992) scheme for ice clouds        !</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">!           =2: use streamer v3.0 (2001) method for ice clouds          !</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">!           =3: use fu&#39;s method (1996) for ice clouds                   !</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">!   iswmode - control flag for 2-stream transfer scheme                 !</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">!           =1; delta-eddington    (joseph et al., 1976)                !</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">!           =2: pifm               (zdunkowski et al., 1980)            !</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">!           =3: discrete ordinates (liou, 1973)                         !</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">!   isubcsw - sub-column cloud approximation control flag               !</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">!           =0: no sub-col cld treatment, use grid-mean cld quantities  !</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">!           =1: mcica sub-col, prescribed seeds to get random numbers   !</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">!           =2: mcica sub-col, providing array icseed for random numbers!</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">!   iovrsw  - cloud overlapping control flag                            !</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">!           =0: random overlapping clouds                               !</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment">!           =1: maximum/random overlapping clouds                       !</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">!           =2: maximum overlap cloud                                   !</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">!   ivflip  - control flg for direction of vertical index               !</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">!           =0: index from toa to surface                               !</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">!           =1: index from surface to toa                               !</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">!  module parameters, control variables:                                !</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">!     nblow,nbhgh      - lower and upper limits of spectral bands       !</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">!     maxgas           - maximum number of absorbing gaseous            !</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">!     ngptsw           - total number of g-point subintervals           !</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">!     ng##             - number of g-points in band (##=16-29)          !</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">!     ngb(ngptsw)      - band indices for each g-point                  !</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">!     bpade            - pade approximation constant (1/0.278)          !</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">!     nspa,nspb(nblow:nbhgh)                                            !</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment">!                      - number of lower/upper ref atm&#39;s per band       !</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">!     ipsdsw0          - permutation seed for mcica sub-col clds        !</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">!  major local variables:                                               !</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">!     pavel  (nlay)         - layer pressures (mb)                      !</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">!     delp   (nlay)         - layer pressure thickness (mb)             !</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment">!     tavel  (nlay)         - layer temperatures (k)                    !</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">!     coldry (nlay)         - dry air column amount                     !</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment">!                                   (1.e-20*molecules/cm**2)            !</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment">!     cldfrc (nlay)         - layer cloud fraction (norm by tot cld)    !</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">!     cldfmc (nlay,ngptsw)  - layer cloud fraction for g-point          !</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">!     taucw  (nlay,nbdsw)   - cloud optical depth                       !</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">!     ssacw  (nlay,nbdsw)   - cloud single scattering albedo (weighted) !</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">!     asycw  (nlay,nbdsw)   - cloud asymmetry factor         (weighted) !</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">!     tauaer (nlay,nbdsw)   - aerosol optical depths                    !</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment">!     ssaaer (nlay,nbdsw)   - aerosol single scattering albedo          !</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">!     asyaer (nlay,nbdsw)   - aerosol asymmetry factor                  !</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">!     colamt (nlay,maxgas)  - column amounts of absorbing gases         !</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">!                             1 to maxgas are for h2o, co2, o3, n2o,    !</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">!                             ch4, o2, co, respectively (mol/cm**2)     !</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">!     facij  (nlay)         - indicator of interpolation factors        !</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">!                             =0/1: indicate lower/higher temp &amp; height !</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment">!     selffac(nlay)         - scale factor for self-continuum, equals   !</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">!                          (w.v. density)/(atm density at 296K,1013 mb) !</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment">!     selffrac(nlay)        - factor for temp interpolation of ref      !</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment">!                             self-continuum data                       !</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">!     indself(nlay)         - index of the lower two appropriate ref    !</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment">!                             temp for the self-continuum interpolation !</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="comment">!     forfac (nlay)         - scale factor for w.v. foreign-continuum   !</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment">!     forfrac(nlay)         - factor for temp interpolation of ref      !</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">!                             w.v. foreign-continuum data               !</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">!     indfor (nlay)         - index of the lower two appropriate ref    !</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">!                             temp for the foreign-continuum interp     !</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">!     laytrop               - layer at which switch is made from one    !</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment">!                             combination of key species to another     !</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">!     jp(nlay),jt(nlay),jt1(nlay)                                       !</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">!                           - lookup table indexes                      !</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">!     flxucb(nlp1,nbdsw)    - spectral bnd total-sky upward flx (w/m2)  !</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">!     flxdcb(nlp1,nbdsw)    - spectral bnd total-sky downward flx (w/m2)!</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">!     flxu0b(nlp1,nbdsw)    - spectral bnd clear-sky upward flx (w/m2)  !</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">!     flxd0b(nlp1,nbdsw)    - spectral b d clear-sky downward flx (w/m2)!</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment">!  =====================    end of definitions    ====================  !</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: npts, nlay, nlp1, NDAY</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: idxday, icseed</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: lprnt</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlp1)</span>, <span class="keywordtype">intent(in)</span> ::        &amp;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;     &amp;       plvl, tlvl</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay)</span>, <span class="keywordtype">intent(in)</span> ::        &amp;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;     &amp;       plyr, tlyr, qlyr, olyr</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,4)</span>,    <span class="keywordtype">intent(in)</span> :: sfcalb</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay,9)</span>,<span class="keywordtype">intent(in)</span>:: gasvmr</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay,11)</span>:: clouds</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay,nbdsw,3)</span>,<span class="keywordtype">intent(in)</span>::  &amp;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;     &amp;       aerosols</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: cosz(npts), solcon</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay)</span>, <span class="keywordtype">intent(out)</span> :: hswc</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      type(<a class="code" href="structmodule__radsw__parameters_1_1topfsw__type.html">topfsw_type</a>),    <span class="keywordtype">dimension(npts)</span>, <span class="keywordtype">intent(out)</span> :: topflx</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      type(<a class="code" href="structmodule__radsw__parameters_1_1sfcfsw__type.html">sfcfsw_type</a>),    <span class="keywordtype">dimension(npts)</span>, <span class="keywordtype">intent(out)</span> :: sfcflx</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment">!! ---  optional outputs:</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay,nbdsw)</span>, <span class="keywordtype">optional</span>,      &amp;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;     &amp;       intent(out) :: hswb</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay)</span>,       <span class="keywordtype">optional</span>,      &amp;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;     &amp;       intent(out) :: hsw0</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      <span class="keywordtype">type</span> (<a class="code" href="structmodule__radsw__parameters_1_1profsw__type.html">profsw_type</a>),    <span class="keywordtype">dimension(npts,nlp1)</span>,       <span class="keywordtype">optional</span>,      &amp;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;     &amp;       intent(out) :: flxprf</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      <span class="keywordtype">type</span> (<a class="code" href="structmodule__radsw__parameters_1_1cmpfsw__type.html">cmpfsw_type</a>),    <span class="keywordtype">dimension(npts)</span>,            <span class="keywordtype">optional</span>,      &amp;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;     &amp;       intent(out) :: fdncmp</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,ngptsw)</span> :: cldfmc,          &amp;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;     &amp;       taug, taur</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlp1,nbdsw)</span>:: fxupc, fxdnc,      &amp;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;     &amp;       fxup0, fxdn0</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,nbdsw)</span>  ::                  &amp;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;     &amp;       tauae, ssaae, asyae, taucw, ssacw, asycw</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(ngptsw)</span> :: sfluxzen</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>   :: cldfrc,     delp,     &amp;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;     &amp;       pavel, tavel, coldry, colmol, h2ovmr, o3vmr, temcol,       &amp;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;     &amp;       cliqp, reliq, cicep, reice, cdat1, cdat2, cdat3, cdat4,    &amp;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;     &amp;       cfrac, fac00, fac01, fac10, fac11, forfac, forfrac,        &amp;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;     &amp;       selffac, selffrac, rfdelp</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlp1)</span> :: fnet, flxdc, flxuc,     &amp;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;     &amp;       flxd0, flxu0</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(2)</span> :: albbm, albdf, sfbmc,       &amp;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;     &amp;       sfbm0, sfdfc, sfdf0</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: cosz1, sntz1, tem0, tem1, tem2, s0fac,   &amp;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;     &amp;       ssolar, zcf0, zcf1, ftoau0, ftoauc, ftoadc,                &amp;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;     &amp;       fsfcu0, fsfcuc, fsfcd0, fsfcdc, suvbfc, suvbf0</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">!  ---  column amount of absorbing gases:</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment">!       (:,m) m = 1-h2o, 2-co2, 3-o3, 4-n2o, 5-ch4, 6-o2, 7-co</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> ::  colamt(nlay,<a class="code" href="namespacemodule__radsw__parameters.html#a5bc6fbb4231281a604352eec6b8e2bfc">maxgas</a>)</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(npts)</span> :: ipseed</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nlay)</span> :: indfor, indself, jp, jt, jt1</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      <span class="keywordtype">integer</span> :: i, ib, ipt, j1, k, kk, laytrop, mb</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      lhswb  = <span class="keyword">present</span> ( hswb )</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      lhsw0  = <span class="keyword">present</span> ( hsw0 )</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      lflxprf= <span class="keyword">present</span> ( flxprf )</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      lfdncmp= <span class="keyword">present</span> ( fdncmp )</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">!      ***  s0, the solar constant at toa in w/m**2, is hard-coded with</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">!           each spectra band, the total flux is about 1368.22 w/m**2.</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      s0fac = solcon / <a class="code" href="group__module__radsw__main.html#ga244c149eb05c0675a7e040dbf7e2bc4b">s0</a></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      hswc(:,:) = f_zero</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      topflx = <a class="code" href="structmodule__radsw__parameters_1_1topfsw__type.html">topfsw_type</a>( f_zero, f_zero, f_zero )</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      sfcflx = <a class="code" href="structmodule__radsw__parameters_1_1sfcfsw__type.html">sfcfsw_type</a>( f_zero, f_zero, f_zero, f_zero )</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment">!! --- ...  initial optional outputs</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <span class="keywordflow">if</span> ( lflxprf ) <span class="keywordflow">then</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        flxprf = <a class="code" href="structmodule__radsw__parameters_1_1profsw__type.html">profsw_type</a>( f_zero, f_zero, f_zero, f_zero )</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      <span class="keywordflow">if</span> ( lfdncmp ) <span class="keywordflow">then</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        fdncmp = <a class="code" href="structmodule__radsw__parameters_1_1cmpfsw__type.html">cmpfsw_type</a>(f_zero,f_zero,f_zero,f_zero,f_zero,f_zero)</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      <span class="keywordflow">if</span> ( lhsw0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        hsw0(:,:) = f_zero</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      <span class="keywordflow">if</span> ( lhswb ) <span class="keywordflow">then</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        hswb(:,:,:) = f_zero</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      <span class="keywordflow">if</span>     ( isubcsw == 1 ) <span class="keywordflow">then</span>     <span class="comment">! advance prescribed permutation seed</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <span class="keywordflow">do</span> i = 1, npts</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;          ipseed(i) = <a class="code" href="group__module__radsw__main.html#gae1f88a0b60d69b892cfae83bb9ab67df">ipsdsw0</a> + i</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <span class="keywordflow">elseif</span> ( isubcsw == 2 ) <span class="keywordflow">then</span>     <span class="comment">! use input array of permutaion seeds</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="keywordflow">do</span> i = 1, npts</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;          ipseed(i) = icseed(i)</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      <span class="keywordflow">if</span> ( lprnt ) <span class="keywordflow">then</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        <span class="keyword">write</span>(0,*)<span class="stringliteral">&#39;  In radsw, isubcsw, ipsdsw0,ipseed =&#39;</span>,              &amp;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;     &amp;           isubcsw, <a class="code" href="group__module__radsw__main.html#gae1f88a0b60d69b892cfae83bb9ab67df">ipsdsw0</a>, ipseed</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">!  --- ...  loop over each daytime grid point</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      lab_do_ipt : <span class="keywordflow">do</span> ipt = 1, nday</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        j1 = idxday(ipt)</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        cosz1  = cosz(j1)</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        sntz1  = f_one / cosz(j1)</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        ssolar = s0fac * cosz(j1)</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        albbm(1) = sfcalb(j1,1)</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        albdf(1) = sfcalb(j1,2)</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        albbm(2) = sfcalb(j1,3)</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        albdf(2) = sfcalb(j1,4)</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">!           the vertical index of internal array is from surface to top</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">if</span> (ivflip == 0) <span class="keywordflow">then</span>       <span class="comment">! input from toa to sfc</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;          tem1 = 100.0 * con_g</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;          tem2 = 1.0e-20 * 1.0e3 * con_avgd</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            kk = nlp1 - k</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            pavel(k) = plyr(j1,kk)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            tavel(k) = tlyr(j1,kk)</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            delp(k) = plvl(j1,kk+1) - plvl(j1,kk)</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">!test use</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">!           h2ovmr(k)= max(f_zero,qlyr(j1,kk)*amdw)                     ! input mass mixing ratio</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment">!           h2ovmr(k)= max(f_zero,qlyr(j1,kk))                          ! input vol mixing ratio</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment">!           o3vmr (k)= max(f_zero,olyr(j1,kk))                          ! input vol mixing ratio</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="comment">!ncep model use</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            h2ovmr(k)= max(f_zero,qlyr(j1,kk)*amdw/(f_one-qlyr(j1,kk))) <span class="comment">! input specific humidity</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            o3vmr(k)= max(f_zero,olyr(j1,kk)*amdo3)                    <span class="comment">! input mass mixing ratio</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            tem0 = (f_one - h2ovmr(k))*con_amd + h2ovmr(k)*con_amw</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            coldry(k) = tem2 * delp(k) / (tem1*tem0*(f_one + h2ovmr(k)))</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            temcol(k) = 1.0e-12 * coldry(k)</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            colamt(k,1) = max(f_zero,    coldry(k)*h2ovmr(k))         <span class="comment">! h2o</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            colamt(k,2) = max(temcol(k), coldry(k)*gasvmr(j1,kk,1))   <span class="comment">! co2</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;            colamt(k,3) = max(f_zero,    coldry(k)*o3vmr(k))          <span class="comment">! o3</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            colmol(k)   = coldry(k) + colamt(k,1)</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">!  --- ...  set up gas column amount, convert from volume mixing ratio</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">!           to molec/cm2 based on coldry (scaled to 1.0e-20)</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;          <span class="keywordflow">if</span> (iswrgas &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;              kk = nlp1 - k</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;              colamt(k,4) = max(temcol(k), coldry(k)*gasvmr(j1,kk,2))  <span class="comment">! n2o</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;              colamt(k,5) = max(temcol(k), coldry(k)*gasvmr(j1,kk,3))  <span class="comment">! ch4</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;              colamt(k,6) = max(temcol(k), coldry(k)*gasvmr(j1,kk,4))  <span class="comment">! o2</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">!             colamt(k,7) = max(temcol(k), coldry(k)*gasvmr(j1,kk,5))  ! co - notused</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;              colamt(k,4) = temcol(k)                                  <span class="comment">! n2o</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;              colamt(k,5) = temcol(k)                                  <span class="comment">! ch4</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;              colamt(k,6) = temcol(k)                                  <span class="comment">! o2</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment">!             colamt(k,7) = temcol(k)                                  ! co - notused</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            kk = nlp1 - k</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;              tauae(k,ib) = aerosols(j1,kk,ib,1)</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;              ssaae(k,ib) = aerosols(j1,kk,ib,2)</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;              asyae(k,ib) = aerosols(j1,kk,ib,3)</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;          <span class="keywordflow">if</span> (iswcliq &gt; 0) <span class="keywordflow">then</span>    <span class="comment">! use prognostic cloud method</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;              kk = nlp1 - k</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;              cfrac(k) = clouds(j1,kk,1)      <span class="comment">! cloud fraction</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;              cliqp(k) = clouds(j1,kk,2)      <span class="comment">! cloud liq path</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;              reliq(k) = clouds(j1,kk,3)      <span class="comment">! liq partical effctive radius</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;              cicep(k) = clouds(j1,kk,4)      <span class="comment">! cloud ice path</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;              reice(k) = clouds(j1,kk,5)      <span class="comment">! ice partical effctive radius</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;              cdat1(k) = clouds(j1,kk,6)      <span class="comment">! cloud rain drop path</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;              cdat2(k) = clouds(j1,kk,7)      <span class="comment">! rain partical effctive radius</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;              cdat3(k) = clouds(j1,kk,8)      <span class="comment">! cloud snow path</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;              cdat4(k) = clouds(j1,kk,9)      <span class="comment">! snow partical effctive radius</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;          <span class="keywordflow">else</span>                     <span class="comment">! use diagnostic cloud method</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;              kk = nlp1 - k</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;              cfrac(k) = clouds(j1,kk,1)      <span class="comment">! cloud fraction</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;              cdat1(k) = clouds(j1,kk,2)      <span class="comment">! cloud optical depth</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;              cdat2(k) = clouds(j1,kk,3)      <span class="comment">! cloud single scattering albedo</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;              cdat3(k) = clouds(j1,kk,4)      <span class="comment">! cloud asymmetry factor</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="keywordflow">          endif</span>                    <span class="comment">! end if_iswcliq</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        <span class="keywordflow">else</span>                        <span class="comment">! input from sfc to toa</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;          tem1 = 100.0 * con_g</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;          tem2 = 1.0e-20 * 1.0e3 * con_avgd</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            pavel(k) = plyr(j1,k)</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            tavel(k) = tlyr(j1,k)</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;            delp(k) = plvl(j1,k) - plvl(j1,k+1)</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">!  --- ...  set absorber amount</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment">!test use</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">!           h2ovmr(k)= max(f_zero,qlyr(j1,k)*amdw)                    ! input mass mixing ratio</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">!           h2ovmr(k)= max(f_zero,qlyr(j1,k))                         ! input vol mixing ratio</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment">!           o3vmr (k)= max(f_zero,olyr(j1,k))                         ! input vol mixing ratio</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">!ncep model use</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            h2ovmr(k)= max(f_zero,qlyr(j1,k)*amdw/(f_one-qlyr(j1,k))) <span class="comment">! input specific humidity</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;            o3vmr(k)= max(f_zero,olyr(j1,k)*amdo3)                   <span class="comment">! input mass mixing ratio</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;            tem0 = (f_one - h2ovmr(k))*con_amd + h2ovmr(k)*con_amw</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;            coldry(k) = tem2 * delp(k) / (tem1*tem0*(f_one + h2ovmr(k)))</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;            temcol(k) = 1.0e-12 * coldry(k)</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;            colamt(k,1) = max(f_zero,    coldry(k)*h2ovmr(k))         <span class="comment">! h2o</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            colamt(k,2) = max(temcol(k), coldry(k)*gasvmr(j1,k,1))    <span class="comment">! co2</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            colamt(k,3) = max(f_zero,    coldry(k)*o3vmr(k))          <span class="comment">! o3</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            colmol(k)   = coldry(k) + colamt(k,1)</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;          <span class="keywordflow">if</span> (lprnt) <span class="keywordflow">then</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            <span class="keywordflow">if</span> (ipt == 1) <span class="keywordflow">then</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;              <span class="keyword">write</span>(0,*)<span class="stringliteral">&#39; pavel=&#39;</span>,pavel</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;              <span class="keyword">write</span>(0,*)<span class="stringliteral">&#39; tavel=&#39;</span>,tavel</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;              <span class="keyword">write</span>(0,*)<span class="stringliteral">&#39; delp=&#39;</span>,delp</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;              <span class="keyword">write</span>(0,*)<span class="stringliteral">&#39; h2ovmr=&#39;</span>,h2ovmr*1000</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;              <span class="keyword">write</span>(0,*)<span class="stringliteral">&#39; o3vmr=&#39;</span>,o3vmr*1000000</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">!  --- ...  set up gas column amount, convert from volume mixing ratio</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment">!           to molec/cm2 based on coldry (scaled to 1.0e-20)</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;          <span class="keywordflow">if</span> (iswrgas &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;              colamt(k,4) = max(temcol(k), coldry(k)*gasvmr(j1,k,2))  <span class="comment">! n2o</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;              colamt(k,5) = max(temcol(k), coldry(k)*gasvmr(j1,k,3))  <span class="comment">! ch4</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;              colamt(k,6) = max(temcol(k), coldry(k)*gasvmr(j1,k,4))  <span class="comment">! o2</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">!             colamt(k,7) = max(temcol(k), coldry(k)*gasvmr(j1,k,5))  ! co - notused</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;              colamt(k,4) = temcol(k)                                 <span class="comment">! n2o</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;              colamt(k,5) = temcol(k)                                 <span class="comment">! ch4</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;              colamt(k,6) = temcol(k)                                 <span class="comment">! o2</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">!             colamt(k,7) = temcol(k)                                 ! co - notused</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">!  --- ...  set aerosol optical properties</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;          <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;              tauae(k,ib) = aerosols(j1,k,ib,1)</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;              ssaae(k,ib) = aerosols(j1,k,ib,2)</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;              asyae(k,ib) = aerosols(j1,k,ib,3)</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;          <span class="keywordflow">if</span> (iswcliq &gt; 0) <span class="keywordflow">then</span>    <span class="comment">! use prognostic cloud method</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;              cfrac(k) = clouds(j1,k,1)       <span class="comment">! cloud fraction</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;              cliqp(k) = clouds(j1,k,2)       <span class="comment">! cloud liq path</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;              reliq(k) = clouds(j1,k,3)       <span class="comment">! liq partical effctive radius</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;              cicep(k) = clouds(j1,k,4)       <span class="comment">! cloud ice path</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;              reice(k) = clouds(j1,k,5)       <span class="comment">! ice partical effctive radius</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;              cdat1(k) = clouds(j1,k,6)       <span class="comment">! cloud rain drop path</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;              cdat2(k) = clouds(j1,k,7)       <span class="comment">! rain partical effctive radius</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;              cdat3(k) = clouds(j1,k,8)       <span class="comment">! cloud snow path</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;              cdat4(k) = clouds(j1,k,9)       <span class="comment">! snow partical effctive radius</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;          <span class="keywordflow">else</span>                     <span class="comment">! use diagnostic cloud method</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;              cfrac(k) = clouds(j1,k,1)       <span class="comment">! cloud fraction</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;              cdat1(k) = clouds(j1,k,2)       <span class="comment">! cloud optical depth</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;              cdat2(k) = clouds(j1,k,3)       <span class="comment">! cloud single scattering albedo</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;              cdat3(k) = clouds(j1,k,4)       <span class="comment">! cloud asymmetry factor</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="keywordflow">          endif</span>                    <span class="comment">! end if_iswcliq</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="keywordflow">        endif</span>                       <span class="comment">! if_ivflip</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        zcf0   = f_one</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        zcf1   = f_one</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        <span class="keywordflow">if</span> (iovrsw == 0) <span class="keywordflow">then</span>                    <span class="comment">! random overlapping</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            zcf0 = zcf0 * (f_one - cfrac(k))</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iovrsw == 1) <span class="keywordflow">then</span>               <span class="comment">! max/ran overlapping</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            <span class="keywordflow">if</span> (cfrac(k) &gt; ftiny) <span class="keywordflow">then</span>                <span class="comment">! cloudy layer</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;              zcf1 = min( zcf1, f_one-cfrac(k) )</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            <span class="keywordflow">elseif</span> (zcf1 &lt; f_one) <span class="keywordflow">then</span>                <span class="comment">! clear layer</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;              zcf0 = zcf0 * zcf1</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;              zcf1 = f_one</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;          zcf0 = zcf0 * zcf1</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iovrsw == 2) <span class="keywordflow">then</span>               <span class="comment">! maximum overlapping</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            zcf0 = min( zcf0, f_one-cfrac(k) )</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        <span class="keywordflow">if</span> (zcf0 &lt;= ftiny) zcf0 = f_zero</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        <span class="keywordflow">if</span> (zcf0 &gt; oneminus) zcf0 = f_one</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        zcf1 = f_one - zcf0</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        <span class="keywordflow">if</span> (zcf1 &gt; f_zero) <span class="keywordflow">then</span>     <span class="comment">! cloudy sky column</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;          <span class="keyword">call </span><a class="code" href="group__module__radsw__main.html#ga89ca572fa54a63a21009caa0760d405b">cldprop</a>                                                  &amp;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;     &amp;     ( cfrac,cliqp,reliq,cicep,reice,cdat1,cdat2,cdat3,cdat4,     &amp;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;     &amp;       zcf1, nlay, ipseed(j1),                                    &amp;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;     &amp;       taucw, ssacw, asycw, cldfrc, cldfmc                        &amp;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;     &amp;     )</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <span class="keywordflow">else</span>                        <span class="comment">! clear sky column</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;          cldfrc(:)  = f_zero</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;          cldfmc(:,:)= f_zero</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;          <span class="keywordflow">do</span> i = 1, nbdsw</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;              taucw(k,i) = f_zero</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;              ssacw(k,i) = f_zero</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;              asycw(k,i) = f_zero</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="keywordflow">        endif</span>   <span class="comment">! end if_zcf1_block</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;          clouds(j1,k,10) = taucw(k,10)</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="keywordflow">        end do</span> </div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        <span class="keyword">call </span><a class="code" href="group__module__radsw__main.html#ga5eb9918ebc222138a9dad016440e1a74">setcoef</a>                                                    &amp;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;     &amp;     ( pavel,tavel,h2ovmr, nlay,nlp1,                             &amp;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;     &amp;       laytrop,jp,jt,jt1,fac00,fac01,fac10,fac11,                 &amp;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;     &amp;       selffac,selffrac,indself,forfac,forfrac,indfor             &amp;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;     &amp;     )</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        <span class="keyword">call </span><a class="code" href="group__module__radsw__main.html#gaa82121d21c1e8f2ca938378249fea135">taumol</a>                                                     &amp;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;     &amp;     ( colamt,colmol,fac00,fac01,fac10,fac11,jp,jt,jt1,laytrop,   &amp;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;     &amp;       forfac,forfrac,indfor,selffac,selffrac,indself, nlay,      &amp;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;     &amp;       sfluxzen, taug, taur                                       &amp;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;     &amp;     )</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        <span class="keywordflow">if</span> ( isubcsw &lt;= 0 ) <span class="keywordflow">then</span>     <span class="comment">! use standard cloud scheme</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;          <span class="keyword">call </span><a class="code" href="group__module__radsw__main.html#gaeb992f35bdf7dbf9ea8709d7d91dedfd">spcvrtc</a>                                                  &amp;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;     &amp;     ( ssolar,cosz1,sntz1,albbm,albdf,sfluxzen,cldfrc,            &amp;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;     &amp;       zcf1,zcf0,taug,taur,tauae,ssaae,asyae,taucw,ssacw,asycw,   &amp;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;     &amp;       nlay, nlp1,                                                &amp;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;     &amp;       fxupc,fxdnc,fxup0,fxdn0,                                   &amp;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;     &amp;       ftoauc,ftoau0,ftoadc,fsfcuc,fsfcu0,fsfcdc,fsfcd0,          &amp;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;     &amp;       sfbmc,sfdfc,sfbm0,sfdf0,suvbfc,suvbf0                      &amp;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;     &amp;     )</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <span class="keywordflow">else</span>                         <span class="comment">! use mcica cloud scheme</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;          <span class="keyword">call </span><a class="code" href="group__module__radsw__main.html#ga859cc14063a58e9d0a252e4366b9fff3">spcvrtm</a>                                                  &amp;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;     &amp;     ( ssolar,cosz1,sntz1,albbm,albdf,sfluxzen,cldfmc,            &amp;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;     &amp;       zcf1,zcf0,taug,taur,tauae,ssaae,asyae,taucw,ssacw,asycw,   &amp;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;     &amp;       nlay, nlp1,                                                &amp;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;     &amp;       fxupc,fxdnc,fxup0,fxdn0,                                   &amp;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;     &amp;       ftoauc,ftoau0,ftoadc,fsfcuc,fsfcu0,fsfcdc,fsfcd0,          &amp;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;     &amp;       sfbmc,sfdfc,sfbm0,sfdf0,suvbfc,suvbf0                      &amp;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;     &amp;     )</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment">!  --- ...  sum up total spectral fluxes for total-sky</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;          flxuc(k) = f_zero</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          flxdc(k) = f_zero</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;          <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            flxuc(k) = flxuc(k) + fxupc(k,ib)</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            flxdc(k) = flxdc(k) + fxdnc(k,ib)</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment">!! --- ...  optional clear sky fluxes</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        <span class="keywordflow">if</span> ( lhsw0 .or. lflxprf ) <span class="keywordflow">then</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;          <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;            flxu0(k) = f_zero</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;            flxd0(k) = f_zero</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;            <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;              flxu0(k) = flxu0(k) + fxup0(k,ib)</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;              flxd0(k) = flxd0(k) + fxdn0(k,ib)</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment">!  --- ...  prepare for final outputs</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;          rfdelp(k) = <a class="code" href="group__module__radsw__main.html#gaad60e753cdda20d4e84d063280f0dfcc">heatfac</a> / delp(k)</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <span class="keywordflow">if</span> ( lfdncmp ) <span class="keywordflow">then</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="comment">!! --- ...  optional uv-b surface downward flux</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;          fdncmp(j1)%uvbf0 = suvbf0</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;          fdncmp(j1)%uvbfc = suvbfc</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment">!! --- ...  optional beam and diffuse sfc fluxes</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;          fdncmp(j1)%nirbm = sfbmc(1)</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;          fdncmp(j1)%nirdf = sfdfc(1)</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;          fdncmp(j1)%visbm = sfbmc(2)</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;          fdncmp(j1)%visdf = sfdfc(2)</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="keywordflow">        endif</span>    <span class="comment">! end if_lfdncmp</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">!  --- ...  toa and sfc fluxes</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        topflx(j1)%upfxc = ftoauc</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;        topflx(j1)%dnfxc = ftoadc</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;        topflx(j1)%upfx0 = ftoau0</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;        sfcflx(j1)%upfxc = fsfcuc</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        sfcflx(j1)%dnfxc = fsfcdc</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        sfcflx(j1)%upfx0 = fsfcu0</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        sfcflx(j1)%dnfx0 = fsfcd0</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        <span class="keywordflow">if</span> (ivflip == 0) <span class="keywordflow">then</span>       <span class="comment">! output from toa to sfc</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="comment">!  --- ...  compute heating rates</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;          fnet(1) = flxdc(1) - flxuc(1)</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;          <span class="keywordflow">do</span> k = 2, nlp1</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;            kk = nlp1 - k + 1</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;            fnet(k) = flxdc(k) - flxuc(k)</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;            hswc(j1,kk) = (fnet(k)-fnet(k-1)) * rfdelp(k-1)</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment">!! --- ...  optional flux profiles</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;          <span class="keywordflow">if</span> ( lflxprf ) <span class="keywordflow">then</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;            <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;              kk = nlp1 - k + 1</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;              flxprf(j1,kk)%upfxc = flxuc(k)</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;              flxprf(j1,kk)%dnfxc = flxdc(k)</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;              flxprf(j1,kk)%upfx0 = flxu0(k)</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;              flxprf(j1,kk)%dnfx0 = flxd0(k)</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment">!! --- ...  optional clear sky heating rates</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;          <span class="keywordflow">if</span> ( lhsw0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;            fnet(1) = flxd0(1) - flxu0(1)</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;            <span class="keywordflow">do</span> k = 2, nlp1</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;              kk = nlp1 - k + 1</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;              fnet(k) = flxd0(k) - flxu0(k)</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;              hsw0(j1,kk) = (fnet(k)-fnet(k-1)) * rfdelp(k-1)</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">!! --- ...  optional spectral band heating rates</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;          <span class="keywordflow">if</span> ( lhswb ) <span class="keywordflow">then</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;            <span class="keywordflow">do</span> mb = 1, nbdsw</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;              fnet(1) = fxdnc(1,mb) - fxupc(1,mb)</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;              <span class="keywordflow">do</span> k = 2, nlp1</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                kk = nlp1 - k + 1</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                fnet(k) = fxdnc(k,mb) - fxupc(k,mb)</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                hswb(j1,kk,mb) = (fnet(k) - fnet(k-1)) * rfdelp(k-1)</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <span class="keywordflow">else</span>                        <span class="comment">! output from sfc to toa</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment">!  --- ...  compute heating rates</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;          fnet(1) = flxdc(1) - flxuc(1)</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;          <span class="keywordflow">do</span> k = 2, nlp1</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            fnet(k) = flxdc(k) - flxuc(k)</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            hswc(j1,k-1) = (fnet(k)-fnet(k-1)) * rfdelp(k-1)</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment">!! --- ...  optional flux profiles</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;          <span class="keywordflow">if</span> ( lflxprf ) <span class="keywordflow">then</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;            <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;              flxprf(j1,k)%upfxc = flxuc(k)</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;              flxprf(j1,k)%dnfxc = flxdc(k)</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;              flxprf(j1,k)%upfx0 = flxu0(k)</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;              flxprf(j1,k)%dnfx0 = flxd0(k)</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment">!! --- ...  optional clear sky heating rates</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;          <span class="keywordflow">if</span> ( lhsw0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;            fnet(1) = flxd0(1) - flxu0(1)</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;            <span class="keywordflow">do</span> k = 2, nlp1</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;              fnet(k) = flxd0(k) - flxu0(k)</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;              hsw0(j1,k-1) = (fnet(k)-fnet(k-1)) * rfdelp(k-1)</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="comment">!! --- ...  optional spectral band heating rates</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;          <span class="keywordflow">if</span> ( lhswb ) <span class="keywordflow">then</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;            <span class="keywordflow">do</span> mb = 1, nbdsw</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;              fnet(1) = fxdnc(1,mb) - fxupc(1,mb)</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;              <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                fnet(k+1) = fxdnc(k+1,mb) - fxupc(k+1,mb)</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                hswb(j1,k,mb) = (fnet(k+1) - fnet(k)) * rfdelp(k)</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="keywordflow">        endif</span>                       <span class="comment">! if_ivflip</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="keywordflow">      enddo</span>   lab_do_ipt</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radsw__main.html#ga784397878835a8cdd0b14a7b9eafb4e3">swrad</a></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radsw__main.html#ga5b0d35149515607d94f42b6ee5a40665">rswinit</a>                                                &amp;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;     &amp;     ( me ) <span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01379"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#ga5b0d35149515607d94f42b6ee5a40665"> 1379</a></span>&#160;<span class="comment">!  ---  outputs: (none)</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment">!  ===================  program usage description  ===================  !</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment">! purpose:  initialize non-varying module variables, conversion factors,!</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment">! and look-up tables.                                                   !</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">! subprograms called:  none                                             !</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">!  inputs:                                                              !</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment">!    me       - print control for parallel process                      !</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment">!  outputs: (none)                                                      !</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment">!  external module variables:  (in physparam)                           !</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment">!   iswrate - heating rate unit selections                              !</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment">!           =1: output in k/day                                         !</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="comment">!           =2: output in k/second                                      !</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="comment">!   iswrgas - control flag for rare gases (ch4,n2o,o2, etc.)            !</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="comment">!           =0: do not include rare gases                               !</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment">!           &gt;0: include all rare gases                                  !</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="comment">!   iswcliq - liquid cloud optical properties contrl flag               !</span></div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment">!           =0: input cloud opt depth from diagnostic scheme            !</span></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="comment">!           &gt;0: input cwp,rew, and other cloud content parameters       !</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="comment">!   isubcsw - sub-column cloud approximation control flag               !</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment">!           =0: no sub-col cld treatment, use grid-mean cld quantities  !</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="comment">!           =1: mcica sub-col, prescribed seeds to get random numbers   !</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="comment">!           =2: mcica sub-col, providing array icseed for random numbers!</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment">!   icldflg - cloud scheme control flag                                 !</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment">!           =0: diagnostic scheme gives cloud tau, omiga, and g.        !</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment">!           =1: prognostic scheme gives cloud liq/ice path, etc.        !</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">!   iovrsw  - clouds vertical overlapping control flag                  !</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment">!           =0: random overlapping clouds                               !</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="comment">!           =1: maximum/random overlapping clouds                       !</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="comment">!           =2: maximum overlap cloud                                   !</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="comment">!   iswmode - control flag for 2-stream transfer scheme                 !</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="comment">!           =1; delta-eddington    (joseph et al., 1976)                !</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment">!           =2: pifm               (zdunkowski et al., 1980)            !</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="comment">!           =3: discrete ordinates (liou, 1973)                         !</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment">! definitions:                                                          !</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="comment">!     arrays for 10000-point look-up tables:                            !</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="comment">!     tau_tbl  clear-sky optical depth                                  !</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="comment">!     exp_tbl  exponential lookup table for transmittance               !</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="comment">!  ======================  end of description block  =================  !</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: me</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment">!  ---  outputs: none</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: expeps = 1.e-20</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;      <span class="keywordtype">integer</span> :: i</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tfn, tau</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      <span class="keywordflow">if</span> ( iovrsw&lt;0 .or. iovrsw&gt;2 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        print *,<span class="stringliteral">&#39;  *** Error in specification of cloud overlap flag&#39;</span>,   &amp;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;     &amp;          <span class="stringliteral">&#39; IOVRSW=&#39;</span>,iovrsw,<span class="stringliteral">&#39; in RSWINIT !!&#39;</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        stop</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      <span class="keywordflow">if</span> (me == 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        print *,<span class="stringliteral">&#39; - Using AER Shortwave Radiation, Version: &#39;</span>,vtagsw</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="keywordflow">if</span> (iswmode == 1) <span class="keywordflow">then</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;          print *,<span class="stringliteral">&#39;   --- Delta-eddington 2-stream transfer scheme&#39;</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iswmode == 2) <span class="keywordflow">then</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;          print *,<span class="stringliteral">&#39;   --- PIFM 2-stream transfer scheme&#39;</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iswmode == 3) <span class="keywordflow">then</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;          print *,<span class="stringliteral">&#39;   --- Discrete ordinates 2-stream transfer scheme&#39;</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        <span class="keywordflow">if</span> (iswrgas &lt;= 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;          print *,<span class="stringliteral">&#39;   --- Rare gases absorption is NOT included in SW&#39;</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;          print *,<span class="stringliteral">&#39;   --- Include rare gases N2O, CH4, O2, absorptions&#39;</span>,&amp;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;     &amp;            <span class="stringliteral">&#39; in SW&#39;</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        <span class="keywordflow">if</span> ( isubcsw == 0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;          print *,<span class="stringliteral">&#39;   --- Using standard grid average clouds, no &#39;</span>,     &amp;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;     &amp;            <span class="stringliteral">&#39;sub-column clouds approximation applied&#39;</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        <span class="keywordflow">elseif</span> ( isubcsw == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;          print *,<span class="stringliteral">&#39;   --- Using MCICA sub-colum clouds approximation &#39;</span>, &amp;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;     &amp;            <span class="stringliteral">&#39;with a prescribed sequence of permutation seeds&#39;</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        <span class="keywordflow">elseif</span> ( isubcsw == 2 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;          print *,<span class="stringliteral">&#39;   --- Using MCICA sub-colum clouds approximation &#39;</span>, &amp;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;     &amp;            <span class="stringliteral">&#39;with provided input array of permutation seeds&#39;</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;          print *,<span class="stringliteral">&#39;  *** Error in specification of sub-column cloud &#39;</span>,  &amp;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;     &amp;            <span class="stringliteral">&#39; control flag isubcsw =&#39;</span>,isubcsw,<span class="stringliteral">&#39; !!&#39;</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;          stop</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="comment">!  --- ...  check cloud flags for consistency</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      <span class="keywordflow">if</span> ((icldflg == 0 .and. iswcliq /= 0) .or.                        &amp;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;     &amp;    (icldflg == 1 .and. iswcliq == 0)) <span class="keywordflow">then</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        print *,<span class="stringliteral">&#39;  *** Model cloud scheme inconsistent with SW&#39;</span>,        &amp;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;     &amp;          <span class="stringliteral">&#39; radiation cloud radiative property setup !!&#39;</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        stop</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment">!  --- ...  setup constant factors for heating rate</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="comment">!           the 1.0e-2 is to convert pressure from mb to N/m**2</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      <span class="keywordflow">if</span> (iswrate == 1) <span class="keywordflow">then</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="comment">!       heatfac = 8.4391</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment">!       heatfac = con_g * 86400. * 1.0e-2 / con_cp  !   (in k/day)</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        <a class="code" href="group__module__radsw__main.html#gaad60e753cdda20d4e84d063280f0dfcc">heatfac</a> = con_g * 864.0 / con_cp            <span class="comment">!   (in k/day)</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        <a class="code" href="group__module__radsw__main.html#gaad60e753cdda20d4e84d063280f0dfcc">heatfac</a> = con_g * 1.0e-2 / con_cp           <span class="comment">!   (in k/second)</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">!  --- ...  define exponential lookup tables for transmittance. tau is</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">!           computed as a function of the tau transition function, and</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment">!           transmittance is calculated as a function of tau.  all tables</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment">!           are computed at intervals of 0.0001.  the inverse of the</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="comment">!           constant used in the Pade approximation to the tau transition</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="comment">!           function is set to bpade.</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(0) = 1.0</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>) = expeps</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      <span class="keywordflow">do</span> i = 1, <a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>-1</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        tfn = float(i) / float(<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>-i)</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        tau = <a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> * tfn</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(i) = exp( -tau )</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radsw__main.html#ga5b0d35149515607d94f42b6ee5a40665">rswinit</a></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radsw__main.html#ga89ca572fa54a63a21009caa0760d405b">cldprop</a>                                                &amp;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;     &amp;     ( cfrac,cliqp,reliq,cicep,reice,cdat1,cdat2,cdat3,cdat4,     &amp;   <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;     &amp;       cf1, nlay, ipseed,                                         &amp;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;     &amp;       taucw, ssacw, asycw, cldfrc, cldfmc                        &amp;   <span class="comment">!  ---  output</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;     &amp;     )</div><div class="line"><a name="l01568"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#ga89ca572fa54a63a21009caa0760d405b"> 1568</a></span>&#160;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="comment">!  ===================  program usage description  ===================  !</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="comment">! Purpose: Compute the cloud optical properties for each cloudy layer   !</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="comment">! and g-point interval.                                                 !</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment">! subprograms called:  none                                             !</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">!  inputs:                                                        size  !</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="comment">!    cfrac - real, layer cloud fraction                            nlay !</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment">!        .....  for  iswcliq &gt; 0 (prognostic cloud sckeme)  - - -       !</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="comment">!    cliqp - real, layer in-cloud liq water path (g/m**2)          nlay !</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="comment">!    reliq - real, mean eff radius for liq cloud (micron)          nlay !</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="comment">!    cicep - real, layer in-cloud ice water path (g/m**2)          nlay !</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="comment">!    reice - real, mean eff radius for ice cloud (micron)          nlay !</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="comment">!    cdat1 - real, layer rain drop water path (g/m**2)             nlay !</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="comment">!    cdat2 - real, effective radius for rain drop (micron)         nlay !</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="comment">!    cdat3 - real, layer snow flake water path(g/m**2)             nlay !</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="comment">!    cdat4 - real, mean eff radius for snow flake(micron)          nlay !</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="comment">!        .....  for iswcliq = 0  (diagnostic cloud sckeme)  - - -       !</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;<span class="comment">!    cdat1 - real, layer cloud optical depth                       nlay !</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="comment">!    cdat2 - real, layer cloud single scattering albedo            nlay !</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="comment">!    cdat3 - real, layer cloud asymmetry factor                    nlay !</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="comment">!    cdat4 - real, optional use                                    nlay !</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment">!    cliqp - real, not used                                        nlay !</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment">!    cicep - real, not used                                        nlay !</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment">!    reliq - real, not used                                        nlay !</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">!    reice - real, not used                                        nlay !</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="comment">!    cf1   - real, effective total cloud cover at surface           1   !</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="comment">!    nlay  - integer, vertical layer number                         1   !</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="comment">!    ipseed- permutation seed for generating random numbers (isubcsw&gt;0) !</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment">!  outputs:                                                             !</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment">!    taucw  - real, cloud optical depth, w/o delta scaled    nlay*nbdsw !</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">!    ssacw  - real, weighted cloud single scattering albedo  nlay*nbdsw !</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment">!                             (ssa = ssacw / taucw)                     !</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment">!    asycw  - real, weighted cloud asymmetry factor          nlay*nbdsw !</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment">!                             (asy = asycw / ssacw)                     !</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment">!    cldfrc - real, cloud fraction of grid mean value              nlay !</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="comment">!    cldfmc - real, cloud fraction for each sub-column       nlay*ngptsw!</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="comment">!  explanation of the method for each value of iswcliq, and iswcice.    !</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="comment">!  set up in module &quot;physparam&quot;                                         !</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment">!     iswcliq=0  : input cloud optical property (tau, ssa, asy).        !</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment">!                  (used for diagnostic cloud method)                   !</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment">!     iswcliq&gt;0  : input cloud liq/ice path and effective radius, also  !</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment">!                  require the user of &#39;iswcice&#39; to specify the method  !</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="comment">!                  used to compute aborption due to water/ice parts.    !</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="comment">!  ...................................................................  !</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment">!     iswcliq=1  : liquid water cloud optical properties are computed   !</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment">!                  as in hu and stamnes (1993), j. clim., 6, 728-742.   !</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">!     iswcice used only when iswcliq &gt; 0                                !</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment">!                  the cloud ice path (g/m2) and ice effective radius   !</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="comment">!                  (microns) are inputs.                                !</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="comment">!     iswcice=1  : ice cloud optical properties are computed as in      !</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="comment">!                  ebert and curry (1992), jgr, 97, 3831-3836.          !</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="comment">!     iswcice=2  : ice cloud optical properties are computed as in      !</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="comment">!                  streamer v3.0 (2001), key, streamer user&#39;s guide,    !</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="comment">!                  cooperative institude for meteorological studies,95pp!</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="comment">!     iswcice=3  : ice cloud optical properties are computed as in      !</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="comment">!                  fu (1996), j. clim., 9.                              !</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="comment">!  other cloud control module variables:                                !</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="comment">!     isubcsw =0: standard cloud scheme, no sub-col cloud approximation !</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="comment">!             &gt;0: mcica sub-col cloud scheme using ipseed as permutation!</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="comment">!                 seed for generating rundom numbers                    !</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment">!  ======================  end of description block  =================  !</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__cldprtb.html">module_radsw_cldprtb</a></div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, ipseed</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: cf1</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(in)</span> :: cliqp,      &amp;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;     &amp;       reliq, cicep, reice, cdat1, cdat2, cdat3, cdat4, cfrac</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,ngptsw)</span>, <span class="keywordtype">intent(out)</span> ::     &amp;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;     &amp;       cldfmc</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,nbdsw)</span>,  <span class="keywordtype">intent(out)</span> ::     &amp;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;     &amp;       taucw, ssacw, asycw</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(out)</span> :: cldfrc</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nblow:nbhgh)</span> :: tauliq, tauice,  &amp;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;     &amp;       ssaliq, ssaice, ssaran, ssasnw, asyliq, asyice,            &amp;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;     &amp;       asyran, asysnw</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>       :: cldf</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: dgeice, factor, fint, tauran, tausnw,    &amp;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;     &amp;       cldliq, refliq, cldice, refice, cldran, cldsnw, refsnw,    &amp;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;     &amp;       extcoliq, ssacoliq, asycoliq, extcoice, ssacoice, asycoice,&amp;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;     &amp;       dgesnw</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;      <span class="keywordtype">logical</span> :: lcloudy(nlay,<a class="code" href="namespacemodule__radsw__parameters.html#adc3e4d5a848d50e2883e05c62f61bc97">ngptsw</a>)</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      <span class="keywordtype">integer</span> :: ia, ib, ig, jb, k, index</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;          taucw(k,ib) = f_zero</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;          ssacw(k,ib) = f_one</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;          asycw(k,ib) = f_zero</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;      lab_if_iswcliq : <span class="keywordflow">if</span> (iswcliq &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;        lab_do_k : <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;          lab_if_cld : <span class="keywordflow">if</span> (cfrac(k) &gt; ftiny) <span class="keywordflow">then</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;            cldran = cdat1(k)</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="comment">!           refran = cdat2(k)</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;            cldsnw = cdat3(k)</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;            refsnw = cdat4(k)</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;            dgesnw = 1.0315 * refsnw        <span class="comment">! for fu&#39;s snow formula</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;            tauran = cldran * <a class="code" href="namespacemodule__radsw__cldprtb.html#a0fdb9425031a10735e11d7f5c9e0376e">a0r</a></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="comment">!  ---  if use fu&#39;s formula it needs to be normalized by snow/ice density</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="comment">!       !not use snow density = 0.1 g/cm**3 = 0.1 g/(mu * m**2)</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="comment">!       use ice density = 0.9167 g/cm**3 = 0.9167 g/(mu * m**2)</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="comment">!       1/0.9167 = 1.09087</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;<span class="comment">!       factor 1.5396=8/(3*sqrt(3)) converts reff to generalized ice particle size</span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="comment">!       use newer factor value 1.0315</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;            <span class="keywordflow">if</span> (cldsnw&gt;f_zero .and. refsnw&gt;10.0_kind_phys) <span class="keywordflow">then</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="comment">!             tausnw = cldsnw * (a0s + a1s/refsnw)</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;              tausnw = cldsnw*1.09087*(<a class="code" href="namespacemodule__radsw__cldprtb.html#a81ba576e28e5844772d040ff7543faae">a0s</a> + a1s/dgesnw)     <span class="comment">! fu&#39;s formula</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;              tausnw = f_zero</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;            <span class="keywordflow">do</span> ib = <a class="code" href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">nblow</a>, <a class="code" href="namespacemodule__radsw__parameters.html#a39e5ca4fd5defbc2545ee39bbf50d61b">nbhgh</a></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;              ssaran(ib) = tauran * (f_one - <a class="code" href="namespacemodule__radsw__cldprtb.html#ac39d49e73ffa960421e36e45a35db162">b0r</a>(ib))</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;              ssasnw(ib) = tausnw * (f_one - (<a class="code" href="namespacemodule__radsw__cldprtb.html#a391fbdda62f6fba95e105c2041e16880">b0s</a>(ib)+b1s(ib)*dgesnw))</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;              asyran(ib) = ssaran(ib) * <a class="code" href="namespacemodule__radsw__cldprtb.html#a8927b6e7cc810301e3843eb0f5c0c795">c0r</a>(ib)</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;              asysnw(ib) = ssasnw(ib) * <a class="code" href="namespacemodule__radsw__cldprtb.html#aab7693c5f31ce2182bca61aff77996bc">c0s</a>(ib)</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;            cldliq = cliqp(k)</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;            cldice = cicep(k)</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;            refliq = reliq(k)</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;            refice = reice(k)</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="comment">!  --- ...  calculation of absorption coefficients due to water clouds.</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            <span class="keywordflow">if</span> ( cldliq &lt;= f_zero ) <span class="keywordflow">then</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;              <span class="keywordflow">do</span> ib = <a class="code" href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">nblow</a>, <a class="code" href="namespacemodule__radsw__parameters.html#a39e5ca4fd5defbc2545ee39bbf50d61b">nbhgh</a></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;                tauliq(ib) = f_zero</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;                ssaliq(ib) = f_zero</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                asyliq(ib) = f_zero</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;              <span class="keywordflow">if</span> ( iswcliq == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;                factor = refliq - 1.5</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;                index  = max( 1, min( 57, int( factor ) ))</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;                fint   = factor - float(index)</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;                <span class="keywordflow">do</span> ib = <a class="code" href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">nblow</a>, <a class="code" href="namespacemodule__radsw__parameters.html#a39e5ca4fd5defbc2545ee39bbf50d61b">nbhgh</a></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;                  extcoliq = max(f_zero,            <a class="code" href="namespacemodule__radsw__cldprtb.html#ac68593a33577c720ca8c74eafb3c9f96">extliq1</a>(index,ib)   &amp;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;     &amp;              + fint*(<a class="code" href="namespacemodule__radsw__cldprtb.html#ac68593a33577c720ca8c74eafb3c9f96">extliq1</a>(index+1,ib)-<a class="code" href="namespacemodule__radsw__cldprtb.html#ac68593a33577c720ca8c74eafb3c9f96">extliq1</a>(index,ib)) )</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;                  ssacoliq = max(f_zero, min(f_one, <a class="code" href="namespacemodule__radsw__cldprtb.html#a7944084ba9f240723dc93467ec66f825">ssaliq1</a>(index,ib)   &amp;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;     &amp;              + fint*(<a class="code" href="namespacemodule__radsw__cldprtb.html#a7944084ba9f240723dc93467ec66f825">ssaliq1</a>(index+1,ib)-<a class="code" href="namespacemodule__radsw__cldprtb.html#a7944084ba9f240723dc93467ec66f825">ssaliq1</a>(index,ib)) ))</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                  asycoliq = max(f_zero, min(f_one, <a class="code" href="namespacemodule__radsw__cldprtb.html#a430be0720aa2e2ac46aa1ec7c9a9b64b">asyliq1</a>(index,ib)   &amp;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;     &amp;              + fint*(<a class="code" href="namespacemodule__radsw__cldprtb.html#a430be0720aa2e2ac46aa1ec7c9a9b64b">asyliq1</a>(index+1,ib)-<a class="code" href="namespacemodule__radsw__cldprtb.html#a430be0720aa2e2ac46aa1ec7c9a9b64b">asyliq1</a>(index,ib)) ))</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="comment">!                 forcoliq = asycoliq * asycoliq</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;                  tauliq(ib) = cldliq     * extcoliq</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;                  ssaliq(ib) = tauliq(ib) * ssacoliq</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;                  asyliq(ib) = ssaliq(ib) * asycoliq</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="keywordflow">              endif</span>   <span class="comment">! end if_iswcliq_block</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="keywordflow">            endif</span>   <span class="comment">! end if_cldliq_block</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="comment">!  --- ...  calculation of absorption coefficients due to ice clouds.</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;            <span class="keywordflow">if</span> ( cldice &lt;= f_zero ) <span class="keywordflow">then</span></div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;              <span class="keywordflow">do</span> ib = <a class="code" href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">nblow</a>, <a class="code" href="namespacemodule__radsw__parameters.html#a39e5ca4fd5defbc2545ee39bbf50d61b">nbhgh</a></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;                tauice(ib) = f_zero</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;                ssaice(ib) = f_zero</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;                asyice(ib) = f_zero</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="comment">!  --- ...  ebert and curry approach for all particle sizes though somewhat</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="comment">!           unjustified for large ice particles</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;              <span class="keywordflow">if</span> ( iswcice == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;                refice = min(130.0_kind_phys,max(13.0_kind_phys,refice))</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;                <span class="keywordflow">do</span> ib = <a class="code" href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">nblow</a>, <a class="code" href="namespacemodule__radsw__parameters.html#a39e5ca4fd5defbc2545ee39bbf50d61b">nbhgh</a></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;                  ia = <a class="code" href="group__module__radsw__main.html#gaa20102786f7e7f8c71fb2783082eac1b">idxebc</a>(ib)           <span class="comment">! eb_&amp;_c band index for ice cloud coeff</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;                  extcoice = max(f_zero, <a class="code" href="namespacemodule__radsw__cldprtb.html#ace960bbbf15ab3cadbee76301ff111dd">abari</a>(ia)+<a class="code" href="namespacemodule__radsw__cldprtb.html#ad5342321ccd4759cb70f7a673620ee19">bbari</a>(ia)/refice )</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;                  ssacoice = max(f_zero, min(f_one,                     &amp;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;     &amp;                             f_one-<a class="code" href="namespacemodule__radsw__cldprtb.html#ae7f1de5c9736894ac7b54c0e0d312f16">cbari</a>(ia)-<a class="code" href="namespacemodule__radsw__cldprtb.html#af8b02590603ea2f838d954cb0a93bbeb">dbari</a>(ia)*refice ))</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;                  asycoice = max(f_zero, min(f_one,                     &amp;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;     &amp;                                   <a class="code" href="namespacemodule__radsw__cldprtb.html#a3cc7ab844ca564bd3df02a687bbc2f43">ebari</a>(ia)+<a class="code" href="namespacemodule__radsw__cldprtb.html#ac2e5b61aea6effe7d49586bf5223c154">fbari</a>(ia)*refice ))</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="comment">!                 forcoice = asycoice * asycoice</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;                  tauice(ib) = cldice     * extcoice</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;                  ssaice(ib) = tauice(ib) * ssacoice</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;                  asyice(ib) = ssaice(ib) * asycoice</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="comment">!  --- ...  streamer approach for ice effective radius between 5.0 and 131.0 microns</span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;              <span class="keywordflow">elseif</span> ( iswcice == 2 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;                refice = min(131.0_kind_phys,max(5.0_kind_phys,refice))</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;                factor = (refice - 2.0) / 3.0</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;                index  = max( 1, min( 42, int( factor ) ))</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;                fint   = factor - float(index)</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                <span class="keywordflow">do</span> ib = <a class="code" href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">nblow</a>, <a class="code" href="namespacemodule__radsw__parameters.html#a39e5ca4fd5defbc2545ee39bbf50d61b">nbhgh</a></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                  extcoice = max(f_zero,            <a class="code" href="namespacemodule__radsw__cldprtb.html#a8ed403302034ea073243157749673e14">extice2</a>(index,ib)   &amp;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;     &amp;                + fint*(<a class="code" href="namespacemodule__radsw__cldprtb.html#a8ed403302034ea073243157749673e14">extice2</a>(index+1,ib)-<a class="code" href="namespacemodule__radsw__cldprtb.html#a8ed403302034ea073243157749673e14">extice2</a>(index,ib)) )</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;                  ssacoice = max(f_zero, min(f_one, <a class="code" href="namespacemodule__radsw__cldprtb.html#a48555ff54d3a46f8c49733ff82e94d70">ssaice2</a>(index,ib)   &amp;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;     &amp;                + fint*(<a class="code" href="namespacemodule__radsw__cldprtb.html#a48555ff54d3a46f8c49733ff82e94d70">ssaice2</a>(index+1,ib)-<a class="code" href="namespacemodule__radsw__cldprtb.html#a48555ff54d3a46f8c49733ff82e94d70">ssaice2</a>(index,ib)) ))</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;                  asycoice = max(f_zero, min(f_one, <a class="code" href="namespacemodule__radsw__cldprtb.html#ad9328ffc5e90cc62c8c9c5089b55fc79">asyice2</a>(index,ib)   &amp;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;     &amp;                + fint*(<a class="code" href="namespacemodule__radsw__cldprtb.html#ad9328ffc5e90cc62c8c9c5089b55fc79">asyice2</a>(index+1,ib)-<a class="code" href="namespacemodule__radsw__cldprtb.html#ad9328ffc5e90cc62c8c9c5089b55fc79">asyice2</a>(index,ib)) ))</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment">!                 forcoice = asycoice * asycoice</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;                  tauice(ib) = cldice     * extcoice</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;                  ssaice(ib) = tauice(ib) * ssacoice</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;                  asyice(ib) = ssaice(ib) * asycoice</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="comment">!  --- ...  fu&#39;s approach for ice effective radius between 4.8 and 135 microns</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="comment">!           (generalized effective size from 5 to 140 microns)</span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;              <span class="keywordflow">elseif</span> ( iswcice == 3 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;                dgeice = max( 5.0, min( 140.0, 1.0315*refice ))</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;                factor = (dgeice - 2.0) / 3.0</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                index  = max( 1, min( 45, int( factor ) ))</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;                fint   = factor - float(index)</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;                <span class="keywordflow">do</span> ib = <a class="code" href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">nblow</a>, <a class="code" href="namespacemodule__radsw__parameters.html#a39e5ca4fd5defbc2545ee39bbf50d61b">nbhgh</a></div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;                  extcoice = max(f_zero,            <a class="code" href="namespacemodule__radsw__cldprtb.html#a8b8bae831aa5b460e260c94e7f24f4c7">extice3</a>(index,ib)   &amp;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;     &amp;                + fint*(<a class="code" href="namespacemodule__radsw__cldprtb.html#a8b8bae831aa5b460e260c94e7f24f4c7">extice3</a>(index+1,ib)-<a class="code" href="namespacemodule__radsw__cldprtb.html#a8b8bae831aa5b460e260c94e7f24f4c7">extice3</a>(index,ib)) )</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;                  ssacoice = max(f_zero, min(f_one, <a class="code" href="namespacemodule__radsw__cldprtb.html#a39b045b05e6bc9c04603277654ff8fc6">ssaice3</a>(index,ib)   &amp;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;     &amp;                + fint*(<a class="code" href="namespacemodule__radsw__cldprtb.html#a39b045b05e6bc9c04603277654ff8fc6">ssaice3</a>(index+1,ib)-<a class="code" href="namespacemodule__radsw__cldprtb.html#a39b045b05e6bc9c04603277654ff8fc6">ssaice3</a>(index,ib)) ))</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                  asycoice = max(f_zero, min(f_one, <a class="code" href="namespacemodule__radsw__cldprtb.html#aec2685be0de3a557aca169062cf1055e">asyice3</a>(index,ib)   &amp;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;     &amp;                + fint*(<a class="code" href="namespacemodule__radsw__cldprtb.html#aec2685be0de3a557aca169062cf1055e">asyice3</a>(index+1,ib)-<a class="code" href="namespacemodule__radsw__cldprtb.html#aec2685be0de3a557aca169062cf1055e">asyice3</a>(index,ib)) ))</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="comment">!                 fdelta   = max(f_zero, min(f_one, fdlice3(index,ib)   &amp;</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="comment">!    &amp;                + fint*(fdlice3(index+1,ib)-fdlice3(index,ib)) ))</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">!                 forcoice = min( asycoice, fdelta+0.5/ssacoice )           ! see fu 1996 p. 2067</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;                  tauice(ib) = cldice     * extcoice</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;                  ssaice(ib) = tauice(ib) * ssacoice</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                  asyice(ib) = ssaice(ib) * asycoice</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="keywordflow">              endif</span>   <span class="comment">! end if_iswcice_block</span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="keywordflow">            endif</span>   <span class="comment">! end if_cldice_block</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;            <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;              jb = <a class="code" href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">nblow</a> + ib - 1</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;              taucw(k,ib) = tauliq(jb)+tauice(jb)+tauran+tausnw</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;              ssacw(k,ib) = ssaliq(jb)+ssaice(jb)+ssaran(jb)+ssasnw(jb)</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;              asycw(k,ib) = asyliq(jb)+asyice(jb)+asyran(jb)+asysnw(jb)</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="keywordflow">          endif</span>  lab_if_cld</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="keywordflow">        enddo</span>  lab_do_k</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      <span class="keywordflow">else</span>  lab_if_iswcliq</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;          <span class="keywordflow">if</span> (cfrac(k) &gt; ftiny) <span class="keywordflow">then</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;            <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;              taucw(k,ib) = cdat1(k)</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;              ssacw(k,ib) = cdat1(k)    * cdat2(k)</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;              asycw(k,ib) = ssacw(k,ib) * cdat3(k)</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="keywordflow">      endif</span>  lab_if_iswcliq</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <span class="keywordflow">if</span> ( isubcsw &gt; 0 ) <span class="keywordflow">then</span>      <span class="comment">! mcica sub-col clouds approx</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        cldf(:) = cfrac(:)</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        <span class="keywordflow">where</span> (cldf(:) &lt; ftiny)</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;          cldf(:) = f_zero</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="keywordflow">        end where</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="comment">!  --- ...  call sub-column cloud generator</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        <span class="keyword">call </span><a class="code" href="group__module__radsw__main.html#gadf2f35094ed7dc31e8f52781745cf021">mcica_subcol</a>                                               &amp;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;     &amp;     ( cldf, nlay, ipseed,                                        &amp;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;     &amp;       lcloudy                                                    &amp;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;     &amp;     )</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;        <span class="keywordflow">do</span> ig = 1, <a class="code" href="namespacemodule__radsw__parameters.html#adc3e4d5a848d50e2883e05c62f61bc97">ngptsw</a></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;            <span class="keywordflow">if</span> ( lcloudy(k,ig) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;              cldfmc(k,ig) = f_one</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;              cldfmc(k,ig) = f_zero</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      <span class="keywordflow">else</span>                         <span class="comment">! non-mcica, normalize cloud</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;          cldfrc(k) = cfrac(k) / cf1</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="keywordflow">      endif</span>   <span class="comment">! end if_isubcsw_block</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radsw__main.html#ga89ca572fa54a63a21009caa0760d405b">cldprop</a></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radsw__main.html#gadf2f35094ed7dc31e8f52781745cf021">mcica_subcol</a>                                           &amp;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;     &amp;    ( cldf, nlay, ipseed,                                         &amp;       <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;     &amp;      lcloudy                                                     &amp;       <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;     &amp;    )</div><div class="line"><a name="l01928"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#gadf2f35094ed7dc31e8f52781745cf021"> 1928</a></span>&#160;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<span class="comment">!  input variables:                                                size !</span></div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;<span class="comment">!   cldf    - real, layer cloud fraction                           nlay !</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="comment">!   nlay    - integer, number of model vertical layers               1  !</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;<span class="comment">!   ipseed  - integer, permute seed for random num generator         1  !</span></div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;<span class="comment">!    ** note : if the cloud generator is called multiple times, need    !</span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;<span class="comment">!              to permute the seed between each call; if between calls  !</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;<span class="comment">!              for lw and sw, use values differ by the number of g-pts. !</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="comment">!  output variables:                                                    !</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="comment">!   lcloudy - logical, sub-colum cloud profile flag array    nlay*ngptsw!</span></div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;<span class="comment">!  other control flags from module variables:                           !</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;<span class="comment">!     iovrsw    : control flag for cloud overlapping method             !</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="comment">!                 =0:random; =1:maximum/random; =2:maximum              !</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;<span class="comment">!  =====================    end of definitions    ====================  !</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      <span class="keywordtype">implicit none</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, ipseed</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(in)</span> :: cldf</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      <span class="keywordtype">logical</span>, <span class="keywordtype">dimension(nlay,ngptsw)</span>, <span class="keywordtype">intent(out)</span>:: lcloudy</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: cdfunc(nlay,<a class="code" href="namespacemodule__radsw__parameters.html#adc3e4d5a848d50e2883e05c62f61bc97">ngptsw</a>), tem1,               &amp;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;     &amp;       rand2d(nlay*ngptsw), rand1d(ngptsw)</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;      type(random_stat) :: stat          <span class="comment">! for thread safe random generator</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;      <span class="keywordtype">integer</span> :: k, n, k1</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="comment">!  --- ...  advance randum number generator by ipseed values</span></div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;      <span class="keyword">call </span>random_setseed                                               &amp;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;     &amp;    ( ipseed,                                                     &amp;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;     &amp;      stat                                                        &amp;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;     &amp;    )</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="comment">!  --- ...  sub-column set up according to overlapping assumption</span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;      <span class="keywordflow">select case</span> ( iovrsw )</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;        <span class="keywordflow">case</span>( 0 )        <span class="comment">! random overlap, pick a random value at every level</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;          <span class="keyword">call </span>random_number                                            &amp;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment">!  ---  inputs: ( none )</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;     &amp;     ( rand2d, stat )</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;          k1 = 0</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;          <span class="keywordflow">do</span> n = 1, <a class="code" href="namespacemodule__radsw__parameters.html#adc3e4d5a848d50e2883e05c62f61bc97">ngptsw</a></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;              k1 = k1 + 1</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;              cdfunc(k,n) = rand2d(k1)</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;        <span class="keywordflow">case</span>( 1 )        <span class="comment">! max-ran overlap</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;          <span class="keyword">call </span>random_number                                            &amp;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="comment">!  ---  inputs: ( none )</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;     &amp;     ( rand2d, stat )</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;          k1 = 0</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;          <span class="keywordflow">do</span> n = 1, <a class="code" href="namespacemodule__radsw__parameters.html#adc3e4d5a848d50e2883e05c62f61bc97">ngptsw</a></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;              k1 = k1 + 1</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;              cdfunc(k,n) = rand2d(k1)</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;<span class="comment">!  ---  first pick a random number for bottom/top layer.</span></div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;<span class="comment">!       then walk up the column: (aer&#39;s code)</span></div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="comment">!       if layer below is cloudy, use the same rand num in the layer below</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment">!       if layer below is clear,  use a new random number</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment">!  ---  from bottom up</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;          <span class="keywordflow">do</span> k = 2, nlay</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;            k1 = k - 1</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;            tem1 = f_one - cldf(k1)</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;            <span class="keywordflow">do</span> n = 1, <a class="code" href="namespacemodule__radsw__parameters.html#adc3e4d5a848d50e2883e05c62f61bc97">ngptsw</a></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;              <span class="keywordflow">if</span> ( cdfunc(k1,n) &gt; tem1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;                cdfunc(k,n) = cdfunc(k1,n)</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;                cdfunc(k,n) = cdfunc(k,n) * tem1</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="comment">!  ---  then walk down the column: (if use original author&#39;s method)</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;<span class="comment">!       if layer above is cloudy, use the same rand num in the layer above</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="comment">!       if layer above is clear,  use a new random number</span></div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="comment">!  ---  from top down</span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="comment">!         do k = nlay-1, 1, -1</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="comment">!           k1 = k + 1</span></div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="comment">!           tem1 = f_one - cldf(k1)</span></div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="comment">!           do n = 1, ngptsw</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="comment">!             if ( cdfunc(k1,n) &gt; tem1 ) then</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;<span class="comment">!               cdfunc(k,n) = cdfunc(k1,n)</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="comment">!             else</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="comment">!               cdfunc(k,n) = cdfunc(k,n) * tem1</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="comment">!             endif</span></div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;<span class="comment">!           enddo</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="comment">!         enddo</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        <span class="keywordflow">case</span>( 2 )        <span class="comment">! maximum overlap, pick same random numebr at every level</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;          <span class="keyword">call </span>random_number                                            &amp;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="comment">!  ---  inputs: ( none )</span></div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;     &amp;     ( rand1d, stat )</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;          <span class="keywordflow">do</span> n = 1, <a class="code" href="namespacemodule__radsw__parameters.html#adc3e4d5a848d50e2883e05c62f61bc97">ngptsw</a></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;            tem1 = rand1d(n)</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;              cdfunc(k,n) = tem1</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="keywordflow">      end select</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="comment">!  --- ...  generate subcolumns for homogeneous clouds</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;        tem1 = f_one - cldf(k)</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;        <span class="keywordflow">do</span> n = 1, <a class="code" href="namespacemodule__radsw__parameters.html#adc3e4d5a848d50e2883e05c62f61bc97">ngptsw</a></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;          lcloudy(k,n) = cdfunc(k,n) &gt;= tem1</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radsw__main.html#gadf2f35094ed7dc31e8f52781745cf021">mcica_subcol</a></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radsw__main.html#ga5eb9918ebc222138a9dad016440e1a74">setcoef</a>                                                &amp;</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;     &amp;     ( pavel,tavel,h2ovmr, nlay,nlp1,                             &amp;    <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;     &amp;       laytrop,jp,jt,jt1,fac00,fac01,fac10,fac11,                 &amp;    <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;     &amp;       selffac,selffrac,indself,forfac,forfrac,indfor             &amp;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;     &amp;     )</div><div class="line"><a name="l02111"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#ga5eb9918ebc222138a9dad016440e1a74"> 2111</a></span>&#160;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;<span class="comment">!  ===================  program usage description  ===================  !</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;<span class="comment">! purpose:  compute various coefficients needed in radiative transfer   !</span></div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="comment">!    calculations.                                                      !</span></div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;<span class="comment">! subprograms called:  none                                             !</span></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="comment">!  inputs:                                                       -size- !</span></div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="comment">!   pavel     - real, layer pressures (mb)                         nlay !</span></div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="comment">!   tavel     - real, layer temperatures (k)                       nlay !</span></div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="comment">!   h2ovmr    - real, layer w.v. volum mixing ratio (kg/kg)        nlay !</span></div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;<span class="comment">!   nlay/nlp1 - integer, total number of vertical layers, levels    1   !</span></div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="comment">!  outputs:                                                             !</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;<span class="comment">!   laytrop   - integer, tropopause layer index (unitless)          1   !</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;<span class="comment">!   jp        - real, indices of lower reference pressure          nlay !</span></div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;<span class="comment">!   jt, jt1   - real, indices of lower reference temperatures      nlay !</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="comment">!                 at levels of jp and jp+1                              !</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;<span class="comment">!   facij     - real, factors multiply the reference ks,           nlay !</span></div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="comment">!                 i,j=0/1 for lower/higher of the 2 appropriate         !</span></div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;<span class="comment">!                 temperatures and altitudes.                           !</span></div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;<span class="comment">!   selffac   - real, scale factor for w. v. self-continuum        nlay !</span></div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;<span class="comment">!                 equals (w. v. density)/(atmospheric density           !</span></div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;<span class="comment">!                 at 296k and 1013 mb)                                  !</span></div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;<span class="comment">!   selffrac  - real, factor for temperature interpolation of      nlay !</span></div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;<span class="comment">!                 reference w. v. self-continuum data                   !</span></div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;<span class="comment">!   indself   - integer, index of lower ref temp for selffac       nlay !</span></div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;<span class="comment">!   forfac    - real, scale factor for w. v. foreign-continuum     nlay !</span></div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;<span class="comment">!   forfrac   - real, factor for temperature interpolation of      nlay !</span></div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="comment">!                 reference w.v. foreign-continuum data                 !</span></div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="comment">!   indfor    - integer, index of lower ref temp for forfac        nlay !</span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="comment">!  ======================    end of definitions    ===================  !</span></div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: pavel, tavel,  &amp;</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;     &amp;       h2ovmr</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(out)</span> :: indself, indfor,         &amp;</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;     &amp;       jp, jt, jt1</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: laytrop</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(out)</span> :: fac00,     &amp;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;     &amp;       fac01, fac10, fac11, selffac, selffrac, forfac, forfrac</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: plog, fp, fp1, ft, ft1, tem1, tem2</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;      <span class="keywordtype">integer</span> :: i, k, jp1</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      laytrop= nlay</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;        forfac(k) = pavel(k)*stpfac / (tavel(k)*(f_one + h2ovmr(k)))</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="comment">!  --- ...  find the two reference pressures on either side of the</span></div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="comment">!           layer pressure.  store them in jp and jp1.  store in fp the</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;<span class="comment">!           fraction of the difference (in ln(pressure)) between these</span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;<span class="comment">!           two values that the layer pressure lies.</span></div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;        plog  = log(pavel(k))</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;        jp(k) = max(1, min(58, int(36.0 - 5.0*(plog+0.04)) ))</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;        jp1   = jp(k) + 1</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;        fp    = 5.0 * (<a class="code" href="namespacemodule__radsw__ref.html#afb71559d084ca709bd134e6c489035e2">preflog</a>(jp(k)) - plog)</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;<span class="comment">!  --- ...  determine, for each reference pressure (jp and jp1), which</span></div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="comment">!          reference temperature (these are different for each reference</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;<span class="comment">!          pressure) is nearest the layer temperature but does not exceed it.</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;<span class="comment">!          store these indices in jt and jt1, resp. store in ft (resp. ft1)</span></div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;<span class="comment">!          the fraction of the way between jt (jt1) and the next highest</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;<span class="comment">!          reference temperature that the layer temperature falls.</span></div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        tem1 = (tavel(k) - <a class="code" href="namespacemodule__radsw__ref.html#a449fffa7047caa0fba6c166c26f7dbbd">tref</a>(jp(k))) / 15.0</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        tem2 = (tavel(k) - <a class="code" href="namespacemodule__radsw__ref.html#a449fffa7047caa0fba6c166c26f7dbbd">tref</a>(jp1  )) / 15.0</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        jt(k) = max(1, min(4, int(3.0 + tem1) ))</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        jt1(k) = max(1, min(4, int(3.0 + tem2) ))</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        ft  = tem1 - float(jt(k) - 3)</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;        ft1 = tem2 - float(jt1(k) - 3)</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;<span class="comment">!  --- ...  we have now isolated the layer ln pressure and temperature,</span></div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="comment">!           between two reference pressures and two reference temperatures</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;<span class="comment">!           (for each reference pressure).  we multiply the pressure</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;<span class="comment">!           fraction fp with the appropriate temperature fractions to get</span></div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;<span class="comment">!           the factors that will be needed for the interpolation that yields</span></div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;<span class="comment">!           the optical depths (performed in routines taugbn for band n).</span></div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;        fp1 = f_one - fp</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        fac10(k) = fp1 * ft</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        fac00(k) = fp1 * (f_one - ft)</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;        fac11(k) = fp  * ft1</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        fac01(k) = fp  * (f_one - ft1)</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;<span class="comment">!  --- ...  if the pressure is less than ~100mb, perform a different</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;<span class="comment">!           set of species interpolations.</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        <span class="keywordflow">if</span> ( plog &gt; 4.56 ) <span class="keywordflow">then</span></div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;          laytrop =  k</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;<span class="comment">!  --- ...  set up factors needed to separately include the water vapor</span></div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;<span class="comment">!           foreign-continuum in the calculation of absorption coefficient.</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;          tem1 = (332.0 - tavel(k)) / 36.0</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;          indfor(k) = min(2, max(1, int(tem1)))</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;          forfrac(k) = tem1 - float(indfor(k))</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;<span class="comment">!  --- ...  set up factors needed to separately include the water vapor</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;<span class="comment">!           self-continuum in the calculation of absorption coefficient.</span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;          tem2 = (tavel(k) - 188.0) / 7.2</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;          indself(k) = min(9, max(1, int(tem2)-7))</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;          selffrac(k) = tem2 - float(indself(k) + 7)</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;          selffac(k) = h2ovmr(k) * forfac(k)</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;<span class="comment">!  --- ...  set up factors needed to separately include the water vapor</span></div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;<span class="comment">!           foreign-continuum in the calculation of absorption coefficient.</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;          tem1 = (tavel(k) - 188.0) / 36.0</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;          indfor(k) = 3</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;          forfrac(k) = tem1 - f_one</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;          indself(k) = 0</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;          selffrac(k) = f_zero</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;          selffac(k) = f_zero</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="keywordflow">      enddo</span>    <span class="comment">! end_do_k_loop</span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radsw__main.html#ga5eb9918ebc222138a9dad016440e1a74">setcoef</a></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radsw__main.html#gaeb992f35bdf7dbf9ea8709d7d91dedfd">spcvrtc</a>                                                &amp;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;     &amp;     ( ssolar,cosz,sntz,albbm,albdf,sfluxzen,cldfrc,              &amp;  <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;     &amp;       cf1,cf0,taug,taur,tauae,ssaae,asyae,taucw,ssacw,asycw,     &amp;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;     &amp;       nlay, nlp1,                                                &amp;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;     &amp;       fxupc,fxdnc,fxup0,fxdn0,                                   &amp;  <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;     &amp;       ftoauc,ftoau0,ftoadc,fsfcuc,fsfcu0,fsfcdc,fsfcd0,          &amp;</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;     &amp;       sfbmc,sfdfc,sfbm0,sfdf0,suvbfc,suvbf0                      &amp;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;     &amp;     )</div><div class="line"><a name="l02304"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#gaeb992f35bdf7dbf9ea8709d7d91dedfd"> 2304</a></span>&#160;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;<span class="comment">!  ===================  program usage description  ===================  !</span></div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;<span class="comment">!   purpose:  computes the shortwave radiative fluxes using two-stream  !</span></div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;<span class="comment">!             method                                                    !</span></div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;<span class="comment">!   subprograms called:  vrtqdr                                         !</span></div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;<span class="comment">!  inputs:                                                        size  !</span></div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;<span class="comment">!    ssolar  - real, incoming solar flux at top                    1    !</span></div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;<span class="comment">!    cosz    - real, cosine solar zenith angle                     1    !</span></div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;<span class="comment">!    sntz    - real, secant solar zenith angle                     1    !</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;<span class="comment">!    albbm   - real, surface albedo for direct beam radiation      2    !</span></div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;<span class="comment">!    albdf   - real, surface albedo for diffused radiation         2    !</span></div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;<span class="comment">!    sfluxzen- real, spectral distribution of incoming solar flux ngptsw!</span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;<span class="comment">!    cldfrc  - real, layer cloud fraction                         nlay  !</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;<span class="comment">!    cf1     - real, &gt;0: cloudy sky, otherwise: clear sky          1    !</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="comment">!    cf0     - real, =1-cf1                                        1    !</span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;<span class="comment">!    taug    - real, spectral optical depth for gases        nlay*ngptsw!</span></div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;<span class="comment">!    taur    - real, optical depth for rayleigh scattering   nlay*ngptsw!</span></div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;<span class="comment">!    tauae   - real, aerosols optical depth                  nlay*nbdsw !</span></div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;<span class="comment">!    ssaae   - real, aerosols single scattering albedo       nlay*nbdsw !</span></div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;<span class="comment">!    asyae   - real, aerosols asymmetry factor               nlay*nbdsw !</span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;<span class="comment">!    taucw   - real, weighted cloud optical depth            nlay*nbdsw !</span></div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="comment">!    ssacw   - real, weighted cloud single scat albedo       nlay*nbdsw !</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;<span class="comment">!    asycw   - real, weighted cloud asymmetry factor         nlay*nbdsw !</span></div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="comment">!    nlay,nlp1 - integer,  number of layers/levels                 1    !</span></div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;<span class="comment">!  output variables:                                                    !</span></div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;<span class="comment">!    fxupc   - real, tot sky upward flux                     nlp1*nbdsw !</span></div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;<span class="comment">!    fxdnc   - real, tot sky downward flux                   nlp1*nbdsw !</span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;<span class="comment">!    fxup0   - real, clr sky upward flux                     nlp1*nbdsw !</span></div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;<span class="comment">!    fxdn0   - real, clr sky downward flux                   nlp1*nbdsw !</span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="comment">!    ftoauc  - real, tot sky toa upwd flux                         1    !</span></div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="comment">!    ftoau0  - real, clr sky toa upwd flux                         1    !</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;<span class="comment">!    ftoadc  - real, toa downward (incoming) solar flux            1    !</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;<span class="comment">!    fsfcuc  - real, tot sky sfc upwd flux                         1    !</span></div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;<span class="comment">!    fsfcu0  - real, clr sky sfc upwd flux                         1    !</span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="comment">!    fsfcdc  - real, tot sky sfc dnwd flux                         1    !</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="comment">!    fsfcd0  - real, clr sky sfc dnwd flux                         1    !</span></div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;<span class="comment">!    sfbmc   - real, tot sky sfc dnwd beam flux (nir/uv+vis)       2    !</span></div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="comment">!    sfdfc   - real, tot sky sfc dnwd diff flux (nir/uv+vis)       2    !</span></div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="comment">!    sfbm0   - real, clr sky sfc dnwd beam flux (nir/uv+vis)       2    !</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;<span class="comment">!    sfdf0   - real, clr sky sfc dnwd diff flux (nir/uv+vis)       2    !</span></div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;<span class="comment">!    suvbfc  - real, tot sky sfc dnwd uv-b flux                    1    !</span></div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;<span class="comment">!    suvbf0  - real, clr sky sfc dnwd uv-b flux                    1    !</span></div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;<span class="comment">!  internal variables:                                                  !</span></div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;<span class="comment">!    zrefb   - real, direct beam reflectivity for clear/cloudy    nlp1  !</span></div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;<span class="comment">!    zrefd   - real, diffuse reflectivity for clear/cloudy        nlp1  !</span></div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="comment">!    ztrab   - real, direct beam transmissivity for clear/cloudy  nlp1  !</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="comment">!    ztrad   - real, diffuse transmissivity for clear/cloudy      nlp1  !</span></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="comment">!    zldbt   - real, layer beam transmittance for clear/cloudy    nlp1  !</span></div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;<span class="comment">!    ztdbt   - real, lev total beam transmittance for clr/cld     nlp1  !</span></div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;<span class="comment">!  control parameters in module &quot;physparam&quot;                             !</span></div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;<span class="comment">!    iswmode - control flag for 2-stream transfer schemes               !</span></div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;<span class="comment">!              = 1 delta-eddington    (joseph et al., 1976)             !</span></div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="comment">!              = 2 pifm               (zdunkowski et al., 1980)         !</span></div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;<span class="comment">!              = 3 discrete ordinates (liou, 1973)                      !</span></div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;<span class="comment">!  original code description                                            !</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;<span class="comment">!  method:                                                              !</span></div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;<span class="comment">!  -------                                                              !</span></div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;<span class="comment">!     standard delta-eddington, p.i.f.m., or d.o.m. layer calculations. !</span></div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;<span class="comment">!     kmodts  = 1 eddington (joseph et al., 1976)                       !</span></div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;<span class="comment">!             = 2 pifm (zdunkowski et al., 1980)                        !</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="comment">!             = 3 discrete ordinates (liou, 1973)                       !</span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;<span class="comment">!  modifications:                                                       !</span></div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="comment">!  --------------                                                       !</span></div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="comment">!   original: h. barker                                                 !</span></div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="comment">!   revision: merge with rrtmg_sw: j.-j.morcrette, ecmwf, feb 2003      !</span></div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;<span class="comment">!   revision: add adjustment for earth/sun distance:mjiacono,aer,oct2003!</span></div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;<span class="comment">!   revision: bug fix for use of palbp and palbd: mjiacono, aer, nov2003!</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;<span class="comment">!   revision: bug fix to apply delta scaling to clear sky: aer, dec2004 !</span></div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;<span class="comment">!   revision: code modified so that delta scaling is not done in cloudy !</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;<span class="comment">!             profiles if routine cldprop is used; delta scaling can be !</span></div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;<span class="comment">!             applied by swithcing code below if cldprop is not used to !</span></div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="comment">!             get cloud properties. aer, jan 2005                       !</span></div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<span class="comment">!   revision: uniform formatting for rrtmg: mjiacono, aer, jul 2006     !</span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;<span class="comment">!   revision: use exponential lookup table for transmittance: mjiacono, !</span></div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="comment">!             aer, aug 2007                                             !</span></div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;<span class="comment">!  ======================  end of description block  =================  !</span></div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="comment">!  ---  constant parameters:</span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: zcrit = 0.9999995 <span class="comment">! thresold for conservative scattering</span></div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: zsr3  = sqrt(3.0)</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: od_lo = 0.06</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: eps1  = 1.0e-8</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,ngptsw)</span>, <span class="keywordtype">intent(in)</span> ::      &amp;</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;     &amp;       taug, taur</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,nbdsw)</span>,  <span class="keywordtype">intent(in)</span> ::      &amp;</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;     &amp;       taucw, ssacw, asycw, tauae, ssaae, asyae</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(ngptsw)</span>, <span class="keywordtype">intent(in)</span> :: sfluxzen</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>,   <span class="keywordtype">intent(in)</span> :: cldfrc</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(2)</span>,  <span class="keywordtype">intent(in)</span> :: albbm, albdf</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: cosz, sntz, cf1, cf0, ssolar</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlp1,nbdsw)</span>, <span class="keywordtype">intent(out)</span> ::      &amp;</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;     &amp;       fxupc, fxdnc, fxup0, fxdn0</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(2)</span>, <span class="keywordtype">intent(out)</span> :: sfbmc, sfdfc, &amp;</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;     &amp;       sfbm0, sfdf0</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(out)</span> :: suvbfc, suvbf0, ftoadc,     &amp;</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;     &amp;       ftoauc, ftoau0, fsfcuc, fsfcu0, fsfcdc, fsfcd0</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span> :: ztaus, zssas, zasys,    &amp;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;     &amp;       zldbt0</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlp1)</span> :: zrefb, zrefd, ztrab,    &amp;</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;     &amp;       ztrad, ztdbt, zldbt, zfu, zfd</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: ztau1, zssa1, zasy1, ztau0, zssa0,       &amp;</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;     &amp;       zasy0, zasy3, zssaw, zasyw, zgam1, zgam2, zgam3, zgam4,    &amp;</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;     &amp;       zc0, zc1, za1, za2, zb1, zb2, zrk, zrk2, zrp, zrp1, zrm1,  &amp;</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;     &amp;       zrpp, zrkg1, zrkg3, zrkg4, zexp1, zexm1, zexp2, zexm2,     &amp;</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;     &amp;       zexp3, zexp4, zden1, ze1r45, ftind, zsolar, zrefb1,        &amp;</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;     &amp;       zrefd1, ztrab1, ztrad1, ztdbt0, zr1, zr2, zr3, zr4, zr5,   &amp;</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;     &amp;       zt1, zt2, zt3, zf1, zf2, zrpp1</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;      <span class="keywordtype">integer</span> :: ib, ibd, jb, jg, k, kp, itind</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;      <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;        <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;          fxdnc(k,ib) = f_zero</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;          fxupc(k,ib) = f_zero</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;          fxdn0(k,ib) = f_zero</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;          fxup0(k,ib) = f_zero</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;      ftoadc = f_zero</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;      ftoauc = f_zero</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;      ftoau0 = f_zero</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;      fsfcuc = f_zero</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;      fsfcu0 = f_zero</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;      fsfcdc = f_zero</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;      fsfcd0 = f_zero</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;<span class="comment">!! --- ...  uv-b surface downward fluxes</span></div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;      suvbfc  = f_zero</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;      suvbf0  = f_zero</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;<span class="comment">!! --- ...  output surface flux components</span></div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;      sfbmc(1) = f_zero</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;      sfbmc(2) = f_zero</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;      sfdfc(1) = f_zero</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;      sfdfc(2) = f_zero</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;      sfbm0(1) = f_zero</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;      sfbm0(2) = f_zero</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;      sfdf0(1) = f_zero</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;      sfdf0(2) = f_zero</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;<span class="comment">!  --- ...  loop over all g-points in each band</span></div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;      lab_do_jg : <span class="keywordflow">do</span> jg = 1, <a class="code" href="namespacemodule__radsw__parameters.html#adc3e4d5a848d50e2883e05c62f61bc97">ngptsw</a></div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;        jb = <a class="code" href="namespacemodule__radsw__parameters.html#afdd8496d7eaa017f7f1e08e998945c1e">ngb</a>(jg)</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;        ib = jb + 1 - <a class="code" href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">nblow</a></div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;        ibd = <a class="code" href="group__module__radsw__main.html#gad295d723dd7d269cb51c73923a4cbb94">idxsfc</a>(jb)</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;        zsolar = ssolar * sfluxzen(jg)</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;<span class="comment">!  --- ...  set up toa direct beam and surface values (beam and diff)</span></div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;        ztdbt(nlp1) = f_one</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;        ztdbt0   = f_one</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;        zldbt(1) = f_zero</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;        <span class="keywordflow">if</span> (ibd /= 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;          zrefb(1) = albbm(ibd)</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;          zrefd(1) = albdf(ibd)</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;          zrefb(1) = 0.5 * (albbm(1) + albbm(2))</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;          zrefd(1) = 0.5 * (albdf(1) + albdf(2))</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;        ztrab(1) = f_zero</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;        ztrad(1) = f_zero</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;        <span class="keywordflow">do</span> k = nlay, 1, -1</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;          kp = k + 1</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;          ztau0 = max( ftiny, taur(k,jg)+taug(k,jg)+tauae(k,ib) )</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;          zssa0 = taur(k,jg) + tauae(k,ib)*ssaae(k,ib)</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;          zasy0 = asyae(k,ib)*ssaae(k,ib)*tauae(k,ib)</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;          zssaw = min( oneminus, zssa0 / ztau0 )</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;          zasyw = zasy0 / max( ftiny, zssa0 )</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;<span class="comment">!  --- ...  saving clear-sky quantities for later total-sky usage</span></div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;          ztaus(k) = ztau0</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;          zssas(k) = zssa0</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;          zasys(k) = zasy0</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;<span class="comment">!  --- ...  delta scaling for clear-sky condition</span></div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;          za1 = zasyw * zasyw</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;          za2 = zssaw * za1</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;          ztau1 = (f_one - za2) * ztau0</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;          zssa1 = (zssaw - za2) / (f_one - za2)</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;<span class="comment">!org      zasy1 = (zasyw - za1) / (f_one - za1)   ! this line is replaced by the next</span></div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;          zasy1 = zasyw / (f_one + zasyw)         <span class="comment">! to reduce truncation error</span></div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;          zasy3 = 0.75 * zasy1</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;<span class="comment">!  --- ...  general two-stream expressions</span></div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;          <span class="keywordflow">if</span> ( iswmode == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;            zgam1 = 1.75 - zssa1 * (f_one + zasy3)</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;            zgam2 =-0.25 + zssa1 * (f_one - zasy3)</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;            zgam3 = 0.5  - zasy3 * cosz</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;          <span class="keywordflow">elseif</span> ( iswmode == 2 ) <span class="keywordflow">then</span>               <span class="comment">! pifm</span></div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;            zgam1 = 2.0 - zssa1 * (1.25 + zasy3)</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;            zgam2 = 0.75* zssa1 * (f_one- zasy1)</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;            zgam3 = 0.5 - zasy3 * cosz</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;          <span class="keywordflow">elseif</span> ( iswmode == 3 ) <span class="keywordflow">then</span>               <span class="comment">! discrete ordinates</span></div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;            zgam1 = zsr3 * (2.0 - zssa1 * (1.0 + zasy1)) * 0.5</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;            zgam2 = zsr3 * zssa1 * (1.0 - zasy1) * 0.5</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;            zgam3 = (1.0 - zsr3 * zasy1 * cosz) * 0.5</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;          zgam4 = f_one - zgam3</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;<span class="comment">!  --- ...  compute homogeneous reflectance and transmittance</span></div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;          <span class="keywordflow">if</span> ( zssaw &gt;= zcrit ) <span class="keywordflow">then</span>    <span class="comment">! for conservative scattering</span></div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;            za1 = zgam1 * cosz - zgam3</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;            za2 = zgam1 * ztau1</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;<span class="comment">!  --- ...  use exponential lookup table for transmittance, or expansion</span></div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;<span class="comment">!           of exponential for low optical depth</span></div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;            zb1 = min( ztau1*sntz , 500.0 )</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;            <span class="keywordflow">if</span> ( zb1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;              zb2 = f_one - zb1 + 0.5*zb1*zb1</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;              ftind = zb1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zb1)</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;              itind = ftind*<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a> + 0.5</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;              zb2 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;<span class="comment">!      ...  collimated beam</span></div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;            zrefb(kp) = max(f_zero, min(f_one,                          &amp;</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;     &amp;                  (za2 - za1*(f_one - zb2))/(f_one + za2) ))</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;            ztrab(kp) = max(f_zero, min(f_one, f_one-zrefb(kp) ))</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;<span class="comment">!      ...  isotropic incidence</span></div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;            zrefd(kp) = max(f_zero, min(f_one, za2/(f_one + za2) ))</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;            ztrad(kp) = max(f_zero, min(f_one, f_one-zrefd(kp) ))</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;          <span class="keywordflow">else</span>                          <span class="comment">! for non-conservative scattering</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;            za1 = zgam1*zgam4 + zgam2*zgam3</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;            za2 = zgam1*zgam3 + zgam2*zgam4</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;            zrk = sqrt( (zgam1 - zgam2) * (zgam1 + zgam2) )</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;            zrk2= 2.0 * zrk</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;            zrp  = zrk * cosz</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;            zrp1 = f_one + zrp</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;            zrm1 = f_one - zrp</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;            zrpp1= f_one - zrp*zrp</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;            zrpp = sign( max(flimit, abs(zrpp1)), zrpp1 )    <span class="comment">! avoid numerical singularity</span></div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;            zrkg1= zrk + zgam1</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;            zrkg3= zrk * zgam3</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;            zrkg4= zrk * zgam4</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;            zr1  = zrm1 * (za2 + zrkg3)</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;            zr2  = zrp1 * (za2 - zrkg3)</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;            zr3  = zrk2 * (zgam3 - za2*cosz)</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;            zr4  = zrpp * zrkg1</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;            zr5  = zrpp * (zrk - zgam1)</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;            zt1  = zrp1 * (za1 + zrkg4)</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;            zt2  = zrm1 * (za1 - zrkg4)</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;            zt3  = zrk2 * (zgam4 + za1*cosz)</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;<span class="comment">!  --- ...  use exponential lookup table for transmittance, or expansion</span></div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;<span class="comment">!           of exponential for low optical depth</span></div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;            zb1 = min( zrk*ztau1, 500.0 )</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;            <span class="keywordflow">if</span> ( zb1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;              zexm1 = f_one - zb1 + 0.5*zb1*zb1</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;              ftind = zb1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zb1)</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;              itind = ftind*<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a> + 0.5</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;              zexm1 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;            zexp1 = f_one / zexm1</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;            zb2 = min( sntz*ztau1, 500.0 )</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;            <span class="keywordflow">if</span> ( zb2 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;              zexm2 = f_one - zb2 + 0.5*zb2*zb2</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;              ftind = zb2 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zb2)</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;              itind = ftind*<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a> + 0.5</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;              zexm2 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;            zexp2 = f_one / zexm2</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;            ze1r45 = zr4*zexp1 + zr5*zexm1</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;<span class="comment">!      ...  collimated beam</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;            <span class="keywordflow">if</span> (ze1r45&gt;=-eps1 .and. ze1r45&lt;=eps1) <span class="keywordflow">then</span></div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;              zrefb(kp) = eps1</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;              ztrab(kp) = zexm2</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;              zden1 = zssa1 / ze1r45</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;              zrefb(kp) = max(f_zero, min(f_one,                        &amp;</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;     &amp;                    (zr1*zexp1 - zr2*zexm1 - zr3*zexm2)*zden1 ))</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;              ztrab(kp) = max(f_zero, min(f_one, zexm2*(f_one           &amp;</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;     &amp;                  - (zt1*zexp1 - zt2*zexm1 - zt3*zexp2)*zden1) ))</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;<span class="comment">!      ...  diffuse beam</span></div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;            zden1 = zr4 / (ze1r45 * zrkg1)</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;            zrefd(kp) = max(f_zero, min(f_one,                          &amp;</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;     &amp;                  zgam2*(zexp1 - zexm1)*zden1 ))</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;            ztrad(kp) = max(f_zero, min(f_one, zrk2*zden1 ))</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;<span class="keywordflow">          endif</span>    <span class="comment">! end if_zssaw_block</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;<span class="comment">!  --- ...  direct beam transmittance. use exponential lookup table</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;<span class="comment">!           for transmittance, or expansion of exponential for low</span></div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;<span class="comment">!           optical depth</span></div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;          zr1 = ztau1 * sntz</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;          <span class="keywordflow">if</span> ( zr1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;            zexp3 = f_one - zr1 + 0.5*zr1*zr1</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;            ftind = zr1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zr1)</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;            itind = max(0, min(<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>, int(0.5+<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>*ftind) ))</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;            zexp3 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;          ztdbt(k)  = zexp3 * ztdbt(kp)</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;          zldbt(kp) = zexp3</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;<span class="comment">!  --- ...  pre-delta-scaling clear and cloudy direct beam transmittance</span></div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;<span class="comment">!           (must use &#39;orig&#39;, unscaled cloud optical depth)</span></div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;          zr1 = ztau0 * sntz</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;          <span class="keywordflow">if</span> ( zr1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;            zexp4 = f_one - zr1 + 0.5*zr1*zr1</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;            ftind = zr1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zr1)</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;            itind = max(0, min(<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>, int(0.5+<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>*ftind) ))</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;            zexp4 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;          zldbt0(k) = zexp4</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;          ztdbt0 = zexp4 * ztdbt0</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;<span class="keywordflow">        enddo</span>    <span class="comment">! end do_k_loop</span></div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;        <span class="keyword">call </span><a class="code" href="group__module__radsw__main.html#gad227ccde86a01f47c1ab3b4bed5ba1be">vrtqdr</a>                                                     &amp;</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;     &amp;     ( zrefb,zrefd,ztrab,ztrad,zldbt,ztdbt,                       &amp;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;     &amp;       nlay, nlp1,                                                &amp;</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;     &amp;       zfu, zfd                                                   &amp;</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;     &amp;     )</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;<span class="comment">!  --- ...  compute upward and downward fluxes at levels</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;        <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;          fxup0(k,ib) = fxup0(k,ib) + zsolar*zfu(k)</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;          fxdn0(k,ib) = fxdn0(k,ib) + zsolar*zfd(k)</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;<span class="comment">!! --- ...  surface downward beam/diffused flux components</span></div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;        zb1 = zsolar*ztdbt0</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;        zb2 = zsolar*(zfd(1) - ztdbt0)</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;        <span class="keywordflow">if</span> (ibd /= 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;          sfbm0(ibd) = sfbm0(ibd) + zb1</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;          sfdf0(ibd) = sfdf0(ibd) + zb2</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;          zf1 = 0.5 * zb1</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;          zf2 = 0.5 * zb2</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;          sfbm0(1) = sfbm0(1) + zf1</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;          sfdf0(1) = sfdf0(1) + zf2</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;          sfbm0(2) = sfbm0(2) + zf1</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;          sfdf0(2) = sfdf0(2) + zf2</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;<span class="comment">!       sfbm0(ibd) = sfbm0(ibd) + zsolar*ztdbt0</span></div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;<span class="comment">!       sfdf0(ibd) = sfdf0(ibd) + zsolar*(zfd(1) - ztdbt0)</span></div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;        <span class="keywordflow">if</span> ( cf1 &gt; eps ) <span class="keywordflow">then</span></div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;<span class="comment">!  --- ...  set up toa direct beam and surface values (beam and diff)</span></div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;          ztdbt0 = f_one</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;          zldbt(1) = f_zero</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;          <span class="keywordflow">do</span> k = nlay, 1, -1</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;            kp = k + 1</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;            zc0 = f_one - cldfrc(k)</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;            zc1 = cldfrc(k)</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;            <span class="keywordflow">if</span> ( zc1 &gt; ftiny ) <span class="keywordflow">then</span>          <span class="comment">! it is a cloudy-layer</span></div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;              ztau0 = ztaus(k) + taucw(k,ib)</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;              zssa0 = zssas(k) + ssacw(k,ib)</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;              zasy0 = zasys(k) + asycw(k,ib)</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;              zssaw = min(oneminus, zssa0 / ztau0)</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;              zasyw = zasy0 / max(ftiny, zssa0)</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;<span class="comment">!  --- ...  delta scaling for total-sky condition</span></div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;              za1 = zasyw * zasyw</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;              za2 = zssaw * za1</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;              ztau1 = (f_one - za2) * ztau0</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;              zssa1 = (zssaw - za2) / (f_one - za2)</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;<span class="comment">!org          zasy1 = (zasyw - za1) / (f_one - za1)</span></div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;              zasy1 = zasyw / (f_one + zasyw)</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;              zasy3 = 0.75 * zasy1</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;<span class="comment">!  --- ...  general two-stream expressions</span></div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;              <span class="keywordflow">if</span> ( iswmode == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;                zgam1 = 1.75 - zssa1 * (f_one + zasy3)</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;                zgam2 =-0.25 + zssa1 * (f_one - zasy3)</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;                zgam3 = 0.5  - zasy3 * cosz</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;              <span class="keywordflow">elseif</span> ( iswmode == 2 ) <span class="keywordflow">then</span>               <span class="comment">! pifm</span></div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;                zgam1 = 2.0 - zssa1 * (1.25 + zasy3)</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;                zgam2 = 0.75* zssa1 * (f_one- zasy1)</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;                zgam3 = 0.5 - zasy3 * cosz</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;              <span class="keywordflow">elseif</span> ( iswmode == 3 ) <span class="keywordflow">then</span>               <span class="comment">! discrete ordinates</span></div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                zgam1 = zsr3 * (2.0 - zssa1 * (1.0 + zasy1)) * 0.5</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;                zgam2 = zsr3 * zssa1 * (1.0 - zasy1) * 0.5</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;                zgam3 = (1.0 - zsr3 * zasy1 * cosz) * 0.5</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;              zgam4 = f_one - zgam3</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;              zrefb1 = zrefb(kp)</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;              zrefd1 = zrefd(kp)</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;              ztrab1 = ztrab(kp)</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;              ztrad1 = ztrad(kp)</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;<span class="comment">!  --- ...  compute homogeneous reflectance and transmittance</span></div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;              <span class="keywordflow">if</span> ( zssaw &gt;= zcrit ) <span class="keywordflow">then</span>    <span class="comment">! for conservative scattering</span></div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;                za1 = zgam1 * cosz - zgam3</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;                za2 = zgam1 * ztau1</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;<span class="comment">!  --- ...  use exponential lookup table for transmittance, or expansion</span></div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;<span class="comment">!           of exponential for low optical depth</span></div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;                zb1 = min( ztau1*sntz , 500.0 )</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;                <span class="keywordflow">if</span> ( zb1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;                  zb2 = f_one - zb1 + 0.5*zb1*zb1</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;                  ftind = zb1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zb1)</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;                  itind = ftind*<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a> + 0.5</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;                  zb2 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;<span class="keywordflow">                endif</span></div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;<span class="comment">!      ...  collimated beam</span></div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;                zrefb(kp) = max(f_zero, min(f_one,                      &amp;</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;     &amp;                      (za2 - za1*(f_one - zb2))/(f_one + za2) ))</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;                ztrab(kp) = max(f_zero, min(f_one, f_one-zrefb(kp)))</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;<span class="comment">!      ...  isotropic incidence</span></div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;                zrefd(kp) = max(f_zero, min(f_one, za2 / (f_one+za2) ))</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;                ztrad(kp) = max(f_zero, min(f_one, f_one - zrefd(kp) ))</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;              <span class="keywordflow">else</span>                          <span class="comment">! for non-conservative scattering</span></div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;                za1 = zgam1*zgam4 + zgam2*zgam3</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;                za2 = zgam1*zgam3 + zgam2*zgam4</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;                zrk = sqrt( (zgam1 - zgam2) * (zgam1 + zgam2) )</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;                zrk2= 2.0 * zrk</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;                zrp  = zrk * cosz</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;                zrp1 = f_one + zrp</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;                zrm1 = f_one - zrp</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;                zrpp1= f_one - zrp*zrp</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;                zrpp = sign( max(flimit, abs(zrpp1)), zrpp1 )    <span class="comment">! avoid numerical singularity</span></div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;                zrkg1= zrk + zgam1</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;                zrkg3= zrk * zgam3</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;                zrkg4= zrk * zgam4</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;                zr1  = zrm1 * (za2 + zrkg3)</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;                zr2  = zrp1 * (za2 - zrkg3)</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;                zr3  = zrk2 * (zgam3 - za2*cosz)</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;                zr4  = zrpp * zrkg1</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;                zr5  = zrpp * (zrk - zgam1)</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;                zt1  = zrp1 * (za1 + zrkg4)</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;                zt2  = zrm1 * (za1 - zrkg4)</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;                zt3  = zrk2 * (zgam4 + za1*cosz)</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;<span class="comment">!  --- ...  use exponential lookup table for transmittance, or expansion</span></div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="comment">!           of exponential for low optical depth</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;                zb1 = min( zrk*ztau1, 500.0 )</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;                <span class="keywordflow">if</span> ( zb1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;                  zexm1 = f_one - zb1 + 0.5*zb1*zb1</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;                  ftind = zb1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zb1)</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;                  itind = ftind*<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a> + 0.5</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;                  zexm1 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;<span class="keywordflow">                endif</span></div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;                zexp1 = f_one / zexm1</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;                zb2 = min( ztau1*sntz, 500.0 )</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;                <span class="keywordflow">if</span> ( zb2 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;                  zexm2 = f_one - zb2 + 0.5*zb2*zb2</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;                  ftind = zb2 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zb2)</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;                  itind = ftind*<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a> + 0.5</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;                  zexm2 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;<span class="keywordflow">                endif</span></div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;                zexp2 = f_one / zexm2</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;                ze1r45 = zr4*zexp1 + zr5*zexm1</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;<span class="comment">!      ...  collimated beam</span></div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;                <span class="keywordflow">if</span> ( ze1r45&gt;=-eps1 .and. ze1r45&lt;=eps1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;                  zrefb(kp) = eps1</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;                  ztrab(kp) = zexm2</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;                  zden1 = zssa1 / ze1r45</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;                  zrefb(kp) = max(f_zero, min(f_one,                    &amp;</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;     &amp;                        (zr1*zexp1-zr2*zexm1-zr3*zexm2)*zden1 ))</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;                  ztrab(kp) = max(f_zero, min(f_one, zexm2*(f_one -     &amp;</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;     &amp;                        (zt1*zexp1-zt2*zexm1-zt3*zexp2)*zden1) ))</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;<span class="keywordflow">                endif</span></div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;<span class="comment">!      ...  diffuse beam</span></div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;                zden1 = zr4 / (ze1r45 * zrkg1)</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;                zrefd(kp) = max(f_zero, min(f_one,                      &amp;</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;     &amp;                      zgam2*(zexp1 - zexm1)*zden1 ))</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;                ztrad(kp) = max(f_zero, min(f_one, zrk2*zden1 ))</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;<span class="keywordflow">              endif</span>    <span class="comment">! end if_zssaw_block</span></div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;<span class="comment">!  --- ...  combine clear and cloudy contributions for total sky</span></div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;<span class="comment">!           and calculate direct beam transmittances</span></div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;              zrefb(kp) = zc0*zrefb1 + zc1*zrefb(kp)</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;              zrefd(kp) = zc0*zrefd1 + zc1*zrefd(kp)</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;              ztrab(kp) = zc0*ztrab1 + zc1*ztrab(kp)</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;              ztrad(kp) = zc0*ztrad1 + zc1*ztrad(kp)</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;<span class="comment">!  --- ...  direct beam transmittance. use exponential lookup table</span></div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;<span class="comment">!           for transmittance, or expansion of exponential for low</span></div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;<span class="comment">!           optical depth</span></div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;              zr1 = ztau1 * sntz</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;              <span class="keywordflow">if</span> ( zr1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;                zexp3 = f_one - zr1 + 0.5*zr1*zr1</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;                ftind = zr1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zr1)</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;                itind = max(0, min(<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>, int(0.5+<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>*ftind) ))</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;                zexp3 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;              zldbt(kp) = zc0*zldbt(kp) + zc1*zexp3</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;              ztdbt(k) = zldbt(kp) * ztdbt(kp)</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;<span class="comment">!  --- ...  pre-delta-scaling clear and cloudy direct beam transmittance</span></div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;<span class="comment">!           (must use &#39;orig&#39;, unscaled cloud optical depth)</span></div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;              zr1 = ztau0 * sntz</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;              <span class="keywordflow">if</span> ( zr1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;                zexp4 = f_one - zr1 + 0.5*zr1*zr1</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;                ftind = zr1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zr1)</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;                itind = max(0, min(<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>, int(0.5+<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>*ftind) ))</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;                zexp4 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;              ztdbt0 = (zc0*zldbt0(k) + zc1*zexp4) * ztdbt0</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;            <span class="keywordflow">else</span>     <span class="comment">! if_zc1_block  ---  it is a clear layer</span></div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;<span class="comment">!  --- ...  direct beam transmittance</span></div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;              ztdbt(k) = zldbt(kp) * ztdbt(kp)</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="comment">!  --- ...  pre-delta-scaling clear and cloudy direct beam transmittance</span></div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;              ztdbt0 = zldbt0(k) * ztdbt0</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;<span class="keywordflow">            endif</span>    <span class="comment">! end if_zc1_block</span></div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;<span class="keywordflow">          enddo</span>   <span class="comment">! end do_k_loop</span></div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;<span class="comment">!  --- ...  perform vertical quadrature</span></div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;          <span class="keyword">call </span><a class="code" href="group__module__radsw__main.html#gad227ccde86a01f47c1ab3b4bed5ba1be">vrtqdr</a>                                                   &amp;</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;     &amp;     ( zrefb,zrefd,ztrab,ztrad,zldbt,ztdbt,                       &amp;</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;     &amp;       nlay, nlp1,                                                &amp;</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;     &amp;       zfu, zfd                                                   &amp;</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;     &amp;     )</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;<span class="comment">!  --- ...  compute upward and downward fluxes at levels</span></div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;          <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;            fxupc(k,ib) = fxupc(k,ib) + zsolar*zfu(k)</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;            fxdnc(k,ib) = fxdnc(k,ib) + zsolar*zfd(k)</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;<span class="comment">! --- ...  surface downward beam/diffused flux components</span></div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;          zb1 = zsolar*ztdbt0</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;          zb2 = zsolar*(zfd(1) - ztdbt0)</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;          <span class="keywordflow">if</span> (ibd /= 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;            sfbmc(ibd) = sfbmc(ibd) + zb1</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;            sfdfc(ibd) = sfdfc(ibd) + zb2</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;            zf1 = 0.5 * zb1</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;            zf2 = 0.5 * zb2</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;            sfbmc(1) = sfbmc(1) + zf1</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;            sfdfc(1) = sfdfc(1) + zf2</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;            sfbmc(2) = sfbmc(2) + zf1</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;            sfdfc(2) = sfdfc(2) + zf2</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;<span class="comment">!         sfbmc(ibd) = sfbmc(ibd) + zsolar*ztdbt0</span></div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;<span class="comment">!         sfdfc(ibd) = sfdfc(ibd) + zsolar*(zfd(1) - ztdbt0)</span></div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;<span class="keywordflow">        endif</span>      <span class="comment">! end if_cf1_block</span></div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;<span class="keywordflow">      enddo</span>  lab_do_jg</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;<span class="comment">!  --- ...  end of g-point loop</span></div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;      <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;        ftoadc = ftoadc + fxdn0(nlp1,ib)</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;        ftoau0 = ftoau0 + fxup0(nlp1,ib)</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;        fsfcu0 = fsfcu0 + fxup0(1,ib)</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;        fsfcd0 = fsfcd0 + fxdn0(1,ib)</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;<span class="comment">!! --- ...  uv-b surface downward flux</span></div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;      ibd = <a class="code" href="group__module__radsw__main.html#ga177282b3087dce2f54f1233ee8631231">nuvb</a> - <a class="code" href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">nblow</a> + 1</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;      suvbf0 = fxdn0(1,ibd)</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;      <span class="keywordflow">if</span> ( cf1 &lt;= eps ) <span class="keywordflow">then</span>       <span class="comment">! clear column, set total-sky=clear-sky fluxes</span></div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;        <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;          <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;            fxupc(k,ib) = fxup0(k,ib)</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;            fxdnc(k,ib) = fxdn0(k,ib)</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;        ftoauc = ftoau0</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;        fsfcuc = fsfcu0</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;        fsfcdc = fsfcd0</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;<span class="comment">!! --- ...  surface downward beam/diffused flux components</span></div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;        sfbmc(1) = sfbm0(1)</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;        sfdfc(1) = sfdf0(1)</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;        sfbmc(2) = sfbm0(2)</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;        sfdfc(2) = sfdf0(2)</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;<span class="comment">!! --- ...  uv-b surface downward flux</span></div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;        suvbfc = suvbf0</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;      <span class="keywordflow">else</span>                        <span class="comment">! cloudy column, compute total-sky fluxes</span></div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;        <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;          <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;            fxupc(k,ib) = cf1*fxupc(k,ib) + cf0*fxup0(k,ib)</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;            fxdnc(k,ib) = cf1*fxdnc(k,ib) + cf0*fxdn0(k,ib)</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;        <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;          ftoauc = ftoauc + fxupc(nlp1,ib)</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;          fsfcuc = fsfcuc + fxupc(1,ib)</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;          fsfcdc = fsfcdc + fxdnc(1,ib)</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;<span class="comment">!! --- ...  uv-b surface downward flux</span></div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;        suvbfc = fxdnc(1,ibd)</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;<span class="comment">!! --- ...  surface downward beam/diffused flux components</span></div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;        sfbmc(1) = cf1*sfbmc(1) + cf0*sfbm0(1)</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;        sfbmc(2) = cf1*sfbmc(2) + cf0*sfbm0(2)</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;        sfdfc(1) = cf1*sfdfc(1) + cf0*sfdf0(1)</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        sfdfc(2) = cf1*sfdfc(2) + cf0*sfdf0(2)</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;<span class="keywordflow">      endif</span>    <span class="comment">! end if_cf1_block</span></div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radsw__main.html#gaeb992f35bdf7dbf9ea8709d7d91dedfd">spcvrtc</a></div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radsw__main.html#ga859cc14063a58e9d0a252e4366b9fff3">spcvrtm</a>                                                &amp;</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;     &amp;     ( ssolar,cosz,sntz,albbm,albdf,sfluxzen,cldfmc,              &amp;   <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;     &amp;       cf1,cf0,taug,taur,tauae,ssaae,asyae,taucw,ssacw,asycw,     &amp;</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;     &amp;       nlay, nlp1,                                                &amp;</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;     &amp;       fxupc,fxdnc,fxup0,fxdn0,                                   &amp;   <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;     &amp;       ftoauc,ftoau0,ftoadc,fsfcuc,fsfcu0,fsfcdc,fsfcd0,          &amp;</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;     &amp;       sfbmc,sfdfc,sfbm0,sfdf0,suvbfc,suvbf0                      &amp;</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;     &amp;     )</div><div class="line"><a name="l03066"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#ga859cc14063a58e9d0a252e4366b9fff3"> 3066</a></span>&#160;</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;<span class="comment">!  ===================  program usage description  ===================  !</span></div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="comment">!   purpose:  computes the shortwave radiative fluxes using two-stream  !</span></div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;<span class="comment">!             method of h. barker and mcica, the monte-carlo independent!</span></div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;<span class="comment">!             column approximation, for the representation of sub-grid  !</span></div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;<span class="comment">!             cloud variability (i.e. cloud overlap).                   !</span></div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;<span class="comment">!   subprograms called:  vrtqdr                                         !</span></div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;<span class="comment">!  inputs:                                                        size  !</span></div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;<span class="comment">!    ssolar  - real, incoming solar flux at top                    1    !</span></div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;<span class="comment">!    cosz    - real, cosine solar zenith angle                     1    !</span></div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;<span class="comment">!    sntz    - real, secant solar zenith angle                     1    !</span></div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;<span class="comment">!    albbm   - real, surface albedo for direct beam radiation      2    !</span></div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;<span class="comment">!    albdf   - real, surface albedo for diffused radiation         2    !</span></div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;<span class="comment">!    sfluxzen- real, spectral distribution of incoming solar flux ngptsw!</span></div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;<span class="comment">!    cldfmc  - real, layer cloud fraction for g-point        nlay*ngptsw!</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;<span class="comment">!    cf1     - real, &gt;0: cloudy sky, otherwise: clear sky          1    !</span></div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;<span class="comment">!    cf0     - real, =1-cf1                                        1    !</span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;<span class="comment">!    taug    - real, spectral optical depth for gases        nlay*ngptsw!</span></div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;<span class="comment">!    taur    - real, optical depth for rayleigh scattering   nlay*ngptsw!</span></div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;<span class="comment">!    tauae   - real, aerosols optical depth                  nlay*nbdsw !</span></div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;<span class="comment">!    ssaae   - real, aerosols single scattering albedo       nlay*nbdsw !</span></div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;<span class="comment">!    asyae   - real, aerosols asymmetry factor               nlay*nbdsw !</span></div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;<span class="comment">!    taucw   - real, weighted cloud optical depth            nlay*nbdsw !</span></div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;<span class="comment">!    ssacw   - real, weighted cloud single scat albedo       nlay*nbdsw !</span></div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;<span class="comment">!    asycw   - real, weighted cloud asymmetry factor         nlay*nbdsw !</span></div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;<span class="comment">!    nlay,nlp1 - integer,  number of layers/levels                 1    !</span></div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;<span class="comment">!  output variables:                                                    !</span></div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;<span class="comment">!    fxupc   - real, tot sky upward flux                     nlp1*nbdsw !</span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;<span class="comment">!    fxdnc   - real, tot sky downward flux                   nlp1*nbdsw !</span></div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;<span class="comment">!    fxup0   - real, clr sky upward flux                     nlp1*nbdsw !</span></div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;<span class="comment">!    fxdn0   - real, clr sky downward flux                   nlp1*nbdsw !</span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;<span class="comment">!    ftoauc  - real, tot sky toa upwd flux                         1    !</span></div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;<span class="comment">!    ftoau0  - real, clr sky toa upwd flux                         1    !</span></div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;<span class="comment">!    ftoadc  - real, toa downward (incoming) solar flux            1    !</span></div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;<span class="comment">!    fsfcuc  - real, tot sky sfc upwd flux                         1    !</span></div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;<span class="comment">!    fsfcu0  - real, clr sky sfc upwd flux                         1    !</span></div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;<span class="comment">!    fsfcdc  - real, tot sky sfc dnwd flux                         1    !</span></div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;<span class="comment">!    fsfcd0  - real, clr sky sfc dnwd flux                         1    !</span></div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;<span class="comment">!    sfbmc   - real, tot sky sfc dnwd beam flux (nir/uv+vis)       2    !</span></div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;<span class="comment">!    sfdfc   - real, tot sky sfc dnwd diff flux (nir/uv+vis)       2    !</span></div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;<span class="comment">!    sfbm0   - real, clr sky sfc dnwd beam flux (nir/uv+vis)       2    !</span></div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;<span class="comment">!    sfdf0   - real, clr sky sfc dnwd diff flux (nir/uv+vis)       2    !</span></div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;<span class="comment">!    suvbfc  - real, tot sky sfc dnwd uv-b flux                    1    !</span></div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;<span class="comment">!    suvbf0  - real, clr sky sfc dnwd uv-b flux                    1    !</span></div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;<span class="comment">!  internal variables:                                                  !</span></div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;<span class="comment">!    zrefb   - real, direct beam reflectivity for clear/cloudy    nlp1  !</span></div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;<span class="comment">!    zrefd   - real, diffuse reflectivity for clear/cloudy        nlp1  !</span></div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;<span class="comment">!    ztrab   - real, direct beam transmissivity for clear/cloudy  nlp1  !</span></div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;<span class="comment">!    ztrad   - real, diffuse transmissivity for clear/cloudy      nlp1  !</span></div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;<span class="comment">!    zldbt   - real, layer beam transmittance for clear/cloudy    nlp1  !</span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;<span class="comment">!    ztdbt   - real, lev total beam transmittance for clr/cld     nlp1  !</span></div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;<span class="comment">!  control parameters in module &quot;physparam&quot;                             !</span></div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;<span class="comment">!    iswmode - control flag for 2-stream transfer schemes               !</span></div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;<span class="comment">!              = 1 delta-eddington    (joseph et al., 1976)             !</span></div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;<span class="comment">!              = 2 pifm               (zdunkowski et al., 1980)         !</span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;<span class="comment">!              = 3 discrete ordinates (liou, 1973)                      !</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;<span class="comment">!  original code description                                            !</span></div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;<span class="comment">!  method:                                                              !</span></div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;<span class="comment">!  -------                                                              !</span></div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;<span class="comment">!     standard delta-eddington, p.i.f.m., or d.o.m. layer calculations. !</span></div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;<span class="comment">!     kmodts  = 1 eddington (joseph et al., 1976)                       !</span></div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;<span class="comment">!             = 2 pifm (zdunkowski et al., 1980)                        !</span></div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;<span class="comment">!             = 3 discrete ordinates (liou, 1973)                       !</span></div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;<span class="comment">!  modifications:                                                       !</span></div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;<span class="comment">!  --------------                                                       !</span></div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;<span class="comment">!   original: h. barker                                                 !</span></div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;<span class="comment">!   revision: merge with rrtmg_sw: j.-j.morcrette, ecmwf, feb 2003      !</span></div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;<span class="comment">!   revision: add adjustment for earth/sun distance:mjiacono,aer,oct2003!</span></div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;<span class="comment">!   revision: bug fix for use of palbp and palbd: mjiacono, aer, nov2003!</span></div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;<span class="comment">!   revision: bug fix to apply delta scaling to clear sky: aer, dec2004 !</span></div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;<span class="comment">!   revision: code modified so that delta scaling is not done in cloudy !</span></div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;<span class="comment">!             profiles if routine cldprop is used; delta scaling can be !</span></div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;<span class="comment">!             applied by swithcing code below if cldprop is not used to !</span></div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;<span class="comment">!             get cloud properties. aer, jan 2005                       !</span></div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;<span class="comment">!   revision: uniform formatting for rrtmg: mjiacono, aer, jul 2006     !</span></div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;<span class="comment">!   revision: use exponential lookup table for transmittance: mjiacono, !</span></div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;<span class="comment">!             aer, aug 2007                                             !</span></div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;<span class="comment">!  ======================  end of description block  =================  !</span></div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;<span class="comment">!  ---  constant parameters:</span></div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: zcrit = 0.9999995 <span class="comment">! thresold for conservative scattering</span></div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: zsr3  = sqrt(3.0)</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: od_lo = 0.06</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: eps1  = 1.0e-8</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,ngptsw)</span>, <span class="keywordtype">intent(in)</span> ::      &amp;</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;     &amp;       taug, taur, cldfmc</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,nbdsw)</span>,  <span class="keywordtype">intent(in)</span> ::      &amp;</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;     &amp;       taucw, ssacw, asycw, tauae, ssaae, asyae</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(ngptsw)</span>, <span class="keywordtype">intent(in)</span> :: sfluxzen</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(2)</span>,  <span class="keywordtype">intent(in)</span> :: albbm, albdf</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: cosz, sntz, cf1, cf0, ssolar</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlp1,nbdsw)</span>, <span class="keywordtype">intent(out)</span> ::      &amp;</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;     &amp;       fxupc, fxdnc, fxup0, fxdn0</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(2)</span>, <span class="keywordtype">intent(out)</span> :: sfbmc, sfdfc, &amp;</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;     &amp;       sfbm0, sfdf0</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(out)</span> :: suvbfc, suvbf0, ftoadc,     &amp;</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;     &amp;       ftoauc, ftoau0, fsfcuc, fsfcu0, fsfcdc, fsfcd0</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span> :: ztaus, zssas, zasys,    &amp;</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;     &amp;       zldbt0</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlp1)</span> :: zrefb, zrefd, ztrab,    &amp;</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;     &amp;       ztrad, ztdbt, zldbt, zfu, zfd</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: ztau1, zssa1, zasy1, ztau0, zssa0,       &amp;</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;     &amp;       zasy0, zasy3, zssaw, zasyw, zgam1, zgam2, zgam3, zgam4,    &amp;</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;     &amp;       za1, za2, zb1, zb2, zrk, zrk2, zrp, zrp1, zrm1, zrpp,      &amp;</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;     &amp;       zrkg1, zrkg3, zrkg4, zexp1, zexm1, zexp2, zexm2, zden1,    &amp;</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;     &amp;       zexp3, zexp4, ze1r45, ftind, zsolar, ztdbt0, zr1, zr2,     &amp;</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;     &amp;       zr3, zr4, zr5, zt1, zt2, zt3, zf1, zf2, zrpp1</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;      <span class="keywordtype">integer</span> :: ib, ibd, jb, jg, k, kp, itind</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;      <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;        <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;          fxdnc(k,ib) = f_zero</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;          fxupc(k,ib) = f_zero</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;          fxdn0(k,ib) = f_zero</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;          fxup0(k,ib) = f_zero</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;      ftoadc = f_zero</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;      ftoauc = f_zero</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;      ftoau0 = f_zero</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;      fsfcuc = f_zero</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;      fsfcu0 = f_zero</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;      fsfcdc = f_zero</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;      fsfcd0 = f_zero</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;<span class="comment">!! --- ...  uv-b surface downward fluxes</span></div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;      suvbfc  = f_zero</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;      suvbf0  = f_zero</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;<span class="comment">!! --- ...  output surface flux components</span></div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;      sfbmc(1) = f_zero</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;      sfbmc(2) = f_zero</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;      sfdfc(1) = f_zero</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;      sfdfc(2) = f_zero</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;      sfbm0(1) = f_zero</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;      sfbm0(2) = f_zero</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;      sfdf0(1) = f_zero</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;      sfdf0(2) = f_zero</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;<span class="comment">!  --- ...  loop over all g-points in each band</span></div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;      lab_do_jg : <span class="keywordflow">do</span> jg = 1, <a class="code" href="namespacemodule__radsw__parameters.html#adc3e4d5a848d50e2883e05c62f61bc97">ngptsw</a></div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;        jb = <a class="code" href="namespacemodule__radsw__parameters.html#afdd8496d7eaa017f7f1e08e998945c1e">ngb</a>(jg)</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;        ib = jb + 1 - <a class="code" href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">nblow</a></div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;        ibd = <a class="code" href="group__module__radsw__main.html#gad295d723dd7d269cb51c73923a4cbb94">idxsfc</a>(jb)         <span class="comment">! spectral band index</span></div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;        zsolar = ssolar * sfluxzen(jg)</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;<span class="comment">!  --- ...  set up toa direct beam and surface values (beam and diff)</span></div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;        ztdbt(nlp1) = f_one</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;        ztdbt0   = f_one</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;        zldbt(1) = f_zero</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;        <span class="keywordflow">if</span> (ibd /= 0) <span class="keywordflow">then</span></div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;          zrefb(1) = albbm(ibd)</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;          zrefd(1) = albdf(ibd)</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;          zrefb(1) = 0.5 * (albbm(1) + albbm(2))</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;          zrefd(1) = 0.5 * (albdf(1) + albdf(2))</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;        ztrab(1) = f_zero</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;        ztrad(1) = f_zero</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;        <span class="keywordflow">do</span> k = nlay, 1, -1</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;          kp = k + 1</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;          ztau0 = max( ftiny, taur(k,jg)+taug(k,jg)+tauae(k,ib) )</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;          zssa0 = taur(k,jg) + tauae(k,ib)*ssaae(k,ib)</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;          zasy0 = asyae(k,ib)*ssaae(k,ib)*tauae(k,ib)</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;          zssaw = min( oneminus, zssa0 / ztau0 )</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;          zasyw = zasy0 / max( ftiny, zssa0 )</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;<span class="comment">!  --- ...  saving clear-sky quantities for later total-sky usage</span></div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;          ztaus(k) = ztau0</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;          zssas(k) = zssa0</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;          zasys(k) = zasy0</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;<span class="comment">!  --- ...  delta scaling for clear-sky condition</span></div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;          za1 = zasyw * zasyw</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;          za2 = zssaw * za1</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;          ztau1 = (f_one - za2) * ztau0</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;          zssa1 = (zssaw - za2) / (f_one - za2)</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;<span class="comment">!org      zasy1 = (zasyw - za1) / (f_one - za1)   ! this line is replaced by the next</span></div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;          zasy1 = zasyw / (f_one + zasyw)         <span class="comment">! to reduce truncation error</span></div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;          zasy3 = 0.75 * zasy1</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;<span class="comment">!  --- ...  general two-stream expressions</span></div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;          <span class="keywordflow">if</span> ( iswmode == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;            zgam1 = 1.75 - zssa1 * (f_one + zasy3)</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;            zgam2 =-0.25 + zssa1 * (f_one - zasy3)</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;            zgam3 = 0.5  - zasy3 * cosz</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;          <span class="keywordflow">elseif</span> ( iswmode == 2 ) <span class="keywordflow">then</span>               <span class="comment">! pifm</span></div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;            zgam1 = 2.0 - zssa1 * (1.25 + zasy3)</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;            zgam2 = 0.75* zssa1 * (f_one- zasy1)</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;            zgam3 = 0.5 - zasy3 * cosz</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;          <span class="keywordflow">elseif</span> ( iswmode == 3 ) <span class="keywordflow">then</span>               <span class="comment">! discrete ordinates</span></div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;            zgam1 = zsr3 * (2.0 - zssa1 * (1.0 + zasy1)) * 0.5</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;            zgam2 = zsr3 * zssa1 * (1.0 - zasy1) * 0.5</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;            zgam3 = (1.0 - zsr3 * zasy1 * cosz) * 0.5</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;          zgam4 = f_one - zgam3</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;<span class="comment">!  --- ...  compute homogeneous reflectance and transmittance</span></div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;          <span class="keywordflow">if</span> ( zssaw &gt;= zcrit ) <span class="keywordflow">then</span>    <span class="comment">! for conservative scattering</span></div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;            za1 = zgam1 * cosz - zgam3</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;            za2 = zgam1 * ztau1</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;<span class="comment">!  --- ...  use exponential lookup table for transmittance, or expansion</span></div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;<span class="comment">!           of exponential for low optical depth</span></div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;            zb1 = min( ztau1*sntz , 500.0 )</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;            <span class="keywordflow">if</span> ( zb1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;              zb2 = f_one - zb1 + 0.5*zb1*zb1</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;              ftind = zb1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zb1)</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;              itind = ftind*<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a> + 0.5</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;              zb2 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;<span class="comment">!      ...  collimated beam</span></div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;            zrefb(kp) = max(f_zero, min(f_one,                          &amp;</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;     &amp;                  (za2 - za1*(f_one - zb2))/(f_one + za2) ))</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;            ztrab(kp) = max(f_zero, min(f_one, f_one-zrefb(kp) ))</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;<span class="comment">!      ...  isotropic incidence</span></div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;            zrefd(kp) = max(f_zero, min(f_one, za2/(f_one + za2) ))</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;            ztrad(kp) = max(f_zero, min(f_one, f_one-zrefd(kp) ))</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;          <span class="keywordflow">else</span>                          <span class="comment">! for non-conservative scattering</span></div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;            za1 = zgam1*zgam4 + zgam2*zgam3</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;            za2 = zgam1*zgam3 + zgam2*zgam4</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;            zrk = sqrt( (zgam1 - zgam2) * (zgam1 + zgam2) )</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;            zrk2= 2.0 * zrk</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;            zrp  = zrk * cosz</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;            zrp1 = f_one + zrp</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;            zrm1 = f_one - zrp</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;            zrpp1= f_one - zrp*zrp</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;            zrpp = sign( max(flimit, abs(zrpp1)), zrpp1 )    <span class="comment">! avoid numerical singularity</span></div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;            zrkg1= zrk + zgam1</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;            zrkg3= zrk * zgam3</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;            zrkg4= zrk * zgam4</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;            zr1  = zrm1 * (za2 + zrkg3)</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;            zr2  = zrp1 * (za2 - zrkg3)</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;            zr3  = zrk2 * (zgam3 - za2*cosz)</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;            zr4  = zrpp * zrkg1</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;            zr5  = zrpp * (zrk - zgam1)</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;            zt1  = zrp1 * (za1 + zrkg4)</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;            zt2  = zrm1 * (za1 - zrkg4)</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;            zt3  = zrk2 * (zgam4 + za1*cosz)</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;<span class="comment">!  --- ...  use exponential lookup table for transmittance, or expansion</span></div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;<span class="comment">!           of exponential for low optical depth</span></div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;            zb1 = min( zrk*ztau1, 500.0 )</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;            <span class="keywordflow">if</span> ( zb1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;              zexm1 = f_one - zb1 + 0.5*zb1*zb1</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;              ftind = zb1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zb1)</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;              itind = ftind*<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a> + 0.5</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;              zexm1 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;            zexp1 = f_one / zexm1</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;            zb2 = min( sntz*ztau1, 500.0 )</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;            <span class="keywordflow">if</span> ( zb2 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;              zexm2 = f_one - zb2 + 0.5*zb2*zb2</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;              ftind = zb2 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zb2)</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;              itind = ftind*<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a> + 0.5</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;              zexm2 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;            zexp2 = f_one / zexm2</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;            ze1r45 = zr4*zexp1 + zr5*zexm1</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;<span class="comment">!      ...  collimated beam</span></div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;            <span class="keywordflow">if</span> (ze1r45&gt;=-eps1 .and. ze1r45&lt;=eps1) <span class="keywordflow">then</span></div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;              zrefb(kp) = eps1</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;              ztrab(kp) = zexm2</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;              zden1 = zssa1 / ze1r45</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;              zrefb(kp) = max(f_zero, min(f_one,                        &amp;</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;     &amp;                    (zr1*zexp1 - zr2*zexm1 - zr3*zexm2)*zden1 ))</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;              ztrab(kp) = max(f_zero, min(f_one, zexm2*(f_one           &amp;</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;     &amp;                  - (zt1*zexp1 - zt2*zexm1 - zt3*zexp2)*zden1) ))</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;<span class="comment">!      ...  diffuse beam</span></div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;            zden1 = zr4 / (ze1r45 * zrkg1)</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;            zrefd(kp) = max(f_zero, min(f_one,                          &amp;</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;     &amp;                  zgam2*(zexp1 - zexm1)*zden1 ))</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;            ztrad(kp) = max(f_zero, min(f_one, zrk2*zden1 ))</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;<span class="keywordflow">          endif</span>    <span class="comment">! end if_zssaw_block</span></div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;<span class="comment">!  --- ...  direct beam transmittance. use exponential lookup table</span></div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;<span class="comment">!           for transmittance, or expansion of exponential for low</span></div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;<span class="comment">!           optical depth</span></div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;          zr1 = ztau1 * sntz</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;          <span class="keywordflow">if</span> ( zr1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;            zexp3 = f_one - zr1 + 0.5*zr1*zr1</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;            ftind = zr1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zr1)</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;            itind = max(0, min(<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>, int(0.5+<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>*ftind) ))</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;            zexp3 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;          ztdbt(k)  = zexp3 * ztdbt(kp)</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;          zldbt(kp) = zexp3</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;<span class="comment">!  --- ...  pre-delta-scaling clear and cloudy direct beam transmittance</span></div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;<span class="comment">!           (must use &#39;orig&#39;, unscaled cloud optical depth)</span></div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;          zr1 = ztau0 * sntz</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;          <span class="keywordflow">if</span> ( zr1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;            zexp4 = f_one - zr1 + 0.5*zr1*zr1</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;            ftind = zr1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zr1)</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;            itind = max(0, min(<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>, int(0.5+<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>*ftind) ))</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;            zexp4 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;          zldbt0(k) = zexp4</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;          ztdbt0 = zexp4 * ztdbt0</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;<span class="keywordflow">        enddo</span>    <span class="comment">! end do_k_loop</span></div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;        <span class="keyword">call </span><a class="code" href="group__module__radsw__main.html#gad227ccde86a01f47c1ab3b4bed5ba1be">vrtqdr</a>                                                     &amp;</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;     &amp;     ( zrefb,zrefd,ztrab,ztrad,zldbt,ztdbt,                       &amp;</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;     &amp;       nlay, nlp1,                                                &amp;</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;     &amp;       zfu, zfd                                                   &amp;</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;     &amp;     )</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;<span class="comment">!  --- ...  compute upward and downward fluxes at levels</span></div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;        <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;          fxup0(k,ib) = fxup0(k,ib) + zsolar*zfu(k)</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;          fxdn0(k,ib) = fxdn0(k,ib) + zsolar*zfd(k)</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;<span class="comment">!! --- ...  surface downward beam/diffuse flux components</span></div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;        zb1 = zsolar*ztdbt0</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;        zb2 = zsolar*(zfd(1) - ztdbt0)</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;        <span class="keywordflow">if</span> (ibd /= 0) <span class="keywordflow">then</span></div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;          sfbm0(ibd) = sfbm0(ibd) + zb1</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;          sfdf0(ibd) = sfdf0(ibd) + zb2</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;          zf1 = 0.5 * zb1</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;          zf2 = 0.5 * zb2</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;          sfbm0(1) = sfbm0(1) + zf1</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;          sfdf0(1) = sfdf0(1) + zf2</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;          sfbm0(2) = sfbm0(2) + zf1</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;          sfdf0(2) = sfdf0(2) + zf2</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;<span class="comment">!       sfbm0(ibd) = sfbm0(ibd) + zsolar*ztdbt0</span></div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;<span class="comment">!       sfdf0(ibd) = sfdf0(ibd) + zsolar*(zfd(1) - ztdbt0)</span></div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;        <span class="keywordflow">if</span> ( cf1 &gt; eps ) <span class="keywordflow">then</span></div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;<span class="comment">!  --- ...  set up toa direct beam and surface values (beam and diff)</span></div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;          ztdbt0 = f_one</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;          zldbt(1) = f_zero</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;          <span class="keywordflow">do</span> k = nlay, 1, -1</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;            kp = k + 1</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;            <span class="keywordflow">if</span> ( cldfmc(k,jg) &gt; ftiny ) <span class="keywordflow">then</span>      <span class="comment">! it is a cloudy-layer</span></div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;              ztau0 = ztaus(k) + taucw(k,ib)</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;              zssa0 = zssas(k) + ssacw(k,ib)</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;              zasy0 = zasys(k) + asycw(k,ib)</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;              zssaw = min(oneminus, zssa0 / ztau0)</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;              zasyw = zasy0 / max(ftiny, zssa0)</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;<span class="comment">!  --- ...  delta scaling for total-sky condition</span></div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;              za1 = zasyw * zasyw</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;              za2 = zssaw * za1</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;              ztau1 = (f_one - za2) * ztau0</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;              zssa1 = (zssaw - za2) / (f_one - za2)</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;<span class="comment">!org          zasy1 = (zasyw - za1) / (f_one - za1)</span></div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;              zasy1 = zasyw / (f_one + zasyw)</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;              zasy3 = 0.75 * zasy1</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;<span class="comment">!  --- ...  general two-stream expressions</span></div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;              <span class="keywordflow">if</span> ( iswmode == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;                zgam1 = 1.75 - zssa1 * (f_one + zasy3)</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;                zgam2 =-0.25 + zssa1 * (f_one - zasy3)</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;                zgam3 = 0.5  - zasy3 * cosz</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;              <span class="keywordflow">elseif</span> ( iswmode == 2 ) <span class="keywordflow">then</span>               <span class="comment">! pifm</span></div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;                zgam1 = 2.0 - zssa1 * (1.25 + zasy3)</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;                zgam2 = 0.75* zssa1 * (f_one- zasy1)</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;                zgam3 = 0.5 - zasy3 * cosz</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;              <span class="keywordflow">elseif</span> ( iswmode == 3 ) <span class="keywordflow">then</span>               <span class="comment">! discrete ordinates</span></div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;                zgam1 = zsr3 * (2.0 - zssa1 * (1.0 + zasy1)) * 0.5</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;                zgam2 = zsr3 * zssa1 * (1.0 - zasy1) * 0.5</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;                zgam3 = (1.0 - zsr3 * zasy1 * cosz) * 0.5</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;              zgam4 = f_one - zgam3</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;<span class="comment">!  --- ...  compute homogeneous reflectance and transmittance</span></div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;              <span class="keywordflow">if</span> ( zssaw &gt;= zcrit ) <span class="keywordflow">then</span>    <span class="comment">! for conservative scattering</span></div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;                za1 = zgam1 * cosz - zgam3</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;                za2 = zgam1 * ztau1</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;<span class="comment">!  --- ...  use exponential lookup table for transmittance, or expansion</span></div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;<span class="comment">!           of exponential for low optical depth</span></div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;                zb1 = min( ztau1*sntz , 500.0 )</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;                <span class="keywordflow">if</span> ( zb1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;                  zb2 = f_one - zb1 + 0.5*zb1*zb1</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;                  ftind = zb1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zb1)</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;                  itind = ftind*<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a> + 0.5</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;                  zb2 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;<span class="keywordflow">                endif</span></div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;<span class="comment">!      ...  collimated beam</span></div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;                zrefb(kp) = max(f_zero, min(f_one,                      &amp;</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;     &amp;                      (za2 - za1*(f_one - zb2))/(f_one + za2) ))</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;                ztrab(kp) = max(f_zero, min(f_one, f_one-zrefb(kp)))</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;<span class="comment">!      ...  isotropic incidence</span></div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;                zrefd(kp) = max(f_zero, min(f_one, za2 / (f_one+za2) ))</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;                ztrad(kp) = max(f_zero, min(f_one, f_one - zrefd(kp) ))</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;              <span class="keywordflow">else</span>                          <span class="comment">! for non-conservative scattering</span></div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;                za1 = zgam1*zgam4 + zgam2*zgam3</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;                za2 = zgam1*zgam3 + zgam2*zgam4</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;                zrk = sqrt( (zgam1 - zgam2) * (zgam1 + zgam2) )</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;                zrk2= 2.0 * zrk</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;                zrp  = zrk * cosz</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;                zrp1 = f_one + zrp</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;                zrm1 = f_one - zrp</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;                zrpp1= f_one - zrp*zrp</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;                zrpp = sign( max(flimit, abs(zrpp1)), zrpp1 )    <span class="comment">! avoid numerical singularity</span></div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;                zrkg1= zrk + zgam1</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;                zrkg3= zrk * zgam3</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;                zrkg4= zrk * zgam4</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;                zr1  = zrm1 * (za2 + zrkg3)</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;                zr2  = zrp1 * (za2 - zrkg3)</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;                zr3  = zrk2 * (zgam3 - za2*cosz)</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;                zr4  = zrpp * zrkg1</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;                zr5  = zrpp * (zrk - zgam1)</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;                zt1  = zrp1 * (za1 + zrkg4)</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;                zt2  = zrm1 * (za1 - zrkg4)</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;                zt3  = zrk2 * (zgam4 + za1*cosz)</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;<span class="comment">!  --- ...  use exponential lookup table for transmittance, or expansion</span></div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;<span class="comment">!           of exponential for low optical depth</span></div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;                zb1 = min( zrk*ztau1, 500.0 )</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;                <span class="keywordflow">if</span> ( zb1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;                  zexm1 = f_one - zb1 + 0.5*zb1*zb1</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;                  ftind = zb1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zb1)</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;                  itind = ftind*<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a> + 0.5</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;                  zexm1 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;<span class="keywordflow">                endif</span></div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;                zexp1 = f_one / zexm1</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;                zb2 = min( ztau1*sntz, 500.0 )</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;                <span class="keywordflow">if</span> ( zb2 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;                  zexm2 = f_one - zb2 + 0.5*zb2*zb2</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;                  ftind = zb2 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zb2)</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;                  itind = ftind*<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a> + 0.5</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;                  zexm2 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;<span class="keywordflow">                endif</span></div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;                zexp2 = f_one / zexm2</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;                ze1r45 = zr4*zexp1 + zr5*zexm1</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;<span class="comment">!      ...  collimated beam</span></div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;                <span class="keywordflow">if</span> ( ze1r45&gt;=-eps1 .and. ze1r45&lt;=eps1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;                  zrefb(kp) = eps1</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;                  ztrab(kp) = zexm2</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;                  zden1 = zssa1 / ze1r45</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;                  zrefb(kp) = max(f_zero, min(f_one,                    &amp;</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;     &amp;                        (zr1*zexp1-zr2*zexm1-zr3*zexm2)*zden1 ))</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;                  ztrab(kp) = max(f_zero, min(f_one, zexm2*(f_one -     &amp;</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;     &amp;                        (zt1*zexp1-zt2*zexm1-zt3*zexp2)*zden1) ))</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;<span class="keywordflow">                endif</span></div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;<span class="comment">!      ...  diffuse beam</span></div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;                zden1 = zr4 / (ze1r45 * zrkg1)</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;                zrefd(kp) = max(f_zero, min(f_one,                      &amp;</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;     &amp;                      zgam2*(zexp1 - zexm1)*zden1 ))</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;                ztrad(kp) = max(f_zero, min(f_one, zrk2*zden1 ))</div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;<span class="keywordflow">              endif</span>    <span class="comment">! end if_zssaw_block</span></div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;<span class="comment">!  --- ...  direct beam transmittance. use exponential lookup table</span></div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;<span class="comment">!           for transmittance, or expansion of exponential for low</span></div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;<span class="comment">!           optical depth</span></div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;              zr1 = ztau1 * sntz</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;              <span class="keywordflow">if</span> ( zr1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;                zexp3 = f_one - zr1 + 0.5*zr1*zr1</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;                ftind = zr1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zr1)</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;                itind = max(0, min(<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>, int(0.5+<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>*ftind) ))</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;                zexp3 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;              zldbt(kp) = zexp3</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;              ztdbt(k)  = zexp3 * ztdbt(kp)</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;<span class="comment">!  --- ...  pre-delta-scaling clear and cloudy direct beam transmittance</span></div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;<span class="comment">!           (must use &#39;orig&#39;, unscaled cloud optical depth)</span></div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;              zr1 = ztau0 * sntz</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;              <span class="keywordflow">if</span> ( zr1 &lt;= od_lo ) <span class="keywordflow">then</span></div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;                zexp4 = f_one - zr1 + 0.5*zr1*zr1</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;                ftind = zr1 / (<a class="code" href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">bpade</a> + zr1)</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;                itind = max(0, min(<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>, int(0.5+<a class="code" href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">ntbmx</a>*ftind) ))</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;                zexp4 = <a class="code" href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">exp_tbl</a>(itind)</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;              ztdbt0 = zexp4 * ztdbt0</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;            <span class="keywordflow">else</span>     <span class="comment">! if_cldfmc_block  ---  it is a clear layer</span></div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;<span class="comment">!  --- ...  direct beam transmittance</span></div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;              ztdbt(k) = zldbt(kp) * ztdbt(kp)</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;<span class="comment">!  --- ...  pre-delta-scaling clear and cloudy direct beam transmittance</span></div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;              ztdbt0 = zldbt0(k) * ztdbt0</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;<span class="keywordflow">            endif</span>    <span class="comment">! end if_cldfmc_block</span></div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;<span class="keywordflow">          enddo</span>   <span class="comment">! end do_k_loop</span></div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;<span class="comment">!  --- ...  perform vertical quadrature</span></div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;          <span class="keyword">call </span><a class="code" href="group__module__radsw__main.html#gad227ccde86a01f47c1ab3b4bed5ba1be">vrtqdr</a>                                                   &amp;</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;     &amp;     ( zrefb,zrefd,ztrab,ztrad,zldbt,ztdbt,                       &amp;</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;     &amp;       nlay, nlp1,                                                &amp;</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;     &amp;       zfu, zfd                                                   &amp;</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;     &amp;     )</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;<span class="comment">!  --- ...  compute upward and downward fluxes at levels</span></div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;          <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;            fxupc(k,ib) = fxupc(k,ib) + zsolar*zfu(k)</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;            fxdnc(k,ib) = fxdnc(k,ib) + zsolar*zfd(k)</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;<span class="comment">! --- ...  surface downward beam/diffused flux components</span></div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;          zb1 = zsolar*ztdbt0</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;          zb2 = zsolar*(zfd(1) - ztdbt0)</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;          <span class="keywordflow">if</span> (ibd /= 0) <span class="keywordflow">then</span></div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;           sfbmc(ibd) = sfbmc(ibd) + zb1</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;           sfdfc(ibd) = sfdfc(ibd) + zb2</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;            zf1 = 0.5 * zb1</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;            zf2 = 0.5 * zb2</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;            sfbmc(1) = sfbmc(1) + zf1</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;            sfdfc(1) = sfdfc(1) + zf2</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;            sfbmc(2) = sfbmc(2) + zf1</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;            sfdfc(2) = sfdfc(2) + zf2</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;<span class="comment">!         sfbmc(ibd) = sfbmc(ibd) + zsolar*ztdbt0</span></div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;<span class="comment">!         sfdfc(ibd) = sfdfc(ibd) + zsolar*(zfd(1) - ztdbt0)</span></div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;<span class="keywordflow">        endif</span>      <span class="comment">! end if_cf1_block</span></div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;<span class="keywordflow">      enddo</span>  lab_do_jg</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;<span class="comment">!  --- ...  end of g-point loop</span></div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;      <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;        ftoadc = ftoadc + fxdn0(nlp1,ib)</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;        ftoau0 = ftoau0 + fxup0(nlp1,ib)</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;        fsfcu0 = fsfcu0 + fxup0(1,ib)</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;        fsfcd0 = fsfcd0 + fxdn0(1,ib)</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;<span class="comment">!! --- ...  uv-b surface downward flux</span></div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;      ibd = <a class="code" href="group__module__radsw__main.html#ga177282b3087dce2f54f1233ee8631231">nuvb</a> - <a class="code" href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">nblow</a> + 1</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;      suvbf0 = fxdn0(1,ibd)</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;      <span class="keywordflow">if</span> ( cf1 &lt;= eps ) <span class="keywordflow">then</span>       <span class="comment">! clear column, set total-sky=clear-sky fluxes</span></div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;        <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;          <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;            fxupc(k,ib) = fxup0(k,ib)</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;            fxdnc(k,ib) = fxdn0(k,ib)</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;        ftoauc = ftoau0</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;        fsfcuc = fsfcu0</div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;        fsfcdc = fsfcd0</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;</div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;<span class="comment">!! --- ...  surface downward beam/diffused flux components</span></div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;        sfbmc(1) = sfbm0(1)</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;        sfdfc(1) = sfdf0(1)</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;        sfbmc(2) = sfbm0(2)</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;        sfdfc(2) = sfdf0(2)</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;<span class="comment">!! --- ...  uv-b surface downward flux</span></div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;        suvbfc = suvbf0</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;      <span class="keywordflow">else</span>                        <span class="comment">! cloudy column, compute total-sky fluxes</span></div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;        <span class="keywordflow">do</span> ib = 1, nbdsw</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;          ftoauc = ftoauc + fxupc(nlp1,ib)</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;          fsfcuc = fsfcuc + fxupc(1,ib)</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;          fsfcdc = fsfcdc + fxdnc(1,ib)</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;<span class="comment">!! --- ...  uv-b surface downward flux</span></div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;        suvbfc = fxdnc(1,ibd)</div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;<span class="keywordflow">      endif</span>    <span class="comment">! end if_cf1_block</span></div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radsw__main.html#ga859cc14063a58e9d0a252e4366b9fff3">spcvrtm</a></div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radsw__main.html#gad227ccde86a01f47c1ab3b4bed5ba1be">vrtqdr</a>                                                 &amp;</div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;     &amp;     ( zrefb,zrefd,ztrab,ztrad,zldbt,ztdbt,                       &amp; <span class="comment">! inputs</span></div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;     &amp;       nlay, nlp1,                                                &amp;</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;     &amp;       zfu, zfd                                                   &amp; <span class="comment">! outputs:</span></div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;     &amp;     )</div><div class="line"><a name="l03770"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#gad227ccde86a01f47c1ab3b4bed5ba1be"> 3770</a></span>&#160;</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;<span class="comment">!  ===================  program usage description  ===================  !</span></div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;<span class="comment">!   purpose:  computes the upward and downward radiation fluxes         !</span></div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;<span class="comment">!   interface:  &quot;vrtqdr&quot; is called by &quot;spcvrc&quot; and &quot;spcvrm&quot;             !</span></div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;<span class="comment">!   subroutines called : none                                           !</span></div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;<span class="comment">!  input variables:                                                     !</span></div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;<span class="comment">!    zrefb(NLP1)     - layer direct beam reflectivity                   !</span></div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;<span class="comment">!    zrefd(NLP1)     - layer diffuse reflectivity                       !</span></div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;<span class="comment">!    ztrab(NLP1)     - layer direct beam transmissivity                 !</span></div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;<span class="comment">!    ztrad(NLP1)     - layer diffuse transmissivity                     !</span></div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;<span class="comment">!    zldbt(NLP1)     - layer mean beam transmittance                    !</span></div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;<span class="comment">!    ztdbt(NLP1)     - total beam transmittance at levels               !</span></div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;<span class="comment">!    NLAY, NLP1      - number of layers/levels                          !</span></div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;<span class="comment">!  output variables:                                                    !</span></div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;<span class="comment">!    zfu  (NLP1)     - upward flux at layer interface                   !</span></div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;<span class="comment">!    zfd  (NLP1)     - downward flux at layer interface                 !</span></div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;<span class="comment">!  ======================  end of description block  =================  !</span></div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlp1)</span>, <span class="keywordtype">intent(in)</span> :: zrefb,      &amp;</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;     &amp;       zrefd, ztrab, ztrad, ztdbt, zldbt</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlp1)</span>, <span class="keywordtype">intent(out)</span> :: zfu, zfd</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlp1)</span> :: zrupb,zrupd,zrdnd,ztdn</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: zden1</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;      <span class="keywordtype">integer</span> :: k, kp</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;        zrupb(1) = zrefb(1)        <span class="comment">! direct beam</span></div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;        zrupd(1) = zrefd(1)        <span class="comment">! diffused</span></div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;          kp = k + 1</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;          zden1 = f_one / ( f_one - zrupd(k)*zrefd(kp) )</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;          zrupb(kp) = zrefb(kp) + ( ztrad(kp) *                         &amp;</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;     &amp;                ( (ztrab(kp) - zldbt(kp))*zrupd(k) +              &amp;</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;     &amp;                zldbt(kp)*zrupb(k)) ) * zden1</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;          zrupd(kp) = zrefd(kp) + ztrad(kp)*ztrad(kp)*zrupd(k)*zden1</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;        ztdn(nlp1) = f_one</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;        zrdnd(nlp1) = f_zero</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;        ztdn(nlay) = ztrab(nlp1)</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;        zrdnd(nlay) = zrefd(nlp1)</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;        <span class="keywordflow">do</span> k = nlay, 2, -1</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;          zden1 = f_one / (f_one - zrefd(k)*zrdnd(k))</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;          ztdn(k-1) = ztdbt(k)*ztrab(k) + ( ztrad(k) *                 &amp;</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;     &amp;                 ( (ztdn(k) - ztdbt(k)) + ztdbt(k) *              &amp;</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;     &amp;                 zrefb(k)*zrdnd(k) )) * zden1</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;          zrdnd(k-1) = zrefd(k) + ztrad(k)*ztrad(k)*zrdnd(k)*zden1</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;        <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;          zden1 = f_one / (f_one - zrdnd(k)*zrupd(k))</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;          zfu(k) = ( ztdbt(k)*zrupb(k) +                                &amp;</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;     &amp;             (ztdn(k) - ztdbt(k))*zrupd(k) ) * zden1</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;          zfd(k) = ztdbt(k) + ( ztdn(k) - ztdbt(k) +                    &amp;</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;     &amp;             ztdbt(k)*zrupb(k)*zrdnd(k) ) * zden1</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radsw__main.html#gad227ccde86a01f47c1ab3b4bed5ba1be">vrtqdr</a></div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radsw__main.html#gaa82121d21c1e8f2ca938378249fea135">taumol</a>                                                 &amp;</div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;     &amp;     ( colamt,colmol,fac00,fac01,fac10,fac11,jp,jt,jt1,laytrop,   &amp; <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;     &amp;       forfac,forfrac,indfor,selffac,selffrac,indself, nlay,      &amp;</div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;     &amp;       sfluxzen, taug, taur                                       &amp;  <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;     &amp;     )</div><div class="line"><a name="l03906"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#gaa82121d21c1e8f2ca938378249fea135"> 3906</a></span>&#160;</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;<span class="comment">!  ==================   program usage description   ==================  !</span></div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;<span class="comment">!  description:                                                         !</span></div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;<span class="comment">!    calculate optical depths for gaseous absorption and rayleigh       !</span></div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;<span class="comment">!    scattering.                                                        !</span></div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;<span class="comment">!  subroutines called: taugb## (## = 16 - 29)                           !</span></div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;<span class="comment">!  inputs:                                                         size !</span></div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;<span class="comment">!    colamt  - real, column amounts of absorbing gases the index        !</span></div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;<span class="comment">!                    are for h2o, co2, o3, n2o, ch4, and o2,            !</span></div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;<span class="comment">!                    respectively (molecules/cm**2)          nlay*maxgas!</span></div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;<span class="comment">!    colmol  - real, total column amount (dry air+water vapor)     nlay !</span></div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;<span class="comment">!    facij   - real, for each layer, these are factors that are         !</span></div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;<span class="comment">!                    needed to compute the interpolation factors        !</span></div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;<span class="comment">!                    that multiply the appropriate reference k-         !</span></div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;<span class="comment">!                    values.  a value of 0/1 for i,j indicates          !</span></div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;<span class="comment">!                    that the corresponding factor multiplies           !</span></div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;<span class="comment">!                    reference k-value for the lower/higher of the      !</span></div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;<span class="comment">!                    two appropriate temperatures, and altitudes,       !</span></div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;<span class="comment">!                    respectively.                                 naly !</span></div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;<span class="comment">!    jp      - real, the index of the lower (in altitude) of the        !</span></div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;<span class="comment">!                    two appropriate ref pressure levels needed         !</span></div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;<span class="comment">!                    for interpolation.                            nlay !</span></div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;<span class="comment">!    jt, jt1 - integer, the indices of the lower of the two approp      !</span></div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;<span class="comment">!                    ref temperatures needed for interpolation (for     !</span></div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;<span class="comment">!                    pressure levels jp and jp+1, respectively)    nlay !</span></div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;<span class="comment">!    laytrop - integer, tropopause layer index                       1  !</span></div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;<span class="comment">!    forfac  - real, scale factor needed to foreign-continuum.     nlay !</span></div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;<span class="comment">!    forfrac - real, factor needed for temperature interpolation   nlay !</span></div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;<span class="comment">!    indfor  - integer, index of the lower of the two appropriate       !</span></div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;<span class="comment">!                    reference temperatures needed for foreign-         !</span></div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;<span class="comment">!                    continuum interpolation                       nlay !</span></div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;<span class="comment">!    selffac - real, scale factor needed to h2o self-continuum.    nlay !</span></div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;<span class="comment">!    selffrac- real, factor needed for temperature interpolation        !</span></div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;<span class="comment">!                    of reference h2o self-continuum data          nlay !</span></div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;<span class="comment">!    indself - integer, index of the lower of the two appropriate       !</span></div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;<span class="comment">!                    reference temperatures needed for the self-        !</span></div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;<span class="comment">!                    continuum interpolation                       nlay !</span></div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;<span class="comment">!    nlay    - integer, number of vertical layers                    1  !</span></div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;<span class="comment">!  output:                                                              !</span></div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;<span class="comment">!    sfluxzen- real, spectral distribution of incoming solar flux ngptsw!</span></div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;<span class="comment">!    taug    - real, spectral optical depth for gases        nlay*ngptsw!</span></div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;<span class="comment">!    taur    - real, opt depth for rayleigh scattering       nlay*ngptsw!</span></div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;<span class="comment">!  ===================================================================  !</span></div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;<span class="comment">!  ************     original subprogram description    ***************  !</span></div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;<span class="comment">!                  optical depths developed for the                     !</span></div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;<span class="comment">!                rapid radiative transfer model (rrtm)                  !</span></div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;<span class="comment">!            atmospheric and environmental research, inc.               !</span></div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;<span class="comment">!                        131 hartwell avenue                            !</span></div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;<span class="comment">!                        lexington, ma 02421                            !</span></div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;<span class="comment">!                           eli j. mlawer                               !</span></div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;<span class="comment">!                         jennifer delamere                             !</span></div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;<span class="comment">!                         steven j. taubman                             !</span></div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;<span class="comment">!                         shepard a. clough                             !</span></div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;<span class="comment">!                       email:  mlawer@aer.com                          !</span></div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;<span class="comment">!                       email:  jdelamer@aer.com                        !</span></div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;<span class="comment">!        the authors wish to acknowledge the contributions of the       !</span></div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;<span class="comment">!        following people:  patrick d. brown, michael j. iacono,        !</span></div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;<span class="comment">!        ronald e. farren, luke chen, robert bergstrom.                 !</span></div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;<span class="comment">!  taumol                                                               !</span></div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;<span class="comment">!    this file contains the subroutines taugbn (where n goes from       !</span></div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;<span class="comment">!    16 to 29).  taugbn calculates the optical depths and Planck        !</span></div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;<span class="comment">!    fractions per g-value and layer for band n.                        !</span></div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;<span class="comment">!  output:  optical depths (unitless)                                   !</span></div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;<span class="comment">!           fractions needed to compute planck functions at every layer !</span></div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;<span class="comment">!           and g-value                                                 !</span></div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;<span class="comment">!  modifications:                                                       !</span></div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;<span class="comment">! revised: adapted to f90 coding, j.-j.morcrette, ecmwf, feb 2003       !</span></div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;<span class="comment">! revised: modified for g-point reduction, mjiacono, aer, dec 2003      !</span></div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;<span class="comment">! revised: reformatted for consistency with rrtmg_lw, mjiacono, aer,    !</span></div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;<span class="comment">!          jul 2006                                                     !</span></div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;<span class="comment">!  ======================  end of description block  =================  !</span></div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;      <span class="keywordtype">integer</span>,               <span class="keywordtype">intent(in)</span> :: nlay, laytrop</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(in)</span> :: indfor, indself,          &amp;</div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;     &amp;       jp, jt, jt1</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>,  <span class="keywordtype">intent(in)</span> :: colmol,    &amp;</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;     &amp;       fac00, fac01, fac10, fac11, forfac, forfrac, selffac,      &amp;</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;     &amp;       selffrac</div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,maxgas)</span>,<span class="keywordtype">intent(in)</span> :: colamt</div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;</div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(ngptsw)</span>, <span class="keywordtype">intent(out)</span> :: sfluxzen</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;</div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,ngptsw)</span>, <span class="keywordtype">intent(out)</span> ::     &amp;</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;     &amp;       taug, taur</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: fs, speccomb, specmult, colm1, colm2</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nlay,nblow:nbhgh)</span> :: id0, id1</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;</div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;      <span class="keywordtype">integer</span> :: ibd, j, jb, js, k, klow, khgh, klim, ks, njb, ns</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;<span class="comment">!  --- ...  loop over each spectral band</span></div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;      <span class="keywordflow">do</span> jb = <a class="code" href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">nblow</a>, <a class="code" href="namespacemodule__radsw__parameters.html#a39e5ca4fd5defbc2545ee39bbf50d61b">nbhgh</a></div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;</div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;<span class="comment">!  --- ...  indices for layer optical depth</span></div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;        <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;          id0(k,jb) = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(jb)</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;          id1(k,jb) = ( jp(k)   *5 + (jt1(k)-1)) * nspa(jb)</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;        <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;          id0(k,jb) = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(jb)</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;          id1(k,jb) = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(jb)</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;<span class="comment">!  --- ...  calculate spectral flux at toa</span></div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;</div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;        ibd = <a class="code" href="namespacemodule__radsw__sflux.html#acb1498ecf044449dbe6d7a5630fdc375">ibx</a>(jb)</div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;        njb = ng(jb)</div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;        ns  = <a class="code" href="namespacemodule__radsw__parameters.html#a715ab3195493dff0639da443c21e4fb5">ngs</a>(jb)</div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;</div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;        <span class="keywordflow">select case</span> (jb)</div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;          <span class="keywordflow">case</span> (16, 20, 23, 25, 26, 29)</div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;</div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;            <span class="keywordflow">do</span> j = 1, njb</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;              sfluxzen(ns+j) = <a class="code" href="namespacemodule__radsw__sflux.html#a84205f359fb3e1a0e1d03e755c52dc78">sfluxref01</a>(j,1,ibd)</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;          <span class="keywordflow">case</span> (27)</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;            <span class="keywordflow">do</span> j = 1, njb</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;              sfluxzen(ns+j) = scalekur * <a class="code" href="namespacemodule__radsw__sflux.html#a84205f359fb3e1a0e1d03e755c52dc78">sfluxref01</a>(j,1,ibd)</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;<span class="keywordflow">          case default</span></div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;            <span class="keywordflow">if</span> (jb==17 .or. jb==28) <span class="keywordflow">then</span></div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;</div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;              ks = nlay</div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;              lab_do_k1 : <span class="keywordflow">do</span> k = laytrop, nlay-1</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;                <span class="keywordflow">if</span> (jp(k)&lt;<a class="code" href="namespacemodule__radsw__sflux.html#a90c56da1bcadbea0b42e12487c1c1eec">layreffr</a>(jb) .and. jp(k+1)&gt;=<a class="code" href="namespacemodule__radsw__sflux.html#a90c56da1bcadbea0b42e12487c1c1eec">layreffr</a>(jb)) <span class="keywordflow">then</span></div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;                  ks = k + 1</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;                  <span class="keywordflow">exit</span> lab_do_k1</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;<span class="keywordflow">                endif</span></div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;<span class="keywordflow">              enddo</span>  lab_do_k1</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;</div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;              colm1 = colamt(ks,<a class="code" href="namespacemodule__radsw__sflux.html#ac2864b4501e9bc3804d45d14f4aab472">ix1</a>(jb))</div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;              colm2 = colamt(ks,<a class="code" href="namespacemodule__radsw__sflux.html#a92703c3e826f7e81267c6b7ae31ebe42">ix2</a>(jb))</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;              speccomb = colm1 + <a class="code" href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">strrat</a>(jb)*colm2</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;              specmult = <a class="code" href="namespacemodule__radsw__sflux.html#a7d1a386e92555bcb09239ab098d8b398">specwt</a>(jb) * min( oneminus, colm1/speccomb )</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;              js = 1 + int( specmult )</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;              fs = mod(specmult, f_one)</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;              <span class="keywordflow">do</span> j = 1, njb</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;                sfluxzen(ns+j) = <a class="code" href="namespacemodule__radsw__sflux.html#aa57fca862289bd57327b9c3ef27e3e2f">sfluxref02</a>(j,js,ibd)                   &amp;</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;     &amp;           + fs * (<a class="code" href="namespacemodule__radsw__sflux.html#aa57fca862289bd57327b9c3ef27e3e2f">sfluxref02</a>(j,js+1,ibd) - <a class="code" href="namespacemodule__radsw__sflux.html#aa57fca862289bd57327b9c3ef27e3e2f">sfluxref02</a>(j,js,ibd))</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;</div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;              ks = laytrop</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;              lab_do_k2 : <span class="keywordflow">do</span> k = 1, laytrop-1</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;                <span class="keywordflow">if</span> (jp(k)&lt;<a class="code" href="namespacemodule__radsw__sflux.html#a90c56da1bcadbea0b42e12487c1c1eec">layreffr</a>(jb) .and. jp(k+1)&gt;=<a class="code" href="namespacemodule__radsw__sflux.html#a90c56da1bcadbea0b42e12487c1c1eec">layreffr</a>(jb)) <span class="keywordflow">then</span></div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;                  ks = k + 1</div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;                  <span class="keywordflow">exit</span> lab_do_k2</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;<span class="keywordflow">                endif</span></div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;<span class="keywordflow">              enddo</span>  lab_do_k2</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;              colm1 = colamt(ks,<a class="code" href="namespacemodule__radsw__sflux.html#ac2864b4501e9bc3804d45d14f4aab472">ix1</a>(jb))</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;              colm2 = colamt(ks,<a class="code" href="namespacemodule__radsw__sflux.html#a92703c3e826f7e81267c6b7ae31ebe42">ix2</a>(jb))</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;              speccomb = colm1 + <a class="code" href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">strrat</a>(jb)*colm2</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;              specmult = <a class="code" href="namespacemodule__radsw__sflux.html#a7d1a386e92555bcb09239ab098d8b398">specwt</a>(jb) * min( oneminus, colm1/speccomb )</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;              js = 1 + int( specmult )</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;              fs = mod(specmult, f_one)</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;</div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;              <span class="keywordflow">do</span> j = 1, njb</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;                sfluxzen(ns+j) = <a class="code" href="namespacemodule__radsw__sflux.html#a95d2640cf0e6cf0ba4a8ca1758806e48">sfluxref03</a>(j,js,ibd)                   &amp;</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;     &amp;           + fs * (<a class="code" href="namespacemodule__radsw__sflux.html#a95d2640cf0e6cf0ba4a8ca1758806e48">sfluxref03</a>(j,js+1,ibd) - <a class="code" href="namespacemodule__radsw__sflux.html#a95d2640cf0e6cf0ba4a8ca1758806e48">sfluxref03</a>(j,js,ibd))</div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;<span class="keywordflow">        end select</span></div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;</div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;</div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;</div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;      <span class="keyword">call </span><a class="code" href="group__module__radsw__main.html#ga8702f5f6285ff1a5cbfad740545fffb6">taumol16</a></div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;      <span class="keyword">call </span><a class="code" href="radsw__main_8f.html#ae46d1c061726bcde426caadd80b1fd80">taumol17</a></div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;      <span class="keyword">call </span><a class="code" href="radsw__main_8f.html#a06f6f2b0ef60df93c267a667a2e1aa36">taumol18</a></div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;      <span class="keyword">call </span><a class="code" href="radsw__main_8f.html#a776a0d78fda9f4fd0f1153b55be597df">taumol19</a></div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;      <span class="keyword">call </span><a class="code" href="radsw__main_8f.html#a6eb9a29728a986ea6b15240adebd4a0c">taumol20</a></div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;      <span class="keyword">call </span><a class="code" href="radsw__main_8f.html#a54619c48147f35da2d7855dc488c0ff4">taumol21</a></div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;      <span class="keyword">call </span><a class="code" href="radsw__main_8f.html#a3b5392346eee35eb13a2a54175b6338b">taumol22</a></div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;      <span class="keyword">call </span><a class="code" href="radsw__main_8f.html#adf5d73763c80ec079b72dda7d74cba94">taumol23</a></div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;      <span class="keyword">call </span><a class="code" href="radsw__main_8f.html#ae0abf1a08aa5d6ca14bfea83d0603716">taumol24</a></div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;      <span class="keyword">call </span><a class="code" href="radsw__main_8f.html#a21b72d6de9247eccb20de836ea76cf7a">taumol25</a></div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;      <span class="keyword">call </span><a class="code" href="radsw__main_8f.html#a20261640145a5d10e091ef3c67763175">taumol26</a></div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;      <span class="keyword">call </span><a class="code" href="radsw__main_8f.html#a7d2cea6cc0cfde853d25a14ba0efcca2">taumol27</a></div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;      <span class="keyword">call </span><a class="code" href="radsw__main_8f.html#a2113c76707f43cf91fe5926ab69d1b8b">taumol28</a></div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;      <span class="keyword">call </span><a class="code" href="radsw__main_8f.html#a08e2db10432d07392f29a49bc5b5c640">taumol29</a></div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;</div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;<span class="comment">! =================</span></div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;      <span class="keyword">contains</span></div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;<span class="comment">! =================</span></div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radsw__main.html#ga8702f5f6285ff1a5cbfad740545fffb6">taumol16</a></div><div class="line"><a name="l04158"></a><span class="lineno"><a class="line" href="group__module__radsw__main.html#ga8702f5f6285ff1a5cbfad740545fffb6"> 4158</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;<span class="comment">!     band 16:  2600-3250 cm-1 (low - h2o,ch4; high - ch4)             !</span></div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb16.html">module_radsw_kgb16</a></div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: speccomb, specmult, tauray, fs, fs1,     &amp;</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;     &amp;       fac000,fac001,fac010,fac011, fac100,fac101,fac110,fac111</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;      <span class="keywordtype">integer</span> :: ind01, ind02, ind03, ind04, ind11, ind12, ind13, ind14</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;      <span class="keywordtype">integer</span> :: inds, indf, indsp, indfp, j, js, k</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;</div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;<span class="comment">!  --- ... compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;<span class="comment">!          temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;<span class="comment">!          vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;        tauray = colmol(k) * <a class="code" href="group__module__radsw__kgbnn.html#ga27964e0300eb686acf1ed3c8459d3810">rayl</a></div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;        <span class="keywordflow">do</span> j = 1, ng16</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;          taur(k,ns16+j) = tauray</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;        speccomb = colamt(k,1) + <a class="code" href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">strrat</a>(16)*colamt(k,5)</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;        specmult = 8.0 * min( oneminus, colamt(k,1)/speccomb )</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;        js = 1 + int( specmult )</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;        fs = mod( specmult, f_one )</div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;        fs1= f_one - fs</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;        fac000 = fs1 * fac00(k)</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;        fac010 = fs1 * fac10(k)</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;        fac100 = fs  * fac00(k)</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;        fac110 = fs  * fac10(k)</div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;        fac001 = fs1 * fac01(k)</div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;        fac011 = fs1 * fac11(k)</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;        fac101 = fs  * fac01(k)</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;        fac111 = fs  * fac11(k)</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;        ind01 = id0(k,16) + js</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;        ind03 = ind01 + 9</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;        ind04 = ind01 + 10</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;        ind11 = id1(k,16) + js</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;        ind13 = ind11 + 9</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;        ind14 = ind11 + 10</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;        inds = indself(k)</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;        indsp= inds + 1</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;        indfp= indf + 1</div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;        <span class="keywordflow">do</span> j = 1, ng16</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;          taug(k,ns16+j) = speccomb                                     &amp;</div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;     &amp;        *( fac000 * <a class="code" href="group__module__radsw__kgbnn.html#ga51fe40b5f24cc461850fe5be40d18869">absa</a>(ind01,j) + fac100 * <a class="code" href="group__module__radsw__kgbnn.html#ga51fe40b5f24cc461850fe5be40d18869">absa</a>(ind02,j)        &amp;</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;     &amp;        +  fac010 * <a class="code" href="group__module__radsw__kgbnn.html#ga51fe40b5f24cc461850fe5be40d18869">absa</a>(ind03,j) + fac110 * <a class="code" href="group__module__radsw__kgbnn.html#ga51fe40b5f24cc461850fe5be40d18869">absa</a>(ind04,j)        &amp;</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;     &amp;        +  fac001 * <a class="code" href="group__module__radsw__kgbnn.html#ga51fe40b5f24cc461850fe5be40d18869">absa</a>(ind11,j) + fac101 * <a class="code" href="group__module__radsw__kgbnn.html#ga51fe40b5f24cc461850fe5be40d18869">absa</a>(ind12,j)        &amp;</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;     &amp;        +  fac011 * <a class="code" href="group__module__radsw__kgbnn.html#ga51fe40b5f24cc461850fe5be40d18869">absa</a>(ind13,j) + fac111 * <a class="code" href="group__module__radsw__kgbnn.html#ga51fe40b5f24cc461850fe5be40d18869">absa</a>(ind14,j) )      &amp;</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;     &amp;        + colamt(k,1) * (selffac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#ga77d98f3fb766d4abfd494332ce67c2c2">selfref</a>(inds,j)            &amp;</div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;     &amp;        + selffrac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#ga77d98f3fb766d4abfd494332ce67c2c2">selfref</a>(indsp,j)-<a class="code" href="group__module__radsw__kgbnn.html#ga77d98f3fb766d4abfd494332ce67c2c2">selfref</a>(inds,j)))       &amp;</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;     &amp;        + forfac(k) * (forref(indf,j) + forfrac(k)                &amp;</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;     &amp;        * (forref(indfp,j) - forref(indf,j))))</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;</div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;        ind01 = id0(k,16) + 1</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;        ind11 = id1(k,16) + 1</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;</div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;        <span class="keywordflow">do</span> j = 1, ng16</div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;          taug(k,ns16+j) = colamt(k,5)                                  &amp;</div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;     &amp;      * ( fac00(k)*<a class="code" href="group__module__radsw__kgbnn.html#gafe8639128e4f7a48f133b7399addcb79">absb</a>(ind01,j) + fac10(k)*<a class="code" href="group__module__radsw__kgbnn.html#gafe8639128e4f7a48f133b7399addcb79">absb</a>(ind02,j)         &amp;</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;     &amp;      +   fac01(k)*<a class="code" href="group__module__radsw__kgbnn.html#gafe8639128e4f7a48f133b7399addcb79">absb</a>(ind11,j) + fac11(k)*<a class="code" href="group__module__radsw__kgbnn.html#gafe8639128e4f7a48f133b7399addcb79">absb</a>(ind12,j) )</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;</div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radsw__main.html#ga8702f5f6285ff1a5cbfad740545fffb6">taumol16</a></div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;</div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radsw__main_8f.html#ae46d1c061726bcde426caadd80b1fd80">taumol17</a></div><div class="line"><a name="l04255"></a><span class="lineno"><a class="line" href="radsw__main_8f.html#ae46d1c061726bcde426caadd80b1fd80"> 4255</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;</div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;<span class="comment">!     band 17:  3250-4000 cm-1 (low - h2o,co2; high - h2o,co2)         !</span></div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb17.html">module_radsw_kgb17</a></div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;</div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: speccomb, specmult, tauray, fs, fs1,     &amp;</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;     &amp;       fac000,fac001,fac010,fac011, fac100,fac101,fac110,fac111</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;      <span class="keywordtype">integer</span> :: ind01, ind02, ind03, ind04, ind11, ind12, ind13, ind14</div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;      <span class="keywordtype">integer</span> :: inds, indf, indsp, indfp, j, js, k</div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;</div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;</div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;<span class="comment">!  --- ...  compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;<span class="comment">!           temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;<span class="comment">!           vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;</div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;        tauray = colmol(k) * <a class="code" href="group__module__radsw__kgbnn.html#gaa4862628a06e0e08d1db5637bc62ffa5">rayl</a></div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;        <span class="keywordflow">do</span> j = 1, ng17</div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;          taur(k,ns17+j) = tauray</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;        speccomb = colamt(k,1) + <a class="code" href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">strrat</a>(17)*colamt(k,2)</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;        specmult = 8.0 * min(oneminus, colamt(k,1) / speccomb)</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;        fs1= f_one - fs</div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;        fac000 = fs1 * fac00(k)</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;        fac010 = fs1 * fac10(k)</div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;        fac100 = fs  * fac00(k)</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;        fac110 = fs  * fac10(k)</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;        fac001 = fs1 * fac01(k)</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;        fac011 = fs1 * fac11(k)</div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;        fac101 = fs  * fac01(k)</div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;        fac111 = fs  * fac11(k)</div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;</div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;        ind01 = id0(k,17) + js</div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;        ind03 = ind01 + 9</div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;        ind04 = ind01 + 10</div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;        ind11 = id1(k,17) + js</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;        ind13 = ind11 + 9</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;        ind14 = ind11 + 10</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;</div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;        inds = indself(k)</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;        indsp= inds + 1</div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;        indfp= indf + 1</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;        <span class="keywordflow">do</span> j = 1, ng17</div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;          taug(k,ns17+j) = speccomb                                     &amp;</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;     &amp;        * ( fac000 * <a class="code" href="group__module__radsw__kgbnn.html#ga19083764c3dfe437282b032517baf3ed">absa</a>(ind01,j) + fac100 * <a class="code" href="group__module__radsw__kgbnn.html#ga19083764c3dfe437282b032517baf3ed">absa</a>(ind02,j)       &amp;</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;     &amp;        +   fac010 * <a class="code" href="group__module__radsw__kgbnn.html#ga19083764c3dfe437282b032517baf3ed">absa</a>(ind03,j) + fac110 * <a class="code" href="group__module__radsw__kgbnn.html#ga19083764c3dfe437282b032517baf3ed">absa</a>(ind04,j)       &amp;</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;     &amp;        +   fac001 * <a class="code" href="group__module__radsw__kgbnn.html#ga19083764c3dfe437282b032517baf3ed">absa</a>(ind11,j) + fac101 * <a class="code" href="group__module__radsw__kgbnn.html#ga19083764c3dfe437282b032517baf3ed">absa</a>(ind12,j)       &amp;</div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;     &amp;        +   fac011 * <a class="code" href="group__module__radsw__kgbnn.html#ga19083764c3dfe437282b032517baf3ed">absa</a>(ind13,j) + fac111 * <a class="code" href="group__module__radsw__kgbnn.html#ga19083764c3dfe437282b032517baf3ed">absa</a>(ind14,j) )     &amp;</div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;     &amp;        + colamt(k,1) * (selffac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#gaade34dfbe8c5f380088b6e03acc727c9">selfref</a>(inds,j)            &amp;</div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;     &amp;        + selffrac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#gaade34dfbe8c5f380088b6e03acc727c9">selfref</a>(indsp,j)-<a class="code" href="group__module__radsw__kgbnn.html#gaade34dfbe8c5f380088b6e03acc727c9">selfref</a>(inds,j)))       &amp;</div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;     &amp;        + forfac(k) * (forref(indf,j) + forfrac(k)                &amp;</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;     &amp;        * (forref(indfp,j) - forref(indf,j))))</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;        speccomb = colamt(k,1) + <a class="code" href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">strrat</a>(17)*colamt(k,2)</div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;        specmult = 4.0 * min(oneminus, colamt(k,1) / speccomb)</div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;</div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;        fs1= f_one - fs</div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;        fac000 = fs1 * fac00(k)</div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;        fac010 = fs1 * fac10(k)</div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;        fac100 = fs  * fac00(k)</div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;        fac110 = fs  * fac10(k)</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;        fac001 = fs1 * fac01(k)</div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;        fac011 = fs1 * fac11(k)</div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;        fac101 = fs  * fac01(k)</div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;        fac111 = fs  * fac11(k)</div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;</div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;        ind01 = id0(k,17) + js</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;        ind03 = ind01 + 5</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;        ind04 = ind01 + 6</div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;        ind11 = id1(k,17) + js</div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;        ind13 = ind11 + 5</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;        ind14 = ind11 + 6</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;        indfp= indf + 1</div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;        <span class="keywordflow">do</span> j = 1, ng17</div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;          taug(k,ns17+j) = speccomb                                     &amp;</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;     &amp;        * ( fac000 * <a class="code" href="group__module__radsw__kgbnn.html#gaef407d13a88f5e1bfd20652ab3010e2f">absb</a>(ind01,j) + fac100 * <a class="code" href="group__module__radsw__kgbnn.html#gaef407d13a88f5e1bfd20652ab3010e2f">absb</a>(ind02,j)       &amp;</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;     &amp;        +   fac010 * <a class="code" href="group__module__radsw__kgbnn.html#gaef407d13a88f5e1bfd20652ab3010e2f">absb</a>(ind03,j) + fac110 * <a class="code" href="group__module__radsw__kgbnn.html#gaef407d13a88f5e1bfd20652ab3010e2f">absb</a>(ind04,j)       &amp;</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;     &amp;        +   fac001 * <a class="code" href="group__module__radsw__kgbnn.html#gaef407d13a88f5e1bfd20652ab3010e2f">absb</a>(ind11,j) + fac101 * <a class="code" href="group__module__radsw__kgbnn.html#gaef407d13a88f5e1bfd20652ab3010e2f">absb</a>(ind12,j)       &amp;</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;     &amp;        +   fac011 * <a class="code" href="group__module__radsw__kgbnn.html#gaef407d13a88f5e1bfd20652ab3010e2f">absb</a>(ind13,j) + fac111 * <a class="code" href="group__module__radsw__kgbnn.html#gaef407d13a88f5e1bfd20652ab3010e2f">absb</a>(ind14,j) )     &amp;</div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;     &amp;        + colamt(k,1) * forfac(k) * (forref(indf,j)               &amp;</div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;     &amp;        + forfrac(k) * (forref(indfp,j) - forref(indf,j)))</div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;</div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radsw__main_8f.html#ae46d1c061726bcde426caadd80b1fd80">taumol17</a></div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radsw__main_8f.html#a06f6f2b0ef60df93c267a667a2e1aa36">taumol18</a></div><div class="line"><a name="l04378"></a><span class="lineno"><a class="line" href="radsw__main_8f.html#a06f6f2b0ef60df93c267a667a2e1aa36"> 4378</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;</div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;<span class="comment">!     band 18:  4000-4650 cm-1 (low - h2o,ch4; high - ch4)             !</span></div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb18.html">module_radsw_kgb18</a></div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;</div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: speccomb, specmult, tauray, fs, fs1,     &amp;</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;     &amp;       fac000,fac001,fac010,fac011, fac100,fac101,fac110,fac111</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;      <span class="keywordtype">integer</span> :: ind01, ind02, ind03, ind04, ind11, ind12, ind13, ind14</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;      <span class="keywordtype">integer</span> :: inds, indf, indsp, indfp, j, js, k</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;</div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;<span class="comment">!  --- ...  compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;<span class="comment">!           temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;<span class="comment">!           vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;        tauray = colmol(k) * <a class="code" href="group__module__radsw__kgbnn.html#ga9cd3f07e259e4982c7ef2889fee6cccb">rayl</a></div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;        <span class="keywordflow">do</span> j = 1, ng18</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;          taur(k,ns18+j) = tauray</div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;</div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;        speccomb = colamt(k,1) + <a class="code" href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">strrat</a>(18)*colamt(k,5)</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;        specmult = 8.0 * min(oneminus, colamt(k,1) / speccomb)</div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;        fs1= f_one - fs</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;        fac000 = fs1 * fac00(k)</div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;        fac010 = fs1 * fac10(k)</div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;        fac100 = fs  * fac00(k)</div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;        fac110 = fs  * fac10(k)</div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;        fac001 = fs1 * fac01(k)</div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;        fac011 = fs1 * fac11(k)</div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;        fac101 = fs  * fac01(k)</div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;        fac111 = fs  * fac11(k)</div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;</div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;        ind01 = id0(k,18) + js</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;        ind03 = ind01 + 9</div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;        ind04 = ind01 + 10</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;        ind11 = id1(k,18) + js</div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;        ind13 = ind11 + 9</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;        ind14 = ind11 + 10</div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;</div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;        inds = indself(k)</div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;        indsp= inds + 1</div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;        indfp= indf + 1</div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;</div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;        <span class="keywordflow">do</span> j = 1, ng18</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;          taug(k,ns18+j) = speccomb                                     &amp;</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;     &amp;        * ( fac000 * <a class="code" href="group__module__radsw__kgbnn.html#ga8a7787776bd057b1815e92a5f58b9cac">absa</a>(ind01,j) + fac100 * <a class="code" href="group__module__radsw__kgbnn.html#ga8a7787776bd057b1815e92a5f58b9cac">absa</a>(ind02,j)       &amp;</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;     &amp;        +   fac010 * <a class="code" href="group__module__radsw__kgbnn.html#ga8a7787776bd057b1815e92a5f58b9cac">absa</a>(ind03,j) + fac110 * <a class="code" href="group__module__radsw__kgbnn.html#ga8a7787776bd057b1815e92a5f58b9cac">absa</a>(ind04,j)       &amp;</div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;     &amp;        +   fac001 * <a class="code" href="group__module__radsw__kgbnn.html#ga8a7787776bd057b1815e92a5f58b9cac">absa</a>(ind11,j) + fac101 * <a class="code" href="group__module__radsw__kgbnn.html#ga8a7787776bd057b1815e92a5f58b9cac">absa</a>(ind12,j)       &amp;</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;     &amp;        +   fac011 * <a class="code" href="group__module__radsw__kgbnn.html#ga8a7787776bd057b1815e92a5f58b9cac">absa</a>(ind13,j) + fac111 * <a class="code" href="group__module__radsw__kgbnn.html#ga8a7787776bd057b1815e92a5f58b9cac">absa</a>(ind14,j) )     &amp;</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;     &amp;        + colamt(k,1) * (selffac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#ga488f807878d909b8f69457b0d7d8ac6a">selfref</a>(inds,j)            &amp;</div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;     &amp;        + selffrac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#ga488f807878d909b8f69457b0d7d8ac6a">selfref</a>(indsp,j)-<a class="code" href="group__module__radsw__kgbnn.html#ga488f807878d909b8f69457b0d7d8ac6a">selfref</a>(inds,j)))       &amp;</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;     &amp;        + forfac(k) * (forref(indf,j) + forfrac(k)                &amp;</div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;     &amp;        * (forref(indfp,j) - forref(indf,j))))</div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;</div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;        ind01 = id0(k,18) + 1</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;        ind11 = id1(k,18) + 1</div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;</div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;        <span class="keywordflow">do</span> j = 1, ng18</div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;          taug(k,ns18+j) = colamt(k,5)                                  &amp;</div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;     &amp;        * ( fac00(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga858680db0ee5e9a599639844a91f8f06">absb</a>(ind01,j) + fac10(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga858680db0ee5e9a599639844a91f8f06">absb</a>(ind02,j)       &amp;</div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;     &amp;        +   fac01(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga858680db0ee5e9a599639844a91f8f06">absb</a>(ind11,j) + fac11(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga858680db0ee5e9a599639844a91f8f06">absb</a>(ind12,j) )</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radsw__main_8f.html#a06f6f2b0ef60df93c267a667a2e1aa36">taumol18</a></div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;</div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radsw__main_8f.html#a776a0d78fda9f4fd0f1153b55be597df">taumol19</a></div><div class="line"><a name="l04474"></a><span class="lineno"><a class="line" href="radsw__main_8f.html#a776a0d78fda9f4fd0f1153b55be597df"> 4474</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;<span class="comment">!     band 19:  4650-5150 cm-1 (low - h2o,co2; high - co2)             !</span></div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb19.html">module_radsw_kgb19</a></div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;</div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: speccomb, specmult, tauray, fs, fs1,     &amp;</div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;     &amp;       fac000,fac001,fac010,fac011, fac100,fac101,fac110,fac111</div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;</div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;      <span class="keywordtype">integer</span> :: ind01, ind02, ind03, ind04, ind11, ind12, ind13, ind14</div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;      <span class="keywordtype">integer</span> :: inds, indf, indsp, indfp, j, js, k</div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;</div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;</div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;<span class="comment">!  --- ...  compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;<span class="comment">!           temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;<span class="comment">!           vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;</div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;        tauray = colmol(k) * <a class="code" href="group__module__radsw__kgbnn.html#gac79ad61e8d246d6075664df4201373d7">rayl</a></div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;</div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;        <span class="keywordflow">do</span> j = 1, ng19</div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;          taur(k,ns19+j) = tauray</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;</div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;        speccomb = colamt(k,1) + <a class="code" href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">strrat</a>(19)*colamt(k,2)</div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;        specmult = 8.0 * min(oneminus, colamt(k,1) / speccomb)</div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;</div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;        fs1= f_one - fs</div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;        fac000 = fs1 * fac00(k)</div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;        fac010 = fs1 * fac10(k)</div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;        fac100 = fs  * fac00(k)</div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;        fac110 = fs  * fac10(k)</div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;        fac001 = fs1 * fac01(k)</div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;        fac011 = fs1 * fac11(k)</div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;        fac101 = fs  * fac01(k)</div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;        fac111 = fs  * fac11(k)</div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;</div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;        ind01 = id0(k,19) + js</div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;        ind03 = ind01 + 9</div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;        ind04 = ind01 + 10</div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;        ind11 = id1(k,19) + js</div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;        ind13 = ind11 + 9</div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;        ind14 = ind11 + 10</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;</div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;        inds = indself(k)</div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;        indsp= inds + 1</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;        indfp= indf + 1</div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;        <span class="keywordflow">do</span> j = 1, ng19</div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;          taug(k,ns19+j) = speccomb                                     &amp;</div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;     &amp;        * ( fac000 * <a class="code" href="group__module__radsw__kgbnn.html#gad9a6fc80122a2f06d9f2277d74e00c85">absa</a>(ind01,j) + fac100 * <a class="code" href="group__module__radsw__kgbnn.html#gad9a6fc80122a2f06d9f2277d74e00c85">absa</a>(ind02,j)       &amp;</div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;     &amp;        +   fac010 * <a class="code" href="group__module__radsw__kgbnn.html#gad9a6fc80122a2f06d9f2277d74e00c85">absa</a>(ind03,j) + fac110 * <a class="code" href="group__module__radsw__kgbnn.html#gad9a6fc80122a2f06d9f2277d74e00c85">absa</a>(ind04,j)       &amp;</div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;     &amp;        +   fac001 * <a class="code" href="group__module__radsw__kgbnn.html#gad9a6fc80122a2f06d9f2277d74e00c85">absa</a>(ind11,j) + fac101 * <a class="code" href="group__module__radsw__kgbnn.html#gad9a6fc80122a2f06d9f2277d74e00c85">absa</a>(ind12,j)       &amp;</div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;     &amp;        +   fac011 * <a class="code" href="group__module__radsw__kgbnn.html#gad9a6fc80122a2f06d9f2277d74e00c85">absa</a>(ind13,j) + fac111 * <a class="code" href="group__module__radsw__kgbnn.html#gad9a6fc80122a2f06d9f2277d74e00c85">absa</a>(ind14,j) )     &amp;</div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;     &amp;        + colamt(k,1) * (selffac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#gadb26cae00c05ac5c048a4db5a319a2eb">selfref</a>(inds,j)            &amp;</div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;     &amp;        + selffrac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#gadb26cae00c05ac5c048a4db5a319a2eb">selfref</a>(indsp,j)-<a class="code" href="group__module__radsw__kgbnn.html#gadb26cae00c05ac5c048a4db5a319a2eb">selfref</a>(inds,j)))       &amp;</div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;     &amp;        + forfac(k) * (forref(indf,j) + forfrac(k)                &amp;</div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;     &amp;        * (forref(indfp,j) - forref(indf,j))))</div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;        ind01 = id0(k,19) + 1</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;        ind11 = id1(k,19) + 1</div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;</div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;        <span class="keywordflow">do</span> j = 1, ng19</div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;          taug(k,ns19+j) = colamt(k,2)                                  &amp;</div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;     &amp;        * ( fac00(k)*<a class="code" href="group__module__radsw__kgbnn.html#gad1171c012a1615c4b98eb3e95276867d">absb</a>(ind01,j) + fac10(k)*<a class="code" href="group__module__radsw__kgbnn.html#gad1171c012a1615c4b98eb3e95276867d">absb</a>(ind02,j)       &amp;</div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;     &amp;        +   fac01(k)*<a class="code" href="group__module__radsw__kgbnn.html#gad1171c012a1615c4b98eb3e95276867d">absb</a>(ind11,j) + fac11(k)*<a class="code" href="group__module__radsw__kgbnn.html#gad1171c012a1615c4b98eb3e95276867d">absb</a>(ind12,j) )</div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radsw__main_8f.html#a776a0d78fda9f4fd0f1153b55be597df">taumol19</a></div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;</div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;</div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radsw__main_8f.html#a6eb9a29728a986ea6b15240adebd4a0c">taumol20</a></div><div class="line"><a name="l04570"></a><span class="lineno"><a class="line" href="radsw__main_8f.html#a6eb9a29728a986ea6b15240adebd4a0c"> 4570</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;</div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;<span class="comment">!     band 20:  5150-6150 cm-1 (low - h2o; high - h2o)                 !</span></div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb20.html">module_radsw_kgb20</a></div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;</div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tauray</div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;      <span class="keywordtype">integer</span> :: ind01, ind02, ind11, ind12</div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;      <span class="keywordtype">integer</span> :: inds, indf, indsp, indfp, j, k</div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;</div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;<span class="comment">!  --- ...  compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;<span class="comment">!           temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;<span class="comment">!           vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;</div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;        tauray = colmol(k) * <a class="code" href="group__module__radsw__kgbnn.html#ga6a00db6ce81c299d44ef5eadc1fe3b5b">rayl</a></div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;</div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;        <span class="keywordflow">do</span> j = 1, ng20</div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;          taur(k,ns20+j) = tauray</div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;</div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;        ind01 = id0(k,20) + 1</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;        ind11 = id1(k,20) + 1</div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;</div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;        inds = indself(k)</div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;        indsp= inds + 1</div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;        indfp= indf + 1</div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;</div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;        <span class="keywordflow">do</span> j = 1, ng20</div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;          taug(k,ns20+j) = colamt(k,1)                                  &amp;</div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;     &amp;        * ( (fac00(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga405eabf194b1216dd083c2344e80f5b4">absa</a>(ind01,j) + fac10(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga405eabf194b1216dd083c2344e80f5b4">absa</a>(ind02,j)      &amp;</div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;     &amp;        +    fac01(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga405eabf194b1216dd083c2344e80f5b4">absa</a>(ind11,j) + fac11(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga405eabf194b1216dd083c2344e80f5b4">absa</a>(ind12,j))     &amp;</div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;     &amp;        +   selffac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#gaa3853af5e29277f9ed2bdd397cab5029">selfref</a>(inds,j) + selffrac(k)           &amp;</div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;     &amp;        *   (<a class="code" href="group__module__radsw__kgbnn.html#gaa3853af5e29277f9ed2bdd397cab5029">selfref</a>(indsp,j) - <a class="code" href="group__module__radsw__kgbnn.html#gaa3853af5e29277f9ed2bdd397cab5029">selfref</a>(inds,j)))                 &amp;</div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;     &amp;        +   forfac(k) * (forref(indf,j) + forfrac(k)              &amp;</div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;     &amp;        *   (forref(indfp,j) - forref(indf,j))) )                 &amp;</div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;     &amp;        + colamt(k,5) * <a class="code" href="group__module__radsw__kgbnn.html#ga1757aee0ec8211f84e2c9334cc9b0f9d">absch4</a>(j)</div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;</div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;        ind01 = id0(k,20) + 1</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;        ind11 = id1(k,20) + 1</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;</div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;        indfp= indf + 1</div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;</div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;        <span class="keywordflow">do</span> j = 1, ng20</div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;          taug(k,ns20+j) = colamt(k,1)                                  &amp;</div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;     &amp;        * ( fac00(k)*<a class="code" href="group__module__radsw__kgbnn.html#gaf5b135f82f34831e86a12f726cbe47ad">absb</a>(ind01,j) + fac10(k)*<a class="code" href="group__module__radsw__kgbnn.html#gaf5b135f82f34831e86a12f726cbe47ad">absb</a>(ind02,j)       &amp;</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;     &amp;        +   fac01(k)*<a class="code" href="group__module__radsw__kgbnn.html#gaf5b135f82f34831e86a12f726cbe47ad">absb</a>(ind11,j) + fac11(k)*<a class="code" href="group__module__radsw__kgbnn.html#gaf5b135f82f34831e86a12f726cbe47ad">absb</a>(ind12,j)       &amp;</div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;     &amp;        +   forfac(k) * (forref(indf,j) + forfrac(k)              &amp;</div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;     &amp;        *   (forref(indfp,j) - forref(indf,j))) )                 &amp;</div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;     &amp;        + colamt(k,5) * <a class="code" href="group__module__radsw__kgbnn.html#ga1757aee0ec8211f84e2c9334cc9b0f9d">absch4</a>(j)</div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radsw__main_8f.html#a6eb9a29728a986ea6b15240adebd4a0c">taumol20</a></div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;</div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;</div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radsw__main_8f.html#a54619c48147f35da2d7855dc488c0ff4">taumol21</a></div><div class="line"><a name="l04652"></a><span class="lineno"><a class="line" href="radsw__main_8f.html#a54619c48147f35da2d7855dc488c0ff4"> 4652</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;<span class="comment">!     band 21:  6150-7700 cm-1 (low - h2o,co2; high - h2o,co2)         !</span></div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb21.html">module_radsw_kgb21</a></div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;</div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: speccomb, specmult, tauray, fs, fs1,     &amp;</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;     &amp;       fac000,fac001,fac010,fac011, fac100,fac101,fac110,fac111</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;      <span class="keywordtype">integer</span> :: ind01, ind02, ind03, ind04, ind11, ind12, ind13, ind14</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;      <span class="keywordtype">integer</span> :: inds, indf, indsp, indfp, j, js, k</div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;</div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;<span class="comment">!  --- ...  compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;<span class="comment">!           temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;<span class="comment">!           vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;</div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;        tauray = colmol(k) * <a class="code" href="group__module__radsw__kgbnn.html#ga8df418599fb8aef5fc8f2935a913b361">rayl</a></div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;</div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;        <span class="keywordflow">do</span> j = 1, ng21</div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;          taur(k,ns21+j) = tauray</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;</div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;        speccomb = colamt(k,1) + <a class="code" href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">strrat</a>(21)*colamt(k,2)</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;        specmult = 8.0 * min(oneminus, colamt(k,1) / speccomb)</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;        fs1= f_one - fs</div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;        fac000 = fs1 * fac00(k)</div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;        fac010 = fs1 * fac10(k)</div><div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;        fac100 = fs  * fac00(k)</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;        fac110 = fs  * fac10(k)</div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;        fac001 = fs1 * fac01(k)</div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;        fac011 = fs1 * fac11(k)</div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;        fac101 = fs  * fac01(k)</div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;        fac111 = fs  * fac11(k)</div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;</div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;        ind01 = id0(k,21) + js</div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;        ind03 = ind01 + 9</div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;        ind04 = ind01 + 10</div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;        ind11 = id1(k,21) + js</div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;        ind13 = ind11 + 9</div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;        ind14 = ind11 + 10</div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;        inds = indself(k)</div><div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;        indsp= inds + 1</div><div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;        indfp= indf + 1</div><div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;</div><div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;        <span class="keywordflow">do</span> j = 1, ng21</div><div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;          taug(k,ns21+j) = speccomb                                     &amp;</div><div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;     &amp;        * ( fac000 * <a class="code" href="group__module__radsw__kgbnn.html#ga7cce83c282d3efec6a3fe319480c270a">absa</a>(ind01,j) + fac100 * <a class="code" href="group__module__radsw__kgbnn.html#ga7cce83c282d3efec6a3fe319480c270a">absa</a>(ind02,j)       &amp;</div><div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;     &amp;        +   fac010 * <a class="code" href="group__module__radsw__kgbnn.html#ga7cce83c282d3efec6a3fe319480c270a">absa</a>(ind03,j) + fac110 * <a class="code" href="group__module__radsw__kgbnn.html#ga7cce83c282d3efec6a3fe319480c270a">absa</a>(ind04,j)       &amp;</div><div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;     &amp;        +   fac001 * <a class="code" href="group__module__radsw__kgbnn.html#ga7cce83c282d3efec6a3fe319480c270a">absa</a>(ind11,j) + fac101 * <a class="code" href="group__module__radsw__kgbnn.html#ga7cce83c282d3efec6a3fe319480c270a">absa</a>(ind12,j)       &amp;</div><div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;     &amp;        +   fac011 * <a class="code" href="group__module__radsw__kgbnn.html#ga7cce83c282d3efec6a3fe319480c270a">absa</a>(ind13,j) + fac111 * <a class="code" href="group__module__radsw__kgbnn.html#ga7cce83c282d3efec6a3fe319480c270a">absa</a>(ind14,j) )     &amp;</div><div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;     &amp;        + colamt(k,1) * (selffac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#ga76fc3e4566fcee982b99b10ea562ba93">selfref</a>(inds,j)            &amp;</div><div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;     &amp;        + selffrac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#ga76fc3e4566fcee982b99b10ea562ba93">selfref</a>(indsp,j) - <a class="code" href="group__module__radsw__kgbnn.html#ga76fc3e4566fcee982b99b10ea562ba93">selfref</a>(inds,j)))     &amp;</div><div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;     &amp;        + forfac(k) * (forref(indf,j) + forfrac(k)                &amp;</div><div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;     &amp;        * (forref(indfp,j) - forref(indf,j))))</div><div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;</div><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;        speccomb = colamt(k,1) + <a class="code" href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">strrat</a>(21)*colamt(k,2)</div><div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;        specmult = 4.0 * min(oneminus, colamt(k,1) / speccomb)</div><div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;</div><div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;        fs1= f_one - fs</div><div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;        fac000 = fs1 * fac00(k)</div><div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;        fac010 = fs1 * fac10(k)</div><div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;        fac100 = fs  * fac00(k)</div><div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;        fac110 = fs  * fac10(k)</div><div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;        fac001 = fs1 * fac01(k)</div><div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;        fac011 = fs1 * fac11(k)</div><div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;        fac101 = fs  * fac01(k)</div><div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;        fac111 = fs  * fac11(k)</div><div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;</div><div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;        ind01 = id0(k,21) + js</div><div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;        ind03 = ind01 + 5</div><div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;        ind04 = ind01 + 6</div><div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;        ind11 = id1(k,21) + js</div><div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;        ind13 = ind11 + 5</div><div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;        ind14 = ind11 + 6</div><div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;</div><div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;        indfp= indf + 1</div><div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;</div><div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;        <span class="keywordflow">do</span> j = 1, ng21</div><div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;          taug(k,ns21+j) = speccomb                                     &amp;</div><div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;     &amp;        * ( fac000 * <a class="code" href="group__module__radsw__kgbnn.html#ga1d3f12f050c90be49f109205c463b29b">absb</a>(ind01,j) + fac100 * <a class="code" href="group__module__radsw__kgbnn.html#ga1d3f12f050c90be49f109205c463b29b">absb</a>(ind02,j)       &amp;</div><div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;     &amp;        +   fac010 * <a class="code" href="group__module__radsw__kgbnn.html#ga1d3f12f050c90be49f109205c463b29b">absb</a>(ind03,j) + fac110 * <a class="code" href="group__module__radsw__kgbnn.html#ga1d3f12f050c90be49f109205c463b29b">absb</a>(ind04,j)       &amp;</div><div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;     &amp;        +   fac001 * <a class="code" href="group__module__radsw__kgbnn.html#ga1d3f12f050c90be49f109205c463b29b">absb</a>(ind11,j) + fac101 * <a class="code" href="group__module__radsw__kgbnn.html#ga1d3f12f050c90be49f109205c463b29b">absb</a>(ind12,j)       &amp;</div><div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;     &amp;        +   fac011 * <a class="code" href="group__module__radsw__kgbnn.html#ga1d3f12f050c90be49f109205c463b29b">absb</a>(ind13,j) + fac111 * <a class="code" href="group__module__radsw__kgbnn.html#ga1d3f12f050c90be49f109205c463b29b">absb</a>(ind14,j) )     &amp;</div><div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;     &amp;        + colamt(k,1) * forfac(k) * (forref(indf,j)               &amp;</div><div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;     &amp;        + forfrac(k) * (forref(indfp,j) - forref(indf,j)))</div><div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;</div><div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radsw__main_8f.html#a54619c48147f35da2d7855dc488c0ff4">taumol21</a></div><div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;</div><div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;</div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radsw__main_8f.html#a3b5392346eee35eb13a2a54175b6338b">taumol22</a></div><div class="line"><a name="l04774"></a><span class="lineno"><a class="line" href="radsw__main_8f.html#a3b5392346eee35eb13a2a54175b6338b"> 4774</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;</div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;<span class="comment">!     band 22:  7700-8050 cm-1 (low - h2o,o2; high - o2)               !</span></div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb22.html">module_radsw_kgb22</a></div><div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;</div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: speccomb, specmult, tauray, fs, fs1,     &amp;</div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;     &amp;       fac000,fac001,fac010,fac011, fac100,fac101,fac110,fac111,  &amp;</div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;     &amp;       o2adj, o2cont, o2tem</div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;</div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;      <span class="keywordtype">integer</span> :: ind01, ind02, ind03, ind04, ind11, ind12, ind13, ind14</div><div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;      <span class="keywordtype">integer</span> :: inds, indf, indsp, indfp, j, js, k</div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;</div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;<span class="comment">!  --- ...  the following factor is the ratio of total o2 band intensity (lines</span></div><div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;<span class="comment">!           and mate continuum) to o2 band intensity (line only). it is needed</span></div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;<span class="comment">!           to adjust the optical depths since the k&#39;s include only lines.</span></div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;</div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;      o2adj = 1.6</div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;      o2tem = 4.35e-4 / (350.0*2.0)</div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;</div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;</div><div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;<span class="comment">!  --- ...  compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;<span class="comment">!           temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;<span class="comment">!           vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;</div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;        tauray = colmol(k) * <a class="code" href="group__module__radsw__kgbnn.html#gae77b766677ea476e2ba14b88e511870a">rayl</a></div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;</div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;        <span class="keywordflow">do</span> j = 1, ng22</div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;          taur(k,ns22+j) = tauray</div><div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;</div><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;        o2cont   = o2tem * colamt(k,6)</div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;        speccomb = colamt(k,1) + <a class="code" href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">strrat</a>(22)*colamt(k,6)</div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;        specmult = 8.0 * min(oneminus, colamt(k,1) / speccomb)</div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;</div><div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;        fs1= f_one - fs</div><div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;        fac000 = fs1 * fac00(k)</div><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;        fac010 = fs1 * fac10(k)</div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;        fac100 = fs  * fac00(k)</div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;        fac110 = fs  * fac10(k)</div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;        fac001 = fs1 * fac01(k)</div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;        fac011 = fs1 * fac11(k)</div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;        fac101 = fs  * fac01(k)</div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;        fac111 = fs  * fac11(k)</div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;</div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;        ind01 = id0(k,22) + js</div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;        ind03 = ind01 + 9</div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;        ind04 = ind01 + 10</div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;        ind11 = id1(k,22) + js</div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;        ind13 = ind11 + 9</div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;        ind14 = ind11 + 10</div><div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;</div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;        inds = indself(k)</div><div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;        indsp= inds + 1</div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;        indfp= indf + 1</div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;</div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;        <span class="keywordflow">do</span> j = 1, ng22</div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;          taug(k,ns22+j) = speccomb                                     &amp;</div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;     &amp;        * ( fac000 * <a class="code" href="group__module__radsw__kgbnn.html#ga15ed79e7136ed6d7f11c19a81281af53">absa</a>(ind01,j) + fac100 * <a class="code" href="group__module__radsw__kgbnn.html#ga15ed79e7136ed6d7f11c19a81281af53">absa</a>(ind02,j)       &amp;</div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;     &amp;        +   fac010 * <a class="code" href="group__module__radsw__kgbnn.html#ga15ed79e7136ed6d7f11c19a81281af53">absa</a>(ind03,j) + fac110 * <a class="code" href="group__module__radsw__kgbnn.html#ga15ed79e7136ed6d7f11c19a81281af53">absa</a>(ind04,j)       &amp;</div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;     &amp;        +   fac001 * <a class="code" href="group__module__radsw__kgbnn.html#ga15ed79e7136ed6d7f11c19a81281af53">absa</a>(ind11,j) + fac101 * <a class="code" href="group__module__radsw__kgbnn.html#ga15ed79e7136ed6d7f11c19a81281af53">absa</a>(ind12,j)       &amp;</div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;     &amp;        +   fac011 * <a class="code" href="group__module__radsw__kgbnn.html#ga15ed79e7136ed6d7f11c19a81281af53">absa</a>(ind13,j) + fac111 * <a class="code" href="group__module__radsw__kgbnn.html#ga15ed79e7136ed6d7f11c19a81281af53">absa</a>(ind14,j) )     &amp;</div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;     &amp;        + colamt(k,1) * (selffac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#gabc3bd99e8ad7d1f09fb7fab7ed67a32b">selfref</a>(inds,j)            &amp;</div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;     &amp;        + selffrac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#gabc3bd99e8ad7d1f09fb7fab7ed67a32b">selfref</a>(indsp,j)-<a class="code" href="group__module__radsw__kgbnn.html#gabc3bd99e8ad7d1f09fb7fab7ed67a32b">selfref</a>(inds,j)))       &amp;</div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;     &amp;        + forfac(k) * (forref(indf,j) + forfrac(k)                &amp;</div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;     &amp;        * (forref(indfp,j) - forref(indf,j)))) + o2cont</div><div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;</div><div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;        o2cont = o2tem * colamt(k,6)</div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;</div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;        ind01 = id0(k,22) + 1</div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;        ind11 = id1(k,22) + 1</div><div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;</div><div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;        <span class="keywordflow">do</span> j = 1, ng22</div><div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;          taug(k,ns22+j) = colamt(k,6) * o2adj                          &amp;</div><div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;     &amp;        * ( fac00(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga60403e7d343c85e965f3507b0db0f2a5">absb</a>(ind01,j) + fac10(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga60403e7d343c85e965f3507b0db0f2a5">absb</a>(ind02,j)       &amp;</div><div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;     &amp;        +   fac01(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga60403e7d343c85e965f3507b0db0f2a5">absb</a>(ind11,j) + fac11(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga60403e7d343c85e965f3507b0db0f2a5">absb</a>(ind12,j) )     &amp;</div><div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;     &amp;        + o2cont</div><div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;</div><div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radsw__main_8f.html#a3b5392346eee35eb13a2a54175b6338b">taumol22</a></div><div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;</div><div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;</div><div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radsw__main_8f.html#adf5d73763c80ec079b72dda7d74cba94">taumol23</a></div><div class="line"><a name="l04883"></a><span class="lineno"><a class="line" href="radsw__main_8f.html#adf5d73763c80ec079b72dda7d74cba94"> 4883</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;</div><div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;<span class="comment">!     band 23:  8050-12850 cm-1 (low - h2o; high - nothing)            !</span></div><div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb23.html">module_radsw_kgb23</a></div><div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;</div><div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;      <span class="keywordtype">integer</span> :: ind01, ind02, ind11, ind12</div><div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;      <span class="keywordtype">integer</span> :: inds, indf, indsp, indfp, j, k</div><div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;</div><div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;</div><div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;<span class="comment">!  --- ...  compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;<span class="comment">!           temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;<span class="comment">!           vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;</div><div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;        <span class="keywordflow">do</span> j = 1, ng23</div><div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;          taur(k,ns23+j) = colmol(k) * <a class="code" href="group__module__radsw__kgbnn.html#ga40006f284543c7347eced417b9de2fc6">rayl</a>(j)</div><div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;</div><div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;        ind01 = id0(k,23) + 1</div><div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;        ind11 = id1(k,23) + 1</div><div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;</div><div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;        inds = indself(k)</div><div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;        indsp= inds + 1</div><div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;        indfp= indf + 1</div><div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;</div><div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;        <span class="keywordflow">do</span> j = 1, ng23</div><div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;          taug(k,ns23+j) = colamt(k,1) * (<a class="code" href="group__module__radsw__kgbnn.html#ga5f6ced06169db4b7470e20d5639ac54c">givfac</a>                        &amp;</div><div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;     &amp;        * ( fac00(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga2541e41c7d445a2ce73283e2fb76270c">absa</a>(ind01,j) + fac10(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga2541e41c7d445a2ce73283e2fb76270c">absa</a>(ind02,j)       &amp;</div><div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;     &amp;        +   fac01(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga2541e41c7d445a2ce73283e2fb76270c">absa</a>(ind11,j) + fac11(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga2541e41c7d445a2ce73283e2fb76270c">absa</a>(ind12,j) )     &amp;</div><div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;     &amp;        + selffac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#gae4e51bcb3c3cbaaf1476d5ab18b072e5">selfref</a>(inds,j) + selffrac(k)             &amp;</div><div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;     &amp;        * (<a class="code" href="group__module__radsw__kgbnn.html#gae4e51bcb3c3cbaaf1476d5ab18b072e5">selfref</a>(indsp,j) - <a class="code" href="group__module__radsw__kgbnn.html#gae4e51bcb3c3cbaaf1476d5ab18b072e5">selfref</a>(inds,j)))                   &amp;</div><div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;     &amp;        + forfac(k) * (forref(indf,j) + forfrac(k)                &amp;</div><div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;     &amp;        * (forref(indfp,j) - forref(indf,j))))</div><div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;</div><div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;        <span class="keywordflow">do</span> j = 1, ng23</div><div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;          taug(k,ns23+j) = f_zero</div><div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;</div><div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radsw__main_8f.html#adf5d73763c80ec079b72dda7d74cba94">taumol23</a></div><div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;</div><div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;</div><div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radsw__main_8f.html#ae0abf1a08aa5d6ca14bfea83d0603716">taumol24</a></div><div class="line"><a name="l04946"></a><span class="lineno"><a class="line" href="radsw__main_8f.html#ae0abf1a08aa5d6ca14bfea83d0603716"> 4946</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;</div><div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;<span class="comment">!     band 24:  12850-16000 cm-1 (low - h2o,o2; high - o2)             !</span></div><div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb24.html">module_radsw_kgb24</a></div><div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;</div><div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: speccomb, specmult, fs, fs1,             &amp;</div><div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;     &amp;       fac000,fac001,fac010,fac011, fac100,fac101,fac110,fac111</div><div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;</div><div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;      <span class="keywordtype">integer</span> :: ind01, ind02, ind03, ind04, ind11, ind12, ind13, ind14</div><div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;      <span class="keywordtype">integer</span> :: inds, indf, indsp, indfp, j, js, k</div><div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;</div><div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;</div><div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;<span class="comment">!  --- ...  compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;<span class="comment">!           temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;<span class="comment">!           vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;</div><div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;        speccomb = colamt(k,1) + <a class="code" href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">strrat</a>(24)*colamt(k,6)</div><div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;        specmult = 8.0 * min(oneminus, colamt(k,1) / speccomb)</div><div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;</div><div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;        fs1= f_one - fs</div><div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;        fac000 = fs1 * fac00(k)</div><div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;        fac010 = fs1 * fac10(k)</div><div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;        fac100 = fs  * fac00(k)</div><div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;        fac110 = fs  * fac10(k)</div><div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;        fac001 = fs1 * fac01(k)</div><div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;        fac011 = fs1 * fac11(k)</div><div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;        fac101 = fs  * fac01(k)</div><div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;        fac111 = fs  * fac11(k)</div><div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;</div><div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;        ind01 = id0(k,24) + js</div><div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;        ind03 = ind01 + 9</div><div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;        ind04 = ind01 + 10</div><div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;        ind11 = id1(k,24) + js</div><div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;        ind13 = ind11 + 9</div><div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;        ind14 = ind11 + 10</div><div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;</div><div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;        inds = indself(k)</div><div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;        indsp= inds + 1</div><div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;        indfp= indf + 1</div><div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;</div><div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;        <span class="keywordflow">do</span> j = 1, ng24</div><div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;          taug(k,ns24+j) = speccomb                                     &amp;</div><div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;     &amp;        * ( fac000 * <a class="code" href="group__module__radsw__kgbnn.html#ga06965ec156c4e1d18d50a70ba43bd8e1">absa</a>(ind01,j) + fac100 * <a class="code" href="group__module__radsw__kgbnn.html#ga06965ec156c4e1d18d50a70ba43bd8e1">absa</a>(ind02,j)       &amp;</div><div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;     &amp;        +   fac010 * <a class="code" href="group__module__radsw__kgbnn.html#ga06965ec156c4e1d18d50a70ba43bd8e1">absa</a>(ind03,j) + fac110 * <a class="code" href="group__module__radsw__kgbnn.html#ga06965ec156c4e1d18d50a70ba43bd8e1">absa</a>(ind04,j)       &amp;</div><div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;     &amp;        +   fac001 * <a class="code" href="group__module__radsw__kgbnn.html#ga06965ec156c4e1d18d50a70ba43bd8e1">absa</a>(ind11,j) + fac101 * <a class="code" href="group__module__radsw__kgbnn.html#ga06965ec156c4e1d18d50a70ba43bd8e1">absa</a>(ind12,j)       &amp;</div><div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;     &amp;        +   fac011 * <a class="code" href="group__module__radsw__kgbnn.html#ga06965ec156c4e1d18d50a70ba43bd8e1">absa</a>(ind13,j) + fac111 * <a class="code" href="group__module__radsw__kgbnn.html#ga06965ec156c4e1d18d50a70ba43bd8e1">absa</a>(ind14,j) )     &amp;</div><div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;     &amp;        + colamt(k,3) * <a class="code" href="group__module__radsw__kgbnn.html#ga3df78e9baa46df182aad6ff9b1662dc4">abso3a</a>(j) + colamt(k,1)                   &amp;</div><div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;     &amp;        * (selffac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#ga784e78b5964fadd3e3e1f57f7af30802">selfref</a>(inds,j) + selffrac(k)            &amp;</div><div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;     &amp;        * (<a class="code" href="group__module__radsw__kgbnn.html#ga784e78b5964fadd3e3e1f57f7af30802">selfref</a>(indsp,j) - <a class="code" href="group__module__radsw__kgbnn.html#ga784e78b5964fadd3e3e1f57f7af30802">selfref</a>(inds,j)))                   &amp;</div><div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;     &amp;        + forfac(k) * (forref(indf,j) + forfrac(k)                &amp;</div><div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;     &amp;        * (forref(indfp,j) - forref(indf,j))))</div><div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;</div><div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;          taur(k,ns24+j) = colmol(k)                                    &amp;</div><div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;     &amp;           * (<a class="code" href="group__module__radsw__kgbnn.html#gab24774576414b5d210c34916c3d19404">rayla</a>(j,js) + fs*(<a class="code" href="group__module__radsw__kgbnn.html#gab24774576414b5d210c34916c3d19404">rayla</a>(j,js+1) - <a class="code" href="group__module__radsw__kgbnn.html#gab24774576414b5d210c34916c3d19404">rayla</a>(j,js)))</div><div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;</div><div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;        ind01 = id0(k,24) + 1</div><div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;        ind11 = id1(k,24) + 1</div><div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;</div><div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;        <span class="keywordflow">do</span> j = 1, ng24</div><div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;          taug(k,ns24+j) = colamt(k,6)                                  &amp;</div><div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;     &amp;        * ( fac00(k)*<a class="code" href="group__module__radsw__kgbnn.html#gabd4db3c9678fee17f2cfd4a3e290619a">absb</a>(ind01,j) + fac10(k)*<a class="code" href="group__module__radsw__kgbnn.html#gabd4db3c9678fee17f2cfd4a3e290619a">absb</a>(ind02,j)       &amp;</div><div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;     &amp;        +   fac01(k)*<a class="code" href="group__module__radsw__kgbnn.html#gabd4db3c9678fee17f2cfd4a3e290619a">absb</a>(ind11,j) + fac11(k)*<a class="code" href="group__module__radsw__kgbnn.html#gabd4db3c9678fee17f2cfd4a3e290619a">absb</a>(ind12,j) )     &amp;</div><div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;     &amp;        + colamt(k,3) * <a class="code" href="group__module__radsw__kgbnn.html#ga6b44aa0637523aa1f78de5b4d16c693b">abso3b</a>(j)</div><div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;</div><div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;          taur(k,ns24+j) = colmol(k) * raylb(j)</div><div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;</div><div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radsw__main_8f.html#ae0abf1a08aa5d6ca14bfea83d0603716">taumol24</a></div><div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;</div><div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;</div><div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radsw__main_8f.html#a21b72d6de9247eccb20de836ea76cf7a">taumol25</a></div><div class="line"><a name="l05042"></a><span class="lineno"><a class="line" href="radsw__main_8f.html#a21b72d6de9247eccb20de836ea76cf7a"> 5042</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;</div><div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;<span class="comment">!     band 25:  16000-22650 cm-1 (low - h2o; high - nothing)           !</span></div><div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb25.html">module_radsw_kgb25</a></div><div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;</div><div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;      <span class="keywordtype">integer</span> :: ind01, ind02, ind11, ind12</div><div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;      <span class="keywordtype">integer</span> :: j, k</div><div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;</div><div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;</div><div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;<span class="comment">!  --- ...  compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;<span class="comment">!           temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;<span class="comment">!           vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;</div><div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;        <span class="keywordflow">do</span> j = 1, ng25</div><div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;          taur(k,ns25+j) = colmol(k) * <a class="code" href="group__module__radsw__kgbnn.html#ga3d32a0d74d03129cacd9c4bb2e58683a">rayl</a>(j)</div><div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;</div><div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;        ind01 = id0(k,25) + 1</div><div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;        ind11 = id1(k,25) + 1</div><div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;</div><div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;        <span class="keywordflow">do</span> j = 1, ng25</div><div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;          taug(k,ns25+j) = colamt(k,1)                                  &amp;</div><div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;     &amp;        * ( fac00(k)*<a class="code" href="group__module__radsw__kgbnn.html#gaf4daf474954d4689219ada6d0662aceb">absa</a>(ind01,j) + fac10(k)*<a class="code" href="group__module__radsw__kgbnn.html#gaf4daf474954d4689219ada6d0662aceb">absa</a>(ind02,j)       &amp;</div><div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;     &amp;        +   fac01(k)*<a class="code" href="group__module__radsw__kgbnn.html#gaf4daf474954d4689219ada6d0662aceb">absa</a>(ind11,j) + fac11(k)*<a class="code" href="group__module__radsw__kgbnn.html#gaf4daf474954d4689219ada6d0662aceb">absa</a>(ind12,j) )     &amp;</div><div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;     &amp;        + colamt(k,3) * <a class="code" href="group__module__radsw__kgbnn.html#gab02765dac8ca71a439cdaf1ed2691851">abso3a</a>(j)</div><div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;</div><div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;        <span class="keywordflow">do</span> j = 1, ng25</div><div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;          taug(k,ns25+j) = colamt(k,3) * <a class="code" href="group__module__radsw__kgbnn.html#ga2844cade392c8805b1d418bc1260b3a5">abso3b</a>(j)</div><div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;</div><div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radsw__main_8f.html#a21b72d6de9247eccb20de836ea76cf7a">taumol25</a></div><div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;</div><div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;</div><div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radsw__main_8f.html#a20261640145a5d10e091ef3c67763175">taumol26</a></div><div class="line"><a name="l05098"></a><span class="lineno"><a class="line" href="radsw__main_8f.html#a20261640145a5d10e091ef3c67763175"> 5098</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;</div><div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;<span class="comment">!     band 26:  22650-29000 cm-1 (low - nothing; high - nothing)       !</span></div><div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb26.html">module_radsw_kgb26</a></div><div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;</div><div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;      <span class="keywordtype">integer</span> :: j, k</div><div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;</div><div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;</div><div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;<span class="comment">!  --- ...  compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;<span class="comment">!           temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;<span class="comment">!           vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;</div><div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;        <span class="keywordflow">do</span> j = 1, ng26</div><div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;          taug(k,ns26+j) = f_zero</div><div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;          taur(k,ns26+j) = colmol(k) * <a class="code" href="namespacemodule__radsw__kgb26.html#ab090be57484d2c5b67dda3d83c1c542b">rayl</a>(j)</div><div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;</div><div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radsw__main_8f.html#a20261640145a5d10e091ef3c67763175">taumol26</a></div><div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;</div><div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;</div><div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radsw__main_8f.html#a7d2cea6cc0cfde853d25a14ba0efcca2">taumol27</a></div><div class="line"><a name="l05134"></a><span class="lineno"><a class="line" href="radsw__main_8f.html#a7d2cea6cc0cfde853d25a14ba0efcca2"> 5134</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;</div><div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;<span class="comment">!     band 27:  29000-38000 cm-1 (low - o3; high - o3)                 !</span></div><div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb27.html">module_radsw_kgb27</a></div><div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;      <span class="keywordtype">integer</span> :: ind01, ind02, ind11, ind12</div><div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;      <span class="keywordtype">integer</span> :: j, k</div><div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;</div><div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;</div><div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;<span class="comment">!  --- ...  compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;<span class="comment">!           temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;<span class="comment">!           vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;</div><div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;        <span class="keywordflow">do</span> j = 1, ng27</div><div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;          taur(k,ns27+j) = colmol(k) * <a class="code" href="group__module__radsw__kgbnn.html#gaca4c6e06d1cd46568048a035c6726f1d">rayl</a>(j)</div><div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;</div><div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;        ind01 = id0(k,27) + 1</div><div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;        ind11 = id1(k,27) + 1</div><div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;</div><div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;        <span class="keywordflow">do</span> j = 1, ng27</div><div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;          taug(k,ns27+j) = colamt(k,3)                                  &amp;</div><div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;     &amp;        * ( fac00(k)*<a class="code" href="group__module__radsw__kgbnn.html#gaaf6ba2ea0beacba67c045a10d7a6a782">absa</a>(ind01,j) + fac10(k)*<a class="code" href="group__module__radsw__kgbnn.html#gaaf6ba2ea0beacba67c045a10d7a6a782">absa</a>(ind02,j)       &amp;</div><div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;     &amp;        +   fac01(k)*<a class="code" href="group__module__radsw__kgbnn.html#gaaf6ba2ea0beacba67c045a10d7a6a782">absa</a>(ind11,j) + fac11(k)*<a class="code" href="group__module__radsw__kgbnn.html#gaaf6ba2ea0beacba67c045a10d7a6a782">absa</a>(ind12,j) )</div><div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;</div><div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;        ind01 = id0(k,27) + 1</div><div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;        ind11 = id1(k,27) + 1</div><div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;</div><div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;        <span class="keywordflow">do</span> j = 1, ng27</div><div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;          taug(k,ns27+j) = colamt(k,3)                                  &amp;</div><div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;     &amp;        * ( fac00(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga8edb349c908e6950e0d18f293dd1b6ea">absb</a>(ind01,j) + fac10(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga8edb349c908e6950e0d18f293dd1b6ea">absb</a>(ind02,j)       &amp;</div><div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;     &amp;        +   fac01(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga8edb349c908e6950e0d18f293dd1b6ea">absb</a>(ind11,j) + fac11(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga8edb349c908e6950e0d18f293dd1b6ea">absb</a>(ind12,j) )</div><div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;</div><div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radsw__main_8f.html#a7d2cea6cc0cfde853d25a14ba0efcca2">taumol27</a></div><div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;</div><div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;</div><div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radsw__main_8f.html#a2113c76707f43cf91fe5926ab69d1b8b">taumol28</a></div><div class="line"><a name="l05196"></a><span class="lineno"><a class="line" href="radsw__main_8f.html#a2113c76707f43cf91fe5926ab69d1b8b"> 5196</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;</div><div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;<span class="comment">!     band 28:  38000-50000 cm-1 (low - o3,o2; high - o3,o2)           !</span></div><div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb28.html">module_radsw_kgb28</a></div><div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;</div><div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: speccomb, specmult, tauray, fs, fs1,     &amp;</div><div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;     &amp;       fac000,fac001,fac010,fac011, fac100,fac101,fac110,fac111</div><div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;</div><div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;      <span class="keywordtype">integer</span> :: ind01, ind02, ind03, ind04, ind11, ind12, ind13, ind14</div><div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;      <span class="keywordtype">integer</span> :: j, js, k</div><div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;</div><div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;</div><div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;<span class="comment">!  --- ...  compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;<span class="comment">!           temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;<span class="comment">!           vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;</div><div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;        tauray = colmol(k) * <a class="code" href="group__module__radsw__kgbnn.html#gaf3641febf88e97741b2cd86a56eda843">rayl</a></div><div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;</div><div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;        <span class="keywordflow">do</span> j = 1, ng28</div><div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;          taur(k,ns28+j) = tauray</div><div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;</div><div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;        speccomb = colamt(k,3) + <a class="code" href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">strrat</a>(28)*colamt(k,6)</div><div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;        specmult = 8.0 * min(oneminus, colamt(k,3) / speccomb)</div><div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;</div><div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;        fs1= f_one - fs</div><div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;        fac000 = fs1 * fac00(k)</div><div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;        fac010 = fs1 * fac10(k)</div><div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;        fac100 = fs  * fac00(k)</div><div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;        fac110 = fs  * fac10(k)</div><div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;        fac001 = fs1 * fac01(k)</div><div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;        fac011 = fs1 * fac11(k)</div><div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;        fac101 = fs  * fac01(k)</div><div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;        fac111 = fs  * fac11(k)</div><div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;</div><div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;        ind01 = id0(k,28) + js</div><div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;        ind03 = ind01 + 9</div><div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;        ind04 = ind01 + 10</div><div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;        ind11 = id1(k,28) + js</div><div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;        ind13 = ind11 + 9</div><div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;        ind14 = ind11 + 10</div><div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;</div><div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;        <span class="keywordflow">do</span> j = 1, ng28</div><div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;          taug(k,ns28+j) = speccomb                                     &amp;</div><div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;     &amp;        * ( fac000 * <a class="code" href="group__module__radsw__kgbnn.html#ga5e48daf035b3b22b6e1b0f36aabcec10">absa</a>(ind01,j) + fac100 * <a class="code" href="group__module__radsw__kgbnn.html#ga5e48daf035b3b22b6e1b0f36aabcec10">absa</a>(ind02,j)       &amp;</div><div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;     &amp;        +   fac010 * <a class="code" href="group__module__radsw__kgbnn.html#ga5e48daf035b3b22b6e1b0f36aabcec10">absa</a>(ind03,j) + fac110 * <a class="code" href="group__module__radsw__kgbnn.html#ga5e48daf035b3b22b6e1b0f36aabcec10">absa</a>(ind04,j)       &amp;</div><div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;     &amp;        +   fac001 * <a class="code" href="group__module__radsw__kgbnn.html#ga5e48daf035b3b22b6e1b0f36aabcec10">absa</a>(ind11,j) + fac101 * <a class="code" href="group__module__radsw__kgbnn.html#ga5e48daf035b3b22b6e1b0f36aabcec10">absa</a>(ind12,j)       &amp;</div><div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;     &amp;        +   fac011 * <a class="code" href="group__module__radsw__kgbnn.html#ga5e48daf035b3b22b6e1b0f36aabcec10">absa</a>(ind13,j) + fac111 * <a class="code" href="group__module__radsw__kgbnn.html#ga5e48daf035b3b22b6e1b0f36aabcec10">absa</a>(ind14,j) )</div><div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;</div><div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;        speccomb = colamt(k,3) + <a class="code" href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">strrat</a>(28)*colamt(k,6)</div><div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;        specmult = 4.0 * min(oneminus, colamt(k,3) / speccomb)</div><div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;</div><div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;        fs1= f_one - fs</div><div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;        fac000 = fs1 * fac00(k)</div><div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;        fac010 = fs1 * fac10(k)</div><div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;        fac100 = fs  * fac00(k)</div><div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;        fac110 = fs  * fac10(k)</div><div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;        fac001 = fs1 * fac01(k)</div><div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;        fac011 = fs1 * fac11(k)</div><div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;        fac101 = fs  * fac01(k)</div><div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;        fac111 = fs  * fac11(k)</div><div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;</div><div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;        ind01 = id0(k,28) + js</div><div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;        ind03 = ind01 + 5</div><div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;        ind04 = ind01 + 6</div><div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;        ind11 = id1(k,28) + js</div><div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;        ind13 = ind11 + 5</div><div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;        ind14 = ind11 + 6</div><div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;</div><div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;        <span class="keywordflow">do</span> j = 1, ng28</div><div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;          taug(k,ns28+j) = speccomb                                     &amp;</div><div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;     &amp;        * ( fac000 * <a class="code" href="group__module__radsw__kgbnn.html#gac3834ddd9d9e2106dc739094c800d09b">absb</a>(ind01,j) + fac100 * <a class="code" href="group__module__radsw__kgbnn.html#gac3834ddd9d9e2106dc739094c800d09b">absb</a>(ind02,j)       &amp;</div><div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;     &amp;        +   fac010 * <a class="code" href="group__module__radsw__kgbnn.html#gac3834ddd9d9e2106dc739094c800d09b">absb</a>(ind03,j) + fac110 * <a class="code" href="group__module__radsw__kgbnn.html#gac3834ddd9d9e2106dc739094c800d09b">absb</a>(ind04,j)       &amp;</div><div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;     &amp;        +   fac001 * <a class="code" href="group__module__radsw__kgbnn.html#gac3834ddd9d9e2106dc739094c800d09b">absb</a>(ind11,j) + fac101 * <a class="code" href="group__module__radsw__kgbnn.html#gac3834ddd9d9e2106dc739094c800d09b">absb</a>(ind12,j)       &amp;</div><div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;     &amp;        +   fac011 * <a class="code" href="group__module__radsw__kgbnn.html#gac3834ddd9d9e2106dc739094c800d09b">absb</a>(ind13,j) + fac111 * <a class="code" href="group__module__radsw__kgbnn.html#gac3834ddd9d9e2106dc739094c800d09b">absb</a>(ind14,j) )</div><div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;</div><div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radsw__main_8f.html#a2113c76707f43cf91fe5926ab69d1b8b">taumol28</a></div><div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;</div><div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;</div><div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radsw__main_8f.html#a08e2db10432d07392f29a49bc5b5c640">taumol29</a></div><div class="line"><a name="l05305"></a><span class="lineno"><a class="line" href="radsw__main_8f.html#a08e2db10432d07392f29a49bc5b5c640"> 5305</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;</div><div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;<span class="comment">!     band 29:  820-2600 cm-1 (low - h2o; high - co2)                  !</span></div><div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__kgb29.html">module_radsw_kgb29</a></div><div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;</div><div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tauray</div><div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;</div><div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;      <span class="keywordtype">integer</span> :: ind01, ind02, ind11, ind12</div><div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;      <span class="keywordtype">integer</span> :: inds, indf, indsp, indfp, j, k</div><div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;</div><div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;</div><div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;<span class="comment">!  --- ...  compute the optical depth by interpolating in ln(pressure),</span></div><div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;<span class="comment">!           temperature, and appropriate species.  below laytrop, the water</span></div><div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;<span class="comment">!           vapor self-continuum is interpolated (in temperature) separately.</span></div><div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;</div><div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;        tauray = colmol(k) * <a class="code" href="group__module__radsw__kgbnn.html#gabc0a41a10d73674e124115fe0511cc23">rayl</a></div><div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;</div><div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;        <span class="keywordflow">do</span> j = 1, ng29</div><div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;          taur(k,ns29+j) = tauray</div><div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;</div><div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;        ind01 = id0(k,29) + 1</div><div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;        ind11 = id1(k,29) + 1</div><div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;</div><div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;        inds = indself(k)</div><div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;        indsp= inds + 1</div><div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;        indfp= indf + 1</div><div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;</div><div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;        <span class="keywordflow">do</span> j = 1, ng29</div><div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;          taug(k,ns29+j) = colamt(k,1)                                  &amp;</div><div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;     &amp;        * ( (fac00(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga1132fd19edc0312f6bcc905619f3bdfd">absa</a>(ind01,j) + fac10(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga1132fd19edc0312f6bcc905619f3bdfd">absa</a>(ind02,j)      &amp;</div><div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;     &amp;        +    fac01(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga1132fd19edc0312f6bcc905619f3bdfd">absa</a>(ind11,j) + fac11(k)*<a class="code" href="group__module__radsw__kgbnn.html#ga1132fd19edc0312f6bcc905619f3bdfd">absa</a>(ind12,j) )    &amp;</div><div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;     &amp;        +  selffac(k) * (<a class="code" href="group__module__radsw__kgbnn.html#ga468e2dd6001734d10784c8fb7b5df4e3">selfref</a>(inds,j) + selffrac(k)            &amp;</div><div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;     &amp;        *  (<a class="code" href="group__module__radsw__kgbnn.html#ga468e2dd6001734d10784c8fb7b5df4e3">selfref</a>(indsp,j) - <a class="code" href="group__module__radsw__kgbnn.html#ga468e2dd6001734d10784c8fb7b5df4e3">selfref</a>(inds,j)))                  &amp;</div><div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;     &amp;        +  forfac(k) * (forref(indf,j) + forfrac(k)               &amp;</div><div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;     &amp;        *  (forref(indfp,j) - forref(indf,j))))                   &amp;</div><div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;     &amp;        +  colamt(k,2) * <a class="code" href="group__module__radsw__kgbnn.html#gaa9a57e32dfbb8979478aa8c931ff0e2d">absco2</a>(j)</div><div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;</div><div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;        ind01 = id0(k,29) + 1</div><div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;        ind02 = ind01 + 1</div><div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;        ind11 = id1(k,29) + 1</div><div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;        ind12 = ind11 + 1</div><div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;</div><div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;        <span class="keywordflow">do</span> j = 1, ng29</div><div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;          taug(k,ns29+j) = colamt(k,2)                                  &amp;</div><div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;     &amp;        * ( fac00(k)*<a class="code" href="group__module__radsw__kgbnn.html#gac9fb794bc4e4a02964b5e5d1431c31c3">absb</a>(ind01,j) + fac10(k)*<a class="code" href="group__module__radsw__kgbnn.html#gac9fb794bc4e4a02964b5e5d1431c31c3">absb</a>(ind02,j)       &amp;</div><div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;     &amp;        +   fac01(k)*<a class="code" href="group__module__radsw__kgbnn.html#gac9fb794bc4e4a02964b5e5d1431c31c3">absb</a>(ind11,j) + fac11(k)*<a class="code" href="group__module__radsw__kgbnn.html#gac9fb794bc4e4a02964b5e5d1431c31c3">absb</a>(ind12,j) )     &amp;</div><div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;     &amp;        + colamt(k,1) * <a class="code" href="group__module__radsw__kgbnn.html#gacab70725ca7faf002f04306fe1798e02">absh2o</a>(j)</div><div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;</div><div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radsw__main_8f.html#a08e2db10432d07392f29a49bc5b5c640">taumol29</a></div><div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;</div><div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radsw__main.html#gaa82121d21c1e8f2ca938378249fea135">taumol</a></div><div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;<span class="comment">!! @}</span></div><div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;</div><div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;<span class="comment">!........................................!</span></div><div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;<span class="keyword">      end module </span>module_radsw_main       <span class="comment">!</span></div><div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;<span class="comment">!========================================!</span></div><div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;<span class="comment">!! @}</span></div><div class="ttc" id="group__module__radsw__kgbnn_html_gabc3bd99e8ad7d1f09fb7fab7ed67a32b"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gabc3bd99e8ad7d1f09fb7fab7ed67a32b">module_radsw_kgb22::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msf22, ng22), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l15829">radsw_datatb.f:15829</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gac79ad61e8d246d6075664df4201373d7"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gac79ad61e8d246d6075664df4201373d7">module_radsw_kgb19::rayl</a></div><div class="ttdeci">real(kind=kind_phys), parameter, public rayl</div><div class="ttdoc">rayleigh extinction coefficient at  </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l09669">radsw_datatb.f:9669</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb19_html"><div class="ttname"><a href="namespacemodule__radsw__kgb19.html">module_radsw_kgb19</a></div><div class="ttdoc">This module sets up absorption coeffients for band 19: 4650-5150 cm-1 (low - h2o,co2; high - co2) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l09596">radsw_datatb.f:9596</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga784e78b5964fadd3e3e1f57f7af30802"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga784e78b5964fadd3e3e1f57f7af30802">module_radsw_kgb24::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msf24, ng24), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l16537">radsw_datatb.f:16537</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gae77b766677ea476e2ba14b88e511870a"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gae77b766677ea476e2ba14b88e511870a">module_radsw_kgb22::rayl</a></div><div class="ttdeci">real(kind=kind_phys), parameter, public rayl</div><div class="ttdoc">rayleigh extinction coefficient at  </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l15832">radsw_datatb.f:15832</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_a3cc7ab844ca564bd3df02a687bbc2f43"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#a3cc7ab844ca564bd3df02a687bbc2f43">module_radsw_cldprtb::ebari</a></div><div class="ttdeci">real(kind=kind_phys), dimension(5), public ebari</div><div class="ttdoc">asymmetry coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00278">radsw_datatb.f:278</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga488f807878d909b8f69457b0d7d8ac6a"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga488f807878d909b8f69457b0d7d8ac6a">module_radsw_kgb18::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msf18, ng18), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l08116">radsw_datatb.f:8116</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb24_html"><div class="ttname"><a href="namespacemodule__radsw__kgb24.html">module_radsw_kgb24</a></div><div class="ttdoc">This module sets up absorption coeffients for band 24: 12850-16000 cm-1 (low - h2o, o2; high - o2) </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l16464">radsw_datatb.f:16464</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gad9a6fc80122a2f06d9f2277d74e00c85"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gad9a6fc80122a2f06d9f2277d74e00c85">module_radsw_kgb19::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msa19, ng19), public absa</div><div class="ttdoc">the array absa(585,NG19) (ka(9,5,13,NG19)) contains absorption coefs at the 16 chosen g-values for a ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l09651">radsw_datatb.f:9651</a></div></div>
<div class="ttc" id="radsw__main_8f_html_ae46d1c061726bcde426caadd80b1fd80"><div class="ttname"><a href="radsw__main_8f.html#ae46d1c061726bcde426caadd80b1fd80">taumol17</a></div><div class="ttdeci">subroutine taumol17</div><div class="ttdoc">The subroutine computes the optical depth in band 17: 3250-4000 cm-1 (low - h2o,co2; high - h2o...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l04255">radsw_main.f:4255</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_gaad60e753cdda20d4e84d063280f0dfcc"><div class="ttname"><a href="group__module__radsw__main.html#gaad60e753cdda20d4e84d063280f0dfcc">module_radsw_main::heatfac</a></div><div class="ttdeci">real(kind=kind_phys) heatfac</div><div class="ttdoc">the factor for heating rates (in k/day, or k/sec set by subroutine &amp;#39;rswinit&amp;#39;) </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l00500">radsw_main.f:500</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga2541e41c7d445a2ce73283e2fb76270c"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga2541e41c7d445a2ce73283e2fb76270c">module_radsw_kgb23::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msa23, ng23), public absa</div><div class="ttdoc">the array absa(65,NG23) (ka(5,13,NG23)) contains absorption coefs at the 16 chosen g-values for a ran...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l16255">radsw_datatb.f:16255</a></div></div>
<div class="ttc" id="namespacemodule__radsw__sflux_html_a92703c3e826f7e81267c6b7ae31ebe42"><div class="ttname"><a href="namespacemodule__radsw__sflux.html#a92703c3e826f7e81267c6b7ae31ebe42">module_radsw_sflux::ix2</a></div><div class="ttdeci">integer, dimension(nblow:nbhgh), public ix2</div><div class="ttdoc">indexes for 2nd entries of the two key species for each of the spectral bands </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l01993">radsw_datatb.f:1993</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_ga1f9d18b17cc24321ed1cf45254ac2b0f"><div class="ttname"><a href="group__module__radsw__main.html#ga1f9d18b17cc24321ed1cf45254ac2b0f">module_radsw_main::exp_tbl</a></div><div class="ttdeci">real(kind=kind_phys), dimension(0:ntbmx) exp_tbl</div><div class="ttdoc">those data will be set up only once by &quot;rswinit&quot; </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l00495">radsw_main.f:495</a></div></div>
<div class="ttc" id="namespacemodule__radsw__sflux_html_ac2864b4501e9bc3804d45d14f4aab472"><div class="ttname"><a href="namespacemodule__radsw__sflux.html#ac2864b4501e9bc3804d45d14f4aab472">module_radsw_sflux::ix1</a></div><div class="ttdeci">integer, dimension(nblow:nbhgh), public ix1</div><div class="ttdoc">indexes for 1st entries of the two key species for each of the spectral bands </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l01989">radsw_datatb.f:1989</a></div></div>
<div class="ttc" id="structmodule__radsw__parameters_1_1cmpfsw__type_html"><div class="ttname"><a href="structmodule__radsw__parameters_1_1cmpfsw__type.html">module_radsw_parameters::cmpfsw_type</a></div><div class="ttdoc">derived type for special components of surface SW fluxes </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00110">radsw_param.f:110</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga3df78e9baa46df182aad6ff9b1662dc4"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga3df78e9baa46df182aad6ff9b1662dc4">module_radsw_kgb24::abso3a</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng24), public abso3a</div><div class="ttdoc">o3 </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l16540">radsw_datatb.f:16540</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gac3834ddd9d9e2106dc739094c800d09b"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gac3834ddd9d9e2106dc739094c800d09b">module_radsw_kgb28::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msb28, ng28), public absb</div><div class="ttdoc">the array absb(1175,6) (kb(5,5,13:59,6)) contains absorption coefs at the 16 chosen g-values for a ra...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18890">radsw_datatb.f:18890</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_a8927b6e7cc810301e3843eb0f5c0c795"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#a8927b6e7cc810301e3843eb0f5c0c795">module_radsw_cldprtb::c0r</a></div><div class="ttdeci">real(kind=kind_phys), dimension(nblow:nbhgh), public c0r</div><div class="ttdoc">asymmetry coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l01910">radsw_datatb.f:1910</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_gad227ccde86a01f47c1ab3b4bed5ba1be"><div class="ttname"><a href="group__module__radsw__main.html#gad227ccde86a01f47c1ab3b4bed5ba1be">module_radsw_main::vrtqdr</a></div><div class="ttdeci">subroutine vrtqdr(zrefb, zrefd, ztrab, ztrad, zldbt, ztdbt, NLAY, NLP1, zfu, zfd)</div><div class="ttdoc">This subroutine is called by spcvrtc() and spcvrtm(), and computes the upward and downward radiation ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l03770">radsw_main.f:3770</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb27_html"><div class="ttname"><a href="namespacemodule__radsw__kgb27.html">module_radsw_kgb27</a></div><div class="ttdoc">This module sets up absorption coeffients for band 27: 29000-38000 cm-1 (low - o3; high - o3) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18228">radsw_datatb.f:18228</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_ad9328ffc5e90cc62c8c9c5089b55fc79"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#ad9328ffc5e90cc62c8c9c5089b55fc79">module_radsw_cldprtb::asyice2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(43, nblow:nbhgh), public asyice2</div><div class="ttdoc">asymmetry coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00249">radsw_datatb.f:249</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_a8ed403302034ea073243157749673e14"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#a8ed403302034ea073243157749673e14">module_radsw_cldprtb::extice2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(43, nblow:nbhgh), public extice2</div><div class="ttdoc">extinction coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00243">radsw_datatb.f:243</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga77d98f3fb766d4abfd494332ce67c2c2"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga77d98f3fb766d4abfd494332ce67c2c2">module_radsw_kgb16::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msf16, ng16), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l02312">radsw_datatb.f:2312</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html_a39e5ca4fd5defbc2545ee39bbf50d61b"><div class="ttname"><a href="namespacemodule__radsw__parameters.html#a39e5ca4fd5defbc2545ee39bbf50d61b">module_radsw_parameters::nbhgh</a></div><div class="ttdeci">integer, parameter nbhgh</div><div class="ttdoc">band range upper index </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00130">radsw_param.f:130</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb20_html"><div class="ttname"><a href="namespacemodule__radsw__kgb20.html">module_radsw_kgb20</a></div><div class="ttdoc">This module sets up absorption coeffients for band 20: 5150-6150 cm-1 (low - h2o; high - h2o) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l11116">radsw_datatb.f:11116</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html_a4bd72558be40bfccfb78c48e640acd07"><div class="ttname"><a href="namespacemodule__radsw__parameters.html#a4bd72558be40bfccfb78c48e640acd07">module_radsw_parameters::ntbmx</a></div><div class="ttdeci">integer, parameter ntbmx</div><div class="ttdoc">index upper limit of optical depth and transmittance tables </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00140">radsw_param.f:140</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gabd4db3c9678fee17f2cfd4a3e290619a"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gabd4db3c9678fee17f2cfd4a3e290619a">module_radsw_kgb24::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msb24, ng24), public absb</div><div class="ttdoc">the array absb(235,8) (kb(5,13:59,8)) contains absorption coefs at the 16 chosen g-values for a range...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l16530">radsw_datatb.f:16530</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_a81ba576e28e5844772d040ff7543faae"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#a81ba576e28e5844772d040ff7543faae">module_radsw_cldprtb::a0s</a></div><div class="ttdeci">real(kind=kind_phys), public a0s</div><div class="ttdoc">optical depth coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l01897">radsw_datatb.f:1897</a></div></div>
<div class="ttc" id="namespacemodule__radsw__sflux_html_a84205f359fb3e1a0e1d03e755c52dc78"><div class="ttname"><a href="namespacemodule__radsw__sflux.html#a84205f359fb3e1a0e1d03e755c52dc78">module_radsw_sflux::sfluxref01</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ngmax, mfs01, mfb01), target, public sfluxref01</div><div class="ttdoc">spectral solar fluxes, j=1,2,...,7 for SW band number of 16,20,23,25,26,27,29 </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l02005">radsw_datatb.f:2005</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_ga177282b3087dce2f54f1233ee8631231"><div class="ttname"><a href="group__module__radsw__main.html#ga177282b3087dce2f54f1233ee8631231">module_radsw_main::nuvb</a></div><div class="ttdeci">integer, parameter nuvb</div><div class="ttdoc">uv-b band index </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l00485">radsw_main.f:485</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb26_html_ab090be57484d2c5b67dda3d83c1c542b"><div class="ttname"><a href="namespacemodule__radsw__kgb26.html#ab090be57484d2c5b67dda3d83c1c542b">module_radsw_kgb26::rayl</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng26), public rayl</div><div class="ttdoc">rayleigh extinction coefficient at all v </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18215">radsw_datatb.f:18215</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html_adc3e4d5a848d50e2883e05c62f61bc97"><div class="ttname"><a href="namespacemodule__radsw__parameters.html#adc3e4d5a848d50e2883e05c62f61bc97">module_radsw_parameters::ngptsw</a></div><div class="ttdeci">integer, parameter ngptsw</div><div class="ttdoc">total number of g-point in all bands </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00134">radsw_param.f:134</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gae4e51bcb3c3cbaaf1476d5ab18b072e5"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gae4e51bcb3c3cbaaf1476d5ab18b072e5">module_radsw_kgb23::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msf23, ng23), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l16262">radsw_datatb.f:16262</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gabc0a41a10d73674e124115fe0511cc23"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gabc0a41a10d73674e124115fe0511cc23">module_radsw_kgb29::rayl</a></div><div class="ttdeci">real(kind=kind_phys), parameter, public rayl</div><div class="ttdoc">rayleigh extinction coefficient at  </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l21226">radsw_datatb.f:21226</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_ac68593a33577c720ca8c74eafb3c9f96"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#ac68593a33577c720ca8c74eafb3c9f96">module_radsw_cldprtb::extliq1</a></div><div class="ttdeci">real(kind=kind_phys), dimension(58, nblow:nbhgh), public extliq1</div><div class="ttdoc">extinction coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00232">radsw_datatb.f:232</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html">module_radsw_cldprtb</a></div><div class="ttdoc">This module contains cloud radiative property coefficients. </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00176">radsw_datatb.f:176</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_aab7693c5f31ce2182bca61aff77996bc"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#aab7693c5f31ce2182bca61aff77996bc">module_radsw_cldprtb::c0s</a></div><div class="ttdeci">real(kind=kind_phys), dimension(nblow:nbhgh), public c0s</div><div class="ttdoc">asymmetry coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l01901">radsw_datatb.f:1901</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga60403e7d343c85e965f3507b0db0f2a5"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga60403e7d343c85e965f3507b0db0f2a5">module_radsw_kgb22::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msb22, ng22), public absb</div><div class="ttdoc">the array absb(235,2) (kb(5,13:59,2)) contains absorption coefs at the 16 chosen g-values for a range...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l15822">radsw_datatb.f:15822</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gab24774576414b5d210c34916c3d19404"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gab24774576414b5d210c34916c3d19404">module_radsw_kgb24::rayla</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng24, mfx24), public rayla</div><div class="ttdoc">rayleigh extinction coefficient at all v </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l16545">radsw_datatb.f:16545</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb23_html"><div class="ttname"><a href="namespacemodule__radsw__kgb23.html">module_radsw_kgb23</a></div><div class="ttdoc">This module sets up absorption coeffients for band 23: 8050-12850 cm-1 (low - h2o; high - nothing) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l16207">radsw_datatb.f:16207</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gadb26cae00c05ac5c048a4db5a319a2eb"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gadb26cae00c05ac5c048a4db5a319a2eb">module_radsw_kgb19::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msf19, ng19), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l09634">radsw_datatb.f:9634</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga1132fd19edc0312f6bcc905619f3bdfd"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga1132fd19edc0312f6bcc905619f3bdfd">module_radsw_kgb29::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msa29, ng29), public absa</div><div class="ttdoc">the array absa(65,NG29) (ka(5,13,NG29)) contains absorption coefs at the 16 chosen g-values for a ran...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l21197">radsw_datatb.f:21197</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga15ed79e7136ed6d7f11c19a81281af53"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga15ed79e7136ed6d7f11c19a81281af53">module_radsw_kgb22::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msa22, ng22), public absa</div><div class="ttdoc">the array absa(585,NG22) (ka(9,5,13,NG22)) contains absorption coefs at the 16 chosen g-values for a ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l15809">radsw_datatb.f:15809</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gaaf6ba2ea0beacba67c045a10d7a6a782"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gaaf6ba2ea0beacba67c045a10d7a6a782">module_radsw_kgb27::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msa27, ng27), public absa</div><div class="ttdoc">the array absa(65,NG27) (ka(5,13,NG27)) contains absorption coefs at the 16 chosen g-values for a ran...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18273">radsw_datatb.f:18273</a></div></div>
<div class="ttc" id="namespacemodule__radsw__sflux_html_aa57fca862289bd57327b9c3ef27e3e2f"><div class="ttname"><a href="namespacemodule__radsw__sflux.html#aa57fca862289bd57327b9c3ef27e3e2f">module_radsw_sflux::sfluxref02</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ngmax, mfs02, mfb02), target, public sfluxref02</div><div class="ttdoc">spectral solar fluxes, j=1,2 for SW band number of 17 and 28 </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l02008">radsw_datatb.f:2008</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga8edb349c908e6950e0d18f293dd1b6ea"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga8edb349c908e6950e0d18f293dd1b6ea">module_radsw_kgb27::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msb27, ng27), public absb</div><div class="ttdoc">the array absb(235,8) (kb(5,13:59,8)) contains absorption coefs at the 16 chosen g-values for a range...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18286">radsw_datatb.f:18286</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gaa3853af5e29277f9ed2bdd397cab5029"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gaa3853af5e29277f9ed2bdd397cab5029">module_radsw_kgb20::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msf20, ng20), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l11189">radsw_datatb.f:11189</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga51fe40b5f24cc461850fe5be40d18869"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga51fe40b5f24cc461850fe5be40d18869">module_radsw_kgb16::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msa16, ng16), public absa</div><div class="ttdoc">the array absa(585,NG16) (ka(9,5,13,NG16)) contains absorption coefs at the 16 chosen g-values for a ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l02329">radsw_datatb.f:2329</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga06965ec156c4e1d18d50a70ba43bd8e1"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga06965ec156c4e1d18d50a70ba43bd8e1">module_radsw_kgb24::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msa24, ng24), public absa</div><div class="ttdoc">the array absa(585,NG24) (ka(9,5,13,NG24)) contains absorption coefs at the 16 chosen g-values for a ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l16517">radsw_datatb.f:16517</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_ga784397878835a8cdd0b14a7b9eafb4e3"><div class="ttname"><a href="group__module__radsw__main.html#ga784397878835a8cdd0b14a7b9eafb4e3">module_radsw_main::swrad</a></div><div class="ttdeci">subroutine, public swrad(plyr, plvl, tlyr, tlvl, qlyr, olyr, gasvmr, clouds, icseed, aerosols, sfcalb, cosz, solcon, NDAY, idxday, npts, nlay, nlp1, lprnt, hswc, topflx, sfcflx, HSW0, HSWB, FLXPRF, FDNCMP)</div><div class="ttdoc">This subroutine is the main SW radiation routine. </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l00594">radsw_main.f:594</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_gaeb992f35bdf7dbf9ea8709d7d91dedfd"><div class="ttname"><a href="group__module__radsw__main.html#gaeb992f35bdf7dbf9ea8709d7d91dedfd">module_radsw_main::spcvrtc</a></div><div class="ttdeci">subroutine spcvrtc(ssolar, cosz, sntz, albbm, albdf, sfluxzen, cldfrc, cf1, cf0, taug, taur, tauae, ssaae, asyae, taucw, ssacw, asycw, nlay, nlp1, fxupc, fxdnc, fxup0, fxdn0, ftoauc, ftoau0, ftoadc, fsfcuc, fsfcu0, fsfcdc, fsfcd0, sfbmc, sfdfc, sfbm0, sfdf0, suvbfc, suvbf0)</div><div class="ttdoc">This subroutine computes the shortwave radiative fluxes using two-stream method. </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l02304">radsw_main.f:2304</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb18_html"><div class="ttname"><a href="namespacemodule__radsw__kgb18.html">module_radsw_kgb18</a></div><div class="ttdoc">This module sets up absorption coeffients for band 18: 4000-4650 cm-1 (low - h2o,ch4; high - ch4) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l08078">radsw_datatb.f:8078</a></div></div>
<div class="ttc" id="radsw__main_8f_html_a3b5392346eee35eb13a2a54175b6338b"><div class="ttname"><a href="radsw__main_8f.html#a3b5392346eee35eb13a2a54175b6338b">taumol22</a></div><div class="ttdeci">subroutine taumol22</div><div class="ttdoc">The subroutine computes the optical depth in band 22: 7700-8050 cm-1 (low - h2o,o2; high - o2) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l04774">radsw_main.f:4774</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_a391fbdda62f6fba95e105c2041e16880"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#a391fbdda62f6fba95e105c2041e16880">module_radsw_cldprtb::b0s</a></div><div class="ttdeci">real(kind=kind_phys), dimension(nblow:nbhgh), public b0s</div><div class="ttdoc">single scattering albedo coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l01899">radsw_datatb.f:1899</a></div></div>
<div class="ttc" id="structmodule__radsw__parameters_1_1profsw__type_html"><div class="ttname"><a href="structmodule__radsw__parameters_1_1profsw__type.html">module_radsw_parameters::profsw_type</a></div><div class="ttdoc">derived type for SW fluxes&amp;#39; column profiles (at layer interfaces) </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00098">radsw_param.f:98</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_gaa20102786f7e7f8c71fb2783082eac1b"><div class="ttname"><a href="group__module__radsw__main.html#gaa20102786f7e7f8c71fb2783082eac1b">module_radsw_main::idxebc</a></div><div class="ttdeci">integer, dimension(nblow:nbhgh) idxebc</div><div class="ttdoc">band index for cld prop </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l00462">radsw_main.f:462</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_ga89ca572fa54a63a21009caa0760d405b"><div class="ttname"><a href="group__module__radsw__main.html#ga89ca572fa54a63a21009caa0760d405b">module_radsw_main::cldprop</a></div><div class="ttdeci">subroutine cldprop(cfrac, cliqp, reliq, cicep, reice, cdat1, cdat2, cdat3, cdat4, cf1, nlay, ipseed, taucw, ssacw, asycw, cldfrc, cldfmc)</div><div class="ttdoc">This subroutine computes the cloud optical properties for each cloudy layer and g-point interval...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l01568">radsw_main.f:1568</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gac9fb794bc4e4a02964b5e5d1431c31c3"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gac9fb794bc4e4a02964b5e5d1431c31c3">module_radsw_kgb29::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msb29, ng29), public absb</div><div class="ttdoc">the array absb(235,12) (kb(5,13:59,12)) contains absorption coefs at the 16 chosen g-values for a ran...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l21210">radsw_datatb.f:21210</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga1757aee0ec8211f84e2c9334cc9b0f9d"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga1757aee0ec8211f84e2c9334cc9b0f9d">module_radsw_kgb20::absch4</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng20), public absch4</div><div class="ttdoc">ch4 </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l11152">radsw_datatb.f:11152</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_a48555ff54d3a46f8c49733ff82e94d70"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#a48555ff54d3a46f8c49733ff82e94d70">module_radsw_cldprtb::ssaice2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(43, nblow:nbhgh), public ssaice2</div><div class="ttdoc">single scattering albedo coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00246">radsw_datatb.f:246</a></div></div>
<div class="ttc" id="radsw__main_8f_html_adf5d73763c80ec079b72dda7d74cba94"><div class="ttname"><a href="radsw__main_8f.html#adf5d73763c80ec079b72dda7d74cba94">taumol23</a></div><div class="ttdeci">subroutine taumol23</div><div class="ttdoc">The subroutine computes the optical depth in band 23: 8050-12850 cm-1 (low - h2o; high - nothing) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l04883">radsw_main.f:4883</a></div></div>
<div class="ttc" id="namespacemodule__radsw__ref_html_afb71559d084ca709bd134e6c489035e2"><div class="ttname"><a href="namespacemodule__radsw__ref.html#afb71559d084ca709bd134e6c489035e2">module_radsw_ref::preflog</a></div><div class="ttdeci">real(kind=kind_phys), dimension(59) preflog</div><div class="ttdoc">logarithm,ln(p), of a 59-level standard pressure profile </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00083">radsw_datatb.f:83</a></div></div>
<div class="ttc" id="radsw__main_8f_html_a20261640145a5d10e091ef3c67763175"><div class="ttname"><a href="radsw__main_8f.html#a20261640145a5d10e091ef3c67763175">taumol26</a></div><div class="ttdeci">subroutine taumol26</div><div class="ttdoc">The subroutine computes the optical depth in band 26: 22650-29000 cm-1 (low - nothing; high - nothing...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l05098">radsw_main.f:5098</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga2844cade392c8805b1d418bc1260b3a5"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga2844cade392c8805b1d418bc1260b3a5">module_radsw_kgb25::abso3b</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng25), public abso3b</div><div class="ttdoc">o3 </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18081">radsw_datatb.f:18081</a></div></div>
<div class="ttc" id="namespacemodule__radsw__ref_html"><div class="ttname"><a href="namespacemodule__radsw__ref.html">module_radsw_ref</a></div><div class="ttdoc">This module contains the reference pressures (in logarithm form) at 59 vertical levels (TOA is omitte...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00073">radsw_datatb.f:73</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_gad295d723dd7d269cb51c73923a4cbb94"><div class="ttname"><a href="group__module__radsw__main.html#gad295d723dd7d269cb51c73923a4cbb94">module_radsw_main::idxsfc</a></div><div class="ttdeci">integer, dimension(nblow:nbhgh) idxsfc</div><div class="ttdoc">band index for sfc flux </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l00460">radsw_main.f:460</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_ga8702f5f6285ff1a5cbfad740545fffb6"><div class="ttname"><a href="group__module__radsw__main.html#ga8702f5f6285ff1a5cbfad740545fffb6">taumol16</a></div><div class="ttdeci">subroutine taumol16</div><div class="ttdoc">The subroutine computes the optical depth in band 16: 2600-3250 cm-1 (low - h2o,ch4; high - ch4) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l04158">radsw_main.f:4158</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_ga5b0d35149515607d94f42b6ee5a40665"><div class="ttname"><a href="group__module__radsw__main.html#ga5b0d35149515607d94f42b6ee5a40665">module_radsw_main::rswinit</a></div><div class="ttdeci">subroutine, public rswinit(me)</div><div class="ttdoc">This subroutine initializes non-varying module variables, conversion factors, and look-up tables...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l01379">radsw_main.f:1379</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html"><div class="ttname"><a href="namespacemodule__radsw__parameters.html">module_radsw_parameters</a></div><div class="ttdoc">This module is for specifying the band structures and program parameters used by the RRTMG-SW scheme...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00066">radsw_param.f:66</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga1d3f12f050c90be49f109205c463b29b"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga1d3f12f050c90be49f109205c463b29b">module_radsw_kgb21::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msb21, ng21), public absb</div><div class="ttdoc">the array absb(1175,10) (kb(5,5,13:59,10)) contains absorption coefs at the 16 chosen g-values for a ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l11964">radsw_datatb.f:11964</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html_a2c5efc91f02dc0d4bdbd5e490f44c19c"><div class="ttname"><a href="namespacemodule__radsw__parameters.html#a2c5efc91f02dc0d4bdbd5e490f44c19c">module_radsw_parameters::nblow</a></div><div class="ttdeci">integer, parameter nblow</div><div class="ttdoc">band range lower index </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00128">radsw_param.f:128</a></div></div>
<div class="ttc" id="radsw__main_8f_html_a776a0d78fda9f4fd0f1153b55be597df"><div class="ttname"><a href="radsw__main_8f.html#a776a0d78fda9f4fd0f1153b55be597df">taumol19</a></div><div class="ttdeci">subroutine taumol19</div><div class="ttdoc">The subroutine computes the optical depth in band 19: 4650-5150 cm-1 (low - h2o,co2; high - co2) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l04474">radsw_main.f:4474</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb26_html"><div class="ttname"><a href="namespacemodule__radsw__kgb26.html">module_radsw_kgb26</a></div><div class="ttdoc">This module sets up absorption coeffients for band 26: 22650-29000 cm-1 (low - nothing; high - nothin...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18191">radsw_datatb.f:18191</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_ga5eb9918ebc222138a9dad016440e1a74"><div class="ttname"><a href="group__module__radsw__main.html#ga5eb9918ebc222138a9dad016440e1a74">module_radsw_main::setcoef</a></div><div class="ttdeci">subroutine setcoef(pavel, tavel, h2ovmr, nlay, nlp1, laytrop, jp, jt, jt1, fac00, fac01, fac10, fac11, selffac, selffrac, indself, forfac, forfrac, indfor)</div><div class="ttdoc">This subroutine computes various coefficients needed in radiative transfer calculation. </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l02111">radsw_main.f:2111</a></div></div>
<div class="ttc" id="radsw__main_8f_html_a2113c76707f43cf91fe5926ab69d1b8b"><div class="ttname"><a href="radsw__main_8f.html#a2113c76707f43cf91fe5926ab69d1b8b">taumol28</a></div><div class="ttdeci">subroutine taumol28</div><div class="ttdoc">The subroutine computes the optical depth in band 28: 38000-50000 cm-1 (low - o3,o2; high - o3...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l05196">radsw_main.f:5196</a></div></div>
<div class="ttc" id="radsw__main_8f_html_a06f6f2b0ef60df93c267a667a2e1aa36"><div class="ttname"><a href="radsw__main_8f.html#a06f6f2b0ef60df93c267a667a2e1aa36">taumol18</a></div><div class="ttdeci">subroutine taumol18</div><div class="ttdoc">The subroutine computes the optical depth in band 18: 4000-4650 cm-1 (low - h2o,ch4; high - ch4) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l04378">radsw_main.f:4378</a></div></div>
<div class="ttc" id="namespacemodule__radsw__sflux_html_aee2a2275da028b0960c5c1c8a34f46cf"><div class="ttname"><a href="namespacemodule__radsw__sflux.html#aee2a2275da028b0960c5c1c8a34f46cf">module_radsw_sflux::strrat</a></div><div class="ttdeci">real(kind=kind_phys), dimension(nblow:nbhgh), public strrat</div><div class="ttdoc">coefficients for computing binary absorbing species </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l01968">radsw_datatb.f:1968</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_a8b8bae831aa5b460e260c94e7f24f4c7"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#a8b8bae831aa5b460e260c94e7f24f4c7">module_radsw_cldprtb::extice3</a></div><div class="ttdeci">real(kind=kind_phys), dimension(46, nblow:nbhgh), public extice3</div><div class="ttdoc">extinction coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00255">radsw_datatb.f:255</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_ac2e5b61aea6effe7d49586bf5223c154"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#ac2e5b61aea6effe7d49586bf5223c154">module_radsw_cldprtb::fbari</a></div><div class="ttdeci">real(kind=kind_phys), dimension(5), public fbari</div><div class="ttdoc">asymmetry coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00280">radsw_datatb.f:280</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_af8b02590603ea2f838d954cb0a93bbeb"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#af8b02590603ea2f838d954cb0a93bbeb">module_radsw_cldprtb::dbari</a></div><div class="ttdeci">real(kind=kind_phys), dimension(5), public dbari</div><div class="ttdoc">single scattering albedo coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00276">radsw_datatb.f:276</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_ga859cc14063a58e9d0a252e4366b9fff3"><div class="ttname"><a href="group__module__radsw__main.html#ga859cc14063a58e9d0a252e4366b9fff3">module_radsw_main::spcvrtm</a></div><div class="ttdeci">subroutine spcvrtm(ssolar, cosz, sntz, albbm, albdf, sfluxzen, cldfmc, cf1, cf0, taug, taur, tauae, ssaae, asyae, taucw, ssacw, asycw, nlay, nlp1, fxupc, fxdnc, fxup0, fxdn0, ftoauc, ftoau0, ftoadc, fsfcuc, fsfcu0, fsfcdc, fsfcd0, sfbmc, sfdfc, sfbm0, sfdf0, suvbfc, suvbf0)</div><div class="ttdoc">This subroutine computes the shortwave radiative fluxes using two-stream method of h...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l03066">radsw_main.f:3066</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb29_html"><div class="ttname"><a href="namespacemodule__radsw__kgb29.html">module_radsw_kgb29</a></div><div class="ttdoc">This module sets up absorption coeffients for band 29: 820-2600 cm-1 (low - h2o; high - co2) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l21147">radsw_datatb.f:21147</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb17_html"><div class="ttname"><a href="namespacemodule__radsw__kgb17.html">module_radsw_kgb17</a></div><div class="ttdoc">This module sets up absorption coeffients for band 17: 3250-4000 cm-1 (low - h2o,co2; high - h2o...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l03468">radsw_datatb.f:3468</a></div></div>
<div class="ttc" id="radsw__main_8f_html_a08e2db10432d07392f29a49bc5b5c640"><div class="ttname"><a href="radsw__main_8f.html#a08e2db10432d07392f29a49bc5b5c640">taumol29</a></div><div class="ttdeci">subroutine taumol29</div><div class="ttdoc">The subroutine computes the optical depth in band 29: 820-2600 cm-1 (low - h2o; high - co2) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l05305">radsw_main.f:5305</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gaf4daf474954d4689219ada6d0662aceb"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gaf4daf474954d4689219ada6d0662aceb">module_radsw_kgb25::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msa25, ng25), public absa</div><div class="ttdoc">the array absa(65,NG25) (ka(5,13,NG25)) contains absorption coefs at the 16 chosen g-values for a ran...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18072">radsw_datatb.f:18072</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_a430be0720aa2e2ac46aa1ec7c9a9b64b"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#a430be0720aa2e2ac46aa1ec7c9a9b64b">module_radsw_cldprtb::asyliq1</a></div><div class="ttdeci">real(kind=kind_phys), dimension(58, nblow:nbhgh), public asyliq1</div><div class="ttdoc">asymmetry coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00238">radsw_datatb.f:238</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_aec2685be0de3a557aca169062cf1055e"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#aec2685be0de3a557aca169062cf1055e">module_radsw_cldprtb::asyice3</a></div><div class="ttdeci">real(kind=kind_phys), dimension(46, nblow:nbhgh), public asyice3</div><div class="ttdoc">asymmetry coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00261">radsw_datatb.f:261</a></div></div>
<div class="ttc" id="radsw__main_8f_html_a7d2cea6cc0cfde853d25a14ba0efcca2"><div class="ttname"><a href="radsw__main_8f.html#a7d2cea6cc0cfde853d25a14ba0efcca2">taumol27</a></div><div class="ttdeci">subroutine taumol27</div><div class="ttdoc">The subroutine computes the optical depth in band 27: 29000-38000 cm-1 (low - o3; high - o3) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l05134">radsw_main.f:5134</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb22_html"><div class="ttname"><a href="namespacemodule__radsw__kgb22.html">module_radsw_kgb22</a></div><div class="ttdoc">This module sets up absorption coeffients for band 22: 7700-8050 cm-1 (low - h2o, o2; high - o2) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l15759">radsw_datatb.f:15759</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga468e2dd6001734d10784c8fb7b5df4e3"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga468e2dd6001734d10784c8fb7b5df4e3">module_radsw_kgb29::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msf29, ng29), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l21217">radsw_datatb.f:21217</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_ga244c149eb05c0675a7e040dbf7e2bc4b"><div class="ttname"><a href="group__module__radsw__main.html#ga244c149eb05c0675a7e040dbf7e2bc4b">module_radsw_main::s0</a></div><div class="ttdeci">real(kind=kind_phys), parameter s0</div><div class="ttdoc">internal solar constant </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l00448">radsw_main.f:448</a></div></div>
<div class="ttc" id="namespacemodule__radsw__sflux_html_a95d2640cf0e6cf0ba4a8ca1758806e48"><div class="ttname"><a href="namespacemodule__radsw__sflux.html#a95d2640cf0e6cf0ba4a8ca1758806e48">module_radsw_sflux::sfluxref03</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ngmax, mfs03, mfb03), target, public sfluxref03</div><div class="ttdoc">spectral solar fluxes, j=1,2,...,5 for SW band number of 18,19,21,22,24 </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l02011">radsw_datatb.f:2011</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_gae1f88a0b60d69b892cfae83bb9ab67df"><div class="ttname"><a href="group__module__radsw__main.html#gae1f88a0b60d69b892cfae83bb9ab67df">module_radsw_main::ipsdsw0</a></div><div class="ttdeci">integer, parameter ipsdsw0</div><div class="ttdoc">initial permutation seed used for sub-column cloud scheme </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l00504">radsw_main.f:504</a></div></div>
<div class="ttc" id="namespacemodule__radsw__sflux_html"><div class="ttname"><a href="namespacemodule__radsw__sflux.html">module_radsw_sflux</a></div><div class="ttdoc">This module contains various indexes and coefficients for SW spectral bands, as well as the spectral ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l01934">radsw_datatb.f:1934</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga19083764c3dfe437282b032517baf3ed"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga19083764c3dfe437282b032517baf3ed">module_radsw_kgb17::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msa17, ng17), public absa</div><div class="ttdoc">the array absa(585,NG17) (ka((9,5,13,NG17)) contains absorption coefs at the 16 chosen g-values for a...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l03523">radsw_datatb.f:3523</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga40006f284543c7347eced417b9de2fc6"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga40006f284543c7347eced417b9de2fc6">module_radsw_kgb23::rayl</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng23), public rayl</div><div class="ttdoc">rayleigh extinction coefficient at all v </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l16265">radsw_datatb.f:16265</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gab02765dac8ca71a439cdaf1ed2691851"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gab02765dac8ca71a439cdaf1ed2691851">module_radsw_kgb25::abso3a</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng25), public abso3a</div><div class="ttdoc">o3 </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18078">radsw_datatb.f:18078</a></div></div>
<div class="ttc" id="radsw__main_8f_html_a6eb9a29728a986ea6b15240adebd4a0c"><div class="ttname"><a href="radsw__main_8f.html#a6eb9a29728a986ea6b15240adebd4a0c">taumol20</a></div><div class="ttdeci">subroutine taumol20</div><div class="ttdoc">The subroutine computes the optical depth in band 20: 5150-6150 cm-1 (low - h2o; high - h2o) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l04570">radsw_main.f:4570</a></div></div>
<div class="ttc" id="radsw__main_8f_html_a54619c48147f35da2d7855dc488c0ff4"><div class="ttname"><a href="radsw__main_8f.html#a54619c48147f35da2d7855dc488c0ff4">taumol21</a></div><div class="ttdeci">subroutine taumol21</div><div class="ttdoc">The subroutine computes the optical depth in band 21: 6150-7700 cm-1 (low - h2o,co2; high - h2o...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l04652">radsw_main.f:4652</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga7cce83c282d3efec6a3fe319480c270a"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga7cce83c282d3efec6a3fe319480c270a">module_radsw_kgb21::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msa21, ng21), public absa</div><div class="ttdoc">the array absa(585,NG21) (ka((9,5,13,NG21)) contains absorption coefs at the 16 chosen g-values for a...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l11951">radsw_datatb.f:11951</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb25_html"><div class="ttname"><a href="namespacemodule__radsw__kgb25.html">module_radsw_kgb25</a></div><div class="ttdoc">This module sets up absorption coeffients for band 25: 16000-22650 cm-1 (low - h2o; high - nothing) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18030">radsw_datatb.f:18030</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gaf5b135f82f34831e86a12f726cbe47ad"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gaf5b135f82f34831e86a12f726cbe47ad">module_radsw_kgb20::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msb20, ng20), public absb</div><div class="ttdoc">the array absb(235,10) (kb(5,13:59,10)) contains absorption coefs at the 16 chosen g-values for a ran...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l11182">radsw_datatb.f:11182</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_a7944084ba9f240723dc93467ec66f825"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#a7944084ba9f240723dc93467ec66f825">module_radsw_cldprtb::ssaliq1</a></div><div class="ttdeci">real(kind=kind_phys), dimension(58, nblow:nbhgh), public ssaliq1</div><div class="ttdoc">single scattering albedo coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00235">radsw_datatb.f:235</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga8a7787776bd057b1815e92a5f58b9cac"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga8a7787776bd057b1815e92a5f58b9cac">module_radsw_kgb18::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msa18, ng18), public absa</div><div class="ttdoc">the array absa(585,NG18) (ka(9,5,13,NG18)) contains absorption coefs at the 16 chosen g-values for a ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l08133">radsw_datatb.f:8133</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gafe8639128e4f7a48f133b7399addcb79"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gafe8639128e4f7a48f133b7399addcb79">module_radsw_kgb16::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msb16, ng16), public absb</div><div class="ttdoc">the array absb(235,6) (kb(5,13:59,6)) contains absorption coefs at the 16 chosen g-values for a range...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l02342">radsw_datatb.f:2342</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_gacd9ae7c14cbfdc55f1f0fff637ca0331"><div class="ttname"><a href="group__module__radsw__main.html#gacd9ae7c14cbfdc55f1f0fff637ca0331">module_radsw_main::bpade</a></div><div class="ttdeci">real(kind=kind_phys), parameter bpade</div><div class="ttdoc">pade approx constant </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l00443">radsw_main.f:443</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga6a00db6ce81c299d44ef5eadc1fe3b5b"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga6a00db6ce81c299d44ef5eadc1fe3b5b">module_radsw_kgb20::rayl</a></div><div class="ttdeci">real(kind=kind_phys), parameter, public rayl</div><div class="ttdoc">rayleigh extinction coefficient at  </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l11192">radsw_datatb.f:11192</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html_a715ab3195493dff0639da443c21e4fb5"><div class="ttname"><a href="namespacemodule__radsw__parameters.html#a715ab3195493dff0639da443c21e4fb5">module_radsw_parameters::ngs</a></div><div class="ttdeci">integer, dimension(nblow:nbhgh) ngs</div><div class="ttdoc">array contains values of NS16-NS29 </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00168">radsw_param.f:168</a></div></div>
<div class="ttc" id="namespacemodule__radsw__sflux_html_acb1498ecf044449dbe6d7a5630fdc375"><div class="ttname"><a href="namespacemodule__radsw__sflux.html#acb1498ecf044449dbe6d7a5630fdc375">module_radsw_sflux::ibx</a></div><div class="ttdeci">integer, dimension(nblow:nbhgh), public ibx</div><div class="ttdoc">band index (3rd index in array sfluxref described below) </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l01996">radsw_datatb.f:1996</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gaef407d13a88f5e1bfd20652ab3010e2f"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gaef407d13a88f5e1bfd20652ab3010e2f">module_radsw_kgb17::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msb17, ng17), public absb</div><div class="ttdoc">the array absb(1175,12) (kb(5,5,13:59,12)) contains absorption coefs at the 16 chosen g-values for a ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l03536">radsw_datatb.f:3536</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gaf3641febf88e97741b2cd86a56eda843"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gaf3641febf88e97741b2cd86a56eda843">module_radsw_kgb28::rayl</a></div><div class="ttdeci">real(kind=kind_phys), parameter, public rayl</div><div class="ttdoc">rayleigh extinction coefficient </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18893">radsw_datatb.f:18893</a></div></div>
<div class="ttc" id="radsw__main_8f_html_a21b72d6de9247eccb20de836ea76cf7a"><div class="ttname"><a href="radsw__main_8f.html#a21b72d6de9247eccb20de836ea76cf7a">taumol25</a></div><div class="ttdeci">subroutine taumol25</div><div class="ttdoc">The subroutine computes the optical depth in band 25: 16000-22650 cm-1 (low - h2o; high - nothing) ...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l05042">radsw_main.f:5042</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga405eabf194b1216dd083c2344e80f5b4"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga405eabf194b1216dd083c2344e80f5b4">module_radsw_kgb20::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msa20, ng20), public absa</div><div class="ttdoc">the array absa(65,NG20) (ka(5,13,NG20)) contains absorption coefs at the 16 chosen g-values for a ran...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l11169">radsw_datatb.f:11169</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_a39b045b05e6bc9c04603277654ff8fc6"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#a39b045b05e6bc9c04603277654ff8fc6">module_radsw_cldprtb::ssaice3</a></div><div class="ttdeci">real(kind=kind_phys), dimension(46, nblow:nbhgh), public ssaice3</div><div class="ttdoc">single scattering albedo coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00258">radsw_datatb.f:258</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_gadf2f35094ed7dc31e8f52781745cf021"><div class="ttname"><a href="group__module__radsw__main.html#gadf2f35094ed7dc31e8f52781745cf021">module_radsw_main::mcica_subcol</a></div><div class="ttdeci">subroutine mcica_subcol(cldf, nlay, ipseed, lcloudy)</div><div class="ttdoc">This subroutine computes the sub-colum cloud profile flag array. </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l01928">radsw_main.f:1928</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_a0fdb9425031a10735e11d7f5c9e0376e"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#a0fdb9425031a10735e11d7f5c9e0376e">module_radsw_cldprtb::a0r</a></div><div class="ttdeci">real(kind=kind_phys), public a0r</div><div class="ttdoc">optical depth coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l01906">radsw_datatb.f:1906</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb21_html"><div class="ttname"><a href="namespacemodule__radsw__kgb21.html">module_radsw_kgb21</a></div><div class="ttdoc">This module sets up absorption coeffients for band 21: 6150-7700 cm-1 (low - h2o,co2; high - h2o...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l11901">radsw_datatb.f:11901</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga858680db0ee5e9a599639844a91f8f06"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga858680db0ee5e9a599639844a91f8f06">module_radsw_kgb18::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msb18, ng18), public absb</div><div class="ttdoc">the array absb(235,8) (kb(5,13:59,8)) contains absorption coefs at the 16 chosen g-values for a range...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l08146">radsw_datatb.f:8146</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_ae7f1de5c9736894ac7b54c0e0d312f16"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#ae7f1de5c9736894ac7b54c0e0d312f16">module_radsw_cldprtb::cbari</a></div><div class="ttdeci">real(kind=kind_phys), dimension(5), public cbari</div><div class="ttdoc">single scattering albedo coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00274">radsw_datatb.f:274</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga27964e0300eb686acf1ed3c8459d3810"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga27964e0300eb686acf1ed3c8459d3810">module_radsw_kgb16::rayl</a></div><div class="ttdeci">real(kind=kind_phys), parameter, public rayl</div><div class="ttdoc">rayleigh extinction coefficient at v =  </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l02347">radsw_datatb.f:2347</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga5f6ced06169db4b7470e20d5639ac54c"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga5f6ced06169db4b7470e20d5639ac54c">module_radsw_kgb23::givfac</a></div><div class="ttdeci">real(kind=kind_phys), parameter, public givfac</div><div class="ttdoc">average giver et al. correction factor for this band. </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l16268">radsw_datatb.f:16268</a></div></div>
<div class="ttc" id="structmodule__radsw__parameters_1_1topfsw__type_html"><div class="ttname"><a href="structmodule__radsw__parameters_1_1topfsw__type.html">module_radsw_parameters::topfsw_type</a></div><div class="ttdoc">derived type for SW fluxes at TOA </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00076">radsw_param.f:76</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga76fc3e4566fcee982b99b10ea562ba93"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga76fc3e4566fcee982b99b10ea562ba93">module_radsw_kgb21::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msf21, ng21), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l11971">radsw_datatb.f:11971</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gaca4c6e06d1cd46568048a035c6726f1d"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gaca4c6e06d1cd46568048a035c6726f1d">module_radsw_kgb27::rayl</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng27), public rayl</div><div class="ttdoc">rayleigh extinction coefficient </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18289">radsw_datatb.f:18289</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gaade34dfbe8c5f380088b6e03acc727c9"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gaade34dfbe8c5f380088b6e03acc727c9">module_radsw_kgb17::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msf17, ng17), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l03506">radsw_datatb.f:3506</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga8df418599fb8aef5fc8f2935a913b361"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga8df418599fb8aef5fc8f2935a913b361">module_radsw_kgb21::rayl</a></div><div class="ttdeci">real(kind=kind_phys), parameter, public rayl</div><div class="ttdoc">rayleigh extinction coefficient at  </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l11974">radsw_datatb.f:11974</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html_afdd8496d7eaa017f7f1e08e998945c1e"><div class="ttname"><a href="namespacemodule__radsw__parameters.html#afdd8496d7eaa017f7f1e08e998945c1e">module_radsw_parameters::ngb</a></div><div class="ttdeci">integer, dimension(ngptsw) ngb</div><div class="ttdoc">reverse checking of band index for each g-point </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00173">radsw_param.f:173</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gacab70725ca7faf002f04306fe1798e02"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gacab70725ca7faf002f04306fe1798e02">module_radsw_kgb29::absh2o</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng29), public absh2o</div><div class="ttdoc">h2o </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l21220">radsw_datatb.f:21220</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html_a5bc6fbb4231281a604352eec6b8e2bfc"><div class="ttname"><a href="namespacemodule__radsw__parameters.html#a5bc6fbb4231281a604352eec6b8e2bfc">module_radsw_parameters::maxgas</a></div><div class="ttdeci">integer, parameter maxgas</div><div class="ttdoc">maximum number of absorbing gases </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00138">radsw_param.f:138</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gad1171c012a1615c4b98eb3e95276867d"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gad1171c012a1615c4b98eb3e95276867d">module_radsw_kgb19::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msb19, ng19), public absb</div><div class="ttdoc">the array absb(235,8) (kb(5,13:59,8)) contains absorption coefs at the 16 chosen g-values for a range...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l09664">radsw_datatb.f:9664</a></div></div>
<div class="ttc" id="namespacemodule__radsw__sflux_html_a90c56da1bcadbea0b42e12487c1c1eec"><div class="ttname"><a href="namespacemodule__radsw__sflux.html#a90c56da1bcadbea0b42e12487c1c1eec">module_radsw_sflux::layreffr</a></div><div class="ttdeci">integer, dimension(nblow:nbhgh), public layreffr</div><div class="ttdoc">reference pressure level for each of the spectral bands </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l01985">radsw_datatb.f:1985</a></div></div>
<div class="ttc" id="group__module__radsw__main_html_gaa82121d21c1e8f2ca938378249fea135"><div class="ttname"><a href="group__module__radsw__main.html#gaa82121d21c1e8f2ca938378249fea135">module_radsw_main::taumol</a></div><div class="ttdeci">subroutine taumol(colamt, colmol, fac00, fac01, fac10, fac11, jp, jt, jt1, laytrop, forfac, forfrac, indfor, selffac, selffrac, indself, nlay, sfluxzen, taug, taur)</div><div class="ttdoc">This subroutine calculates optical depths for gaseous absorption and rayleigh scattering   subroutine...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l03906">radsw_main.f:3906</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_ac39d49e73ffa960421e36e45a35db162"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#ac39d49e73ffa960421e36e45a35db162">module_radsw_cldprtb::b0r</a></div><div class="ttdeci">real(kind=kind_phys), dimension(nblow:nbhgh), public b0r</div><div class="ttdoc">single scattering albedo coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l01908">radsw_datatb.f:1908</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb28_html"><div class="ttname"><a href="namespacemodule__radsw__kgb28.html">module_radsw_kgb28</a></div><div class="ttdoc">This module sets up absorption coeffients for band 28: 38000-50000 cm-1 (low - o3,o2; high - o3,o2) </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18832">radsw_datatb.f:18832</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga5e48daf035b3b22b6e1b0f36aabcec10"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga5e48daf035b3b22b6e1b0f36aabcec10">module_radsw_kgb28::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(msa28, ng28), public absa</div><div class="ttdoc">the array absa(585,NG28) (ka((9,5,13,NG28)) contains absorption coefs at the 16 chosen g-values for a...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18877">radsw_datatb.f:18877</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_ace960bbbf15ab3cadbee76301ff111dd"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#ace960bbbf15ab3cadbee76301ff111dd">module_radsw_cldprtb::abari</a></div><div class="ttdeci">real(kind=kind_phys), dimension(5), public abari</div><div class="ttdoc">extinction coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00270">radsw_datatb.f:270</a></div></div>
<div class="ttc" id="namespacemodule__radsw__kgb16_html"><div class="ttname"><a href="namespacemodule__radsw__kgb16.html">module_radsw_kgb16</a></div><div class="ttdoc">This module sets up absorption coefficients for band 16: 2600-3250 cm-1 (low - h2o, ch4; high - ch4) </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l02274">radsw_datatb.f:2274</a></div></div>
<div class="ttc" id="structmodule__radsw__parameters_1_1sfcfsw__type_html"><div class="ttname"><a href="structmodule__radsw__parameters_1_1sfcfsw__type.html">module_radsw_parameters::sfcfsw_type</a></div><div class="ttdoc">derived type for SW fluxes at surface </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00086">radsw_param.f:86</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga6b44aa0637523aa1f78de5b4d16c693b"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga6b44aa0637523aa1f78de5b4d16c693b">module_radsw_kgb24::abso3b</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng24), public abso3b</div><div class="ttdoc">o3 </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l16542">radsw_datatb.f:16542</a></div></div>
<div class="ttc" id="namespacemodule__radsw__ref_html_a449fffa7047caa0fba6c166c26f7dbbd"><div class="ttname"><a href="namespacemodule__radsw__ref.html#a449fffa7047caa0fba6c166c26f7dbbd">module_radsw_ref::tref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(59) tref</div><div class="ttdoc">MLS standard atmosphere temperature at the standard pressure levels. </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00085">radsw_datatb.f:85</a></div></div>
<div class="ttc" id="namespacemodule__radsw__cldprtb_html_ad5342321ccd4759cb70f7a673620ee19"><div class="ttname"><a href="namespacemodule__radsw__cldprtb.html#ad5342321ccd4759cb70f7a673620ee19">module_radsw_cldprtb::bbari</a></div><div class="ttdeci">real(kind=kind_phys), dimension(5), public bbari</div><div class="ttdoc">extinction coefficients </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l00272">radsw_datatb.f:272</a></div></div>
<div class="ttc" id="namespacemodule__radsw__sflux_html_a7d1a386e92555bcb09239ab098d8b398"><div class="ttname"><a href="namespacemodule__radsw__sflux.html#a7d1a386e92555bcb09239ab098d8b398">module_radsw_sflux::specwt</a></div><div class="ttdeci">real(kind=kind_phys), dimension(nblow:nbhgh), public specwt</div><div class="ttdoc">weighting parameters for major absorbers in each band </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l01971">radsw_datatb.f:1971</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gaa4862628a06e0e08d1db5637bc62ffa5"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gaa4862628a06e0e08d1db5637bc62ffa5">module_radsw_kgb17::rayl</a></div><div class="ttdeci">real(kind=kind_phys), parameter, public rayl</div><div class="ttdoc">rayleigh extinction coefficient at v = 3625  </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l03541">radsw_datatb.f:3541</a></div></div>
<div class="ttc" id="radsw__main_8f_html_ae0abf1a08aa5d6ca14bfea83d0603716"><div class="ttname"><a href="radsw__main_8f.html#ae0abf1a08aa5d6ca14bfea83d0603716">taumol24</a></div><div class="ttdeci">subroutine taumol24</div><div class="ttdoc">The subroutine computes the optical depth in band 24: 12850-16000 cm-1 (low - h2o,o2; high - o2) </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l04946">radsw_main.f:4946</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_gaa9a57e32dfbb8979478aa8c931ff0e2d"><div class="ttname"><a href="group__module__radsw__kgbnn.html#gaa9a57e32dfbb8979478aa8c931ff0e2d">module_radsw_kgb29::absco2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng29), public absco2</div><div class="ttdoc">co2 </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l21223">radsw_datatb.f:21223</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga3d32a0d74d03129cacd9c4bb2e58683a"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga3d32a0d74d03129cacd9c4bb2e58683a">module_radsw_kgb25::rayl</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng25), public rayl</div><div class="ttdoc">rayleigh extinction coefficient </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l18075">radsw_datatb.f:18075</a></div></div>
<div class="ttc" id="group__module__radsw__kgbnn_html_ga9cd3f07e259e4982c7ef2889fee6cccb"><div class="ttname"><a href="group__module__radsw__kgbnn.html#ga9cd3f07e259e4982c7ef2889fee6cccb">module_radsw_kgb18::rayl</a></div><div class="ttdeci">real(kind=kind_phys), parameter, public rayl</div><div class="ttdoc">rayleigh extinction coefficient at  </div><div class="ttdef"><b>Definition:</b> <a href="radsw__datatb_8f_source.html#l08151">radsw_datatb.f:8151</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="radsw__main_8f.html">radsw_main.f</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
