<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GFS Physics Documentation: radlw_main.f Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ccpp_dox_extra_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ncep.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GFS Physics Documentation
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('radlw__main_8f_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">radlw_main.f</div>  </div>
</div><!--header-->
<div class="contents">
<a href="radlw__main_8f.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">!!!!!  ==============================================================  !!!!!</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">!!!!!               lw-rrtm3 radiation package description             !!!!!</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">!!!!!  ==============================================================  !!!!!</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">!   this package includes ncep&#39;s modifications of the rrtm-lw radiation    !</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">!   code from aer inc.                                                     !</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">!    the lw-rrtm3 package includes these parts:                            !</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">!       &#39;radlw_rrtm3_param.f&#39;                                              !</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">!       &#39;radlw_rrtm3_datatb.f&#39;                                             !</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">!       &#39;radlw_rrtm3_main.f&#39;                                               !</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">!    the &#39;radlw_rrtm3_param.f&#39; contains:                                   !</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">!       &#39;module_radlw_parameters&#39;  -- band parameters set up               !</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">!    the &#39;radlw_rrtm3_datatb.f&#39; contains:                                  !</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">!       &#39;module_radlw_avplank&#39;     -- plank flux data                      !</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">!       &#39;module_radlw_ref&#39;         -- reference temperature and pressure   !</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">!       &#39;module_radlw_cldprlw&#39;     -- cloud property coefficients          !</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">!       &#39;module_radlw_kgbnn&#39;       -- absorption coeffients for 16         !</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">!                                     bands, where nn = 01-16              !</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">!    the &#39;radlw_rrtm3_main.f&#39; contains:                                    !</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">!       &#39;module_radlw_main&#39;        -- main lw radiation transfer           !</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">!    in the main module &#39;module_radlw_main&#39; there are only two             !</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">!    externally callable subroutines:                                      !</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">!       &#39;lwrad&#39;     -- main lw radiation routine                           !</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">!          inputs:                                                         !</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">!           (plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr,                         !</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">!            clouds,icseed,aerosols,sfemis,sfgtmp,                         !</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">!            npts, nlay, nlp1, lprnt,                                      !</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">!          outputs:                                                        !</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">!            hlwc,topflx,sfcflx,                                           !</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">!!         optional outputs:                                               !</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">!            HLW0,HLWB,FLXPRF)                                             !</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">!       &#39;rlwinit&#39;   -- initialization routine                              !</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">!          inputs:                                                         !</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">!           ( me )                                                         !</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">!          outputs:                                                        !</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">!           (none)                                                         !</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">!    all the lw radiation subprograms become contained subprograms         !</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">!    in module &#39;module_radlw_main&#39; and many of them are not directly       !</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">!    accessable from places outside the module.                            !</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">!    derived data type constructs used:                                    !</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">!     1. radiation flux at toa: (from module &#39;module_radlw_parameters&#39;)    !</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">!          topflw_type   -  derived data type for toa rad fluxes           !</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">!            upfxc              total sky upward flux at toa               !</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">!            upfx0              clear sky upward flux at toa               !</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">!     2. radiation flux at sfc: (from module &#39;module_radlw_parameters&#39;)    !</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">!          sfcflw_type   -  derived data type for sfc rad fluxes           !</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">!            upfxc              total sky upward flux at sfc               !</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">!            upfx0              clear sky upward flux at sfc               !</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">!            dnfxc              total sky downward flux at sfc             !</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">!            dnfx0              clear sky downward flux at sfc             !</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">!     3. radiation flux profiles(from module &#39;module_radlw_parameters&#39;)    !</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">!          proflw_type    -  derived data type for rad vertical prof       !</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">!            upfxc              level upward flux for total sky            !</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">!            dnfxc              level downward flux for total sky          !</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">!            upfx0              level upward flux for clear sky            !</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">!            dnfx0              level downward flux for clear sky          !</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">!    external modules referenced:                                          !</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">!       &#39;module physparam&#39;                                                 !</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">!       &#39;module physcons&#39;                                                  !</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">!       &#39;mersenne_twister&#39;                                                 !</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">!    compilation sequence is:                                              !</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">!       &#39;radlw_rrtm3_param.f&#39;                                              !</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">!       &#39;radlw_rrtm3_datatb.f&#39;                                             !</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">!       &#39;radlw_rrtm3_main.f&#39;                                               !</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">!    and all should be put in front of routines that use lw modules        !</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">!==========================================================================!</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">!    the original aer&#39;s program declarations:                              !</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">!                                                                          |</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">!  Copyright 2002-2007, Atmospheric &amp; Environmental Research, Inc. (AER).  |</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">!  This software may be used, copied, or redistributed as long as it is    |</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">!  not sold and this copyright notice is reproduced on each copy made.     |</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">!  This model is provided as is without any express or implied warranties. |</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">!                       (http://www.rtweb.aer.com/)                        |</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">!                                                                          |</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">! ************************************************************************ !</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">!                              rrtmg_lw                                    !</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">!                   a rapid radiative transfer model                       !</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">!                       for the longwave region                            ! </span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">!             for application to general circulation models                !</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">!            atmospheric and environmental research, inc.                  !</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">!                        131 hartwell avenue                               !</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">!                        lexington, ma 02421                               !</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">!                           eli j. mlawer                                  !</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">!                        jennifer s. delamere                              !</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">!                         michael j. iacono                                !</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">!                         shepard a. clough                                !</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">!                       email:  miacono@aer.com                            !</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">!                       email:  emlawer@aer.com                            !</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">!                       email:  jdelamer@aer.com                           !</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">!        the authors wish to acknowledge the contributions of the          !</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">!        following people:  steven j. taubman, karen cady-pereira,         !</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">!        patrick d. brown, ronald e. farren, luke chen, robert bergstrom.  !</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">! ************************************************************************ !</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">!    references:                                                           !</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">!    (rrtm_lw/rrtmg_lw):                                                   !</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">!      clough, s.A., m.w. shephard, e.j. mlawer, j.s. delamere,            !</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">!      m.j. iacono, k. cady-pereira, s. boukabara, and p.d. brown:         !</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">!      atmospheric radiative transfer modeling: a summary of the aer       !</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">!      codes, j. quant. spectrosc. radiat. transfer, 91, 233-244, 2005.    !</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">!      mlawer, e.j., s.j. taubman, p.d. brown, m.j. iacono, and s.a.       !</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">!      clough:  radiative transfer for inhomogeneous atmospheres: rrtm,    !</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">!      a validated correlated-k model for the longwave.  j. geophys. res., !</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">!      102, 16663-16682, 1997.                                             !</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">!    (mcica):                                                              !</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">!      pincus, r., h. w. barker, and j.-j. morcrette: a fast, flexible,    !</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">!      approximation technique for computing radiative transfer in         !</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">!      inhomogeneous cloud fields, j. geophys. res., 108(d13), 4376,       !</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">!      doi:10.1029/2002JD003322, 2003.                                     !</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">! ************************************************************************ !</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">!    aer&#39;s revision history:                                               !</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">!     this version of rrtmg_lw has been modified from rrtm_lw to use a     !</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">!     reduced set of g-points for application to gcms.                     !</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">! --  original version (derived from rrtm_lw), reduction of g-points,      !</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">!     other revisions for use with gcms.                                   !</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">!        1999: m. j. iacono, aer, inc.                                     !</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">! --  adapted for use with ncar/cam3.                                      !</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">!        may 2004: m. j. iacono, aer, inc.                                 !</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">! --  revised to add mcica capability.                                     !</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">!        nov 2005: m. j. iacono, aer, inc.                                 !</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">! --  conversion to f90 formatting for consistency with rrtmg_sw.          !</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">!        feb 2007: m. j. iacono, aer, inc.                                 !</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">! --  modifications to formatting to use assumed-shape arrays.             !</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">!        aug 2007: m. j. iacono, aer, inc.                                 !</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">! ************************************************************************ !</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">!    ncep modifications history log:                                       !</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">!       nov 1999,  ken campana       -- received the original code from    !</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">!                    aer (1998 ncar ccm version), updated to link up with  !</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">!                    ncep mrf model                                        !</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">!       jun 2000,  ken campana       -- added option to switch random and  !</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">!                    maximum/random cloud overlap                          !</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">!           2001,  shrinivas moorthi -- further updates for mrf model      !</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">!       may 2001,  yu-tai hou        -- updated on trace gases and cloud   !</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">!                    property based on rrtm_v3.0 codes.                    !</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">!       dec 2001,  yu-tai hou        -- rewritten code into fortran 90 std !</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">!                    set ncep radiation structure standard that contains   !</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">!                    three plug-in compatable fortran program files:       !</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">!                    &#39;radlw_param.f&#39;, &#39;radlw_datatb.f&#39;, &#39;radlw_main.f&#39;     !</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">!                    fixed bugs in subprograms taugb14, taugb2, etc. added !</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">!                    out-of-bounds protections. (a detailed note of        !</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">!                    up_to_date modifications/corrections by ncep was sent !</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">!                    to aer in 2002)                                       !</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">!       jun 2004,  yu-tai hou        -- added mike iacono&#39;s apr 2004       !</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">!                    modification of variable diffusivity angles.          !</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">!       apr 2005,  yu-tai hou        -- minor modifications on module      !</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">!                    structures include rain/snow effect (this version of  !</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">!                    code was given back to aer in jun 2006)               !</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">!       mar 2007,  yu-tai hou        -- added aerosol effect for ncep      !</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">!                    models using the generallized aerosol optical property!</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">!                    scheme for gfs model.                                 !</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">!       apr 2007,  yu-tai hou        -- added spectral band heating as an  !</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">!                    optional output to support the 500 km gfs model&#39;s     !</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">!                    upper stratospheric radiation calculations. and       !</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">!                    restructure optional outputs for easy access by       !</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">!                    different models.                                     !</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">!       oct 2008,  yu-tai hou        -- modified to include new features   !</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">!                    from aer&#39;s newer release v4.4-v4.7, including the     !</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">!                    mcica sub-grid cloud option. add rain/snow optical    !</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">!                    properties support to cloudy sky calculations.        !</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">!                    correct errors in mcica cloud optical properties for  !</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">!                    ebert &amp; curry scheme (ilwcice=1) that needs band      !</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">!                    index conversion. simplified and unified sw and lw    !</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">!                    sub-column cloud subroutines into one module by using !</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">!                    optional parameters.                                  !</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">!       mar 2009,  yu-tai hou        -- replaced the original random number!</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">!                    generator coming from the original code with ncep w3  !</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">!                    library to simplify the program and moved sub-column  !</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">!                    cloud subroutines inside the main module. added       !</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">!                    option of user provided permutation seeds that could  !</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">!                    be randomly generated from forecast time stamp.       !</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">!       oct 2009,  yu-tai hou        -- modified subrtines &quot;cldprop&quot; and   !</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">!                    &quot;rlwinit&quot; according updats from aer&#39;s rrtmg_lw v4.8.  !</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">!       nov 2009,  yu-tai hou        -- modified subrtine &quot;taumol&quot; according</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">!                    updats from aer&#39;s rrtmg_lw version 4.82. notice the   !</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">!                    cloud ice/liquid are assumed as in-cloud quantities,  !</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">!                    not as grid averaged quantities.                      !</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">!       jun 2010,  yu-tai hou        -- optimized code to improve efficiency</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">!       apr 2012,  b. ferrier and y. hou -- added conversion factor to fu&#39;s!</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">!                    cloud-snow optical property scheme.                   !</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">!       nov 2012,  yu-tai hou        -- modified control parameters thru   !</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">!                     module &#39;physparam&#39;.                                  !  </span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">!       FEB 2017    A.Cheng   - add odpth output, effective radius input   !</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">!                                                                          !</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">!!!!!  ==============================================================  !!!!!</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">!!!!!                         end descriptions                         !!!!!</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">!!!!!  ==============================================================  !!!!!</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">!========================================!</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keyword">module</span> module_radlw_main           <span class="comment">!</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">!........................................!</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keywordtype">use </span>physparam<span class="keywordtype">,        only</span> : ilwrate, ilwrgas, ilwcliq, ilwcice,  &amp;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;     &amp;                             isubclw, icldflg, iovrlw,  ivflip,   &amp;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;     &amp;                             kind_phys</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keywordtype">use </span>physcons<span class="keywordtype">,         only</span> : con_g, con_cp, con_avgd, con_amd,    &amp;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;     &amp;                             con_amw, con_amo3</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordtype">use </span>mersenne_twister<span class="keywordtype">, only</span> : random_setseed, random_number,       &amp;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;     &amp;                             random_stat</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__parameters.html">module_radlw_parameters</a></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__avplank.html">module_radlw_avplank</a><span class="keywordtype">, only</span> : <a class="code" href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">totplnk</a></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__ref.html">module_radlw_ref</a><span class="keywordtype">,     only</span> : preflog, tref, chi_mls</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="keywordtype">private</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">!  ...  version tag and last revision date</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keywordtype">character(40)</span>, <span class="keywordtype">parameter</span> ::                                       &amp;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;     &amp;   VTAGLW=<span class="stringliteral">&#39;NCEP LW v5.1  Nov 2012 -RRTMG-LW v4.82  &#39;</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">!    &amp;   VTAGLW=&#39;NCEP LW v5.0  Aug 2012 -RRTMG-LW v4.82  &#39;</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">!    &amp;   VTAGLW=&#39;RRTMG-LW v4.82  Nov 2009  &#39;</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">!    &amp;   VTAGLW=&#39;RRTMG-LW v4.8   Oct 2009  &#39;</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">!    &amp;   VTAGLW=&#39;RRTMG-LW v4.71  Mar 2009  &#39;</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">!    &amp;   VTAGLW=&#39;RRTMG-LW v4.4   Oct 2008  &#39;</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">!    &amp;   VTAGLW=&#39;RRTM-LW v2.3g   Mar 2007  &#39;</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">!    &amp;   VTAGLW=&#39;RRTM-LW v2.3g   Apr 2004  &#39;</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">!  ---  constant values</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: eps     = 1.0e-6</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: oneminus= 1.0-eps</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: cldmin  = 1.0e-80</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: bpade   = 1.0/0.278  <span class="comment">! pade approx constant</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: stpfac  = 296.0/1013.0</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: wtdiff  = 0.5        <span class="comment">! weight for radiance to flux conversion</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: tblint  = <a class="code" href="namespacemodule__radlw__parameters.html#a61ae33b9db5bac9962f72e2a0db3c0e4">ntbl</a>       <span class="comment">! lookup table conversion factor</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: f_zero  = 0.0</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: f_one   = 1.0</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">!  ...  atomic weights for conversion from mass to volume mixing ratios</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: amdw    = con_amd/con_amw</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: amdo3   = con_amd/con_amo3</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">!  ...  band indices</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nbands)</span> :: nspa, nspb</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keyword">data</span> nspa / 1, 1, 9, 9, 9, 1, 9, 1, 9, 1, 1, 9, 9, 1, 9, 9 /</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keyword">data</span> nspb / 1, 1, 5, 5, 5, 0, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0 /</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">!  ...  band wavenumber intervals</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">!     real (kind=kind_phys) :: wavenum1(nbands), wavenum2(nbands)</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">!     data wavenum1/                                                    &amp;</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">!    &amp;         10.,  350.,  500.,  630.,  700.,  820.,  980., 1080.,    &amp;</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">!err &amp;       1180., 1390., 1480., 1800., 2080., 2250., 2390., 2600. /</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">!    &amp;       1180., 1390., 1480., 1800., 2080., 2250., 2380., 2600. /</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">!     data wavenum2/                                                    &amp;</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">!    &amp;        350.,  500.,  630.,  700.,  820.,  980., 1080., 1180.,    &amp;</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">!err &amp;       1390., 1480., 1800., 2080., 2250., 2390., 2600., 3250. /</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">!    &amp;       1390., 1480., 1800., 2080., 2250., 2380., 2600., 3250. /</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">!     real (kind=kind_phys) :: delwave(nbands)</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">!     data delwave / 340., 150., 130.,  70., 120., 160., 100., 100.,    &amp;</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">!    &amp;               210.,  90., 320., 280., 170., 130., 220., 650. /</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">!  ---  reset diffusivity angle for Bands 2-3 and 5-9 to vary (between 1.50</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">!       and 1.80) as a function of total column water vapor.  the function</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">!       has been defined to minimize flux and cooling rate errors in these bands</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">!       over a wide range of precipitable water values.</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands)</span> :: a0, a1, a2</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keyword">data</span> a0 / 1.66,  1.55,  1.58,  1.66,  1.54, 1.454,  1.89,  1.33,  &amp;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;     &amp;         1.668,  1.66,  1.66,  1.66,  1.66,  1.66,  1.66,  1.66 /</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="keyword">data</span> a1 / 0.00,  0.25,  0.22,  0.00,  0.13, 0.446, -0.10,  0.40,  &amp;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;     &amp;        -0.006,  0.00,  0.00,  0.00,  0.00,  0.00,  0.00,  0.00 /</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="keyword">data</span> a2 / 0.00, -12.0, -11.7,  0.00, -0.72,-0.243,  0.19,-0.062,  &amp;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;     &amp;         0.414,  0.00,  0.00,  0.00,  0.00,  0.00,  0.00,  0.00 /</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">!! ---  logical flags for optional output fields</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="keywordtype">logical</span> :: lhlwb  = .false.</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="keywordtype">logical</span> :: lhlw0  = .false.</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordtype">logical</span> :: lflxprf= .false.</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">!  ---  those data will be set up only once by &quot;rlwinit&quot;</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">!  ...  fluxfac, heatfac are factors for fluxes (in w/m**2) and heating</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">!       rates (in k/day, or k/sec set by subroutine &#39;rlwinit&#39;)</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">!       semiss0 are default surface emissivity for each bands</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: fluxfac, heatfac, semiss0(<a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a>)</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="keyword">data</span> semiss0(:) / <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a>*1.0 /</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tau_tbl(0:<a class="code" href="namespacemodule__radlw__parameters.html#a61ae33b9db5bac9962f72e2a0db3c0e4">ntbl</a>)  <span class="comment">!clr-sky opt dep (for cldy transfer)</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: exp_tbl(0:<a class="code" href="namespacemodule__radlw__parameters.html#a61ae33b9db5bac9962f72e2a0db3c0e4">ntbl</a>)  <span class="comment">!transmittance lookup table</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tfn_tbl(0:<a class="code" href="namespacemodule__radlw__parameters.html#a61ae33b9db5bac9962f72e2a0db3c0e4">ntbl</a>)  <span class="comment">!tau transition function; i.e. the</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                                                <span class="comment">!transition of planck func from mean lyr</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                                <span class="comment">!temp to lyr boundary temp as a func of</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                                <span class="comment">!opt dep. &quot;linear in tau&quot; method is used.</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">!  ---  the following variables are used for sub-column cloud scheme</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: ipsdlw0 = <a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a>     <span class="comment">! initial permutation seed</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">!  ---  public accessable subprograms</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordtype">public</span> <a class="code" href="group__module__radlw__main.html#gaf20db29eaadab298ccd8b6bf489a53f4">lwrad</a>, <a class="code" href="group__module__radlw__main.html#gaa9569479682c83b26584b7e9ee6841fa">rlwinit</a></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">! ================</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keyword">contains</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">! ================</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">! --------------------------------</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radlw__main.html#gaf20db29eaadab298ccd8b6bf489a53f4">lwrad</a>                                                  &amp;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;     &amp;     ( plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr,                      &amp;   <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;     &amp;       clouds,icseed,aerosols,sfemis,sfgtmp,                      &amp;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;     &amp;       npts, nlay, nlp1, lprnt,                                   &amp;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;     &amp;       hlwc,topflx,sfcflx,                                        &amp;    <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;     &amp;       hlw0,hlwb,flxprf                                           &amp;   <span class="comment">!! ---  optional</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;     &amp;     )</div><div class="line"><a name="l00463"></a><span class="lineno"><a class="line" href="group__module__radlw__main.html#gaf20db29eaadab298ccd8b6bf489a53f4">  463</a></span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">!  input variables:                                                     !</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">!     plyr (npts,nlay) : layer mean pressures (mb)                      !</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">!     plvl (npts,nlp1) : interface pressures (mb)                       !</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">!     tlyr (npts,nlay) : layer mean temperature (k)                     !</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">!     tlvl (npts,nlp1) : interface temperatures (k)                     !</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">!     qlyr (npts,nlay) : layer specific humidity (gm/gm)   *see inside  !</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">!     olyr (npts,nlay) : layer ozone concentration (gm/gm) *see inside  !</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">!     gasvmr(npts,nlay,:): atmospheric gases amount:                    !</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">!                       (check module_radiation_gases for definition)   !</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">!       gasvmr(:,:,1)  -   co2 volume mixing ratio                      !</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">!       gasvmr(:,:,2)  -   n2o volume mixing ratio                      !</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">!       gasvmr(:,:,3)  -   ch4 volume mixing ratio                      !</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">!       gasvmr(:,:,4)  -   o2  volume mixing ratio                      !</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">!       gasvmr(:,:,5)  -   co  volume mixing ratio                      !</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">!       gasvmr(:,:,6)  -   cfc11 volume mixing ratio                    !</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">!       gasvmr(:,:,7)  -   cfc12 volume mixing ratio                    !</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">!       gasvmr(:,:,8)  -   cfc22 volume mixing ratio                    !</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">!       gasvmr(:,:,9)  -   ccl4  volume mixing ratio                    !</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">!     clouds(npts,nlay,:): layer cloud profiles:                        !</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">!                       (check module_radiation_clouds for definition)  !</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">!                ---  for  ilwcliq &gt; 0  ---                             !</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">!       clouds(:,:,1)  -   layer total cloud fraction                   !</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">!       clouds(:,:,2)  -   layer in-cloud liq water path   (g/m**2)     !</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">!       clouds(:,:,3)  -   mean eff radius for liq cloud   (micron)     !</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">!       clouds(:,:,4)  -   layer in-cloud ice water path   (g/m**2)     !</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">!       clouds(:,:,5)  -   mean eff radius for ice cloud   (micron)     !</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">!       clouds(:,:,6)  -   layer rain drop water path      (g/m**2)     !</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">!       clouds(:,:,7)  -   mean eff radius for rain drop   (micron)     !</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">!       clouds(:,:,8)  -   layer snow flake water path     (g/m**2)     !</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">!       clouds(:,:,9)  -   mean eff radius for snow flake  (micron)     !</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">!                ---  for  ilwcliq = 0  ---                             !</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">!       clouds(:,:,1)  -   layer total cloud fraction                   !</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">!       clouds(:,:,2)  -   layer cloud optical depth                    !</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">!       clouds(:,:,3)  -   layer cloud single scattering albedo         !</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">!       clouds(:,:,4)  -   layer cloud asymmetry factor                 !</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">!     icseed(npts)   : auxiliary special cloud related array            !</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">!                      when module variable isubclw=2, it provides      !</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">!                      permutation seed for each column profile that    !</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">!                      are used for generating random numbers.          !</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">!                      when isubclw /=2, it will not be used.           !</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">!     aerosols(npts,nlay,nbands,:) : aerosol optical properties         !</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">!                       (check module_radiation_aerosols for definition)!</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">!        (:,:,:,1)     - optical depth                                  !</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">!        (:,:,:,2)     - single scattering albedo                       !</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">!        (:,:,:,3)     - asymmetry parameter                            !</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">!     sfemis (npts)  : surface emissivity                               !</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">!     sfgtmp (npts)  : surface ground temperature (k)                   !</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">!     npts           : total number of horizontal points                !</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">!     nlay, nlp1     : total number of vertical layers, levels          !</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">!     lprnt          : cntl flag for diagnostic print out               !</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">!  output variables:                                                    !</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">!     hlwc  (npts,nlay): total sky heating rate (k/day or k/sec)        !</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">!     topflx(npts)     : radiation fluxes at top, component:            !</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">!                        (check module_radlw_paramters for definition)  !</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">!        upfxc           - total sky upward flux at top (w/m2)          !</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">!        upfx0           - clear sky upward flux at top (w/m2)          !</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">!     sfcflx(npts)     : radiation fluxes at sfc, component:            !</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">!                        (check module_radlw_paramters for definition)  !</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">!        upfxc           - total sky upward flux at sfc (w/m2)          !</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">!        upfx0           - clear sky upward flux at sfc (w/m2)          !</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">!        dnfxc           - total sky downward flux at sfc (w/m2)        !</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">!        dnfx0           - clear sky downward flux at sfc (w/m2)        !</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">!! optional output variables:                                           !</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">!     hlwb(npts,nlay,nbands): spectral band total sky heating rates     !</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">!     hlw0  (npts,nlay): clear sky heating rate (k/day or k/sec)        !</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">!     flxprf(npts,nlp1): level radiative fluxes (w/m2), components:     !</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">!                        (check module_radlw_paramters for definition)  !</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">!        upfxc           - total sky upward flux                        !</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">!        dnfxc           - total sky dnward flux                        !</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">!        upfx0           - clear sky upward flux                        !</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">!        dnfx0           - clear sky dnward flux                        !</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">!  external module variables:  (in physparam)                            !</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">!   ilwrgas - control flag for rare gases (ch4,n2o,o2,cfcs, etc.)       !</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">!           =0: do not include rare gases                               !</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">!           &gt;0: include all rare gases                                  !</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">!   ilwcliq - control flag for liq-cloud optical properties             !</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">!           =0: input cloud optical depth, ignor ilwcice                !</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">!           =1: input cld liqp &amp; reliq, hu &amp; stamnes (1993)             !</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">!           =2: not used                                                !</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">!   ilwcice - control flag for ice-cloud optical properties             !</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">!           *** if ilwcliq==0, ilwcice is ignored                       !</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">!           =1: input cld icep &amp; reice, ebert &amp; curry (1997)            !</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">!           =2: input cld icep &amp; reice, streamer (1996)                 !</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">!           =3: input cld icep &amp; reice, fu (1998)                       !</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">!   isubclw - sub-column cloud approximation control flag               !</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">!           =0: no sub-col cld treatment, use grid-mean cld quantities  !</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">!           =1: mcica sub-col, prescribed seeds to get random numbers   !</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">!           =2: mcica sub-col, providing array icseed for random numbers!</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">!   iovrlw  - cloud overlapping control flag                            !</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">!           =0: random overlapping clouds                               !</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">!           =1: maximum/random overlapping clouds                       !</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">!           =2: maximum overlap cloud (used for isubclw&gt;0 only)         !</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">!   ivflip  - control flag for vertical index direction                 !</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">!           =0: vertical index from toa to surface                      !</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">!           =1: vertical index from surface to toa                      !</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">!  module parameters, control variables:                                !</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">!     nbands           - number of longwave spectral bands              !</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">!     maxgas           - maximum number of absorbing gaseous            !</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">!     maxxsec          - maximum number of cross-sections               !</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">!     ngptlw           - total number of g-point subintervals           !</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">!     ng##             - number of g-points in band (##=1-16)           !</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">!     ngb(ngptlw)      - band indices for each g-point                  !</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">!     bpade            - pade approximation constant (1/0.278)          !</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">!     nspa,nspb(nbands)- number of lower/upper ref atm&#39;s per band       !</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">!     delwave(nbands)  - longwave band width (wavenumbers)              !</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">!     ipsdlw0          - permutation seed for mcica sub-col clds        !</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">!  major local variables:                                               !</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">!     pavel  (nlay)         - layer pressures (mb)                      !</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">!     delp   (nlay)         - layer pressure thickness (mb)             !</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">!     tavel  (nlay)         - layer temperatures (k)                    !</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">!     tz     (0:nlay)       - level (interface) temperatures (k)        !</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">!     semiss (nbands)       - surface emissivity for each band          !</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">!     wx     (nlay,maxxsec) - cross-section molecules concentration     !</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">!     coldry (nlay)         - dry air column amount                     !</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">!                                   (1.e-20*molecules/cm**2)            !</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">!     cldfrc (0:nlp1)       - layer cloud fraction                      !</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">!     taucld (nbands,nlay)  - layer cloud optical depth for each band   !</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">!     cldfmc (ngptlw,nlay)  - layer cloud fraction for each g-point     !</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">!     tauaer (nbands,nlay)  - aerosol optical depths                    !</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">!     fracs  (ngptlw,nlay)  - planck fractions                          !</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">!     tautot (ngptlw,nlay)  - total optical depths (gaseous+aerosols)   !</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">!     colamt (nlay,maxgas)  - column amounts of absorbing gases         !</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">!                             1-maxgas are for watervapor, carbon       !</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">!                             dioxide, ozone, nitrous oxide, methane,   !</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">!                             oxigen, carbon monoxide, respectively     !</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">!                             (molecules/cm**2)                         !</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">!     pwvcm                 - column precipitable water vapor (cm)      !</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">!     secdiff(nbands)       - variable diffusivity angle defined as     !</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">!                             an exponential function of the column     !</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">!                             water amount in bands 2-3 and 5-9.        !</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">!                             this reduces the bias of several w/m2 in  !</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">!                             downward surface flux in high water       !</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">!                             profiles caused by using the constant     !</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">!                             diffusivity angle of 1.66.         (mji)  !</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment">!     facij  (nlay)         - indicator of interpolation factors        !</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">!                             =0/1: indicate lower/higher temp &amp; height !</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">!     selffac(nlay)         - scale factor for self-continuum, equals   !</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">!                          (w.v. density)/(atm density at 296K,1013 mb) !</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">!     selffrac(nlay)        - factor for temp interpolation of ref      !</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">!                             self-continuum data                       !</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">!     indself(nlay)         - index of the lower two appropriate ref    !</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">!                             temp for the self-continuum interpolation !</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment">!     forfac (nlay)         - scale factor for w.v. foreign-continuum   !</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">!     forfrac(nlay)         - factor for temp interpolation of ref      !</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">!                             w.v. foreign-continuum data               !</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">!     indfor (nlay)         - index of the lower two appropriate ref    !</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">!                             temp for the foreign-continuum interp     !</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment">!     laytrop               - tropopause layer index at which switch is !</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment">!                             made from one conbination kew species to  !</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">!                             another.                                  !</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">!     jp(nlay),jt(nlay),jt1(nlay)                                       !</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">!                           - lookup table indexes                      !</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">!     totuflux(0:nlay)      - total-sky upward longwave flux (w/m2)     !</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">!     totdflux(0:nlay)      - total-sky downward longwave flux (w/m2)   !</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">!     htr(nlay)             - total-sky heating rate (k/day or k/sec)   !</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">!     totuclfl(0:nlay)      - clear-sky upward longwave flux (w/m2)     !</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">!     totdclfl(0:nlay)      - clear-sky downward longwave flux (w/m2)   !</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">!     htrcl(nlay)           - clear-sky heating rate (k/day or k/sec)   !</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">!     fnet    (0:nlay)      - net longwave flux (w/m2)                  !</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">!     fnetc   (0:nlay)      - clear-sky net longwave flux (w/m2)        !</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">!  ======================    end of definitions    ===================  !</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: npts, nlay, nlp1</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: icseed(npts)</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="keywordtype">logical</span>,  <span class="keywordtype">intent(in)</span> :: lprnt</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlp1)</span>, <span class="keywordtype">intent(in)</span> :: plvl,  &amp;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;     &amp;       tlvl</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay)</span>, <span class="keywordtype">intent(in)</span> :: plyr,  &amp;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;     &amp;       tlyr, qlyr, olyr</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay,9)</span>, <span class="keywordtype">intent(in)</span>:: gasvmr</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay,11)</span>           :: clouds</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts)</span>, <span class="keywordtype">intent(in)</span> :: sfemis,     &amp;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;     &amp;       sfgtmp</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay,nbands,3)</span>,<span class="keywordtype">intent(in)</span>:: &amp;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;     &amp;       aerosols</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay)</span>, <span class="keywordtype">intent(out)</span> :: hlwc</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      type(<a class="code" href="structmodule__radlw__parameters_1_1topflw__type.html">topflw_type</a>),    <span class="keywordtype">dimension(npts)</span>, <span class="keywordtype">intent(out)</span> :: topflx</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      type(<a class="code" href="structmodule__radlw__parameters_1_1sfcflw__type.html">sfcflw_type</a>),    <span class="keywordtype">dimension(npts)</span>, <span class="keywordtype">intent(out)</span> :: sfcflx</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">!! ---  optional outputs:</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay,nbands)</span>,<span class="keywordtype">optional</span>,      &amp;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;     &amp;       intent(out) :: hlwb</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(npts,nlay)</span>,       <span class="keywordtype">optional</span>,      &amp;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;     &amp;       intent(out) :: hlw0</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="keywordtype">type</span> (<a class="code" href="structmodule__radlw__parameters_1_1proflw__type.html">proflw_type</a>),    <span class="keywordtype">dimension(npts,nlp1)</span>,       <span class="keywordtype">optional</span>,      &amp;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;     &amp;       intent(out) :: flxprf</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlp1)</span> :: cldfrc</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlay)</span> :: totuflux, totdflux,   &amp;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;     &amp;       totuclfl, totdclfl, tz</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>   :: htr, htrcl</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>   :: pavel, tavel, delp,   &amp;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;     &amp;       clwp, ciwp, relw, reiw, cda1, cda2, cda3, cda4,            &amp;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;     &amp;       coldry, colbrd, h2ovmr, o3vmr, fac00, fac01, fac10, fac11, &amp;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;     &amp;       selffac, selffrac, forfac, forfrac, minorfrac, scaleminor, &amp;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;     &amp;       scaleminorn2, temcol</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands,0:nlay)</span> :: pklev, pklay</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,nbands)</span> :: htrb</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands,nlay)</span> :: taucld, tauaer</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(ngptlw,nlay)</span> :: fracs, tautot,   &amp;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;     &amp;       cldfmc</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands)</span> :: semiss, secdiff</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">!  ---  column amount of absorbing gases:</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment">!       (:,m) m = 1-h2o, 2-co2, 3-o3, 4-n2o, 5-ch4, 6-o2, 7-co</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: colamt(nlay,<a class="code" href="namespacemodule__radlw__parameters.html#a01330b4ad09907f2db51cb516ed21033">maxgas</a>)</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment">!  ---  column cfc cross-section amounts:</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment">!       (:,m) m = 1-ccl4, 2-cfc11, 3-cfc12, 4-cfc22</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: wx(nlay,<a class="code" href="namespacemodule__radlw__parameters.html#a5817221936731c6ee6443da6a64e934e">maxxsec</a>)</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">!  ---  reference ratios of binary species parameter in lower atmosphere:</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">!       (:,m,:) m = 1-h2o/co2, 2-h2o/o3, 3-h2o/n2o, 4-h2o/ch4, 5-n2o/co2, 6-o3/co2</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: rfrate(nlay,<a class="code" href="namespacemodule__radlw__parameters.html#a86288e4bbe3d6962505488790ff42bfa">nrates</a>,2)</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tem0, tem1, tem2, pwvcm, summol, stemp</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(npts)</span> :: ipseed</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nlay)</span> :: jp, jt, jt1, indself, indfor, indminor</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="keywordtype">integer</span>                  :: laytrop, iplon, i, j, k, k1</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="keywordtype">logical</span> :: lcf1</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">!  --- ...  initialization</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      lhlwb  = <span class="keyword">present</span> ( hlwb )</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      lhlw0  = <span class="keyword">present</span> ( hlw0 )</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      lflxprf= <span class="keyword">present</span> ( flxprf )</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160; </div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      colamt(:,:) = f_zero</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordflow">if</span>     ( isubclw == 1 ) <span class="keywordflow">then</span>     <span class="comment">! advance prescribed permutation seed</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="keywordflow">do</span> i = 1, npts</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;          ipseed(i) = ipsdlw0 + i</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="keywordflow">elseif</span> ( isubclw == 2 ) <span class="keywordflow">then</span>     <span class="comment">! use input array of permutaion seeds</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">do</span> i = 1, npts</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;          ipseed(i) = icseed(i)</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">!     if ( lprnt ) then</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">!       print *,&#39;  In radlw, isubclw, ipsdlw0,ipseed =&#39;,                &amp;</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">!    &amp;          isubclw, ipsdlw0, ipseed</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment">!     endif</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">!  --- ...  loop over horizontal npts profiles</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160; </div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      lab_do_iplon : <span class="keywordflow">do</span> iplon = 1, npts</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        <span class="keywordflow">if</span> (sfemis(iplon) &gt; eps .and. sfemis(iplon) &lt;= 1.0) <span class="keywordflow">then</span>  <span class="comment">! input surface emissivity</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;          <span class="keywordflow">do</span> j = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            semiss(j) = sfemis(iplon)</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="keywordflow">else</span>                                                      <span class="comment">! use default values</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;          <span class="keywordflow">do</span> j = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            semiss(j) = semiss0(j)</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        stemp = sfgtmp(iplon)          <span class="comment">! surface ground temp</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">!           the vertical index of internal array is from surface to top</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">!  --- ...  molecular amounts are input or converted to volume mixing ratio</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">!           and later then converted to molecular amount (molec/cm2) by the</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">!           dry air column coldry (in molec/cm2) which is calculated from the</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">!           layer pressure thickness (in mb), based on the hydrostatic equation</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment">!  --- ...  and includes a correction to account for h2o in the layer.</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="keywordflow">if</span> (ivflip == 0) <span class="keywordflow">then</span>       <span class="comment">! input from toa to sfc</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;          tem1 = 100.0 * con_g</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;          tem2 = 1.0e-20 * 1.0e3 * con_avgd</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;          tz(0) = tlvl(iplon,nlp1)</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            k1 = nlp1 - k</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            pavel(k)= plyr(iplon,k1)</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            delp(k) = plvl(iplon,k1+1) - plvl(iplon,k1)</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            tavel(k)= tlyr(iplon,k1)</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            tz(k)   = tlvl(iplon,k1)</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment">!test use</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment">!           h2ovmr(k)= max(f_zero,qlyr(iplon,k1)*amdw)                  ! input mass mixing ratio</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment">!           h2ovmr(k)= max(f_zero,qlyr(iplon,k1))                       ! input vol mixing ratio</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment">!           o3vmr (k)= max(f_zero,olyr(iplon,k1))                       ! input vol mixing ratio</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment">!ncep model use</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            h2ovmr(k)= max(f_zero,qlyr(iplon,k1)                        &amp;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;     &amp;                           *amdw/(f_one-qlyr(iplon,k1)))          <span class="comment">! input specific humidity</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            o3vmr(k)= max(f_zero,olyr(iplon,k1)*amdo3)                 <span class="comment">! input mass mixing ratio</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">!  --- ...  tem0 is the molecular weight of moist air</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            tem0 = (f_one - h2ovmr(k))*con_amd + h2ovmr(k)*con_amw</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            coldry(k) = tem2*delp(k) / (tem1*tem0*(f_one+h2ovmr(k)))</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            temcol(k) = 1.0e-12 * coldry(k)</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            colamt(k,1) = max(f_zero,    coldry(k)*h2ovmr(k))          <span class="comment">! h2o</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            colamt(k,2) = max(temcol(k), coldry(k)*gasvmr(iplon,k1,1)) <span class="comment">! co2</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            colamt(k,3) = max(temcol(k), coldry(k)*o3vmr(k))           <span class="comment">! o3</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;          <span class="keywordflow">if</span> (ilwrgas &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;              k1 = nlp1 - k</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;              colamt(k,4)=max(temcol(k), coldry(k)*gasvmr(iplon,k1,2))  <span class="comment">! n2o</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;              colamt(k,5)=max(temcol(k), coldry(k)*gasvmr(iplon,k1,3))  <span class="comment">! ch4</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;              colamt(k,6)=max(f_zero,    coldry(k)*gasvmr(iplon,k1,4))  <span class="comment">! o2</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;              colamt(k,7)=max(f_zero,    coldry(k)*gasvmr(iplon,k1,5))  <span class="comment">! co</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;              wx(k,1) = max( f_zero, coldry(k)*gasvmr(iplon,k1,9) )   <span class="comment">! ccl4</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;              wx(k,2) = max( f_zero, coldry(k)*gasvmr(iplon,k1,6) )   <span class="comment">! cf11</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;              wx(k,3) = max( f_zero, coldry(k)*gasvmr(iplon,k1,7) )   <span class="comment">! cf12</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;              wx(k,4) = max( f_zero, coldry(k)*gasvmr(iplon,k1,8) )   <span class="comment">! cf22</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;              colamt(k,4) = f_zero     <span class="comment">! n2o</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;              colamt(k,5) = f_zero     <span class="comment">! ch4</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;              colamt(k,6) = f_zero     <span class="comment">! o2</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;              colamt(k,7) = f_zero     <span class="comment">! co</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;              wx(k,1) = f_zero</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;              wx(k,2) = f_zero</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;              wx(k,3) = f_zero</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;              wx(k,4) = f_zero</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            k1 = nlp1 - k</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            <span class="keywordflow">do</span> j = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;              tauaer(j,k) = aerosols(iplon,k1,j,1)                      &amp;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;     &amp;                    * (f_one - aerosols(iplon,k1,j,2))</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;          <span class="keywordflow">if</span> (ilwcliq &gt; 0) <span class="keywordflow">then</span>    <span class="comment">! use prognostic cloud method</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;              k1 = nlp1 - k</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;              cldfrc(k)= clouds(iplon,k1,1)</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;              clwp(k)  = clouds(iplon,k1,2)</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;              relw(k)  = clouds(iplon,k1,3)</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;              ciwp(k)  = clouds(iplon,k1,4)</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;              reiw(k)  = clouds(iplon,k1,5)</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;              cda1(k)  = clouds(iplon,k1,6)</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;              cda2(k)  = clouds(iplon,k1,7)</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;              cda3(k)  = clouds(iplon,k1,8)</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;              cda4(k)  = clouds(iplon,k1,9)</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;          <span class="keywordflow">else</span>                       <span class="comment">! use diagnostic cloud method</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;              k1 = nlp1 - k</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;              cldfrc(k)= clouds(iplon,k1,1)</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;              cda1(k)  = clouds(iplon,k1,2)</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="keywordflow">          endif</span>                      <span class="comment">! end if_ilwcliq</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;          cldfrc(0)    = f_one       <span class="comment">! padding value only</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;          cldfrc(nlp1) = f_zero      <span class="comment">! padding value only</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;          tem1 = f_zero</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;          tem2 = f_zero</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            tem1 = tem1 + coldry(k) + colamt(k,1)</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            tem2 = tem2 + colamt(k,1)</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;          tem0 = 10.0 * tem2 / (amdw * tem1 * con_g)</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;          pwvcm = tem0 * plvl(iplon,nlp1)</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <span class="keywordflow">else</span>                        <span class="comment">! input from sfc to toa</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;          tem1 = 100.0 * con_g</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;          tem2 = 1.0e-20 * 1.0e3 * con_avgd</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;          tz(0) = tlvl(iplon,1)</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            pavel(k)= plyr(iplon,k)</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            delp(k) = plvl(iplon,k) - plvl(iplon,k+1)</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            tavel(k)= tlyr(iplon,k)</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            tz(k)   = tlvl(iplon,k+1)</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">!  --- ...  set absorber amount</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">!test use</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">!           h2ovmr(k)= max(f_zero,qlyr(iplon,k)*amdw)                   ! input mass mixing ratio</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">!           h2ovmr(k)= max(f_zero,qlyr(iplon,k))                        ! input vol mixing ratio</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">!           o3vmr (k)= max(f_zero,olyr(iplon,k))                        ! input vol mixing ratio</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">!ncep model use</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            h2ovmr(k)= max(f_zero,qlyr(iplon,k)                         &amp;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;     &amp;                           *amdw/(f_one-qlyr(iplon,k)))           <span class="comment">! input specific humidity</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            o3vmr(k)= max(f_zero,olyr(iplon,k)*amdo3)                  <span class="comment">! input mass mixing ratio</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment">!  --- ...  tem0 is the molecular weight of moist air</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            tem0 = (f_one - h2ovmr(k))*con_amd + h2ovmr(k)*con_amw</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            coldry(k) = tem2*delp(k) / (tem1*tem0*(f_one+h2ovmr(k)))</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            temcol(k) = 1.0e-12 * coldry(k)</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            colamt(k,1) = max(f_zero,    coldry(k)*h2ovmr(k))          <span class="comment">! h2o</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            colamt(k,2) = max(temcol(k), coldry(k)*gasvmr(iplon,k,1))  <span class="comment">! co2</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            colamt(k,3) = max(temcol(k), coldry(k)*o3vmr(k))           <span class="comment">! o3</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">!  --- ...  set up col amount for rare gases, convert from volume mixing ratio</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">!           to molec/cm2 based on coldry (scaled to 1.0e-20)</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;          <span class="keywordflow">if</span> (ilwrgas &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;              colamt(k,4)=max(temcol(k), coldry(k)*gasvmr(iplon,k,2))  <span class="comment">! n2o</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;              colamt(k,5)=max(temcol(k), coldry(k)*gasvmr(iplon,k,3))  <span class="comment">! ch4</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;              colamt(k,6)=max(f_zero,    coldry(k)*gasvmr(iplon,k,4))  <span class="comment">! o2</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;              colamt(k,7)=max(f_zero,    coldry(k)*gasvmr(iplon,k,5))  <span class="comment">! co</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;              wx(k,1) = max( f_zero, coldry(k)*gasvmr(iplon,k,9) )   <span class="comment">! ccl4</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;              wx(k,2) = max( f_zero, coldry(k)*gasvmr(iplon,k,6) )   <span class="comment">! cf11</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;              wx(k,3) = max( f_zero, coldry(k)*gasvmr(iplon,k,7) )   <span class="comment">! cf12</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;              wx(k,4) = max( f_zero, coldry(k)*gasvmr(iplon,k,8) )   <span class="comment">! cf22</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;              colamt(k,4) = f_zero     <span class="comment">! n2o</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;              colamt(k,5) = f_zero     <span class="comment">! ch4</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;              colamt(k,6) = f_zero     <span class="comment">! o2</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;              colamt(k,7) = f_zero     <span class="comment">! co</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;              wx(k,1) = f_zero</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;              wx(k,2) = f_zero</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;              wx(k,3) = f_zero</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;              wx(k,4) = f_zero</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment">!  --- ...  set aerosol optical properties</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;          <span class="keywordflow">do</span> j = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;              tauaer(j,k) = aerosols(iplon,k,j,1)                       &amp;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;     &amp;                    * (f_one - aerosols(iplon,k,j,2))</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;          <span class="keywordflow">if</span> (ilwcliq &gt; 0) <span class="keywordflow">then</span>    <span class="comment">! use prognostic cloud method</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;              cldfrc(k)= clouds(iplon,k,1)</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;              clwp(k)  = clouds(iplon,k,2)</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;              relw(k)  = clouds(iplon,k,3)</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;              ciwp(k)  = clouds(iplon,k,4)</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;              reiw(k)  = clouds(iplon,k,5)</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;              cda1(k)  = clouds(iplon,k,6)</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;              cda2(k)  = clouds(iplon,k,7)</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;              cda3(k)  = clouds(iplon,k,8)</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;              cda4(k)  = clouds(iplon,k,9)</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;          <span class="keywordflow">else</span>                       <span class="comment">! use diagnostic cloud method</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;              cldfrc(k)= clouds(iplon,k,1)</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;              cda1(k)  = clouds(iplon,k,2)</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="keywordflow">          endif</span>                      <span class="comment">! end if_ilwcliq</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;          cldfrc(0)    = f_one       <span class="comment">! padding value only</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;          cldfrc(nlp1) = f_zero      <span class="comment">! padding value only</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">!  --- ...  compute precipitable water vapor for diffusivity angle adjustments</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;          tem1 = f_zero</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;          tem2 = f_zero</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            tem1 = tem1 + coldry(k) + colamt(k,1)</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            tem2 = tem2 + colamt(k,1)</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;          tem0 = 10.0 * tem2 / (amdw * tem1 * con_g)</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;          pwvcm = tem0 * plvl(iplon,1)</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="keywordflow">        endif</span>                       <span class="comment">! if_ivflip</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;          summol = f_zero</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;          <span class="keywordflow">do</span> i = 2, <a class="code" href="namespacemodule__radlw__parameters.html#a01330b4ad09907f2db51cb516ed21033">maxgas</a></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            summol = summol + colamt(k,i)</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;          colbrd(k) = coldry(k) - summol</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        tem1 = 1.80</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        tem2 = 1.50</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <span class="keywordflow">do</span> j = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;          <span class="keywordflow">if</span> (j==1 .or. j==4 .or. j==10) <span class="keywordflow">then</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            secdiff(j) = 1.66</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            secdiff(j) = min( tem1, max( tem2,                          &amp;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;     &amp;                   a0(j)+a1(j)*exp(a2(j)*pwvcm) ))</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">!     if (lprnt) then</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">!      print *,&#39;  coldry&#39;,coldry</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">!      print *,&#39; wx(*,1) &#39;,(wx(k,1),k=1,NLAY)</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">!      print *,&#39; wx(*,2) &#39;,(wx(k,2),k=1,NLAY)</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment">!      print *,&#39; wx(*,3) &#39;,(wx(k,3),k=1,NLAY)</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment">!      print *,&#39; wx(*,4) &#39;,(wx(k,4),k=1,NLAY)</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">!      print *,&#39; iplon &#39;,iplon</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">!      print *,&#39;  pavel &#39;,pavel</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment">!      print *,&#39;  delp &#39;,delp</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">!      print *,&#39;  tavel &#39;,tavel</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">!      print *,&#39;  tz &#39;,tz</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment">!      print *,&#39; h2ovmr &#39;,h2ovmr</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">!      print *,&#39; o3vmr &#39;,o3vmr</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment">!     endif</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        lcf1 = .false.</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        lab_do_k0 : <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;          <span class="keywordflow">if</span> ( cldfrc(k) &gt; eps ) <span class="keywordflow">then</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            lcf1 = .true.</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            <span class="keywordflow">exit</span> lab_do_k0</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="keywordflow">        enddo</span>  lab_do_k0</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        <span class="keywordflow">if</span> ( lcf1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;          <span class="keyword">call </span><a class="code" href="group__module__radlw__main.html#ga6bfdea656cc7e1f773ffcc797e072e91">cldprop</a>                                                  &amp;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;     &amp;     ( cldfrc,clwp,relw,ciwp,reiw,cda1,cda2,cda3,cda4,            &amp;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;     &amp;       nlay, nlp1, ipseed(iplon),                                 &amp;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;     &amp;       cldfmc, taucld                                             &amp;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;     &amp;     )</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;          cldfmc = f_zero</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;          taucld = f_zero</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;          clouds(iplon,k,11) = taucld(6,k)                              &amp;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;     &amp;                       + taucld(7,k) + taucld(8,k)</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="keywordflow">        end do</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">!     if (lprnt) then</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">!      print *,&#39; after cldprop&#39;</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">!      print *,&#39; clwp&#39;,clwp</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment">!      print *,&#39; ciwp&#39;,ciwp</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">!      print *,&#39; relw&#39;,relw</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">!      print *,&#39; reiw&#39;,reiw</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">!      print *,&#39; taucl&#39;,cda1</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">!      print *,&#39; cldfrac&#39;,cldfrc</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">!     endif</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        <span class="keyword">call </span><a class="code" href="group__module__radlw__main.html#gaeb7b74288cf87988c14bf6e24a2039ae">setcoef</a>                                                    &amp;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;     &amp;     ( pavel,tavel,tz,stemp,h2ovmr,colamt,coldry,colbrd,          &amp;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;     &amp;       nlay, nlp1,                                                &amp;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;     &amp;       laytrop,pklay,pklev,jp,jt,jt1,                             &amp;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;     &amp;       rfrate,fac00,fac01,fac10,fac11,                            &amp;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;     &amp;       selffac,selffrac,indself,forfac,forfrac,indfor,            &amp;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;     &amp;       minorfrac,scaleminor,scaleminorn2,indminor                 &amp;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;     &amp;     )</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">!     if (lprnt) then</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment">!      print *,&#39;laytrop&#39;,laytrop</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">!      print *,&#39;colh2o&#39;,(colamt(k,1),k=1,NLAY)</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">!      print *,&#39;colco2&#39;,(colamt(k,2),k=1,NLAY)</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">!      print *,&#39;colo3&#39;, (colamt(k,3),k=1,NLAY)</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">!      print *,&#39;coln2o&#39;,(colamt(k,4),k=1,NLAY)</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">!      print *,&#39;colch4&#39;,(colamt(k,5),k=1,NLAY)</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">!      print *,&#39;fac00&#39;,fac00</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">!      print *,&#39;fac01&#39;,fac01</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">!      print *,&#39;fac10&#39;,fac10</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">!      print *,&#39;fac11&#39;,fac11</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">!      print *,&#39;jp&#39;,jp</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">!      print *,&#39;jt&#39;,jt</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment">!      print *,&#39;jt1&#39;,jt1</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">!      print *,&#39;selffac&#39;,selffac</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">!      print *,&#39;selffrac&#39;,selffrac</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">!      print *,&#39;indself&#39;,indself</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment">!      print *,&#39;forfac&#39;,forfac</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">!      print *,&#39;forfrac&#39;,forfrac</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment">!      print *,&#39;indfor&#39;,indfor</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="comment">!     endif</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        <span class="keyword">call </span><a class="code" href="group__module__radlw__main.html#gab09f986fb87e796a30c889086c92aeb1">taumol</a>                                                     &amp;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;     &amp;     ( laytrop,pavel,coldry,colamt,colbrd,wx,tauaer,              &amp;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;     &amp;       rfrate,fac00,fac01,fac10,fac11,jp,jt,jt1,                  &amp;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;     &amp;       selffac,selffrac,indself,forfac,forfrac,indfor,            &amp;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;     &amp;       minorfrac,scaleminor,scaleminorn2,indminor,                &amp;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;     &amp;       nlay,                                                      &amp;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;     &amp;       fracs, tautot                                              &amp;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;     &amp;     )</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment">!     if (lprnt) then</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">!     print *,&#39; after taumol&#39;</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment">!     do k = 1, nlay</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">!       write(6,121) k</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment">!121    format(&#39; k =&#39;,i3,5x,&#39;FRACS&#39;)</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment">!       write(6,122) (fracs(j,k),j=1,ngptlw)</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment">!122    format(10e14.7)</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment">!       write(6,123) k</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">!123    format(&#39; k =&#39;,i3,5x,&#39;TAUTOT&#39;)</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment">!       write(6,122) (tautot(j,k),j=1,ngptlw)</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment">!     enddo</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">!     endif</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <span class="keywordflow">if</span> (isubclw &lt;= 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;          <span class="keywordflow">if</span> (iovrlw &lt;= 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            <span class="keyword">call </span><a class="code" href="group__module__radlw__main.html#gab002119955eb2b82f16352459180f5ed">rtrn</a>                                                   &amp;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;     &amp;     ( semiss,delp,cldfrc,taucld,tautot,pklay,pklev,              &amp;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;     &amp;       fracs,secdiff,nlay,nlp1,                                   &amp;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;     &amp;       totuflux,totdflux,htr, totuclfl,totdclfl,htrcl, htrb       &amp;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;     &amp;     )</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;            <span class="keyword">call </span><a class="code" href="group__module__radlw__main.html#ga8d4a6fecb4ad25468e91661a79d4ca20">rtrnmr</a>                                                 &amp;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;     &amp;     ( semiss,delp,cldfrc,taucld,tautot,pklay,pklev,              &amp;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;     &amp;       fracs,secdiff,nlay,nlp1,                                   &amp;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;     &amp;       totuflux,totdflux,htr, totuclfl,totdclfl,htrcl, htrb       &amp;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;     &amp;     )</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="keywordflow">          endif</span>   <span class="comment">! end if_iovrlw_block</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;          <span class="keyword">call </span><a class="code" href="group__module__radlw__main.html#ga1445abd529b76abe7ffb80e843d9fafc">rtrnmc</a>                                                   &amp;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;     &amp;     ( semiss,delp,cldfmc,taucld,tautot,pklay,pklev,              &amp;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;     &amp;       fracs,secdiff,nlay,nlp1,                                   &amp;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;     &amp;       totuflux,totdflux,htr, totuclfl,totdclfl,htrcl, htrb       &amp;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;     &amp;     )</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="keywordflow">        endif</span>   <span class="comment">! end if_isubclw_block</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        topflx(iplon)%upfxc = totuflux(nlay)</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        topflx(iplon)%upfx0 = totuclfl(nlay)</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        sfcflx(iplon)%upfxc = totuflux(0)</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        sfcflx(iplon)%upfx0 = totuclfl(0)</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        sfcflx(iplon)%dnfxc = totdflux(0)</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        sfcflx(iplon)%dnfx0 = totdclfl(0)</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        <span class="keywordflow">if</span> (ivflip == 0) <span class="keywordflow">then</span>       <span class="comment">! output from toa to sfc</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">!! --- ...  optional fluxes</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;          <span class="keywordflow">if</span> ( lflxprf ) <span class="keywordflow">then</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            <span class="keywordflow">do</span> k = 0, nlay</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;              k1 = nlp1 - k</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;              flxprf(iplon,k1)%upfxc = totuflux(k)</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;              flxprf(iplon,k1)%dnfxc = totdflux(k)</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;              flxprf(iplon,k1)%upfx0 = totuclfl(k)</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;              flxprf(iplon,k1)%dnfx0 = totdclfl(k)</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;            k1 = nlp1 - k</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            hlwc(iplon,k1) = htr(k)</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment">!! --- ...  optional clear sky heating rate</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;          <span class="keywordflow">if</span> ( lhlw0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;              k1 = nlp1 - k</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;              hlw0(iplon,k1) = htrcl(k)</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment">!! --- ...  optional spectral band heating rate</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;          <span class="keywordflow">if</span> ( lhlwb ) <span class="keywordflow">then</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            <span class="keywordflow">do</span> j = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;              k1 = nlp1 - k</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;              hlwb(iplon,k1,j) = htrb(k,j)</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        <span class="keywordflow">else</span>                        <span class="comment">! output from sfc to toa</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="comment">!! --- ...  optional fluxes</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;          <span class="keywordflow">if</span> ( lflxprf ) <span class="keywordflow">then</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            <span class="keywordflow">do</span> k = 0, nlay</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;              flxprf(iplon,k+1)%upfxc = totuflux(k)</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;              flxprf(iplon,k+1)%dnfxc = totdflux(k)</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;              flxprf(iplon,k+1)%upfx0 = totuclfl(k)</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;              flxprf(iplon,k+1)%dnfx0 = totdclfl(k)</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;            hlwc(iplon,k) = htr(k)</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment">!! --- ...  optional clear sky heating rate</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;          <span class="keywordflow">if</span> ( lhlw0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;              hlw0(iplon,k) = htrcl(k)</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment">!! --- ...  optional spectral band heating rate</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;          <span class="keywordflow">if</span> ( lhlwb ) <span class="keywordflow">then</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;            <span class="keywordflow">do</span> j = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;              hlwb(iplon,k,j) = htrb(k,j)</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="keywordflow">        endif</span>                       <span class="comment">! if_ivflip</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="keywordflow">      enddo</span>  lab_do_iplon</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radlw__main.html#gaf20db29eaadab298ccd8b6bf489a53f4">lwrad</a></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radlw__main.html#gaa9569479682c83b26584b7e9ee6841fa">rlwinit</a>                                                &amp;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;     &amp;     ( me ) <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01269"></a><span class="lineno"><a class="line" href="group__module__radlw__main.html#gaa9569479682c83b26584b7e9ee6841fa"> 1269</a></span>&#160;<span class="comment">!  ---  outputs: (none)</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="comment">!  ===================  program usage description  ===================  !</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="comment">! purpose:  initialize non-varying module variables, conversion factors,!</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">! and look-up tables.                                                   !</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment">! subprograms called:  none                                             !</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="comment">!  inputs:                                                              !</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="comment">!    me       - print control for parallel process                      !</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment">!  outputs: (none)                                                      !</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="comment">!  external module variables:  (in physparam)                            !</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="comment">!   ilwrate - heating rate unit selections                              !</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment">!           =1: output in k/day                                         !</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment">!           =2: output in k/second                                      !</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment">!   ilwrgas - control flag for rare gases (ch4,n2o,o2,cfcs, etc.)       !</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment">!           =0: do not include rare gases                               !</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="comment">!           &gt;0: include all rare gases                                  !</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment">!   ilwcliq - liquid cloud optical properties contrl flag               !</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="comment">!           =0: input cloud opt depth from diagnostic scheme            !</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment">!           &gt;0: input cwp,rew, and other cloud content parameters       !</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment">!   isubclw - sub-column cloud approximation control flag               !</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment">!           =0: no sub-col cld treatment, use grid-mean cld quantities  !</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment">!           =1: mcica sub-col, prescribed seeds to get random numbers   !</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment">!           =2: mcica sub-col, providing array icseed for random numbers!</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment">!   icldflg - cloud scheme control flag                                 !</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="comment">!           =0: diagnostic scheme gives cloud tau, omiga, and g.        !</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="comment">!           =1: prognostic scheme gives cloud liq/ice path, etc.        !</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">!   iovrlw  - clouds vertical overlapping control flag                  !</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="comment">!           =0: random overlapping clouds                               !</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment">!           =1: maximum/random overlapping clouds                       !</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">!           =2: maximum overlap cloud (isubcol&gt;0 only)                  !</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="comment">!  original code description                                            !</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">!  original version:       michael j. iacono; july, 1998                !</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment">!  first revision for ncar ccm:               september, 1998           !</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="comment">!  second revision for rrtm_v3.0:             september, 2002           !</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment">!  this subroutine performs calculations necessary for the initialization</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment">!  of the longwave model.  lookup tables are computed for use in the lw !</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment">!  radiative transfer, and input absorption coefficient data for each   !</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment">!  spectral band are reduced from 256 g-point intervals to 140.         !</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment">! definitions:                                                          !</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment">!   arrays for 10000-point look-up tables:                              !</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment">!   tau_tbl - clear-sky optical depth (used in cloudy radiative transfer!</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment">!   exp_tbl - exponential lookup table for tansmittance                 !</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment">!   tfn_tbl - tau transition function; i.e. the transition of the Planck!</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="comment">!             function from that for the mean layer temperature to that !</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment">!             for the layer boundary temperature as a function of optical</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment">!             depth. the &quot;linear in tau&quot; method is used to make the table</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">!  ======================  end of description block  =================  !</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: me</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">!  ---  outputs: none</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: expeps = 1.e-20</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tfn, pival, explimit</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      <span class="keywordtype">integer</span>               :: i</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      <span class="keywordflow">if</span> ( iovrlw&lt;0 .or. iovrlw&gt;2 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        print *,<span class="stringliteral">&#39;  *** Error in specification of cloud overlap flag&#39;</span>,   &amp;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;     &amp;          <span class="stringliteral">&#39; IOVRLW=&#39;</span>,iovrlw,<span class="stringliteral">&#39; in RLWINIT !!&#39;</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        stop</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      <span class="keywordflow">elseif</span> ( iovrlw==2 .and. isubclw==0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        <span class="keywordflow">if</span> (me == 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;          print *,<span class="stringliteral">&#39;  *** IOVRLW=2 - maximum cloud overlap, is not yet&#39;</span>, &amp;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;     &amp;          <span class="stringliteral">&#39; available for ISUBCLW=0 setting!!&#39;</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;          print *,<span class="stringliteral">&#39;      The program uses maximum/random overlap&#39;</span>,      &amp;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;     &amp;          <span class="stringliteral">&#39; instead.&#39;</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        iovrlw = 1</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;      <span class="keywordflow">if</span> (me == 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        print *,<span class="stringliteral">&#39; - Using AER Longwave Radiation, Version: &#39;</span>, vtaglw</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        <span class="keywordflow">if</span> (ilwrgas &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;          print *,<span class="stringliteral">&#39;   --- Include rare gases N2O, CH4, O2, CFCs &#39;</span>,      &amp;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;     &amp;            <span class="stringliteral">&#39;absorptions in LW&#39;</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;          print *,<span class="stringliteral">&#39;   --- Rare gases effect is NOT included in LW&#39;</span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        <span class="keywordflow">if</span> ( isubclw == 0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;          print *,<span class="stringliteral">&#39;   --- Using standard grid average clouds, no &#39;</span>,     &amp;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;     &amp;            <span class="stringliteral">&#39;sub-column clouds approximation applied&#39;</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        <span class="keywordflow">elseif</span> ( isubclw == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;          print *,<span class="stringliteral">&#39;   --- Using MCICA sub-colum clouds approximation &#39;</span>, &amp;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;     &amp;            <span class="stringliteral">&#39;with a prescribed sequence of permutaion seeds&#39;</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        <span class="keywordflow">elseif</span> ( isubclw == 2 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;          print *,<span class="stringliteral">&#39;   --- Using MCICA sub-colum clouds approximation &#39;</span>, &amp;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;     &amp;            <span class="stringliteral">&#39;with provided input array of permutation seeds&#39;</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;          print *,<span class="stringliteral">&#39;  *** Error in specification of sub-column cloud &#39;</span>,  &amp;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;     &amp;            <span class="stringliteral">&#39; control flag isubclw =&#39;</span>,isubclw,<span class="stringliteral">&#39; !!&#39;</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;          stop</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">!  --- ...  check cloud flags for consistency</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      <span class="keywordflow">if</span> ((icldflg == 0 .and. ilwcliq /= 0) .or.                        &amp;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;     &amp;    (icldflg == 1 .and. ilwcliq == 0)) <span class="keywordflow">then</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        print *,<span class="stringliteral">&#39;  *** Model cloud scheme inconsistent with LW&#39;</span>,        &amp;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;     &amp;          <span class="stringliteral">&#39; radiation cloud radiative property setup !!&#39;</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;        stop</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="comment">!  --- ...  setup default surface emissivity for each band here</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;      semiss0(:) = f_one</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment">!  --- ...  setup constant factors for flux and heating rate</span></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="comment">!           the 1.0e-2 is to convert pressure from mb to N/m**2</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      pival = 2.0 * asin(f_one)</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      fluxfac = pival * 2.0d4</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="comment">!     fluxfac = 62831.85307179586                   ! = 2 * pi * 1.0e4</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      <span class="keywordflow">if</span> (ilwrate == 1) <span class="keywordflow">then</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment">!       heatfac = 8.4391</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">!       heatfac = con_g * 86400. * 1.0e-2 / con_cp  !   (in k/day)</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        heatfac = con_g * 864.0 / con_cp            <span class="comment">!   (in k/day)</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        heatfac = con_g * 1.0e-2 / con_cp           <span class="comment">!   (in k/second)</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment">!  --- ...  compute lookup tables for transmittance, tau transition</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="comment">!           function, and clear sky tau (for the cloudy sky radiative</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="comment">!           transfer).  tau is computed as a function of the tau</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="comment">!           transition function, transmittance is calculated as a</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="comment">!           function of tau, and the tau transition function is</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment">!           calculated using the linear in tau formulation at values of</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="comment">!           tau above 0.01.  tf is approximated as tau/6 for tau &lt; 0.01.</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="comment">!           all tables are computed at intervals of 0.001.  the inverse</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="comment">!           of the constant used in the pade approximation to the tau</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment">!           transition function is set to b.</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      tau_tbl(0) = f_zero</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      exp_tbl(0) = f_one</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      tfn_tbl(0) = f_zero</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      tau_tbl(<a class="code" href="namespacemodule__radlw__parameters.html#a61ae33b9db5bac9962f72e2a0db3c0e4">ntbl</a>) = 1.e10</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      exp_tbl(<a class="code" href="namespacemodule__radlw__parameters.html#a61ae33b9db5bac9962f72e2a0db3c0e4">ntbl</a>) = expeps</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      tfn_tbl(<a class="code" href="namespacemodule__radlw__parameters.html#a61ae33b9db5bac9962f72e2a0db3c0e4">ntbl</a>) = f_one</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      explimit = aint( -log(tiny(exp_tbl(0))) )</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;      <span class="keywordflow">do</span> i = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a61ae33b9db5bac9962f72e2a0db3c0e4">ntbl</a>-1</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="comment">!org    tfn = float(i) / float(ntbl)</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="comment">!org    tau_tbl(i) = bpade * tfn / (f_one - tfn)</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        tfn = <span class="keywordtype">real(i, kind_phys)</span> / <span class="keywordtype">real</span>(<a class="code" href="namespacemodule__radlw__parameters.html#a61ae33b9db5bac9962f72e2a0db3c0e4">ntbl</a>-i, kind_phys)</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        tau_tbl(i) = bpade * tfn</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        <span class="keywordflow">if</span> (tau_tbl(i) &gt;= explimit) <span class="keywordflow">then</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;          exp_tbl(i) = expeps</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;          exp_tbl(i) = exp( -tau_tbl(i) )</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        <span class="keywordflow">if</span> (tau_tbl(i) &lt; 0.06) <span class="keywordflow">then</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;          tfn_tbl(i) = tau_tbl(i) / 6.0</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;          tfn_tbl(i) = f_one - 2.0*( (f_one / tau_tbl(i))               &amp;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;     &amp;               - ( exp_tbl(i) / (f_one - exp_tbl(i)) ) )</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radlw__main.html#gaa9569479682c83b26584b7e9ee6841fa">rlwinit</a></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="comment">! ----------------------------</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radlw__main.html#ga6bfdea656cc7e1f773ffcc797e072e91">cldprop</a>                                                &amp;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;     &amp;     ( cfrac,cliqp,reliq,cicep,reice,cdat1,cdat2,cdat3,cdat4,     &amp; <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;     &amp;       nlay, nlp1, ipseed,                                        &amp;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;     &amp;       cldfmc, taucld                                             &amp; <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;     &amp;     )</div><div class="line"><a name="l01497"></a><span class="lineno"><a class="line" href="group__module__radlw__main.html#ga6bfdea656cc7e1f773ffcc797e072e91"> 1497</a></span>&#160;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment">!  ===================  program usage description  ===================  !</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="comment">! purpose:  compute the cloud optical depth(s) for each cloudy layer    !</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment">! and g-point interval.                                                 !</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment">! subprograms called:  none                                             !</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">!  inputs:                                                       -size- !</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">!    cfrac - real, layer cloud fraction                          0:nlp1 !</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment">!        .....  for ilwcliq &gt; 0  (prognostic cloud sckeme)  - - -       !</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment">!    cliqp - real, layer in-cloud liq water path (g/m**2)          nlay !</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="comment">!    reliq - real, mean eff radius for liq cloud (micron)          nlay !</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="comment">!    cicep - real, layer in-cloud ice water path (g/m**2)          nlay !</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="comment">!    reice - real, mean eff radius for ice cloud (micron)          nlay !</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="comment">!    cdat1 - real, layer rain drop water path  (g/m**2)            nlay !</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="comment">!    cdat2 - real, effective radius for rain drop (microm)         nlay !</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="comment">!    cdat3 - real, layer snow flake water path (g/m**2)            nlay !</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="comment">!    cdat4 - real, effective radius for snow flakes (micron)       nlay !</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="comment">!        .....  for ilwcliq = 0  (diagnostic cloud sckeme)  - - -       !</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="comment">!    cdat1 - real, input cloud optical depth                       nlay !</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="comment">!    cdat2 - real, layer cloud single scattering albedo            nlay !</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="comment">!    cdat3 - real, layer cloud asymmetry factor                    nlay !</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment">!    cdat4 - real, optional use                                    nlay !</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="comment">!    cliqp - not used                                              nlay !</span></div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment">!    reliq - not used                                              nlay !</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="comment">!    cicep - not used                                              nlay !</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="comment">!    reice - not used                                              nlay !</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment">!    nlay  - integer, number of vertical layers                      1  !</span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="comment">!    nlp1  - integer, number of vertical levels                      1  !</span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="comment">!    ipseed- permutation seed for generating random numbers (isubclw&gt;0) !</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="comment">!  outputs:                                                             !</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="comment">!    cldfmc - real, cloud fraction for each sub-column       ngptlw*nlay!</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="comment">!    taucld - real, cld opt depth for bands (non-mcica)      nbands*nlay!</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="comment">!  explanation of the method for each value of ilwcliq, and ilwcice.    !</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment">!    set up in module &quot;module_radlw_cntr_para&quot;                          !</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="comment">!     ilwcliq=0  : input cloud optical property (tau, ssa, asy).        !</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="comment">!                  (used for diagnostic cloud method)                   !</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="comment">!     ilwcliq&gt;0  : input cloud liq/ice path and effective radius, also  !</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment">!                  require the user of &#39;ilwcice&#39; to specify the method  !</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment">!                  used to compute aborption due to water/ice parts.    !</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="comment">!  ...................................................................  !</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="comment">!     ilwcliq=1:   the water droplet effective radius (microns) is input!</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment">!                  and the opt depths due to water clouds are computed  !</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="comment">!                  as in hu and stamnes, j., clim., 6, 728-742, (1993). !</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment">!                  the values for absorption coefficients appropriate for</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="comment">!                  the spectral bands in rrtm have been obtained for a  !</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="comment">!                  range of effective radii by an averaging procedure   !</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="comment">!                  based on the work of j. pinto (private communication).</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="comment">!                  linear interpolation is used to get the absorption   !</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment">!                  coefficients for the input effective radius.         !</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="comment">!     ilwcice=1:   the cloud ice path (g/m2) and ice effective radius   !</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="comment">!                  (microns) are input and the optical depths due to ice!</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="comment">!                  clouds are computed as in ebert and curry, jgr, 97,  !</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="comment">!                  3831-3836 (1992).  the spectral regions in this work !</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="comment">!                  have been matched with the spectral bands in rrtm to !</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="comment">!                  as great an extent as possible:                      !</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="comment">!                     e&amp;c 1      ib = 5      rrtm bands 9-16            !</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="comment">!                     e&amp;c 2      ib = 4      rrtm bands 6-8             !</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="comment">!                     e&amp;c 3      ib = 3      rrtm bands 3-5             !</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="comment">!                     e&amp;c 4      ib = 2      rrtm band 2                !</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="comment">!                     e&amp;c 5      ib = 1      rrtm band 1                !</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="comment">!     ilwcice=2:   the cloud ice path (g/m2) and ice effective radius   !</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="comment">!                  (microns) are input and the optical depths due to ice!</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="comment">!                  clouds are computed as in rt code, streamer v3.0     !</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="comment">!                  (ref: key j., streamer user&#39;s guide, cooperative     !</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="comment">!                  institute for meteorological satellite studies, 2001,!</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="comment">!                  96 pp.) valid range of values for re are between 5.0 !</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="comment">!                  and 131.0 micron.                                    !</span></div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment">!     ilwcice=3:   the ice generalized effective size (dge) is input and!</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="comment">!                  the optical properties, are calculated as in q. fu,  !</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment">!                  j. climate, (1998). q. fu provided high resolution   !</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment">!                  tales which were appropriately averaged for the bands!</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">!                  in rrtm_lw. linear interpolation is used to get the  !</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="comment">!                  coeff from the stored tables. valid range of values  !</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment">!                  for deg are between 5.0 and 140.0 micron.            !</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="comment">!  other cloud control module variables:                                !</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="comment">!     isubclw =0: standard cloud scheme, no sub-col cloud approximation !</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="comment">!             &gt;0: mcica sub-col cloud scheme using ipseed as permutation!</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="comment">!                 seed for generating rundom numbers                    !</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="comment">!  ======================  end of description block  =================  !</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__cldprlw.html">module_radlw_cldprlw</a></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1, ipseed</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlp1)</span>, <span class="keywordtype">intent(in)</span> :: cfrac</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>,   <span class="keywordtype">intent(in)</span> :: cliqp,    &amp;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;     &amp;       reliq, cicep, reice, cdat1, cdat2, cdat3, cdat4</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(ngptlw,nlay)</span>,<span class="keywordtype">intent(out)</span>:: cldfmc</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands,nlay)</span>,<span class="keywordtype">intent(out)</span>:: taucld</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands)</span> :: tauliq, tauice</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>   :: cldf</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: dgeice, factor, fint, tauran, tausnw,    &amp;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;     &amp;       cldliq, refliq, cldice, refice</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      <span class="keywordtype">logical</span> :: lcloudy(<a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a>,nlay)</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;      <span class="keywordtype">integer</span> :: ia, ib, ig, k, index</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;          taucld(ib,k) = f_zero</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;        <span class="keywordflow">do</span> ig = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;          cldfmc(ig,k) = f_zero</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="comment">!  --- ...  compute cloud radiative properties for a cloudy column</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;      lab_if_ilwcliq : <span class="keywordflow">if</span> (ilwcliq &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;        lab_do_k : <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;          lab_if_cld : <span class="keywordflow">if</span> (cfrac(k) &gt; cldmin) <span class="keywordflow">then</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;            tauran = <a class="code" href="namespacemodule__radlw__cldprlw.html#a04bff194fec27e0586ab1b4770319882">absrain</a> * cdat1(k)                      <span class="comment">! ncar formula</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment">!!          tausnw = abssnow1 * cdat3(k)                     ! ncar formula</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="comment">!  ---  if use fu&#39;s formula it needs to be normalized by snow density</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="comment">!       !not use snow density = 0.1 g/cm**3 = 0.1 g/(mu * m**2)</span></div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="comment">!       use ice density = 0.9167 g/cm**3 = 0.9167 g/(mu * m**2)</span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment">!       factor 1.5396=8/(3*sqrt(3)) converts reff to generalized ice particle size</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="comment">!       use newer factor value 1.0315</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="comment">!       1/(0.9167*1.0315) = 1.05756</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            <span class="keywordflow">if</span> (cdat3(k)&gt;f_zero .and. cdat4(k)&gt;10.0_kind_phys) <span class="keywordflow">then</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;              tausnw = <a class="code" href="namespacemodule__radlw__cldprlw.html#a4bcd58c6a7e9abdfbb8f8ec7d925d143">abssnow0</a>*1.05756*cdat3(k)/cdat4(k)      <span class="comment">! fu&#39;s formula</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;              tausnw = f_zero</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;            cldliq = cliqp(k)</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;            cldice = cicep(k)</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="comment">!           refliq = max(2.5e0, min(60.0e0, reliq(k) ))</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="comment">!           refice = max(5.0e0, reice(k) )</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;            refliq = reliq(k)</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;            refice = reice(k)</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="comment">!  --- ...  calculation of absorption coefficients due to water clouds.</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;            <span class="keywordflow">if</span> ( cldliq &lt;= f_zero ) <span class="keywordflow">then</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;              <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                tauliq(ib) = f_zero</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;              <span class="keywordflow">if</span> ( ilwcliq == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                factor = refliq - 1.5</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                index  = max( 1, min( 57, int( factor ) ))</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                fint   = factor - float(index)</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                  tauliq(ib) = max(f_zero, cldliq*(<a class="code" href="namespacemodule__radlw__cldprlw.html#a57896538226e9184c3750440d9f62166">absliq1</a>(index,ib)    &amp;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;     &amp;              + fint*(<a class="code" href="namespacemodule__radlw__cldprlw.html#a57896538226e9184c3750440d9f62166">absliq1</a>(index+1,ib)-<a class="code" href="namespacemodule__radlw__cldprlw.html#a57896538226e9184c3750440d9f62166">absliq1</a>(index,ib)) ))</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="keywordflow">              endif</span>   <span class="comment">! end if_ilwcliq_block</span></div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="keywordflow">            endif</span>   <span class="comment">! end if_cldliq_block</span></div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="comment">!  --- ...  calculation of absorption coefficients due to ice clouds.</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;            <span class="keywordflow">if</span> ( cldice &lt;= f_zero ) <span class="keywordflow">then</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;              <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                tauice(ib) = f_zero</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="comment">!  --- ...  ebert and curry approach for all particle sizes though somewhat</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="comment">!           unjustified for large ice particles</span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;              <span class="keywordflow">if</span> ( ilwcice == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                refice = min(130.0, max(13.0, <span class="keywordtype">real(refice)</span> ))</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;                <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;                  ia = <a class="code" href="namespacemodule__radlw__cldprlw.html#a9e8ebd81d5d62c2be4c006a595493aed">ipat</a>(ib)             <span class="comment">! eb_&amp;_c band index for ice cloud coeff</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;                  tauice(ib) = max(f_zero, cldice*(<a class="code" href="namespacemodule__radlw__cldprlw.html#a3b86ff9d6791d95170d3b3ab61cd8291">absice1</a>(1,ia)        &amp;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;     &amp;                         + <a class="code" href="namespacemodule__radlw__cldprlw.html#a3b86ff9d6791d95170d3b3ab61cd8291">absice1</a>(2,ia)/refice) )</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="comment">!  --- ...  streamer approach for ice effective radius between 5.0 and 131.0 microns</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="comment">!           and ebert and curry approach for ice eff radius greater than 131.0 microns.</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="comment">!           no smoothing between the transition of the two methods.</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;              <span class="keywordflow">elseif</span> ( ilwcice == 2 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                factor = (refice - 2.0) / 3.0</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                index  = max( 1, min( 42, int( factor ) ))</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                fint   = factor - float(index)</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                  tauice(ib) = max(f_zero, cldice*(<a class="code" href="namespacemodule__radlw__cldprlw.html#ad2238686c0e6d1c5d74bcfdde1542e1d">absice2</a>(index,ib)    &amp;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;     &amp;              + fint*(<a class="code" href="namespacemodule__radlw__cldprlw.html#ad2238686c0e6d1c5d74bcfdde1542e1d">absice2</a>(index+1,ib) - <a class="code" href="namespacemodule__radlw__cldprlw.html#ad2238686c0e6d1c5d74bcfdde1542e1d">absice2</a>(index,ib)) ))</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="comment">!  --- ...  fu&#39;s approach for ice effective radius between 4.8 and 135 microns</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;<span class="comment">!           (generalized effective size from 5 to 140 microns)</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;              <span class="keywordflow">elseif</span> ( ilwcice == 3 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="comment">!               dgeice = max(5.0, 1.5396*refice)              ! v4.4 value</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;                dgeice = max(5.0, 1.0315*refice)              <span class="comment">! v4.71 value</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;                factor = (dgeice - 2.0) / 3.0</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;                index  = max( 1, min( 45, int( factor ) ))</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                fint   = factor - float(index)</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;                  tauice(ib) = max(f_zero, cldice*(<a class="code" href="namespacemodule__radlw__cldprlw.html#a3aa04541d0b809367f88ef8aa0eafdbb">absice3</a>(index,ib)    &amp;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;     &amp;              + fint*(<a class="code" href="namespacemodule__radlw__cldprlw.html#a3aa04541d0b809367f88ef8aa0eafdbb">absice3</a>(index+1,ib) - <a class="code" href="namespacemodule__radlw__cldprlw.html#a3aa04541d0b809367f88ef8aa0eafdbb">absice3</a>(index,ib)) ))</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="keywordflow">              endif</span>   <span class="comment">! end if_ilwcice_block</span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="keywordflow">            endif</span>   <span class="comment">! end if_cldice_block</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;            <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;              taucld(ib,k) = tauice(ib) + tauliq(ib) + tauran + tausnw</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="keywordflow">          endif</span>  lab_if_cld</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="keywordflow">        enddo</span>  lab_do_k</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;      <span class="keywordflow">else</span>  lab_if_ilwcliq</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;          <span class="keywordflow">if</span> (cfrac(k) &gt; cldmin) <span class="keywordflow">then</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;            <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;              taucld(ib,k) = cdat1(k)</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="keywordflow">      endif</span>  lab_if_ilwcliq</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      <span class="keywordflow">if</span> ( isubclw &gt; 0 ) <span class="keywordflow">then</span>      <span class="comment">! mcica sub-col clouds approx</span></div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;          <span class="keywordflow">if</span> ( cfrac(k) &lt; cldmin ) <span class="keywordflow">then</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;            cldf(k) = f_zero</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;            cldf(k) = cfrac(k)</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="comment">!  --- ...  call sub-column cloud generator</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;        <span class="keyword">call </span><a class="code" href="group__module__radlw__main.html#ga9318778651bca6ec1f1776da6c21dfda">mcica_subcol</a>                                               &amp;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;     &amp;     ( cldf, nlay, ipseed,                                        &amp;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="comment">!  ---  output:</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;     &amp;       lcloudy                                                    &amp;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;     &amp;     )</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;          <span class="keywordflow">do</span> ig = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;            <span class="keywordflow">if</span> ( lcloudy(ig,k) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;              cldfmc(ig,k) = f_one</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;              cldfmc(ig,k) = f_zero</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="keywordflow">      endif</span>   <span class="comment">! end if_isubclw_block</span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radlw__main.html#ga6bfdea656cc7e1f773ffcc797e072e91">cldprop</a></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radlw__main.html#ga9318778651bca6ec1f1776da6c21dfda">mcica_subcol</a>                                           &amp;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;     &amp;    ( cldf, nlay, ipseed,                                         &amp;<span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;     &amp;      lcloudy                                                     &amp; <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;     &amp;    )</div><div class="line"><a name="l01804"></a><span class="lineno"><a class="line" href="group__module__radlw__main.html#ga9318778651bca6ec1f1776da6c21dfda"> 1804</a></span>&#160;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="comment">!  input variables:                                                size !</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="comment">!   cldf    - real, layer cloud fraction                           nlay !</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment">!   nlay    - integer, number of model vertical layers               1  !</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment">!   ipseed  - integer, permute seed for random num generator         1  !</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="comment">!    ** note : if the cloud generator is called multiple times, need    !</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="comment">!              to permute the seed between each call; if between calls  !</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment">!              for lw and sw, use values differ by the number of g-pts. !</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment">!  output variables:                                                    !</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="comment">!   lcloudy - logical, sub-colum cloud profile flag array    ngptlw*nlay!</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="comment">!  other control flags from module variables:                           !</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="comment">!     iovrlw    : control flag for cloud overlapping method             !</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">!                 =0:random; =1:maximum/random: =2:maximum              !</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="comment">!  =====================    end of definitions    ====================  !</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;      <span class="keywordtype">implicit none</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, ipseed</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(in)</span> :: cldf</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;      <span class="keywordtype">logical</span>, <span class="keywordtype">dimension(ngptlw,nlay)</span>, <span class="keywordtype">intent(out)</span> :: lcloudy</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: cdfunc(<a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a>,nlay), rand1d(<a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a>),     &amp;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;     &amp;       rand2d(nlay*ngptlw), tem1</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;      type(random_stat) :: stat          <span class="comment">! for thread safe random generator</span></div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;      <span class="keywordtype">integer</span> :: k, n, k1</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment">!  --- ...  advance randum number generator by ipseed values</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      <span class="keyword">call </span>random_setseed                                               &amp;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;     &amp;    ( ipseed,                                                     &amp;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;     &amp;      stat                                                        &amp;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;     &amp;    )</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="comment">!  --- ...  sub-column set up according to overlapping assumption</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;      <span class="keywordflow">select case</span> ( iovrlw )</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        <span class="keywordflow">case</span>( 0 )        <span class="comment">! random overlap, pick a random value at every level</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;          <span class="keyword">call </span>random_number                                            &amp;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="comment">!  ---  inputs: ( none )</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;     &amp;     ( rand2d, stat )</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;          k1 = 0</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;          <span class="keywordflow">do</span> n = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;              k1 = k1 + 1</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;              cdfunc(n,k) = rand2d(k1)</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;        <span class="keywordflow">case</span>( 1 )        <span class="comment">! max-ran overlap</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;          <span class="keyword">call </span>random_number                                            &amp;</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">!  ---  inputs: ( none )</span></div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;     &amp;     ( rand2d, stat )</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;          k1 = 0</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;          <span class="keywordflow">do</span> n = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;              k1 = k1 + 1</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;              cdfunc(n,k) = rand2d(k1)</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="comment">!  ---  first pick a random number for bottom (or top) layer.</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment">!       then walk up the column: (aer&#39;s code)</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="comment">!       if layer below is cloudy, use the same rand num in the layer below</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment">!       if layer below is clear,  use a new random number</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">!  ---  from bottom up</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;          <span class="keywordflow">do</span> k = 2, nlay</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;            k1 = k - 1</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;            tem1 = f_one - cldf(k1)</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            <span class="keywordflow">do</span> n = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;              <span class="keywordflow">if</span> ( cdfunc(n,k1) &gt; tem1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;                cdfunc(n,k) = cdfunc(n,k1)</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;                cdfunc(n,k) = cdfunc(n,k) * tem1</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="comment">!  ---  or walk down the column: (if use original author&#39;s method)</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="comment">!       if layer above is cloudy, use the same rand num in the layer above</span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="comment">!       if layer above is clear,  use a new random number</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment">!  ---  from top down</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment">!         do k = nlay-1, 1, -1</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="comment">!           k1 = k + 1</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="comment">!           tem1 = f_one - cldf(k1)</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="comment">!           do n = 1, ngptlw</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="comment">!             if ( cdfunc(n,k1) &gt; tem1 ) then</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="comment">!               cdfunc(n,k) = cdfunc(n,k1)</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;<span class="comment">!             else</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;<span class="comment">!               cdfunc(n,k) = cdfunc(n,k) * tem1</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;<span class="comment">!             endif</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;<span class="comment">!           enddo</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="comment">!         enddo</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        <span class="keywordflow">case</span>( 2 )        <span class="comment">! maximum overlap, pick same random numebr at every level</span></div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;          <span class="keyword">call </span>random_number                                            &amp;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="comment">!  ---  inputs: ( none )</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;     &amp;     ( rand1d, stat )</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;          <span class="keywordflow">do</span> n = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a></div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;            tem1 = rand1d(n)</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;            <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;              cdfunc(n,k) = tem1</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="keywordflow">      end select</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;<span class="comment">!  --- ...  generate subcolumns for homogeneous clouds</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;        tem1 = f_one - cldf(k)</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;        <span class="keywordflow">do</span> n = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;          lcloudy(n,k) = cdfunc(n,k) &gt;= tem1</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radlw__main.html#ga9318778651bca6ec1f1776da6c21dfda">mcica_subcol</a></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radlw__main.html#gaeb7b74288cf87988c14bf6e24a2039ae">setcoef</a>                                                &amp;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;     &amp;     ( pavel,tavel,tz,stemp,h2ovmr,colamt,coldry,colbrd,          &amp; <span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;     &amp;       nlay, nlp1,                                                &amp;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;     &amp;       laytrop,pklay,pklev,jp,jt,jt1,                             &amp; <span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;     &amp;       rfrate,fac00,fac01,fac10,fac11,                            &amp;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;     &amp;       selffac,selffrac,indself,forfac,forfrac,indfor,            &amp;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;     &amp;       minorfrac,scaleminor,scaleminorn2,indminor                 &amp;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;     &amp;     )</div><div class="line"><a name="l02004"></a><span class="lineno"><a class="line" href="group__module__radlw__main.html#gaeb7b74288cf87988c14bf6e24a2039ae"> 2004</a></span>&#160;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="comment">!  ===================  program usage description  ===================  !</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;<span class="comment">! purpose:  compute various coefficients needed in radiative transfer   !</span></div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="comment">!    calculations.                                                      !</span></div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;<span class="comment">! subprograms called:  none                                             !</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="comment">!  inputs:                                                       -size- !</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment">!   pavel     - real, layer pressures (mb)                         nlay !</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment">!   tavel     - real, layer temperatures (k)                       nlay !</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment">!   tz        - real, level (interface) temperatures (k)         0:nlay !</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="comment">!   stemp     - real, surface ground temperature (k)                1   !</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="comment">!   h2ovmr    - real, layer w.v. volum mixing ratio (kg/kg)        nlay !</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="comment">!   colamt    - real, column amounts of absorbing gases      nlay*maxgas!</span></div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;<span class="comment">!                 2nd indices range: 1-maxgas, for watervapor,          !</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="comment">!                 carbon dioxide, ozone, nitrous oxide, methane,        !</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="comment">!                 oxigen, carbon monoxide,etc. (molecules/cm**2)        !</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="comment">!   coldry    - real, dry air column amount                        nlay !</span></div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;<span class="comment">!   colbrd    - real, column amount of broadening gases            nlay !</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="comment">!   nlay/nlp1 - integer, total number of vertical layers, levels    1   !</span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="comment">!  outputs:                                                             !</span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="comment">!   laytrop   - integer, tropopause layer index (unitless)          1   !</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;<span class="comment">!   pklay     - real, integrated planck func at lay temp   nbands*0:nlay!</span></div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="comment">!   pklev     - real, integrated planck func at lev temp   nbands*0:nlay!</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;<span class="comment">!   jp        - real, indices of lower reference pressure          nlay !</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="comment">!   jt, jt1   - real, indices of lower reference temperatures      nlay !</span></div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;<span class="comment">!   rfrate    - real, ref ratios of binary species param   nlay*nrates*2!</span></div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="comment">!     (:,m,:)m=1-h2o/co2,2-h2o/o3,3-h2o/n2o,4-h2o/ch4,5-n2o/co2,6-o3/co2!</span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="comment">!     (:,:,n)n=1,2: the rates of ref press at the 2 sides of the layer  !</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="comment">!   facij     - real, factors multiply the reference ks,           nlay !</span></div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="comment">!                 i,j=0/1 for lower/higher of the 2 appropriate         !</span></div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;<span class="comment">!                 temperatures and altitudes.                           !</span></div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="comment">!   selffac   - real, scale factor for w. v. self-continuum        nlay !</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="comment">!                 equals (w. v. density)/(atmospheric density           !</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;<span class="comment">!                 at 296k and 1013 mb)                                  !</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="comment">!   selffrac  - real, factor for temperature interpolation of      nlay !</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="comment">!                 reference w. v. self-continuum data                   !</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="comment">!   indself   - integer, index of lower ref temp for selffac       nlay !</span></div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;<span class="comment">!   forfac    - real, scale factor for w. v. foreign-continuum     nlay !</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="comment">!   forfrac   - real, factor for temperature interpolation of      nlay !</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="comment">!                 reference w.v. foreign-continuum data                 !</span></div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="comment">!   indfor    - integer, index of lower ref temp for forfac        nlay !</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="comment">!   minorfrac - real, factor for minor gases                       nlay !</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="comment">!   scaleminor,scaleminorn2                                             !</span></div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="comment">!             - real, scale factors for minor gases                nlay !</span></div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="comment">!   indminor  - integer, index of lower ref temp for minor gases   nlay !</span></div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="comment">!  ======================    end of definitions    ===================  !</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,maxgas)</span>,<span class="keywordtype">intent(in)</span>:: colamt</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlay)</span>,     <span class="keywordtype">intent(in)</span>:: tz</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(in)</span> :: pavel,      &amp;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;     &amp;       tavel, h2ovmr, coldry, colbrd</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: stemp</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(out)</span> :: jp, jt, jt1, indself,    &amp;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;     &amp;       indfor, indminor</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: laytrop</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,nrates,2)</span>, <span class="keywordtype">intent(out)</span> ::   &amp;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;     &amp;       rfrate</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands,0:nlay)</span>, <span class="keywordtype">intent(out)</span> ::   &amp;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;     &amp;       pklev, pklay</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>,          <span class="keywordtype">intent(out)</span> ::   &amp;</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;     &amp;       fac00, fac01, fac10, fac11, selffac, selffrac, forfac,     &amp;</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;     &amp;       forfrac, minorfrac, scaleminor, scaleminorn2</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tlvlfr, tlyrfr, plog, fp, ft, ft1,       &amp;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;     &amp;       tem1, tem2</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;      <span class="keywordtype">integer</span> :: i, k, jp1, indlev, indlay</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;<span class="comment">!===&gt; ... begin here</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="comment">!  --- ...  calculate information needed by the radiative transfer routine</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;<span class="comment">!           that is specific to this atmosphere, especially some of the</span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;<span class="comment">!           coefficients and indices needed to compute the optical depths</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="comment">!           by interpolating data from stored reference atmospheres.</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;      indlay = min(180, max(1, int(stemp-159.0) ))</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;      indlev = min(180, max(1, int(tz(0)-159.0) ))</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;      tlyrfr = stemp - int(stemp)</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;      tlvlfr = tz(0) - int(tz(0))</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;      <span class="keywordflow">do</span> i = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;        tem1 = <a class="code" href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">totplnk</a>(indlay+1,i) - <a class="code" href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">totplnk</a>(indlay,i)</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        tem2 = <a class="code" href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">totplnk</a>(indlev+1,i) - <a class="code" href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">totplnk</a>(indlev,i)</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;        pklay(i,0) = delwave(i) * (<a class="code" href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">totplnk</a>(indlay,i) + tlyrfr*tem1)</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;        pklev(i,0) = delwave(i) * (<a class="code" href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">totplnk</a>(indlev,i) + tlvlfr*tem2)</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;<span class="comment">!  --- ...  begin layer loop</span></div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;<span class="comment">!           calculate the integrated Planck functions for each band at the</span></div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;<span class="comment">!           surface, level, and layer temperatures.</span></div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;      laytrop = 0</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;        indlay = min(180, max(1, int(tavel(k)-159.0) ))</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;        tlyrfr = tavel(k) - int(tavel(k))</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;        indlev = min(180, max(1, int(tz(k)-159.0) ))</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;        tlvlfr = tz(k) - int(tz(k))</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="comment">!  --- ...  begin spectral band loop</span></div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;        <span class="keywordflow">do</span> i = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;          pklay(i,k) = delwave(i) * (<a class="code" href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">totplnk</a>(indlay,i) + tlyrfr         &amp;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;     &amp;               * (<a class="code" href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">totplnk</a>(indlay+1,i) - <a class="code" href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">totplnk</a>(indlay,i)) )</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;          pklev(i,k) = delwave(i) * (<a class="code" href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">totplnk</a>(indlev,i) + tlvlfr         &amp;</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;     &amp;               * (<a class="code" href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">totplnk</a>(indlev+1,i) - <a class="code" href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">totplnk</a>(indlev,i)) )</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;<span class="comment">!  --- ...  find the two reference pressures on either side of the</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="comment">!           layer pressure. store them in jp and jp1. store in fp the</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;<span class="comment">!           fraction of the difference (in ln(pressure)) between these</span></div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="comment">!           two values that the layer pressure lies.</span></div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        plog = log(pavel(k))</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;        jp(k)= max(1, min(58, int(36.0 - 5.0*(plog+0.04)) ))</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        jp1  = jp(k) + 1</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;<span class="comment">!  --- ...  limit pressure extrapolation at the top</span></div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        fp   = max(f_zero, min(f_one, 5.0*(preflog(jp(k))-plog) ))</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;<span class="comment">!org    fp   = 5.0 * (preflog(jp(k)) - plog)</span></div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;<span class="comment">!  --- ...  determine, for each reference pressure (jp and jp1), which</span></div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="comment">!           reference temperature (these are different for each</span></div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="comment">!           reference pressure) is nearest the layer temperature but does</span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;<span class="comment">!           not exceed it. store these indices in jt and jt1, resp.</span></div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="comment">!           store in ft (resp. ft1) the fraction of the way between jt</span></div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;<span class="comment">!           (jt1) and the next highest reference temperature that the</span></div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="comment">!           layer temperature falls.</span></div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;        tem1 = (tavel(k)-tref(jp(k))) / 15.0</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;        tem2 = (tavel(k)-tref(jp1  )) / 15.0</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;        jt(k) = max(1, min(4, int(3.0 + tem1) ))</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;        jt1(k) = max(1, min(4, int(3.0 + tem2) ))</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;<span class="comment">!  --- ...  restrict extrapolation ranges by limiting abs(det t) &lt; 37.5 deg</span></div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;        ft  = max(-0.5, min(1.5, tem1 - float(jt(k) - 3) ))</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;        ft1 = max(-0.5, min(1.5, tem2 - float(jt1(k) - 3) ))</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;<span class="comment">!org    ft  = tem1 - float(jt (k) - 3)</span></div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;<span class="comment">!org    ft1 = tem2 - float(jt1(k) - 3)</span></div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;<span class="comment">!  --- ...  we have now isolated the layer ln pressure and temperature,</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;<span class="comment">!           between two reference pressures and two reference temperatures</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;<span class="comment">!           (for each reference pressure).  we multiply the pressure</span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;<span class="comment">!           fraction fp with the appropriate temperature fractions to get</span></div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;<span class="comment">!           the factors that will be needed for the interpolation that yields</span></div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;<span class="comment">!           the optical depths (performed in routines taugbn for band n)</span></div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;        tem1 = f_one - fp</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;        fac10(k) = tem1 * ft</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;        fac00(k) = tem1 * (f_one - ft)</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        fac11(k) = fp * ft1</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;        fac01(k) = fp * (f_one - ft1)</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;        forfac(k) = pavel(k)*stpfac / (tavel(k)*(1.0 + h2ovmr(k)))</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;        selffac(k) = h2ovmr(k) * forfac(k)</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="comment">!  --- ...  set up factors needed to separately include the minor gases</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;<span class="comment">!           in the calculation of absorption coefficient</span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;        scaleminor(k) = pavel(k) / tavel(k)</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;        scaleminorn2(k) = (pavel(k) / tavel(k))                         &amp;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;     &amp;                  * (colbrd(k)/(coldry(k) + colamt(k,1)))</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;        tem1 = (tavel(k) - 180.8) / 7.2</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;        indminor(k) = min(18, max(1, int(tem1)))</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;        minorfrac(k) = tem1 - float(indminor(k))</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="comment">!  --- ...  if the pressure is less than ~100mb, perform a different</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;<span class="comment">!           set of species interpolations.</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;        <span class="keywordflow">if</span> (plog &gt; 4.56) <span class="keywordflow">then</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;          laytrop =  laytrop + 1</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;          tem1 = (332.0 - tavel(k)) / 36.0</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;          indfor(k) = min(2, max(1, int(tem1)))</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;          forfrac(k) = tem1 - float(indfor(k))</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;<span class="comment">!  --- ...  set up factors needed to separately include the water vapor</span></div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;<span class="comment">!           self-continuum in the calculation of absorption coefficient.</span></div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;          tem1 = (tavel(k) - 188.0) / 7.2</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;          indself(k) = min(9, max(1, int(tem1)-7))</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;          selffrac(k) = tem1 - float(indself(k) + 7)</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;<span class="comment">!  --- ...  setup reference ratio to be used in calculation of binary</span></div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;<span class="comment">!           species parameter in lower atmosphere.</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;          rfrate(k,1,1) = chi_mls(1,jp(k)) / chi_mls(2,jp(k))</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;          rfrate(k,1,2) = chi_mls(1,jp(k)+1) / chi_mls(2,jp(k)+1)</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;          rfrate(k,2,1) = chi_mls(1,jp(k)) / chi_mls(3,jp(k))</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;          rfrate(k,2,2) = chi_mls(1,jp(k)+1) / chi_mls(3,jp(k)+1)</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;          rfrate(k,3,1) = chi_mls(1,jp(k)) / chi_mls(4,jp(k))</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;          rfrate(k,3,2) = chi_mls(1,jp(k)+1) / chi_mls(4,jp(k)+1)</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;          rfrate(k,4,1) = chi_mls(1,jp(k)) / chi_mls(6,jp(k))</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;          rfrate(k,4,2) = chi_mls(1,jp(k)+1) / chi_mls(6,jp(k)+1)</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;          rfrate(k,5,1) = chi_mls(4,jp(k)) / chi_mls(2,jp(k))</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;          rfrate(k,5,2) = chi_mls(4,jp(k)+1) / chi_mls(2,jp(k)+1)</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;          tem1 = (tavel(k) - 188.0) / 36.0</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;          indfor(k) = 3</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;          forfrac(k) = tem1 - f_one</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;          indself(k) = 0</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;          selffrac(k) = f_zero</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;<span class="comment">!  --- ...  setup reference ratio to be used in calculation of binary</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;<span class="comment">!           species parameter in upper atmosphere.</span></div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;          rfrate(k,1,1) = chi_mls(1,jp(k)) / chi_mls(2,jp(k))</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;          rfrate(k,1,2) = chi_mls(1,jp(k)+1) / chi_mls(2,jp(k)+1)</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;          rfrate(k,6,1) = chi_mls(3,jp(k)) / chi_mls(2,jp(k))</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;          rfrate(k,6,2) = chi_mls(3,jp(k)+1) / chi_mls(2,jp(k)+1)</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;<span class="comment">!  --- ...  rescale selffac and forfac for use in taumol</span></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        selffac(k) = colamt(k,1) * selffac(k)</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        forfac(k)  = colamt(k,1) * forfac(k)</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;<span class="keywordflow">      enddo</span>   <span class="comment">! end do_k layer loop</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radlw__main.html#gaeb7b74288cf87988c14bf6e24a2039ae">setcoef</a></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radlw__main.html#gab002119955eb2b82f16352459180f5ed">rtrn</a>                                                   &amp;</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;     &amp;     ( semiss,delp,cldfrc,taucld,tautot,pklay,pklev,              &amp; <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;     &amp;       fracs,secdif, nlay,nlp1,                                   &amp;</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;     &amp;       totuflux,totdflux,htr, totuclfl,totdclfl,htrcl, htrb       &amp; <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;     &amp;     )</div><div class="line"><a name="l02295"></a><span class="lineno"><a class="line" href="group__module__radlw__main.html#gab002119955eb2b82f16352459180f5ed"> 2295</a></span>&#160;</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="comment">!  ===================  program usage description  ===================  !</span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="comment">! purpose:  compute the upward/downward radiative fluxes, and heating   !</span></div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="comment">! rates for both clear or cloudy atmosphere.  clouds are assumed as     !</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;<span class="comment">! randomly overlaping in a vertical colum.                              !</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;<span class="comment">! subprograms called:  none                                             !</span></div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;<span class="comment">!  inputs:                                                     -size-   !</span></div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;<span class="comment">!   semiss  - real, lw surface emissivity                         nbands!</span></div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;<span class="comment">!   delp    - real, layer pressure thickness (mb)                  nlay !</span></div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;<span class="comment">!   cldfrc  - real, layer cloud fraction                         0:nlp1 !</span></div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;<span class="comment">!   taucld  - real, layer cloud opt depth                    nbands,nlay!</span></div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="comment">!   tautot  - real, total optical depth (gas+aerosols)       ngptlw,nlay!</span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="comment">!   pklay   - real, integrated planck func at lay temp     nbands*0:nlay!</span></div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="comment">!   pklev   - real, integrated planck func at lev temp     nbands*0:nlay!</span></div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;<span class="comment">!   fracs   - real, planck fractions                         ngptlw,nlay!</span></div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;<span class="comment">!   secdif  - real, secant of diffusivity angle                   nbands!</span></div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;<span class="comment">!   nlay    - integer, number of vertical layers                    1   !</span></div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;<span class="comment">!   nlp1    - integer, number of vertical levels (interfaces)       1   !</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;<span class="comment">!  outputs:                                                             !</span></div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;<span class="comment">!   totuflux- real, total sky upward flux (w/m2)                 0:nlay !</span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;<span class="comment">!   totdflux- real, total sky downward flux (w/m2)               0:nlay !</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;<span class="comment">!   htr     - real, total sky heating rate (k/sec or k/day)        nlay !</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="comment">!   totuclfl- real, clear sky upward flux (w/m2)                 0:nlay !</span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;<span class="comment">!   totdclfl- real, clear sky downward flux (w/m2)               0:nlay !</span></div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;<span class="comment">!   htrcl   - real, clear sky heating rate (k/sec or k/day)        nlay !</span></div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;<span class="comment">!   htrb    - real, spectral band lw heating rate (k/day)    nlay*nbands!</span></div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;<span class="comment">!  module veriables:                                                    !</span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;<span class="comment">!   ngb     - integer, band index for each g-value                ngptlw!</span></div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="comment">!   fluxfac - real, conversion factor for fluxes (pi*2.e4)           1  !</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;<span class="comment">!   heatfac - real, conversion factor for heating rates (g/cp*1e-2)  1  !</span></div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="comment">!   tblint  - real, conversion factor for look-up tbl (float(ntbl)   1  !</span></div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;<span class="comment">!   bpade   - real, pade approx constant (1/0.278)                   1  !</span></div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;<span class="comment">!   wtdiff  - real, weight for radiance to flux conversion           1  !</span></div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;<span class="comment">!   ntbl    - integer, dimension of look-up tables                   1  !</span></div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;<span class="comment">!   tau_tbl - real, clr-sky opt dep lookup table                 0:ntbl !</span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;<span class="comment">!   exp_tbl - real, transmittance lookup table                   0:ntbl !</span></div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;<span class="comment">!   tfn_tbl - real, tau transition function                      0:ntbl !</span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="comment">!  local variables:                                                     !</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;<span class="comment">!    itgas  - integer, index for gases contribution look-up table    1  !</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;<span class="comment">!    ittot  - integer, index for gases plus clouds  look-up table    1  !</span></div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;<span class="comment">!    reflct - real, surface reflectance                              1  !</span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="comment">!    atrgas - real, gaseous absorptivity                             1  !</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="comment">!    atrtot - real, gaseous and cloud absorptivity                   1  !</span></div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;<span class="comment">!    odcld  - real, cloud optical depth                              1  !</span></div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="comment">!    efclrfr- real, effective clear sky fraction (1-efcldfr)       nlay !</span></div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="comment">!    odepth - real, optical depth of gaseous only                    1  !</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;<span class="comment">!    odtot  - real, optical depth of gas and cloud                   1  !</span></div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;<span class="comment">!    gasfac - real, gas-only pade factor, used for planck fn         1  !</span></div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;<span class="comment">!    totfac - real, gas+cld pade factor, used for planck fn          1  !</span></div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;<span class="comment">!    bbdgas - real, gas-only planck function for downward rt         1  !</span></div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;<span class="comment">!    bbugas - real, gas-only planck function for upward rt           1  !</span></div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;<span class="comment">!    bbdtot - real, gas and cloud planck function for downward rt    1  !</span></div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;<span class="comment">!    bbutot - real, gas and cloud planck function for upward rt      1  !</span></div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="comment">!    gassrcu- real, upwd source radiance due to gas only            nlay!</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="comment">!    totsrcu- real, upwd source radiance due to gas+cld             nlay!</span></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="comment">!    gassrcd- real, dnwd source radiance due to gas only             1  !</span></div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;<span class="comment">!    totsrcd- real, dnwd source radiance due to gas+cld              1  !</span></div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="comment">!    radtotu- real, spectrally summed total sky upwd radiance        1  !</span></div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;<span class="comment">!    radclru- real, spectrally summed clear sky upwd radiance        1  !</span></div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;<span class="comment">!    radtotd- real, spectrally summed total sky dnwd radiance        1  !</span></div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;<span class="comment">!    radclrd- real, spectrally summed clear sky dnwd radiance        1  !</span></div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="comment">!    toturad- real, total sky upward radiance by layer     0:nlay*nbands!</span></div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;<span class="comment">!    clrurad- real, clear sky upward radiance by layer     0:nlay*nbands!</span></div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="comment">!    totdrad- real, total sky downward radiance by layer   0:nlay*nbands!</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;<span class="comment">!    clrdrad- real, clear sky downward radiance by layer   0:nlay*nbands!</span></div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;<span class="comment">!    fnet   - real, net longwave flux (w/m2)                     0:nlay !</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;<span class="comment">!    fnetc  - real, clear sky net longwave flux (w/m2)           0:nlay !</span></div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;<span class="comment">!  original code description                                            !</span></div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="comment">!  original version:   e. j. mlawer, et al. rrtm_v3.0                   !</span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;<span class="comment">!  revision for gcms:  michael j. iacono; october, 2002                 !</span></div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;<span class="comment">!  revision for f90:   michael j. iacono; june, 2006                    !</span></div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="comment">!  this program calculates the upward fluxes, downward fluxes, and      !</span></div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="comment">!  heating rates for an arbitrary clear or cloudy atmosphere. the input !</span></div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;<span class="comment">!  to this program is the atmospheric profile, all Planck function      !</span></div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;<span class="comment">!  information, and the cloud fraction by layer.  a variable diffusivity!</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;<span class="comment">!  angle (secdif) is used for the angle integration. bands 2-3 and 5-9  !</span></div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;<span class="comment">!  use a value for secdif that varies from 1.50 to 1.80 as a function   !</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;<span class="comment">!  of the column water vapor, and other bands use a value of 1.66.  the !</span></div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;<span class="comment">!  gaussian weight appropriate to this angle (wtdiff=0.5) is applied    !</span></div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="comment">!  here.  note that use of the emissivity angle for the flux integration!</span></div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<span class="comment">!  can cause errors of 1 to 4 W/m2 within cloudy layers.                !</span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;<span class="comment">!  clouds are treated with a random cloud overlap method.               !</span></div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="comment">!  ======================  end of description block  =================  !</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlp1)</span>, <span class="keywordtype">intent(in)</span> :: cldfrc</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands)</span>, <span class="keywordtype">intent(in)</span> :: semiss,   &amp;</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;     &amp;       secdif</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>,   <span class="keywordtype">intent(in)</span> :: delp</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands,nlay)</span>,<span class="keywordtype">intent(in)</span>:: taucld</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(ngptlw,nlay)</span>,<span class="keywordtype">intent(in)</span>:: fracs, &amp;</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;     &amp;       tautot</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands,0:nlay)</span>, <span class="keywordtype">intent(in)</span> ::    &amp;</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;     &amp;       pklev, pklay</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(out)</span> :: htr, htrcl</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,nbands)</span>,<span class="keywordtype">intent(out)</span> :: htrb</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlay)</span>, <span class="keywordtype">intent(out)</span> ::          &amp;</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;     &amp;       totuflux, totdflux, totuclfl, totdclfl</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: rec_6 = 0.166667</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlay,nbands)</span> :: clrurad,       &amp;</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;     &amp;       clrdrad, toturad, totdrad</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>   :: gassrcu, totsrcu,     &amp;</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;     &amp;       trngas, efclrfr, rfdelp</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlay)</span> :: fnet, fnetc</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: totsrcd, gassrcd, tblind, odepth, odtot, &amp;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;     &amp;       odcld, atrtot, atrgas, reflct, totfac, gasfac, flxfac,     &amp;</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;     &amp;       plfrac, blay, bbdgas, bbdtot, bbugas, bbutot, dplnku,      &amp;</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;     &amp;       dplnkd, radtotu, radclru, radtotd, radclrd, rad0,          &amp;</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;     &amp;       clfr, trng, gasu</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      <span class="keywordtype">integer</span> :: ittot, itgas, ib, ig, k</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;      <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;        <span class="keywordflow">do</span> k = 0, nlay</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;          toturad(k,ib) = f_zero</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;          totdrad(k,ib) = f_zero</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;          clrurad(k,ib) = f_zero</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;          clrdrad(k,ib) = f_zero</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;      <span class="keywordflow">do</span> k = 0, nlay</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;        totuflux(k) = f_zero</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;        totdflux(k) = f_zero</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;        totuclfl(k) = f_zero</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;        totdclfl(k) = f_zero</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;<span class="comment">!  --- ...  loop over all g-points</span></div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;      <span class="keywordflow">do</span> ig = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a></div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;        ib = <a class="code" href="namespacemodule__radlw__parameters.html#a2c571bd14c9b7982a7968976858c7547">ngb</a>(ig)</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;        radtotd = f_zero</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;        radclrd = f_zero</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;        <span class="keywordflow">do</span> k = nlay, 1, -1</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;<span class="comment">!!\n  - clear sky, gases contribution</span></div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;          odepth = max( f_zero, secdif(ib)*tautot(ig,k) )</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;          <span class="keywordflow">if</span> (odepth &lt;= 0.06) <span class="keywordflow">then</span></div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;            atrgas = odepth - 0.5*odepth*odepth</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;            trng   = f_one - atrgas</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;            gasfac = rec_6 * odepth</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;            tblind = odepth / (bpade + odepth)</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;            itgas = tblint*tblind + 0.5</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;            trng  = exp_tbl(itgas)</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;            atrgas = f_one - trng</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;            gasfac = tfn_tbl(itgas)</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;            odepth = tau_tbl(itgas)</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;          plfrac = fracs(ig,k)</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;          blay = pklay(ib,k)</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;          dplnku = pklev(ib,k  ) - blay</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;          dplnkd = pklev(ib,k-1) - blay</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;          bbdgas = plfrac * (blay + dplnkd*gasfac)</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;          bbugas = plfrac * (blay + dplnku*gasfac)</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;          gassrcd= bbdgas * atrgas</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;          gassrcu(k)= bbugas * atrgas</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;          trngas(k) = trng</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;<span class="comment">!!\n  - total sky, gases+clouds contribution</span></div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;          clfr = cldfrc(k)</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;          <span class="keywordflow">if</span> (clfr &gt;= eps) <span class="keywordflow">then</span></div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;<span class="comment">!!\n  - cloudy layer</span></div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;            odcld = secdif(ib) * taucld(ib,k)</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;            efclrfr(k) = f_one-(f_one - exp(-odcld))*clfr</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;            odtot = odepth + odcld</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;            <span class="keywordflow">if</span> (odtot &lt; 0.06) <span class="keywordflow">then</span></div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;              totfac = rec_6 * odtot</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;              atrtot = odtot - 0.5*odtot*odtot</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;              tblind = odtot / (bpade + odtot)</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;              ittot  = tblint*tblind + 0.5</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;              totfac = tfn_tbl(ittot)</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;              atrtot = f_one - exp_tbl(ittot)</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;            bbdtot = plfrac * (blay + dplnkd*totfac)</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;            bbutot = plfrac * (blay + dplnku*totfac)</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;            totsrcd= bbdtot * atrtot</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;            totsrcu(k)= bbutot * atrtot</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;<span class="comment">!  --- ...  total sky radiance</span></div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;            radtotd = radtotd*trng*efclrfr(k) + gassrcd                 &amp;</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;     &amp;              + clfr*(totsrcd - gassrcd)</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;            totdrad(k-1,ib) = totdrad(k-1,ib) + radtotd</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;<span class="comment">!  --- ...  clear sky radiance</span></div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;            radclrd = radclrd*trng + gassrcd</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;            clrdrad(k-1,ib) = clrdrad(k-1,ib) + radclrd</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;<span class="comment">!  --- ...  clear layer</span></div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;<span class="comment">!  --- ...  total sky radiance</span></div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;            radtotd = radtotd*trng + gassrcd</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;            totdrad(k-1,ib) = totdrad(k-1,ib) + radtotd</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;<span class="comment">!  --- ...  clear sky radiance</span></div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;            radclrd = radclrd*trng + gassrcd</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;            clrdrad(k-1,ib) = clrdrad(k-1,ib) + radclrd</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;<span class="keywordflow">          endif</span>   <span class="comment">! end if_clfr_block</span></div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;<span class="keywordflow">        enddo</span>   <span class="comment">! end do_k_loop</span></div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="comment">!     note: spectral and Lambertian reflection are identical for the</span></div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;<span class="comment">!           diffusivity angle flux integration used here.</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;        reflct = f_one - semiss(ib)</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;        rad0 = semiss(ib) * fracs(ig,1) * pklay(ib,0)</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;        radtotu = rad0 + reflct*radtotd</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;        toturad(0,ib) = toturad(0,ib) + radtotu</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;        radclru = rad0 + reflct*radclrd</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;        clrurad(0,ib) = clrurad(0,ib) + radclru</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;          clfr = cldfrc(k)</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;          trng = trngas(k)</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;          gasu = gassrcu(k)</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;          <span class="keywordflow">if</span> (clfr &gt;= eps) <span class="keywordflow">then</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;<span class="comment">!  --- ...  cloudy layer</span></div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;<span class="comment">!  --- ... total sky radiance</span></div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;            radtotu = radtotu*trng*efclrfr(k) + gasu                    &amp;</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;     &amp;            + clfr*(totsrcu(k) - gasu)</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;            toturad(k,ib) = toturad(k,ib) + radtotu</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;<span class="comment">!  --- ... clear sky radiance</span></div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;            radclru = radclru*trng + gasu</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;            clrurad(k,ib) = clrurad(k,ib) + radclru</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;<span class="comment">!  --- ...  clear layer</span></div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;<span class="comment">!  --- ... total sky radiance</span></div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;            radtotu = radtotu*trng + gasu</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;            toturad(k,ib) = toturad(k,ib) + radtotu</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;<span class="comment">!  --- ... clear sky radiance</span></div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;            radclru = radclru*trng + gasu</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;            clrurad(k,ib) = clrurad(k,ib) + radclru</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;<span class="keywordflow">          endif</span>   <span class="comment">! end if_clfr_block</span></div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;<span class="keywordflow">        enddo</span>   <span class="comment">! end do_k_loop</span></div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;<span class="keywordflow">      enddo</span>   <span class="comment">! end do_ig_loop</span></div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;      flxfac = wtdiff * fluxfac</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;      <span class="keywordflow">do</span> k = 0, nlay</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;        <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;          totuflux(k) = totuflux(k) + toturad(k,ib)</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;          totdflux(k) = totdflux(k) + totdrad(k,ib)</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;          totuclfl(k) = totuclfl(k) + clrurad(k,ib)</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;          totdclfl(k) = totdclfl(k) + clrdrad(k,ib)</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;        totuflux(k) = totuflux(k) * flxfac</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;        totdflux(k) = totdflux(k) * flxfac</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;        totuclfl(k) = totuclfl(k) * flxfac</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;        totdclfl(k) = totdclfl(k) * flxfac</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="comment">!  --- ...  calculate net fluxes and heating rates</span></div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;      fnet(0) = totuflux(0) - totdflux(0)</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;        rfdelp(k) = heatfac / delp(k)</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;        fnet(k) = totuflux(k) - totdflux(k)</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;        htr(k) = (fnet(k-1) - fnet(k)) * rfdelp(k)</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;<span class="comment">!! --- ...  optional clear sky heating rates</span></div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;      <span class="keywordflow">if</span> ( lhlw0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;        fnetc(0) = totuclfl(0) - totdclfl(0)</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;          fnetc(k) = totuclfl(k) - totdclfl(k)</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;          htrcl(k) = (fnetc(k-1) - fnetc(k)) * rfdelp(k)</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;<span class="comment">!! --- ...  optional spectral band heating rates</span></div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;      <span class="keywordflow">if</span> ( lhlwb ) <span class="keywordflow">then</span></div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;        <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;          fnet(0) = (toturad(0,ib) - totdrad(0,ib)) * flxfac</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;            fnet(k) = (toturad(k,ib) - totdrad(k,ib)) * flxfac</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;            htrb(k,ib) = (fnet(k-1) - fnet(k)) * rfdelp(k)</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radlw__main.html#gab002119955eb2b82f16352459180f5ed">rtrn</a></div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radlw__main.html#ga8d4a6fecb4ad25468e91661a79d4ca20">rtrnmr</a>                                                 &amp;</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;     &amp;     ( semiss,delp,cldfrc,taucld,tautot,pklay,pklev,              &amp;<span class="comment">!  ---  inputs</span></div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;     &amp;       fracs,secdif, nlay,nlp1,                                   &amp;</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;     &amp;       totuflux,totdflux,htr, totuclfl,totdclfl,htrcl, htrb       &amp;  <span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;     &amp;     )</div><div class="line"><a name="l02678"></a><span class="lineno"><a class="line" href="group__module__radlw__main.html#ga8d4a6fecb4ad25468e91661a79d4ca20"> 2678</a></span>&#160;</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;<span class="comment">!  ===================  program usage description  ===================  !</span></div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;<span class="comment">! purpose:  compute the upward/downward radiative fluxes, and heating   !</span></div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;<span class="comment">! rates for both clear or cloudy atmosphere.  clouds are assumed as in  !</span></div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;<span class="comment">! maximum-randomly overlaping in a vertical colum.                      !</span></div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;<span class="comment">! subprograms called:  none                                             !</span></div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;<span class="comment">!  inputs:                                                     -size-   !</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;<span class="comment">!   semiss  - real, lw surface emissivity                         nbands!</span></div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;<span class="comment">!   delp    - real, layer pressure thickness (mb)                  nlay !</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;<span class="comment">!   cldfrc  - real, layer cloud fraction                         0:nlp1 !</span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="comment">!   taucld  - real, layer cloud opt depth                    nbands,nlay!</span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;<span class="comment">!   tautot  - real, total optical depth (gas+aerosols)       ngptlw,nlay!</span></div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;<span class="comment">!   pklay   - real, integrated planck func at lay temp     nbands*0:nlay!</span></div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;<span class="comment">!   pklev   - real, integrated planck func at lev temp     nbands*0:nlay!</span></div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;<span class="comment">!   fracs   - real, planck fractions                         ngptlw,nlay!</span></div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;<span class="comment">!   secdif  - real, secant of diffusivity angle                   nbands!</span></div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;<span class="comment">!   nlay    - integer, number of vertical layers                    1   !</span></div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;<span class="comment">!   nlp1    - integer, number of vertical levels (interfaces)       1   !</span></div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;<span class="comment">!  outputs:                                                             !</span></div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;<span class="comment">!   totuflux- real, total sky upward flux (w/m2)                 0:nlay !</span></div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;<span class="comment">!   totdflux- real, total sky downward flux (w/m2)               0:nlay !</span></div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;<span class="comment">!   htr     - real, total sky heating rate (k/sec or k/day)        nlay !</span></div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;<span class="comment">!   totuclfl- real, clear sky upward flux (w/m2)                 0:nlay !</span></div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;<span class="comment">!   totdclfl- real, clear sky downward flux (w/m2)               0:nlay !</span></div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;<span class="comment">!   htrcl   - real, clear sky heating rate (k/sec or k/day)        nlay !</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;<span class="comment">!   htrb    - real, spectral band lw heating rate (k/day)    nlay*nbands!</span></div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;<span class="comment">!  module veriables:                                                    !</span></div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;<span class="comment">!   ngb     - integer, band index for each g-value                ngptlw!</span></div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;<span class="comment">!   fluxfac - real, conversion factor for fluxes (pi*2.e4)           1  !</span></div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;<span class="comment">!   heatfac - real, conversion factor for heating rates (g/cp*1e-2)  1  !</span></div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;<span class="comment">!   tblint  - real, conversion factor for look-up tbl (float(ntbl)   1  !</span></div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;<span class="comment">!   bpade   - real, pade approx constant (1/0.278)                   1  !</span></div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;<span class="comment">!   wtdiff  - real, weight for radiance to flux conversion           1  !</span></div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;<span class="comment">!   ntbl    - integer, dimension of look-up tables                   1  !</span></div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;<span class="comment">!   tau_tbl - real, clr-sky opt dep lookup table                 0:ntbl !</span></div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;<span class="comment">!   exp_tbl - real, transmittance lookup table                   0:ntbl !</span></div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;<span class="comment">!   tfn_tbl - real, tau transition function                      0:ntbl !</span></div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;<span class="comment">!  local variables:                                                     !</span></div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;<span class="comment">!    itgas  - integer, index for gases contribution look-up table    1  !</span></div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;<span class="comment">!    ittot  - integer, index for gases plus clouds  look-up table    1  !</span></div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;<span class="comment">!    reflct - real, surface reflectance                              1  !</span></div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;<span class="comment">!    atrgas - real, gaseous absorptivity                             1  !</span></div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;<span class="comment">!    atrtot - real, gaseous and cloud absorptivity                   1  !</span></div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;<span class="comment">!    odcld  - real, cloud optical depth                              1  !</span></div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;<span class="comment">!    odepth - real, optical depth of gaseous only                    1  !</span></div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;<span class="comment">!    odtot  - real, optical depth of gas and cloud                   1  !</span></div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;<span class="comment">!    gasfac - real, gas-only pade factor, used for planck fn         1  !</span></div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;<span class="comment">!    totfac - real, gas+cld pade factor, used for planck fn          1  !</span></div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;<span class="comment">!    bbdgas - real, gas-only planck function for downward rt         1  !</span></div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;<span class="comment">!    bbugas - real, gas-only planck function for upward rt           1  !</span></div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;<span class="comment">!    bbdtot - real, gas and cloud planck function for downward rt    1  !</span></div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;<span class="comment">!    bbutot - real, gas and cloud planck function for upward rt      1  !</span></div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;<span class="comment">!    gassrcu- real, upwd source radiance due to gas only            nlay!</span></div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;<span class="comment">!    totsrcu- real, upwd source radiance due to gas + cld           nlay!</span></div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;<span class="comment">!    gassrcd- real, dnwd source radiance due to gas only             1  !</span></div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;<span class="comment">!    totsrcd- real, dnwd source radiance due to gas + cld            1  !</span></div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;<span class="comment">!    radtotu- real, spectrally summed total sky upwd radiance        1  !</span></div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;<span class="comment">!    radclru- real, spectrally summed clear sky upwd radiance        1  !</span></div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;<span class="comment">!    radtotd- real, spectrally summed total sky dnwd radiance        1  !</span></div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;<span class="comment">!    radclrd- real, spectrally summed clear sky dnwd radiance        1  !</span></div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;<span class="comment">!    toturad- real, total sky upward radiance by layer     0:nlay*nbands!</span></div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;<span class="comment">!    clrurad- real, clear sky upward radiance by layer     0:nlay*nbands!</span></div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;<span class="comment">!    totdrad- real, total sky downward radiance by layer   0:nlay*nbands!</span></div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;<span class="comment">!    clrdrad- real, clear sky downward radiance by layer   0:nlay*nbands!</span></div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;<span class="comment">!    fnet   - real, net longwave flux (w/m2)                     0:nlay !</span></div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;<span class="comment">!    fnetc  - real, clear sky net longwave flux (w/m2)           0:nlay !</span></div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;<span class="comment">!  original code description                                            !</span></div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;<span class="comment">!  original version:   e. j. mlawer, et al. rrtm_v3.0                   !</span></div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;<span class="comment">!  revision for gcms:  michael j. iacono; october, 2002                 !</span></div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;<span class="comment">!  revision for f90:   michael j. iacono; june, 2006                    !</span></div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;<span class="comment">!  this program calculates the upward fluxes, downward fluxes, and      !</span></div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;<span class="comment">!  heating rates for an arbitrary clear or cloudy atmosphere. the input !</span></div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;<span class="comment">!  to this program is the atmospheric profile, all Planck function      !</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;<span class="comment">!  information, and the cloud fraction by layer.  a variable diffusivity!</span></div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;<span class="comment">!  angle (secdif) is used for the angle integration. bands 2-3 and 5-9  !</span></div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;<span class="comment">!  use a value for secdif that varies from 1.50 to 1.80 as a function   !</span></div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;<span class="comment">!  of the column water vapor, and other bands use a value of 1.66.  the !</span></div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;<span class="comment">!  gaussian weight appropriate to this angle (wtdiff=0.5) is applied    !</span></div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;<span class="comment">!  here.  note that use of the emissivity angle for the flux integration!</span></div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;<span class="comment">!  can cause errors of 1 to 4 W/m2 within cloudy layers.                !</span></div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;<span class="comment">!  clouds are treated with a maximum-random cloud overlap method.       !</span></div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;<span class="comment">!  ======================  end of description block  =================  !</span></div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlp1)</span>, <span class="keywordtype">intent(in)</span> :: cldfrc</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands)</span>, <span class="keywordtype">intent(in)</span> :: semiss,   &amp;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;     &amp;       secdif</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>,   <span class="keywordtype">intent(in)</span> :: delp</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands,nlay)</span>,<span class="keywordtype">intent(in)</span>:: taucld</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(ngptlw,nlay)</span>,<span class="keywordtype">intent(in)</span>:: fracs, &amp;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;     &amp;       tautot</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands,0:nlay)</span>, <span class="keywordtype">intent(in)</span> ::    &amp;</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;     &amp;       pklev, pklay</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(out)</span> :: htr, htrcl</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,nbands)</span>,<span class="keywordtype">intent(out)</span> :: htrb</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlay)</span>, <span class="keywordtype">intent(out)</span> ::          &amp;</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;     &amp;       totuflux, totdflux, totuclfl, totdclfl</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: rec_6 = 0.166667</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlay,nbands)</span> :: clrurad,       &amp;</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;     &amp;       clrdrad, toturad, totdrad</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>   :: gassrcu, totsrcu,     &amp;</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;     &amp;       trngas, trntot, rfdelp</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlay)</span> :: fnet, fnetc</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: totsrcd, gassrcd, tblind, odepth, odtot, &amp;</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;     &amp;       odcld, atrtot, atrgas, reflct, totfac, gasfac, flxfac,     &amp;</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;     &amp;       plfrac, blay, bbdgas, bbdtot, bbugas, bbutot, dplnku,      &amp;</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;     &amp;       dplnkd, radtotu, radclru, radtotd, radclrd, rad0, rad,     &amp;</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;     &amp;       totradd, clrradd, totradu, clrradu, fmax, fmin, rat1, rat2,&amp;</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;     &amp;       radmod, clfr, trng, trnt, gasu, totu</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;      <span class="keywordtype">integer</span> :: ittot, itgas, ib, ig, k</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;<span class="comment">!  dimensions for cloud overlap adjustment</span></div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlp1)</span> :: faccld1u, faccld2u,     &amp;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;     &amp;        facclr1u, facclr2u, faccmb1u, faccmb2u</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlay)</span> :: faccld1d, faccld2d,   &amp;</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;     &amp;        facclr1d, facclr2d, faccmb1d, faccmb2d</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;      <span class="keywordtype">logical</span> :: lstcldu(nlay), lstcldd(nlay)</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;      <span class="keywordflow">do</span> k = 1, nlp1</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;        faccld1u(k) = f_zero</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;        faccld2u(k) = f_zero</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;        facclr1u(k) = f_zero</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;        facclr2u(k) = f_zero</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;        faccmb1u(k) = f_zero</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;        faccmb2u(k) = f_zero</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;      lstcldu(1) = cldfrc(1) &gt; eps</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;      rat1 = f_zero</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;      rat2 = f_zero</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay-1</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;        lstcldu(k+1) = cldfrc(k+1)&gt;eps .and. cldfrc(k)&lt;=eps</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;        <span class="keywordflow">if</span> (cldfrc(k) &gt; eps) <span class="keywordflow">then</span></div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;          <span class="keywordflow">if</span> (cldfrc(k+1) &gt;= cldfrc(k)) <span class="keywordflow">then</span></div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;            <span class="keywordflow">if</span> (lstcldu(k)) <span class="keywordflow">then</span></div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;              <span class="keywordflow">if</span> (cldfrc(k) &lt; f_one) <span class="keywordflow">then</span></div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;                facclr2u(k+1) = (cldfrc(k+1) - cldfrc(k))               &amp;</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;     &amp;                        / (f_one - cldfrc(k))</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;              facclr2u(k) = f_zero</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;              faccld2u(k) = f_zero</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;              fmax = max(cldfrc(k), cldfrc(k-1))</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;              <span class="keywordflow">if</span> (cldfrc(k+1) &gt; fmax) <span class="keywordflow">then</span></div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;                facclr1u(k+1) = rat2</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;                facclr2u(k+1) = (cldfrc(k+1) - fmax)/(f_one - fmax)</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;              <span class="keywordflow">elseif</span> (cldfrc(k+1) &lt; fmax) <span class="keywordflow">then</span></div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;                facclr1u(k+1) = (cldfrc(k+1) - cldfrc(k))               &amp;</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;     &amp;                        / (cldfrc(k-1) - cldfrc(k))</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;                facclr1u(k+1) = rat2</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;            <span class="keywordflow">if</span> (facclr1u(k+1)&gt;f_zero .or. facclr2u(k+1)&gt;f_zero) <span class="keywordflow">then</span></div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;              rat1 = f_one</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;              rat2 = f_zero</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;              rat1 = f_zero</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;              rat2 = f_zero</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;            <span class="keywordflow">if</span> (lstcldu(k)) <span class="keywordflow">then</span></div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;              faccld2u(k+1) = (cldfrc(k) - cldfrc(k+1)) / cldfrc(k)</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;              facclr2u(k) = f_zero</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;              faccld2u(k) = f_zero</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;              fmin = min(cldfrc(k), cldfrc(k-1))</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;              <span class="keywordflow">if</span> (cldfrc(k+1) &lt;= fmin) <span class="keywordflow">then</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;                faccld1u(k+1) = rat1</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;                faccld2u(k+1) = (fmin - cldfrc(k+1)) / fmin</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;                faccld1u(k+1) = (cldfrc(k) - cldfrc(k+1))               &amp;</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;     &amp;                        / (cldfrc(k) - fmin)</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;            <span class="keywordflow">if</span> (faccld1u(k+1)&gt;f_zero .or. faccld2u(k+1)&gt;f_zero) <span class="keywordflow">then</span></div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;              rat1 = f_zero</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;              rat2 = f_one</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;              rat1 = f_zero</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;              rat2 = f_zero</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;          faccmb1u(k+1) = facclr1u(k+1) * faccld2u(k) * cldfrc(k-1)</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;          faccmb2u(k+1) = faccld1u(k+1) * facclr2u(k)                   &amp;</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;     &amp;                  * (f_one - cldfrc(k-1))</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;      <span class="keywordflow">do</span> k = 0, nlay</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;        faccld1d(k) = f_zero</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;        faccld2d(k) = f_zero</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;        facclr1d(k) = f_zero</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;        facclr2d(k) = f_zero</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;        faccmb1d(k) = f_zero</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;        faccmb2d(k) = f_zero</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;      lstcldd(nlay) = cldfrc(nlay) &gt; eps</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;      rat1 = f_zero</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;      rat2 = f_zero</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;      <span class="keywordflow">do</span> k = nlay, 2, -1</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;        lstcldd(k-1) = cldfrc(k-1) &gt; eps .and. cldfrc(k)&lt;=eps</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;        <span class="keywordflow">if</span> (cldfrc(k) &gt; eps) <span class="keywordflow">then</span></div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;          <span class="keywordflow">if</span> (cldfrc(k-1) &gt;= cldfrc(k)) <span class="keywordflow">then</span></div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;            <span class="keywordflow">if</span> (lstcldd(k)) <span class="keywordflow">then</span></div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;              <span class="keywordflow">if</span> (cldfrc(k) &lt; f_one) <span class="keywordflow">then</span></div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;                facclr2d(k-1) = (cldfrc(k-1) - cldfrc(k))               &amp;</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;     &amp;                        / (f_one - cldfrc(k))</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;              facclr2d(k) = f_zero</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;              faccld2d(k) = f_zero</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;              fmax = max(cldfrc(k), cldfrc(k+1))</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;              <span class="keywordflow">if</span> (cldfrc(k-1) &gt; fmax) <span class="keywordflow">then</span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;                facclr1d(k-1) = rat2</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;                facclr2d(k-1) = (cldfrc(k-1) - fmax) / (f_one - fmax)</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;              <span class="keywordflow">elseif</span> (cldfrc(k-1) &lt; fmax) <span class="keywordflow">then</span></div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;                facclr1d(k-1) = (cldfrc(k-1) - cldfrc(k))               &amp;</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;     &amp;                        / (cldfrc(k+1) - cldfrc(k))</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;                facclr1d(k-1) = rat2</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;            <span class="keywordflow">if</span> (facclr1d(k-1)&gt;f_zero .or. facclr2d(k-1)&gt;f_zero) <span class="keywordflow">then</span></div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;              rat1 = f_one</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;              rat2 = f_zero</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;              rat1 = f_zero</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;              rat2 = f_zero</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;            <span class="keywordflow">if</span> (lstcldd(k)) <span class="keywordflow">then</span></div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;              faccld2d(k-1) = (cldfrc(k) - cldfrc(k-1)) / cldfrc(k)</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;              facclr2d(k) = f_zero</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;              faccld2d(k) = f_zero</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;              fmin = min(cldfrc(k), cldfrc(k+1))</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;              <span class="keywordflow">if</span> (cldfrc(k-1) &lt;= fmin) <span class="keywordflow">then</span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;                faccld1d(k-1) = rat1</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;                faccld2d(k-1) = (fmin - cldfrc(k-1)) / fmin</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;                faccld1d(k-1) = (cldfrc(k) - cldfrc(k-1))               &amp;</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;     &amp;                        / (cldfrc(k) - fmin)</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;            <span class="keywordflow">if</span> (faccld1d(k-1)&gt;f_zero .or. faccld2d(k-1)&gt;f_zero) <span class="keywordflow">then</span></div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;              rat1 = f_zero</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;              rat2 = f_one</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;              rat1 = f_zero</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;              rat2 = f_zero</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;          faccmb1d(k-1) = facclr1d(k-1) * faccld2d(k) * cldfrc(k+1)</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;          faccmb2d(k-1) = faccld1d(k-1) * facclr2d(k)                   &amp;</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;     &amp;                  * (f_one - cldfrc(k+1))</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;      <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;        <span class="keywordflow">do</span> k = 0, nlay</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;          toturad(k,ib) = f_zero</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;          totdrad(k,ib) = f_zero</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;          clrurad(k,ib) = f_zero</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;          clrdrad(k,ib) = f_zero</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;      <span class="keywordflow">do</span> k = 0, nlay</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;        totuflux(k) = f_zero</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;        totdflux(k) = f_zero</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;        totuclfl(k) = f_zero</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;        totdclfl(k) = f_zero</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;<span class="comment">!  --- ...  loop over all g-points</span></div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;      <span class="keywordflow">do</span> ig = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a></div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;        ib = <a class="code" href="namespacemodule__radlw__parameters.html#a2c571bd14c9b7982a7968976858c7547">ngb</a>(ig)</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;        radtotd = f_zero</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        radclrd = f_zero</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;        <span class="keywordflow">do</span> k = nlay, 1, -1</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;<span class="comment">!  --- ...  clear sky, gases contribution</span></div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;          odepth = max( f_zero, secdif(ib)*tautot(ig,k) )</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;          <span class="keywordflow">if</span> (odepth &lt;= 0.06) <span class="keywordflow">then</span></div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;            atrgas = odepth - 0.5*odepth*odepth</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;            trng   = f_one - atrgas</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;            gasfac = rec_6 * odepth</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;            tblind = odepth / (bpade + odepth)</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;            itgas = tblint*tblind + 0.5</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;            trng  = exp_tbl(itgas)</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;            atrgas = f_one - trng</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;            gasfac = tfn_tbl(itgas)</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;            odepth = tau_tbl(itgas)</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;          plfrac = fracs(ig,k)</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;          blay = pklay(ib,k)</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;          dplnku = pklev(ib,k  ) - blay</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;          dplnkd = pklev(ib,k-1) - blay</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;          bbdgas = plfrac * (blay + dplnkd*gasfac)</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;          bbugas = plfrac * (blay + dplnku*gasfac)</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;          gassrcd   = bbdgas * atrgas</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;          gassrcu(k)= bbugas * atrgas</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;          trngas(k) = trng</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;<span class="comment">!  --- ...  total sky, gases+clouds contribution</span></div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;          clfr = cldfrc(k)</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;          <span class="keywordflow">if</span> (lstcldd(k)) <span class="keywordflow">then</span></div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;            totradd = clfr * radtotd</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;            clrradd = radtotd - totradd</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;            rad = f_zero</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;          <span class="keywordflow">if</span> (clfr &gt;= eps) <span class="keywordflow">then</span></div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;            odcld = secdif(ib) * taucld(ib,k)</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;            odtot = odepth + odcld</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;            <span class="keywordflow">if</span> (odtot &lt; 0.06) <span class="keywordflow">then</span></div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;              totfac = rec_6 * odtot</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;              atrtot = odtot - 0.5*odtot*odtot</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;              trnt   = f_one - atrtot</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;              tblind = odtot / (bpade + odtot)</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;              ittot  = tblint*tblind + 0.5</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;              totfac = tfn_tbl(ittot)</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;              trnt   = exp_tbl(ittot)</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;              atrtot = f_one - trnt</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;            bbdtot = plfrac * (blay + dplnkd*totfac)</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;            bbutot = plfrac * (blay + dplnku*totfac)</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;            totsrcd   = bbdtot * atrtot</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;            totsrcu(k)= bbutot * atrtot</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;            trntot(k) = trnt</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;            totradd = totradd*trnt + clfr*totsrcd</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;            clrradd = clrradd*trng + (f_one - clfr)*gassrcd</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;            radtotd = totradd + clrradd</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;            totdrad(k-1,ib) = totdrad(k-1,ib) + radtotd</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;            radclrd = radclrd*trng + gassrcd</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;            clrdrad(k-1,ib) = clrdrad(k-1,ib) + radclrd</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;            radmod = rad*(facclr1d(k-1)*trng + faccld1d(k-1)*trnt)      &amp;</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;     &amp;             - faccmb1d(k-1)*gassrcd + faccmb2d(k-1)*totsrcd</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;            rad = -radmod + facclr2d(k-1)*(clrradd + radmod)            &amp;</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;     &amp;                    - faccld2d(k-1)*(totradd - radmod)</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;            totradd = totradd + rad</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;            clrradd = clrradd - rad</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;<span class="comment">!  --- ...  clear layer</span></div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;<span class="comment">!  --- ...  total sky radiance</span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;            radtotd = radtotd*trng + gassrcd</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;            totdrad(k-1,ib) = totdrad(k-1,ib) + radtotd</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;<span class="comment">!  --- ...  clear sky radiance</span></div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;            radclrd = radclrd*trng + gassrcd</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;            clrdrad(k-1,ib) = clrdrad(k-1,ib) + radclrd</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;<span class="keywordflow">          endif</span>   <span class="comment">! end if_clfr_block</span></div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;<span class="keywordflow">        enddo</span>   <span class="comment">! end do_k_loop</span></div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;<span class="comment">!     note: spectral and Lambertian reflection are identical for the</span></div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;<span class="comment">!           diffusivity angle flux integration used here.</span></div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;        reflct = f_one - semiss(ib)</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;        rad0 = semiss(ib) * fracs(ig,1) * pklay(ib,0)</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;        radtotu = rad0 + reflct*radtotd</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;        toturad(0,ib) = toturad(0,ib) + radtotu</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;        radclru = rad0 + reflct*radclrd</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;        clrurad(0,ib) = clrurad(0,ib) + radclru</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;          clfr = cldfrc(k)</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;          trng = trngas(k)</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;          gasu = gassrcu(k)</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;          <span class="keywordflow">if</span> (lstcldu(k)) <span class="keywordflow">then</span></div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;            totradu = clfr * radtotu</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;            clrradu = radtotu - totradu</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;            rad = f_zero</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;          <span class="keywordflow">if</span> (clfr &gt;= eps) <span class="keywordflow">then</span></div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;            trnt = trntot(k)</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;            totu = totsrcu(k)</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;            totradu = totradu*trnt + clfr*totu</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;            clrradu = clrradu*trng + (f_one - clfr)*gasu</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;            radtotu = totradu + clrradu</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;            toturad(k,ib) = toturad(k,ib) + radtotu</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;            radclru = radclru*trng + gasu</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;            clrurad(k,ib) = clrurad(k,ib) + radclru</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;            radmod = rad*(facclr1u(k+1)*trng + faccld1u(k+1)*trnt)      &amp;</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;     &amp;             - faccmb1u(k+1)*gasu + faccmb2u(k+1)*totu</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;            rad = -radmod + facclr2u(k+1)*(clrradu + radmod)            &amp;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;     &amp;                    - faccld2u(k+1)*(totradu - radmod)</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;            totradu = totradu + rad</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;            clrradu = clrradu - rad</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;<span class="comment">!  --- ...  clear layer</span></div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;<span class="comment">!  --- ...  total sky radiance</span></div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;            radtotu = radtotu*trng + gasu</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;            toturad(k,ib) = toturad(k,ib) + radtotu</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;<span class="comment">!  --- ...  clear sky radiance</span></div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;            radclru = radclru*trng + gasu</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;            clrurad(k,ib) = clrurad(k,ib) + radclru</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;<span class="keywordflow">          endif</span>   <span class="comment">! end if_clfr_block</span></div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;<span class="keywordflow">        enddo</span>   <span class="comment">! end do_k_loop</span></div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;<span class="keywordflow">      enddo</span>   <span class="comment">! end do_ig_loop</span></div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;      flxfac = wtdiff * fluxfac</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;      <span class="keywordflow">do</span> k = 0, nlay</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;        <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;          totuflux(k) = totuflux(k) + toturad(k,ib)</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;          totdflux(k) = totdflux(k) + totdrad(k,ib)</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;          totuclfl(k) = totuclfl(k) + clrurad(k,ib)</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;          totdclfl(k) = totdclfl(k) + clrdrad(k,ib)</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;        totuflux(k) = totuflux(k) * flxfac</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;        totdflux(k) = totdflux(k) * flxfac</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;        totuclfl(k) = totuclfl(k) * flxfac</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;        totdclfl(k) = totdclfl(k) * flxfac</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;<span class="comment">!  --- ...  calculate net fluxes and heating rates</span></div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;      fnet(0) = totuflux(0) - totdflux(0)</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;        rfdelp(k) = heatfac / delp(k)</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;        fnet(k) = totuflux(k) - totdflux(k)</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;        htr(k) = (fnet(k-1) - fnet(k)) * rfdelp(k)</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;<span class="comment">!! --- ...  optional clear sky heating rates</span></div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;      <span class="keywordflow">if</span> ( lhlw0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;        fnetc(0) = totuclfl(0) - totdclfl(0)</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;          fnetc(k) = totuclfl(k) - totdclfl(k)</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;          htrcl(k) = (fnetc(k-1) - fnetc(k)) * rfdelp(k)</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;<span class="comment">!! --- ...  optional spectral band heating rates</span></div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;      <span class="keywordflow">if</span> ( lhlwb ) <span class="keywordflow">then</span></div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;        <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;          fnet(0) = (toturad(0,ib) - totdrad(0,ib)) * flxfac</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;            fnet(k) = (toturad(k,ib) - totdrad(k,ib)) * flxfac</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;            htrb(k,ib) = (fnet(k-1) - fnet(k)) * rfdelp(k)</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;<span class="comment">! .................................</span></div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radlw__main.html#ga8d4a6fecb4ad25468e91661a79d4ca20">rtrnmr</a></div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;<span class="comment">! ---------------------------------</span></div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;<span class="comment">! ---------------------------------</span></div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radlw__main.html#ga1445abd529b76abe7ffb80e843d9fafc">rtrnmc</a>                                                 &amp;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;     &amp;     ( semiss,delp,cldfmc,taucld,tautot,pklay,pklev,              &amp; <span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;     &amp;       fracs,secdif, nlay,nlp1,                                   &amp;</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;     &amp;       totuflux,totdflux,htr, totuclfl,totdclfl,htrcl, htrb       &amp; <span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;     &amp;     )</div><div class="line"><a name="l03271"></a><span class="lineno"><a class="line" href="group__module__radlw__main.html#ga1445abd529b76abe7ffb80e843d9fafc"> 3271</a></span>&#160;</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;<span class="comment">!  ===================  program usage description  ===================  !</span></div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;<span class="comment">! purpose:  compute the upward/downward radiative fluxes, and heating   !</span></div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;<span class="comment">! rates for both clear or cloudy atmosphere.  clouds are treated with   !</span></div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;<span class="comment">! the mcica stochastic approach.                                        !</span></div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;<span class="comment">! subprograms called:  none                                             !</span></div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;<span class="comment">!  inputs:                                                     -size-   !</span></div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;<span class="comment">!   semiss  - real, lw surface emissivity                         nbands!</span></div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;<span class="comment">!   delp    - real, layer pressure thickness (mb)                  nlay !</span></div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;<span class="comment">!   cldfmc  - real, layer cloud fraction (sub-column)        ngptlw*nlay!</span></div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;<span class="comment">!   taucld  - real, layer cloud opt depth                    nbands*nlay!</span></div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;<span class="comment">!   tautot  - real, total optical depth (gas+aerosols)       ngptlw*nlay!</span></div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;<span class="comment">!   pklay   - real, integrated planck func at lay temp     nbands*0:nlay!</span></div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;<span class="comment">!   pklev   - real, integrated planck func at lev temp     nbands*0:nlay!</span></div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;<span class="comment">!   fracs   - real, planck fractions                         ngptlw*nlay!</span></div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;<span class="comment">!   secdif  - real, secant of diffusivity angle                   nbands!</span></div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;<span class="comment">!   nlay    - integer, number of vertical layers                    1   !</span></div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;<span class="comment">!   nlp1    - integer, number of vertical levels (interfaces)       1   !</span></div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;<span class="comment">!  outputs:                                                             !</span></div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;<span class="comment">!   totuflux- real, total sky upward flux (w/m2)                 0:nlay !</span></div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;<span class="comment">!   totdflux- real, total sky downward flux (w/m2)               0:nlay !</span></div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;<span class="comment">!   htr     - real, total sky heating rate (k/sec or k/day)        nlay !</span></div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;<span class="comment">!   totuclfl- real, clear sky upward flux (w/m2)                 0:nlay !</span></div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;<span class="comment">!   totdclfl- real, clear sky downward flux (w/m2)               0:nlay !</span></div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;<span class="comment">!   htrcl   - real, clear sky heating rate (k/sec or k/day)        nlay !</span></div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;<span class="comment">!   htrb    - real, spectral band lw heating rate (k/day)    nlay*nbands!</span></div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;<span class="comment">!  module veriables:                                                    !</span></div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;<span class="comment">!   ngb     - integer, band index for each g-value                ngptlw!</span></div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;<span class="comment">!   fluxfac - real, conversion factor for fluxes (pi*2.e4)           1  !</span></div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;<span class="comment">!   heatfac - real, conversion factor for heating rates (g/cp*1e-2)  1  !</span></div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;<span class="comment">!   tblint  - real, conversion factor for look-up tbl (float(ntbl)   1  !</span></div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;<span class="comment">!   bpade   - real, pade approx constant (1/0.278)                   1  !</span></div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;<span class="comment">!   wtdiff  - real, weight for radiance to flux conversion           1  !</span></div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;<span class="comment">!   ntbl    - integer, dimension of look-up tables                   1  !</span></div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;<span class="comment">!   tau_tbl - real, clr-sky opt dep lookup table                 0:ntbl !</span></div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;<span class="comment">!   exp_tbl - real, transmittance lookup table                   0:ntbl !</span></div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;<span class="comment">!   tfn_tbl - real, tau transition function                      0:ntbl !</span></div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;<span class="comment">!  local variables:                                                     !</span></div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;<span class="comment">!    itgas  - integer, index for gases contribution look-up table    1  !</span></div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;<span class="comment">!    ittot  - integer, index for gases plus clouds  look-up table    1  !</span></div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;<span class="comment">!    reflct - real, surface reflectance                              1  !</span></div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;<span class="comment">!    atrgas - real, gaseous absorptivity                             1  !</span></div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;<span class="comment">!    atrtot - real, gaseous and cloud absorptivity                   1  !</span></div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;<span class="comment">!    odcld  - real, cloud optical depth                              1  !</span></div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;<span class="comment">!    efclrfr- real, effective clear sky fraction (1-efcldfr)        nlay!</span></div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;<span class="comment">!    odepth - real, optical depth of gaseous only                    1  !</span></div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;<span class="comment">!    odtot  - real, optical depth of gas and cloud                   1  !</span></div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;<span class="comment">!    gasfac - real, gas-only pade factor, used for planck function   1  !</span></div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;<span class="comment">!    totfac - real, gas and cloud pade factor, used for planck fn    1  !</span></div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;<span class="comment">!    bbdgas - real, gas-only planck function for downward rt         1  !</span></div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;<span class="comment">!    bbugas - real, gas-only planck function for upward rt           1  !</span></div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;<span class="comment">!    bbdtot - real, gas and cloud planck function for downward rt    1  !</span></div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;<span class="comment">!    bbutot - real, gas and cloud planck function for upward rt      1  !</span></div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;<span class="comment">!    gassrcu- real, upwd source radiance due to gas                 nlay!</span></div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;<span class="comment">!    totsrcu- real, upwd source radiance due to gas+cld             nlay!</span></div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;<span class="comment">!    gassrcd- real, dnwd source radiance due to gas                  1  !</span></div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;<span class="comment">!    totsrcd- real, dnwd source radiance due to gas+cld              1  !</span></div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;<span class="comment">!    radtotu- real, spectrally summed total sky upwd radiance        1  !</span></div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;<span class="comment">!    radclru- real, spectrally summed clear sky upwd radiance        1  !</span></div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;<span class="comment">!    radtotd- real, spectrally summed total sky dnwd radiance        1  !</span></div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;<span class="comment">!    radclrd- real, spectrally summed clear sky dnwd radiance        1  !</span></div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;<span class="comment">!    toturad- real, total sky upward radiance by layer     0:nlay*nbands!</span></div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;<span class="comment">!    clrurad- real, clear sky upward radiance by layer     0:nlay*nbands!</span></div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;<span class="comment">!    totdrad- real, total sky downward radiance by layer   0:nlay*nbands!</span></div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;<span class="comment">!    clrdrad- real, clear sky downward radiance by layer   0:nlay*nbands!</span></div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;<span class="comment">!    fnet   - real, net longwave flux (w/m2)                     0:nlay !</span></div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;<span class="comment">!    fnetc  - real, clear sky net longwave flux (w/m2)           0:nlay !</span></div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;<span class="comment">!  original code description                                            !</span></div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;<span class="comment">!  original version:   e. j. mlawer, et al. rrtm_v3.0                   !</span></div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;<span class="comment">!  revision for gcms:  michael j. iacono; october, 2002                 !</span></div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;<span class="comment">!  revision for f90:   michael j. iacono; june, 2006                    !</span></div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;<span class="comment">!  this program calculates the upward fluxes, downward fluxes, and      !</span></div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;<span class="comment">!  heating rates for an arbitrary clear or cloudy atmosphere. the input !</span></div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;<span class="comment">!  to this program is the atmospheric profile, all Planck function      !</span></div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;<span class="comment">!  information, and the cloud fraction by layer.  a variable diffusivity!</span></div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;<span class="comment">!  angle (secdif) is used for the angle integration. bands 2-3 and 5-9  !</span></div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;<span class="comment">!  use a value for secdif that varies from 1.50 to 1.80 as a function   !</span></div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;<span class="comment">!  of the column water vapor, and other bands use a value of 1.66.  the !</span></div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;<span class="comment">!  gaussian weight appropriate to this angle (wtdiff=0.5) is applied    !</span></div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;<span class="comment">!  here.  note that use of the emissivity angle for the flux integration!</span></div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;<span class="comment">!  can cause errors of 1 to 4 W/m2 within cloudy layers.                !</span></div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;<span class="comment">!  clouds are treated with the mcica stochastic approach and            !</span></div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;<span class="comment">!  maximum-random cloud overlap.                                        !</span></div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;<span class="comment">!  ======================  end of description block  =================  !</span></div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands)</span>, <span class="keywordtype">intent(in)</span> :: semiss,   &amp;</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;     &amp;       secdif</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>,   <span class="keywordtype">intent(in)</span> :: delp</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands,nlay)</span>,<span class="keywordtype">intent(in)</span>:: taucld</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(ngptlw,nlay)</span>,<span class="keywordtype">intent(in)</span>:: fracs, &amp;</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;     &amp;       tautot, cldfmc</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands,0:nlay)</span>, <span class="keywordtype">intent(in)</span> ::    &amp;</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;     &amp;       pklev, pklay</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(out)</span> :: htr, htrcl</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,nbands)</span>,<span class="keywordtype">intent(out)</span> :: htrb</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlay)</span>, <span class="keywordtype">intent(out)</span> ::          &amp;</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;     &amp;       totuflux, totdflux, totuclfl, totdclfl</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: rec_6 = 0.166667</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlay,nbands)</span> :: clrurad,       &amp;</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;     &amp;       clrdrad, toturad, totdrad</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>   :: gassrcu, totsrcu,     &amp;</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;     &amp;       trngas, efclrfr, rfdelp</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(0:nlay)</span> :: fnet, fnetc</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: totsrcd, gassrcd, tblind, odepth, odtot, &amp;</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;     &amp;       odcld, atrtot, atrgas, reflct, totfac, gasfac, flxfac,     &amp;</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;     &amp;       plfrac, blay, bbdgas, bbdtot, bbugas, bbutot, dplnku,      &amp;</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;     &amp;       dplnkd, radtotu, radclru, radtotd, radclrd, rad0,          &amp;</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;     &amp;       clfm, trng, gasu</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;      <span class="keywordtype">integer</span> :: ittot, itgas, ib, ig, k</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;      <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;        <span class="keywordflow">do</span> k = 0, nlay</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;          toturad(k,ib) = f_zero</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;          totdrad(k,ib) = f_zero</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;          clrurad(k,ib) = f_zero</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;          clrdrad(k,ib) = f_zero</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;      <span class="keywordflow">do</span> k = 0, nlay</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;        totuflux(k) = f_zero</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;        totdflux(k) = f_zero</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;        totuclfl(k) = f_zero</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;        totdclfl(k) = f_zero</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;<span class="comment">!  --- ...  loop over all g-points</span></div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;      <span class="keywordflow">do</span> ig = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a></div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;        ib = <a class="code" href="namespacemodule__radlw__parameters.html#a2c571bd14c9b7982a7968976858c7547">ngb</a>(ig)</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;        radtotd = f_zero</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;        radclrd = f_zero</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;        <span class="keywordflow">do</span> k = nlay, 1, -1</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;<span class="comment">!  --- ...  clear sky, gases contribution</span></div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;          odepth = max( f_zero, secdif(ib)*tautot(ig,k) )</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;          <span class="keywordflow">if</span> (odepth &lt;= 0.06) <span class="keywordflow">then</span></div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;            atrgas = odepth - 0.5*odepth*odepth</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;            trng   = f_one - atrgas</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;            gasfac = rec_6 * odepth</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;            tblind = odepth / (bpade + odepth)</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;            itgas = tblint*tblind + 0.5</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;            trng  = exp_tbl(itgas)</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;            atrgas = f_one - trng</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;            gasfac = tfn_tbl(itgas)</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;            odepth = tau_tbl(itgas)</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;          plfrac = fracs(ig,k)</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;          blay = pklay(ib,k)</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;          dplnku = pklev(ib,k  ) - blay</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;          dplnkd = pklev(ib,k-1) - blay</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;          bbdgas = plfrac * (blay + dplnkd*gasfac)</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;          bbugas = plfrac * (blay + dplnku*gasfac)</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;          gassrcd= bbdgas * atrgas</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;          gassrcu(k)= bbugas * atrgas</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;          trngas(k) = trng</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;<span class="comment">!  --- ...  total sky, gases+clouds contribution</span></div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;          clfm = cldfmc(ig,k)</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;          <span class="keywordflow">if</span> (clfm &gt;= eps) <span class="keywordflow">then</span></div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;<span class="comment">!  --- ...  cloudy layer</span></div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;            odcld = secdif(ib) * taucld(ib,k)</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;            efclrfr(k) = f_one - (f_one - exp(-odcld))*clfm</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;            odtot = odepth + odcld</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;            <span class="keywordflow">if</span> (odtot &lt; 0.06) <span class="keywordflow">then</span></div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;              totfac = rec_6 * odtot</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;              atrtot = odtot - 0.5*odtot*odtot</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;              tblind = odtot / (bpade + odtot)</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;              ittot  = tblint*tblind + 0.5</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;              totfac = tfn_tbl(ittot)</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;              atrtot = f_one - exp_tbl(ittot)</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;            bbdtot = plfrac * (blay + dplnkd*totfac)</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;            bbutot = plfrac * (blay + dplnku*totfac)</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;            totsrcd= bbdtot * atrtot</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;            totsrcu(k)= bbutot * atrtot</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;<span class="comment">!  --- ...  total sky radiance</span></div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;            radtotd = radtotd*trng*efclrfr(k) + gassrcd                 &amp;</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;     &amp;              + clfm*(totsrcd - gassrcd)</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;            totdrad(k-1,ib) = totdrad(k-1,ib) + radtotd</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;<span class="comment">!  --- ...  clear sky radiance</span></div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;            radclrd = radclrd*trng + gassrcd</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;            clrdrad(k-1,ib) = clrdrad(k-1,ib) + radclrd</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;<span class="comment">!  --- ...  clear layer</span></div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;<span class="comment">!  --- ...  total sky radiance</span></div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;            radtotd = radtotd*trng + gassrcd</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;            totdrad(k-1,ib) = totdrad(k-1,ib) + radtotd</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;<span class="comment">!  --- ...  clear sky radiance</span></div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;            radclrd = radclrd*trng + gassrcd</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;            clrdrad(k-1,ib) = clrdrad(k-1,ib) + radclrd</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;<span class="keywordflow">          endif</span>   <span class="comment">! end if_clfm_block</span></div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;<span class="keywordflow">        enddo</span>   <span class="comment">! end do_k_loop</span></div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;<span class="comment">!     note: spectral and Lambertian reflection are identical for the</span></div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;<span class="comment">!           diffusivity angle flux integration used here.</span></div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;        reflct = f_one - semiss(ib)</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;        rad0 = semiss(ib) * fracs(ig,1) * pklay(ib,0)</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;        radtotu = rad0 + reflct*radtotd</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;        toturad(0,ib) = toturad(0,ib) + radtotu</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;        radclru = rad0 + reflct*radclrd</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;        clrurad(0,ib) = clrurad(0,ib) + radclru</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;<span class="comment">!          toturad holds summed radiance for total sky stream</span></div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;<span class="comment">!          clrurad holds summed radiance for clear sky stream</span></div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;          clfm = cldfmc(ig,k)</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;          trng = trngas(k)</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;          gasu = gassrcu(k)</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;          <span class="keywordflow">if</span> (clfm &gt; eps) <span class="keywordflow">then</span></div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;<span class="comment">!  --- ...  cloudy layer</span></div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;<span class="comment">!  --- ... total sky radiance</span></div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;            radtotu = radtotu*trng*efclrfr(k) + gasu                    &amp;</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;     &amp;              + clfm*(totsrcu(k) - gasu)</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;            toturad(k,ib) = toturad(k,ib) + radtotu</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;<span class="comment">!  --- ... clear sky radiance</span></div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;            radclru = radclru*trng + gasu</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;            clrurad(k,ib) = clrurad(k,ib) + radclru</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;<span class="comment">!  --- ...  clear layer</span></div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;<span class="comment">!  --- ... total sky radiance</span></div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;            radtotu = radtotu*trng + gasu</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;            toturad(k,ib) = toturad(k,ib) + radtotu</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;<span class="comment">!  --- ... clear sky radiance</span></div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;            radclru = radclru*trng + gasu</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;            clrurad(k,ib) = clrurad(k,ib) + radclru</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;<span class="keywordflow">          endif</span>   <span class="comment">! end if_clfm_block</span></div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;<span class="keywordflow">        enddo</span>   <span class="comment">! end do_k_loop</span></div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;<span class="keywordflow">      enddo</span>   <span class="comment">! end do_ig_loop</span></div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;      flxfac = wtdiff * fluxfac</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;      <span class="keywordflow">do</span> k = 0, nlay</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;        <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;          totuflux(k) = totuflux(k) + toturad(k,ib)</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;          totdflux(k) = totdflux(k) + totdrad(k,ib)</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;          totuclfl(k) = totuclfl(k) + clrurad(k,ib)</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;          totdclfl(k) = totdclfl(k) + clrdrad(k,ib)</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;        totuflux(k) = totuflux(k) * flxfac</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;        totdflux(k) = totdflux(k) * flxfac</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;        totuclfl(k) = totuclfl(k) * flxfac</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;        totdclfl(k) = totdclfl(k) * flxfac</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;<span class="comment">!  --- ...  calculate net fluxes and heating rates</span></div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;      fnet(0) = totuflux(0) - totdflux(0)</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;      <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;        rfdelp(k) = heatfac / delp(k)</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;        fnet(k) = totuflux(k) - totdflux(k)</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;        htr(k) = (fnet(k-1) - fnet(k)) * rfdelp(k)</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;<span class="comment">!! --- ...  optional clear sky heating rates</span></div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;      <span class="keywordflow">if</span> ( lhlw0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;        fnetc(0) = totuclfl(0) - totdclfl(0)</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;          fnetc(k) = totuclfl(k) - totdclfl(k)</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;          htrcl(k) = (fnetc(k-1) - fnetc(k)) * rfdelp(k)</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;<span class="comment">!! --- ...  optional spectral band heating rates</span></div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;      <span class="keywordflow">if</span> ( lhlwb ) <span class="keywordflow">then</span></div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;        <span class="keywordflow">do</span> ib = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">nbands</a></div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;          fnet(0) = (toturad(0,ib) - totdrad(0,ib)) * flxfac</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;          <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;            fnet(k) = (toturad(k,ib) - totdrad(k,ib)) * flxfac</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;            htrb(k,ib) = (fnet(k-1) - fnet(k)) * rfdelp(k)</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radlw__main.html#ga1445abd529b76abe7ffb80e843d9fafc">rtrnmc</a></div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radlw__main.html#gab09f986fb87e796a30c889086c92aeb1">taumol</a>                                                 &amp;</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;     &amp;     ( laytrop,pavel,coldry,colamt,colbrd,wx,tauaer,              &amp; <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;     &amp;       rfrate,fac00,fac01,fac10,fac11,jp,jt,jt1,                  &amp;</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;     &amp;       selffac,selffrac,indself,forfac,forfrac,indfor,            &amp;</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;     &amp;       minorfrac,scaleminor,scaleminorn2,indminor,                &amp;</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;     &amp;       nlay,                                                      &amp;</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;     &amp;       fracs, tautot                                              &amp; <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;     &amp;     )</div><div class="line"><a name="l03688"></a><span class="lineno"><a class="line" href="group__module__radlw__main.html#gab09f986fb87e796a30c889086c92aeb1"> 3688</a></span>&#160;</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;<span class="comment">!  ************    original subprogram description    ***************   !</span></div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;<span class="comment">!                  optical depths developed for the                     !</span></div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;<span class="comment">!                rapid radiative transfer model (rrtm)                  !</span></div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;<span class="comment">!            atmospheric and environmental research, inc.               !</span></div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;<span class="comment">!                        131 hartwell avenue                            !</span></div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;<span class="comment">!                        lexington, ma 02421                            !</span></div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;<span class="comment">!                           eli j. mlawer                               !</span></div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;<span class="comment">!                         jennifer delamere                             !</span></div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;<span class="comment">!                         steven j. taubman                             !</span></div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;<span class="comment">!                         shepard a. clough                             !</span></div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;<span class="comment">!                       email:  mlawer@aer.com                          !</span></div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;<span class="comment">!                       email:  jdelamer@aer.com                        !</span></div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;<span class="comment">!        the authors wish to acknowledge the contributions of the       !</span></div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;<span class="comment">!        following people:  karen cady-pereira, patrick d. brown,       !</span></div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;<span class="comment">!        michael j. iacono, ronald e. farren, luke chen,                !</span></div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;<span class="comment">!        robert bergstrom.                                              !</span></div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;<span class="comment">!  revision for g-point reduction: michael j. iacono; aer, inc.         !</span></div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;<span class="comment">!     taumol                                                            !</span></div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;<span class="comment">!     this file contains the subroutines taugbn (where n goes from      !</span></div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;<span class="comment">!     1 to 16).  taugbn calculates the optical depths and planck        !</span></div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;<span class="comment">!     fractions per g-value and layer for band n.                       !</span></div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;<span class="comment">!  *******************************************************************  !</span></div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;<span class="comment">!  ==================   program usage description   ==================  !</span></div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;<span class="comment">!    call  taumol                                                       !</span></div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;<span class="comment">!       inputs:                                                         !</span></div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;<span class="comment">!          ( laytrop,pavel,coldry,colamt,colbrd,wx,tauaer,              !</span></div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;<span class="comment">!            rfrate,fac00,fac01,fac10,fac11,jp,jt,jt1,                  !</span></div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;<span class="comment">!            selffac,selffrac,indself,forfac,forfrac,indfor,            !</span></div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;<span class="comment">!            minorfrac,scaleminor,scaleminorn2,indminor,                !</span></div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;<span class="comment">!            nlay,                                                      !</span></div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;<span class="comment">!       outputs:                                                        !</span></div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;<span class="comment">!            fracs, tautot )                                            !</span></div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;<span class="comment">!  subprograms called:  taugb## (## = 01 -16)                           !</span></div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;<span class="comment">!  ====================  defination of variables  ====================  !</span></div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;<span class="comment">!  inputs:                                                        size  !</span></div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;<span class="comment">!     laytrop   - integer, tropopause layer index (unitless)        1   !</span></div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;<span class="comment">!                   layer at which switch is made for key species       !</span></div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;<span class="comment">!     pavel     - real, layer pressures (mb)                       nlay !</span></div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;<span class="comment">!     coldry    - real, column amount for dry air (mol/cm2)        nlay !</span></div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;<span class="comment">!     colamt    - real, column amounts of h2o, co2, o3, n2o, ch4,       !</span></div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;<span class="comment">!                   o2, co (mol/cm**2)                       nlay*maxgas!</span></div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;<span class="comment">!     colbrd    - real, column amount of broadening gases          nlay !</span></div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;<span class="comment">!     wx        - real, cross-section amounts(mol/cm2)      nlay*maxxsec!</span></div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;<span class="comment">!     tauaer    - real, aerosol optical depth               nbands*nlay !</span></div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;<span class="comment">!     rfrate    - real, reference ratios of binary species parameter    !</span></div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;<span class="comment">!     (:,m,:)m=1-h2o/co2,2-h2o/o3,3-h2o/n2o,4-h2o/ch4,5-n2o/co2,6-o3/co2!</span></div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;<span class="comment">!     (:,:,n)n=1,2: the rates of ref press at the 2 sides of the layer  !</span></div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;<span class="comment">!                                                          nlay*nrates*2!</span></div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;<span class="comment">!     facij     - real, factors multiply the reference ks, i,j of 0/1   !</span></div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;<span class="comment">!                   for lower/higher of the 2 appropriate temperatures  !</span></div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;<span class="comment">!                   and altitudes                                  nlay !</span></div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;<span class="comment">!     jp        - real, index of lower reference pressure          nlay !</span></div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;<span class="comment">!     jt, jt1   - real, indices of lower reference temperatures    nlay !</span></div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;<span class="comment">!                   for pressure levels jp and jp+1, respectively       !</span></div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;<span class="comment">!     selffac   - real, scale factor for water vapor self-continuum     !</span></div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;<span class="comment">!                   equals (water vapor density)/(atmospheric density   !</span></div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;<span class="comment">!                   at 296k and 1013 mb)                           nlay !</span></div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;<span class="comment">!     selffrac  - real, factor for temperature interpolation of         !</span></div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;<span class="comment">!                   reference water vapor self-continuum data      nlay !</span></div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;<span class="comment">!     indself   - integer, index of lower reference temperature for     !</span></div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;<span class="comment">!                   the self-continuum interpolation               nlay !</span></div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;<span class="comment">!     forfac    - real, scale factor for w. v. foreign-continuum   nlay !</span></div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;<span class="comment">!     forfrac   - real, factor for temperature interpolation of         !</span></div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;<span class="comment">!                   reference w.v. foreign-continuum data          nlay !</span></div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;<span class="comment">!     indfor    - integer, index of lower reference temperature for     !</span></div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;<span class="comment">!                   the foreign-continuum interpolation            nlay !</span></div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;<span class="comment">!     minorfrac - real, factor for minor gases                     nlay !</span></div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;<span class="comment">!     scaleminor,scaleminorn2                                           !</span></div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;<span class="comment">!               - real, scale factors for minor gases              nlay !</span></div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;<span class="comment">!     indminor  - integer, index of lower reference temperature for     !</span></div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;<span class="comment">!                   minor gases                                    nlay !</span></div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;<span class="comment">!     nlay      - integer, total number of layers                   1   !</span></div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;<span class="comment">!  outputs:                                                             !</span></div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;<span class="comment">!     fracs     - real, planck fractions                     ngptlw,nlay!</span></div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;<span class="comment">!     tautot    - real, total optical depth (gas+aerosols)   ngptlw,nlay!</span></div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;<span class="comment">!  internal variables:                                                  !</span></div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;<span class="comment">!     ng##      - integer, number of g-values in band ## (##=01-16) 1   !</span></div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;<span class="comment">!     nspa      - integer, for lower atmosphere, the number of ref      !</span></div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;<span class="comment">!                   atmos, each has different relative amounts of the   !</span></div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;<span class="comment">!                   key species for the band                      nbands!</span></div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;<span class="comment">!     nspb      - integer, same but for upper atmosphere          nbands!</span></div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;<span class="comment">!     absa      - real, k-values for lower ref atmospheres (no w.v.     !</span></div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;<span class="comment">!                   self-continuum) (cm**2/molecule)  nspa(##)*5*13*ng##!</span></div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;<span class="comment">!     absb      - real, k-values for high ref atmospheres (all sources) !</span></div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;<span class="comment">!                   (cm**2/molecule)               nspb(##)*5*13:59*ng##!</span></div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;<span class="comment">!     ka_m&#39;mgas&#39;- real, k-values for low ref atmospheres minor species  !</span></div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;<span class="comment">!                   (cm**2/molecule)                          mmn##*ng##!</span></div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;<span class="comment">!     kb_m&#39;mgas&#39;- real, k-values for high ref atmospheres minor species !</span></div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;<span class="comment">!                   (cm**2/molecule)                          mmn##*ng##!</span></div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;<span class="comment">!     selfref   - real, k-values for w.v. self-continuum for ref atmos  !</span></div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;<span class="comment">!                   used below laytrop (cm**2/mol)               10*ng##!</span></div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;<span class="comment">!     forref    - real, k-values for w.v. foreign-continuum for ref atmos</span></div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;<span class="comment">!                   used below/above laytrop (cm**2/mol)          4*ng##!</span></div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;<span class="comment">!  ******************************************************************   !</span></div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, laytrop</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(in)</span> :: jp, jt, jt1, indself,     &amp;</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;     &amp;       indfor, indminor</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(in)</span> :: pavel,      &amp;</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;     &amp;       coldry, colbrd, fac00, fac01, fac10, fac11, selffac,       &amp;</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;     &amp;       selffrac, forfac, forfrac, minorfrac, scaleminor,          &amp;</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;     &amp;       scaleminorn2</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,maxgas)</span>, <span class="keywordtype">intent(in)</span>:: colamt</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,maxxsec)</span>,<span class="keywordtype">intent(in)</span>:: wx</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nbands,nlay)</span>, <span class="keywordtype">intent(in)</span>:: tauaer</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(nlay,nrates,2)</span>, <span class="keywordtype">intent(in)</span> ::    &amp;</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;     &amp;       rfrate</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(ngptlw,nlay)</span>, <span class="keywordtype">intent(out)</span> ::     &amp;</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;     &amp;       fracs, tautot</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;<span class="comment">!  ---  locals</span></div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(ngptlw,nlay)</span> :: taug</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;      <span class="keywordtype">integer</span> :: ib, ig, k</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;      <span class="keyword">call </span><a class="code" href="group__module__radlw__main.html#ga001d1bcd17533f7f920f859ff9a4e60f">taugb01</a></div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#a926415cb51870dda9a90883e01a2ee38">taugb02</a></div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#a45e39b507d1fc031c80d9c7f06905d4a">taugb03</a></div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#ae69174bcf1a87dc7a5baffac69797d07">taugb04</a></div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#a92653ffcd20ff247a00eaf3339cba6df">taugb05</a></div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#a7190d415614aa35deefacff1041d4719">taugb06</a></div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#a2208d86ae0712a0ca426bbe96de825bc">taugb07</a></div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#a1447d5bda5b521d27171e61881684183">taugb08</a></div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#a889abbaaa2d421c0c3dc820e2004414d">taugb09</a></div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#a74c1cb8390daff1e5ce5e863c50b7873">taugb10</a></div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#a573fd5b3580d6bbf5bfa2f01ee547034">taugb11</a></div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#ae56eaa9e3b897ca235d4d6b271cc1e47">taugb12</a></div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#a2ac7254d2dcff516e8e44b8b679302c0">taugb13</a></div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#a26140cbe1a3d6119b56cf5c2d539670e">taugb14</a></div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#a93b5c0ae0525697ffffb6228581a301c">taugb15</a></div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;      <span class="keyword">call </span><a class="code" href="radlw__main_8f.html#a942ce0031745cd1b3b4ebc3915970554">taugb16</a></div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;<span class="comment">!  ---  combine gaseous and aerosol optical depths</span></div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;      <span class="keywordflow">do</span> ig = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">ngptlw</a></div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;        ib = <a class="code" href="namespacemodule__radlw__parameters.html#a2c571bd14c9b7982a7968976858c7547">ngb</a>(ig)</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;        <span class="keywordflow">do</span> k = 1, nlay</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;          tautot(ig,k) = taug(ig,k) + tauaer(ib,k)</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;<span class="comment">! =================</span></div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;      <span class="keyword">contains</span></div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;<span class="comment">! =================</span></div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radlw__main.html#ga001d1bcd17533f7f920f859ff9a4e60f">taugb01</a></div><div class="line"><a name="l03867"></a><span class="lineno"><a class="line" href="group__module__radlw__main.html#ga001d1bcd17533f7f920f859ff9a4e60f"> 3867</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;<span class="comment">!  written by eli j. mlawer, atmospheric &amp; environmental research.     !</span></div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;<span class="comment">!  revised by michael j. iacono, atmospheric &amp; environmental research. !</span></div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;<span class="comment">!     band 1:  10-350 cm-1 (low key - h2o; low minor - n2)             !</span></div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;<span class="comment">!                          (high key - h2o; high minor - n2)           !</span></div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;<span class="comment">!  compute the optical depth by interpolating in ln(pressure) and      !</span></div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;<span class="comment">!  temperature.  below laytrop, the water vapor self-continuum and     !</span></div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;<span class="comment">!  foreign continuum is interpolated (in temperature) separately.      !</span></div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb01.html">module_radlw_kgb01</a></div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;     &amp;           indm, indmp, ig</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: pp, corradj, scalen2, tauself, taufor,   &amp;</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;     &amp;       taun2</div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;<span class="comment">!  ---  minor gas mapping levels:</span></div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;<span class="comment">!     lower - n2, p = 142.5490 mbar, t = 215.70 k</span></div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;<span class="comment">!     upper - n2, p = 142.5490 mbar, t = 215.70 k</span></div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(1) + 1</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(1) + 1</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;        inds = indself(k)</div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;</div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;        pp = pavel(k)</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;        scalen2 = colbrd(k) * scaleminorn2(k)</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;        <span class="keywordflow">if</span> (pp &lt; 250.0) <span class="keywordflow">then</span></div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;          corradj = f_one - 0.15 * (250.0-pp) / 154.4</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;          corradj = f_one</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng01</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;          tauself = selffac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga14c7cc68b26c0ab1fdfda6faa2d485d5">selfref</a>(ig,inds) + selffrac(k)        &amp;</div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga14c7cc68b26c0ab1fdfda6faa2d485d5">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#ga14c7cc68b26c0ab1fdfda6faa2d485d5">selfref</a>(ig,inds)))</div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#gacd70a32f88808dc40c39edee5b76adbe">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gacd70a32f88808dc40c39edee5b76adbe">forref</a>(ig,indfp) -  <a class="code" href="group__module__radlw__kgbnn.html#gacd70a32f88808dc40c39edee5b76adbe">forref</a>(ig,indf))) </div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;          taun2   = scalen2 * (ka_mn2(ig,indm) + minorfrac(k)           &amp;</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;     &amp;            * (ka_mn2(ig,indmp) - ka_mn2(ig,indm)))</div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;          taug(ig,k) = corradj * (colamt(k,1)                           &amp;</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;     &amp;            * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#gacdbe767d50d503c4a89d4042dd0dee8e">absa</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#gacdbe767d50d503c4a89d4042dd0dee8e">absa</a>(ig,ind0p)   &amp;</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;     &amp;            +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#gacdbe767d50d503c4a89d4042dd0dee8e">absa</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#gacdbe767d50d503c4a89d4042dd0dee8e">absa</a>(ig,ind1p))  &amp;</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;     &amp;            + tauself + taufor + taun2)</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;          fracs(ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga0bca660247ac37483cd55c6936056631">fracrefa</a>(ig)</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;</div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(1) + 1</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(1) + 1</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;</div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;</div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;        scalen2 = colbrd(k) * scaleminorn2(k)</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;        corradj = f_one - 0.15 * (pavel(k) / 95.6)</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;</div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng01</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;          taufor = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#gacd70a32f88808dc40c39edee5b76adbe">forref</a>(ig,indf) + forfrac(k)            &amp;</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;     &amp;           * (<a class="code" href="group__module__radlw__kgbnn.html#gacd70a32f88808dc40c39edee5b76adbe">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#gacd70a32f88808dc40c39edee5b76adbe">forref</a>(ig,indf))) </div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;          taun2  = scalen2 * (kb_mn2(ig,indm) + minorfrac(k)            &amp;</div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;     &amp;           * (kb_mn2(ig,indmp) - kb_mn2(ig,indm)))</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;</div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;          taug(ig,k) = corradj * (colamt(k,1)                           &amp;</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;     &amp;           * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#gabdaefe1c38d8bfcac5ef9b878fac77cb">absb</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#gabdaefe1c38d8bfcac5ef9b878fac77cb">absb</a>(ig,ind0p)    &amp;</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;     &amp;           +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#gabdaefe1c38d8bfcac5ef9b878fac77cb">absb</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#gabdaefe1c38d8bfcac5ef9b878fac77cb">absb</a>(ig,ind1p))   &amp;</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;     &amp;           + taufor + taun2)</div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;          fracs(ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga19b6a3893965817e82c77bee1de536cd">fracrefb</a>(ig)</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;</div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radlw__main.html#ga001d1bcd17533f7f920f859ff9a4e60f">taugb01</a></div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#a926415cb51870dda9a90883e01a2ee38">taugb02</a></div><div class="line"><a name="l03974"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#a926415cb51870dda9a90883e01a2ee38"> 3974</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;<span class="comment">!     band 2:  350-500 cm-1 (low key - h2o; high key - h2o)            !</span></div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb02.html">module_radlw_kgb02</a></div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;</div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;     &amp;           ig</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: corradj, tauself, taufor</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(2) + 1</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(2) + 1</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;        inds = indself(k)</div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;        corradj = f_one - 0.05 * (pavel(k) - 100.0) / 900.0</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng02</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;          tauself = selffac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#gaddb071e93b4ff49ba1f1c4d102e275f1">selfref</a>(ig,inds) + selffrac(k)        &amp;</div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gaddb071e93b4ff49ba1f1c4d102e275f1">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#gaddb071e93b4ff49ba1f1c4d102e275f1">selfref</a>(ig,inds)))</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#gaf6f3d7a0ab6858eab9d4d3e2d2d68031">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gaf6f3d7a0ab6858eab9d4d3e2d2d68031">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#gaf6f3d7a0ab6858eab9d4d3e2d2d68031">forref</a>(ig,indf))) </div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;          taug(ns02+ig,k) = corradj * (colamt(k,1)                      &amp;</div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;     &amp;            * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga46db893d4456b2d867130bb208cb2206">absa</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga46db893d4456b2d867130bb208cb2206">absa</a>(ig,ind0p)   &amp;</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;     &amp;            +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga46db893d4456b2d867130bb208cb2206">absa</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga46db893d4456b2d867130bb208cb2206">absa</a>(ig,ind1p))  &amp;</div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;     &amp;            + tauself + taufor)</div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;</div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;          fracs(ns02+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#gaf6db1580bd4a8b037cdd3e14765e2c83">fracrefa</a>(ig)</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(2) + 1</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(2) + 1</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng02</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;          taufor = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#gaf6f3d7a0ab6858eab9d4d3e2d2d68031">forref</a>(ig,indf) + forfrac(k)            &amp;</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;     &amp;           * (<a class="code" href="group__module__radlw__kgbnn.html#gaf6f3d7a0ab6858eab9d4d3e2d2d68031">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#gaf6f3d7a0ab6858eab9d4d3e2d2d68031">forref</a>(ig,indf))) </div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;</div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;          taug(ns02+ig,k) = colamt(k,1)                                 &amp;</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;     &amp;           * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#gacf34f9255586c9ed5ac5370db5b63c14">absb</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#gacf34f9255586c9ed5ac5370db5b63c14">absb</a>(ig,ind0p)    &amp;</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;     &amp;           +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#gacf34f9255586c9ed5ac5370db5b63c14">absb</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#gacf34f9255586c9ed5ac5370db5b63c14">absb</a>(ig,ind1p))   &amp;</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;     &amp;           + taufor</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;</div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;          fracs(ns02+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#gaeedda30c8d2bd7c9e7124c6445c8c20e">fracrefb</a>(ig)</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#a926415cb51870dda9a90883e01a2ee38">taugb02</a></div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;</div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#a45e39b507d1fc031c80d9c7f06905d4a">taugb03</a></div><div class="line"><a name="l04052"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#a45e39b507d1fc031c80d9c7f06905d4a"> 4052</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;<span class="comment">!     band 3:  500-630 cm-1 (low key - h2o,co2; low minor - n2o)       !</span></div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;<span class="comment">!                           (high key - h2o,co2; high minor - n2o)     !</span></div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;</div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb03.html">module_radlw_kgb03</a></div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind1, inds, indsp, indf, indfp, indm, indmp,  &amp;</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;     &amp;       id000, id010, id100, id110, id200, id210, jmn2o, jmn2op,   &amp;</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;     &amp;       id001, id011, id101, id111, id201, id211, jpl, jplp,       &amp;</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;     &amp;       ig, js, js1</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;</div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> ::  absn2o, ratn2o, adjfac, adjcoln2o,      &amp;</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;     &amp;      speccomb,       specparm,       specmult,       fs,         &amp;</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;     &amp;      speccomb1,      specparm1,      specmult1,      fs1,        &amp;</div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;     &amp;      speccomb_mn2o,  specparm_mn2o,  specmult_mn2o,  fmn2o,      &amp;</div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;     &amp;      speccomb_planck,specparm_planck,specmult_planck,fpl,        &amp;</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;     &amp;      refrat_planck_a, refrat_planck_b, refrat_m_a, refrat_m_b,   &amp;</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;     &amp;      fac000, fac100, fac200, fac010, fac110, fac210,             &amp;</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;     &amp;      fac001, fac101, fac201, fac011, fac111, fac211,             &amp;</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;     &amp;      tau_major, tau_major1, tauself, taufor, n2om1, n2om2,       &amp;</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;     &amp;      p, p4, fk0, fk1, fk2</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;<span class="comment">!  --- ...  minor gas mapping levels:</span></div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;<span class="comment">!     lower - n2o, p = 706.272 mbar, t = 278.94 k</span></div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;<span class="comment">!     upper - n2o, p = 95.58 mbar, t = 215.7 k</span></div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;      refrat_planck_a = chi_mls(1,9)/chi_mls(2,9)    <span class="comment">! P = 212.725 mb</span></div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;      refrat_planck_b = chi_mls(1,13)/chi_mls(2,13)  <span class="comment">! P = 95.58   mb</span></div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;      refrat_m_a      = chi_mls(1,3)/chi_mls(2,3)    <span class="comment">! P = 706.270 mb</span></div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;      refrat_m_b      = chi_mls(1,13)/chi_mls(2,13)  <span class="comment">! P = 95.58   mb</span></div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;</div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;        speccomb = colamt(k,1) + rfrate(k,1,1)*colamt(k,2)</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;        specparm = colamt(k,1) / speccomb</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;        specmult = 8.0 * min(specparm, oneminus)</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;        fs = mod(specmult, f_one)        </div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(3) + js</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;        speccomb1 = colamt(k,1) + rfrate(k,1,2)*colamt(k,2)</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;        specparm1 = colamt(k,1) / speccomb1</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;        specmult1 = 8.0 * min(specparm1, oneminus)</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;        js1 = 1 + int(specmult1)</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;        fs1 = mod(specmult1, f_one)</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(3) + js1</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;        speccomb_mn2o = colamt(k,1) + refrat_m_a*colamt(k,2)</div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;        specparm_mn2o = colamt(k,1) / speccomb_mn2o</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;        specmult_mn2o = 8.0 * min(specparm_mn2o, oneminus)</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;        jmn2o = 1 + int(specmult_mn2o)</div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;        fmn2o = mod(specmult_mn2o, f_one)</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,2)</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;        specparm_planck = colamt(k,1) / speccomb_planck</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;        jpl = 1 + int(specmult_planck)</div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;        fpl = mod(specmult_planck, f_one)</div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;        inds = indself(k)</div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;        jmn2op= jmn2o+ 1</div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;        jplp  = jpl  + 1</div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;</div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;<span class="comment">!  --- ...  in atmospheres where the amount of n2O is too great to be considered</span></div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;<span class="comment">!           a minor species, adjust the column amount of n2O by an empirical factor</span></div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;<span class="comment">!           to obtain the proper contribution.</span></div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;        p = coldry(k) * chi_mls(4,jp(k)+1)</div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;        ratn2o = colamt(k,4) / p</div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;        <span class="keywordflow">if</span> (ratn2o &gt; 1.5) <span class="keywordflow">then</span></div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;          adjfac = 0.5 + (ratn2o - 0.5)**0.65</div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;          adjcoln2o = adjfac * p</div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;          adjcoln2o = colamt(k,4)</div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;</div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;          p = fs - f_one</div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;          p4 = p**4</div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;          fk0 = p4</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;          fk1 = f_one - p - 2.0*p4</div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;          fk2 = p + p4</div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;          id000 = ind0</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;          id200 = ind0 + 2</div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;          id210 = ind0 +11</div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;          p = -fs</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;          p4 = p**4</div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;          fk0 = p4</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;          fk1 = f_one - p - 2.0*p4</div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;          fk2 = p + p4</div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;          id000 = ind0 + 1</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;          id010 = ind0 +10</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;          id100 = ind0</div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;          id110 = ind0 + 9</div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;          id200 = ind0 - 1</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;          id210 = ind0 + 8</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;          fk0 = f_one - fs</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;          fk1 = fs</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;          fk2 = f_zero</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;          id000 = ind0</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;          id200 = ind0</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;          id210 = ind0</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;</div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;        fac000 = fk0*fac00(k)</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;        fac100 = fk1*fac00(k)</div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;        fac200 = fk2*fac00(k)</div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;        fac010 = fk0*fac10(k)</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;        fac110 = fk1*fac10(k)</div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;        fac210 = fk2*fac10(k)</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;</div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;          p = fs1 - f_one</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;          p4 = p**4</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;          fk0 = p4</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;          fk1 = f_one - p - 2.0*p4</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;          fk2 = p + p4</div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;          id001 = ind1</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;          id201 = ind1 + 2</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;          id211 = ind1 +11</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;          p = -fs1</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;          p4 = p**4</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;          fk0 = p4</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;          fk1 = f_one - p - 2.0*p4</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;          fk2 = p + p4</div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;          id001 = ind1 + 1</div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;          id011 = ind1 +10</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;          id101 = ind1</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;          id111 = ind1 + 9</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;          id201 = ind1 - 1</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;          id211 = ind1 + 8</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;          fk0 = f_one - fs1</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;          fk1 = fs1</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;          fk2 = f_zero</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;          id001 = ind1</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;          id201 = ind1</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;          id211 = ind1</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;        fac001 = fk0*fac01(k)</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;        fac101 = fk1*fac01(k)</div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;        fac201 = fk2*fac01(k)</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;        fac011 = fk0*fac11(k)</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;        fac111 = fk1*fac11(k)</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;        fac211 = fk2*fac11(k)</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;</div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng03</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;          tauself = selffac(k)* (<a class="code" href="group__module__radlw__kgbnn.html#ga6bb40d898660e6dfc056d3efe1d0c544">selfref</a>(ig,inds) + selffrac(k)         &amp;</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga6bb40d898660e6dfc056d3efe1d0c544">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#ga6bb40d898660e6dfc056d3efe1d0c544">selfref</a>(ig,inds)))</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#gafcc55fa81ba6369b56d29db2342c2e6a">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gafcc55fa81ba6369b56d29db2342c2e6a">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#gafcc55fa81ba6369b56d29db2342c2e6a">forref</a>(ig,indf)))</div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;          n2om1   = <a class="code" href="group__module__radlw__kgbnn.html#gaeeba4e0a8fc97c557e1127b4d5d1bd94">ka_mn2o</a>(ig,jmn2o,indm) + fmn2o                      &amp;</div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gaeeba4e0a8fc97c557e1127b4d5d1bd94">ka_mn2o</a>(ig,jmn2op,indm) - <a class="code" href="group__module__radlw__kgbnn.html#gaeeba4e0a8fc97c557e1127b4d5d1bd94">ka_mn2o</a>(ig,jmn2o,indm))</div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;          n2om2   = <a class="code" href="group__module__radlw__kgbnn.html#gaeeba4e0a8fc97c557e1127b4d5d1bd94">ka_mn2o</a>(ig,jmn2o,indmp) + fmn2o                     &amp;</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gaeeba4e0a8fc97c557e1127b4d5d1bd94">ka_mn2o</a>(ig,jmn2op,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#gaeeba4e0a8fc97c557e1127b4d5d1bd94">ka_mn2o</a>(ig,jmn2o,indmp))</div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;          absn2o  = n2om1 + minorfrac(k) * (n2om2 - n2om1)</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;          tau_major = speccomb                                          &amp;</div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;     &amp;              * (fac000*<a class="code" href="group__module__radlw__kgbnn.html#gac65fd4afedbd4bfa2c87c5e4f060a1d4">absa</a>(ig,id000) + fac010*<a class="code" href="group__module__radlw__kgbnn.html#gac65fd4afedbd4bfa2c87c5e4f060a1d4">absa</a>(ig,id010)    &amp;</div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;     &amp;              +  fac100*<a class="code" href="group__module__radlw__kgbnn.html#gac65fd4afedbd4bfa2c87c5e4f060a1d4">absa</a>(ig,id100) + fac110*<a class="code" href="group__module__radlw__kgbnn.html#gac65fd4afedbd4bfa2c87c5e4f060a1d4">absa</a>(ig,id110)    &amp;</div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;     &amp;              +  fac200*<a class="code" href="group__module__radlw__kgbnn.html#gac65fd4afedbd4bfa2c87c5e4f060a1d4">absa</a>(ig,id200) + fac210*<a class="code" href="group__module__radlw__kgbnn.html#gac65fd4afedbd4bfa2c87c5e4f060a1d4">absa</a>(ig,id210))</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;          tau_major1 = speccomb1                                        &amp;</div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;     &amp;              * (fac001*<a class="code" href="group__module__radlw__kgbnn.html#gac65fd4afedbd4bfa2c87c5e4f060a1d4">absa</a>(ig,id001) + fac011*<a class="code" href="group__module__radlw__kgbnn.html#gac65fd4afedbd4bfa2c87c5e4f060a1d4">absa</a>(ig,id011)    &amp;</div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;     &amp;              +  fac101*<a class="code" href="group__module__radlw__kgbnn.html#gac65fd4afedbd4bfa2c87c5e4f060a1d4">absa</a>(ig,id101) + fac111*<a class="code" href="group__module__radlw__kgbnn.html#gac65fd4afedbd4bfa2c87c5e4f060a1d4">absa</a>(ig,id111)    &amp;</div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;     &amp;              +  fac201*<a class="code" href="group__module__radlw__kgbnn.html#gac65fd4afedbd4bfa2c87c5e4f060a1d4">absa</a>(ig,id201) + fac211*<a class="code" href="group__module__radlw__kgbnn.html#gac65fd4afedbd4bfa2c87c5e4f060a1d4">absa</a>(ig,id211))</div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;</div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;          taug(ns03+ig,k) = tau_major + tau_major1                      &amp;</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;     &amp;                    + tauself + taufor + adjcoln2o*absn2o</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;          fracs(ns03+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga26e901a002e789933c5c9b622f3a0932">fracrefa</a>(ig,jpl) + fpl                     &amp;</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;     &amp;                     * (<a class="code" href="group__module__radlw__kgbnn.html#ga26e901a002e789933c5c9b622f3a0932">fracrefa</a>(ig,jplp) - <a class="code" href="group__module__radlw__kgbnn.html#ga26e901a002e789933c5c9b622f3a0932">fracrefa</a>(ig,jpl))</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;<span class="keywordflow">        enddo</span>     <span class="comment">! end do_k_loop</span></div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;<span class="keywordflow">      enddo</span>   <span class="comment">! end do_ig_loop</span></div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;</div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;</div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;        speccomb = colamt(k,1) + rfrate(k,1,1)*colamt(k,2)</div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;        specparm = colamt(k,1) / speccomb</div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;        specmult = 4.0 * min(specparm, oneminus)</div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(3) + js</div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;        speccomb1 = colamt(k,1) + rfrate(k,1,2)*colamt(k,2)</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;        specparm1 = colamt(k,1) / speccomb1</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;        specmult1 = 4.0 * min(specparm1, oneminus)</div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;        js1 = 1 + int(specmult1)</div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;        fs1 = mod(specmult1, f_one)</div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(3) + js1</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;</div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;        speccomb_mn2o = colamt(k,1) + refrat_m_b*colamt(k,2)</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;        specparm_mn2o = colamt(k,1) / speccomb_mn2o</div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;        specmult_mn2o = 4.0 * min(specparm_mn2o, oneminus)</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;        jmn2o = 1 + int(specmult_mn2o)</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;        fmn2o = mod(specmult_mn2o, f_one)</div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;</div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;        speccomb_planck = colamt(k,1) + refrat_planck_b*colamt(k,2)</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;        specparm_planck = colamt(k,1) / speccomb_planck</div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;        specmult_planck = 4.0 * min(specparm_planck, oneminus)</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;        jpl = 1 + int(specmult_planck)</div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;        fpl = mod(specmult_planck, f_one)</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;        jmn2op= jmn2o+ 1</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;        jplp  = jpl  + 1</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;        id000 = ind0</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;        id010 = ind0 + 5</div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;        id100 = ind0 + 1</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;        id110 = ind0 + 6</div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;        id001 = ind1</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;        id011 = ind1 + 5</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;        id101 = ind1 + 1</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;        id111 = ind1 + 6</div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;</div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;<span class="comment">!  --- ...  in atmospheres where the amount of n2o is too great to be considered</span></div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;<span class="comment">!           a minor species, adjust the column amount of N2O by an empirical factor</span></div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;<span class="comment">!           to obtain the proper contribution.</span></div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;</div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;        p = coldry(k) * chi_mls(4,jp(k)+1)</div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;        ratn2o = colamt(k,4) / p</div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;        <span class="keywordflow">if</span> (ratn2o &gt; 1.5) <span class="keywordflow">then</span></div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;          adjfac = 0.5 + (ratn2o - 0.5)**0.65</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;          adjcoln2o = adjfac * p</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;          adjcoln2o = colamt(k,4)</div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;        fk0 = f_one - fs</div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;        fk1 = fs</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;        fac000 = fk0*fac00(k)</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;        fac010 = fk0*fac10(k)</div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;        fac100 = fk1*fac00(k)</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;        fac110 = fk1*fac10(k)</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;        fk0 = f_one - fs1</div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;        fk1 = fs1</div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;        fac001 = fk0*fac01(k)</div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;        fac011 = fk0*fac11(k)</div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;        fac101 = fk1*fac01(k)</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;        fac111 = fk1*fac11(k)</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng03</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;          taufor = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#gafcc55fa81ba6369b56d29db2342c2e6a">forref</a>(ig,indf) + forfrac(k)            &amp;</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;     &amp;           * (<a class="code" href="group__module__radlw__kgbnn.html#gafcc55fa81ba6369b56d29db2342c2e6a">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#gafcc55fa81ba6369b56d29db2342c2e6a">forref</a>(ig,indf))) </div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;          n2om1  = <a class="code" href="group__module__radlw__kgbnn.html#gaa2442e663e83b222648a86a34cd6631c">kb_mn2o</a>(ig,jmn2o,indm) + fmn2o                       &amp;</div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;     &amp;           * (<a class="code" href="group__module__radlw__kgbnn.html#gaa2442e663e83b222648a86a34cd6631c">kb_mn2o</a>(ig,jmn2op,indm) - <a class="code" href="group__module__radlw__kgbnn.html#gaa2442e663e83b222648a86a34cd6631c">kb_mn2o</a>(ig,jmn2o,indm))</div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;          n2om2  = <a class="code" href="group__module__radlw__kgbnn.html#gaa2442e663e83b222648a86a34cd6631c">kb_mn2o</a>(ig,jmn2o,indmp) + fmn2o                      &amp;</div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;     &amp;           * (<a class="code" href="group__module__radlw__kgbnn.html#gaa2442e663e83b222648a86a34cd6631c">kb_mn2o</a>(ig,jmn2op,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#gaa2442e663e83b222648a86a34cd6631c">kb_mn2o</a>(ig,jmn2o,indmp))</div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;          absn2o = n2om1 + minorfrac(k) * (n2om2 - n2om1)</div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;</div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;          tau_major = speccomb                                          &amp;</div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;     &amp;              * (fac000*<a class="code" href="group__module__radlw__kgbnn.html#gaa84ba66e0a3cc018b03bd13c9c21e133">absb</a>(ig,id000) + fac010*<a class="code" href="group__module__radlw__kgbnn.html#gaa84ba66e0a3cc018b03bd13c9c21e133">absb</a>(ig,id010)    &amp;</div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;     &amp;              +  fac100*<a class="code" href="group__module__radlw__kgbnn.html#gaa84ba66e0a3cc018b03bd13c9c21e133">absb</a>(ig,id100) + fac110*<a class="code" href="group__module__radlw__kgbnn.html#gaa84ba66e0a3cc018b03bd13c9c21e133">absb</a>(ig,id110))</div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;          tau_major1 = speccomb1                                        &amp;</div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;     &amp;              * (fac001*<a class="code" href="group__module__radlw__kgbnn.html#gaa84ba66e0a3cc018b03bd13c9c21e133">absb</a>(ig,id001) + fac011*<a class="code" href="group__module__radlw__kgbnn.html#gaa84ba66e0a3cc018b03bd13c9c21e133">absb</a>(ig,id011)    &amp;</div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;     &amp;              +  fac101*<a class="code" href="group__module__radlw__kgbnn.html#gaa84ba66e0a3cc018b03bd13c9c21e133">absb</a>(ig,id101) + fac111*<a class="code" href="group__module__radlw__kgbnn.html#gaa84ba66e0a3cc018b03bd13c9c21e133">absb</a>(ig,id111))</div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;</div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;          taug(ns03+ig,k) = tau_major + tau_major1                      &amp;</div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;     &amp;                    + taufor + adjcoln2o*absn2o            </div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;</div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;          fracs(ns03+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#gaf1d33a7362e73bf40ef592bc9863b612">fracrefb</a>(ig,jpl) + fpl                     &amp;</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;     &amp;                     * (<a class="code" href="group__module__radlw__kgbnn.html#gaf1d33a7362e73bf40ef592bc9863b612">fracrefb</a>(ig,jplp) - <a class="code" href="group__module__radlw__kgbnn.html#gaf1d33a7362e73bf40ef592bc9863b612">fracrefb</a>(ig,jpl))</div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#a45e39b507d1fc031c80d9c7f06905d4a">taugb03</a></div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#ae69174bcf1a87dc7a5baffac69797d07">taugb04</a></div><div class="line"><a name="l04359"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#ae69174bcf1a87dc7a5baffac69797d07"> 4359</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;<span class="comment">!     band 4:  630-700 cm-1 (low key - h2o,co2; high key - o3,co2)     !</span></div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;</div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb04.html">module_radlw_kgb04</a></div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;</div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind1, inds, indsp, indf, indfp, jpl, jplp,    &amp;</div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;     &amp;       id000, id010, id100, id110, id200, id210, ig, js, js1,     &amp;</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;     &amp;       id001, id011, id101, id111, id201, id211</div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tauself, taufor, p, p4, fk0, fk1, fk2,   &amp;</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;     &amp;      speccomb,       specparm,       specmult,       fs,         &amp;</div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;     &amp;      speccomb1,      specparm1,      specmult1,      fs1,        &amp;</div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;     &amp;      speccomb_planck,specparm_planck,specmult_planck,fpl,        &amp;</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;     &amp;      fac000, fac100, fac200, fac010, fac110, fac210,             &amp;</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;     &amp;      fac001, fac101, fac201, fac011, fac111, fac211,             &amp;</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;     &amp;      refrat_planck_a, refrat_planck_b, tau_major, tau_major1</div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;      refrat_planck_a = chi_mls(1,11)/chi_mls(2,11)     <span class="comment">! P = 142.5940 mb</span></div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;      refrat_planck_b = chi_mls(3,13)/chi_mls(2,13)     <span class="comment">! P = 95.58350 mb</span></div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;        speccomb = colamt(k,1) + rfrate(k,1,1)*colamt(k,2)</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;        specparm = colamt(k,1) / speccomb</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;        specmult = 8.0 * min(specparm, oneminus)</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(4) + js</div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;        speccomb1 = colamt(k,1) + rfrate(k,1,2)*colamt(k,2)</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;        specparm1 = colamt(k,1) / speccomb1</div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;        specmult1 = 8.0 * min(specparm1, oneminus)</div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;        js1 = 1 + int(specmult1)</div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;        fs1 = mod(specmult1, f_one)</div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;        ind1 = ( jp(k)*5 + (jt1(k)-1)) * nspa(4) + js1</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,2)</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;        specparm_planck = colamt(k,1) / speccomb_planck</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;        jpl = 1 + int(specmult_planck)</div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;        fpl = mod(specmult_planck, 1.0)</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;        inds = indself(k)</div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;        jplp  = jpl  + 1</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;</div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;          p = fs - f_one</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;          p4 = p**4</div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;          fk0 = p4</div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;          fk1 = f_one - p - 2.0*p4</div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;          fk2 = p + p4</div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;          id000 = ind0</div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;          id200 = ind0 + 2</div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;          id210 = ind0 +11</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;          p = -fs</div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;          p4 = p**4</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;          fk0 = p4</div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;          fk1 = f_one - p - 2.0*p4</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;          fk2 = p + p4</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;          id000 = ind0 + 1</div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;          id010 = ind0 +10</div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;          id100 = ind0</div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;          id110 = ind0 + 9</div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;          id200 = ind0 - 1</div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;          id210 = ind0 + 8</div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;          fk0 = f_one - fs</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;          fk1 = fs</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;          fk2 = f_zero</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;          id000 = ind0</div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;          id200 = ind0</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;          id210 = ind0</div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;</div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;        fac000 = fk0*fac00(k)</div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;        fac100 = fk1*fac00(k)</div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;        fac200 = fk2*fac00(k)</div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;        fac010 = fk0*fac10(k)</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;        fac110 = fk1*fac10(k)</div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;        fac210 = fk2*fac10(k)</div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;          p = fs1 - f_one</div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;          p4 = p**4</div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;          fk0 = p4</div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;          fk1 = f_one - p - 2.0*p4</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;          fk2 = p + p4</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;          id001 = ind1</div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;          id201 = ind1 + 2</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;          id211 = ind1 +11</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;          p = -fs1</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;          p4 = p**4</div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;          fk0 = p4</div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;          fk1 = f_one - p - 2.0*p4</div><div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;          fk2 = p + p4</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;          id001 = ind1 + 1</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;          id011 = ind1 +10</div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;          id101 = ind1</div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;          id111 = ind1 + 9</div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;          id201 = ind1 - 1</div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;          id211 = ind1 + 8</div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;          fk0 = f_one - fs1</div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;          fk1 = fs1</div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;          fk2 = f_zero</div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;          id001 = ind1</div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;          id201 = ind1</div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;          id211 = ind1</div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;</div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;        fac001 = fk0*fac01(k)</div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;        fac101 = fk1*fac01(k)</div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;        fac201 = fk2*fac01(k)</div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;        fac011 = fk0*fac11(k)</div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;        fac111 = fk1*fac11(k)</div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;        fac211 = fk2*fac11(k)</div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;</div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng04</div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;          tauself = selffac(k)* (<a class="code" href="group__module__radlw__kgbnn.html#ga696b91ef86ccbda17df10f770797cafa">selfref</a>(ig,inds) + selffrac(k)         &amp;</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga696b91ef86ccbda17df10f770797cafa">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#ga696b91ef86ccbda17df10f770797cafa">selfref</a>(ig,inds)))</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga816fd065291a92c13d026d38a708479b">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga816fd065291a92c13d026d38a708479b">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#ga816fd065291a92c13d026d38a708479b">forref</a>(ig,indf))) </div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;</div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;          tau_major = speccomb                                          &amp;</div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;     &amp;              * (fac000*<a class="code" href="group__module__radlw__kgbnn.html#ga8d73bb6971c872e15a24a81d3917167e">absa</a>(ig,id000) + fac010*<a class="code" href="group__module__radlw__kgbnn.html#ga8d73bb6971c872e15a24a81d3917167e">absa</a>(ig,id010)    &amp;</div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;     &amp;              +  fac100*<a class="code" href="group__module__radlw__kgbnn.html#ga8d73bb6971c872e15a24a81d3917167e">absa</a>(ig,id100) + fac110*<a class="code" href="group__module__radlw__kgbnn.html#ga8d73bb6971c872e15a24a81d3917167e">absa</a>(ig,id110)    &amp;</div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;     &amp;              +  fac200*<a class="code" href="group__module__radlw__kgbnn.html#ga8d73bb6971c872e15a24a81d3917167e">absa</a>(ig,id200) + fac210*<a class="code" href="group__module__radlw__kgbnn.html#ga8d73bb6971c872e15a24a81d3917167e">absa</a>(ig,id210))</div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;</div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;          tau_major1 = speccomb1                                        &amp;</div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;     &amp;              * (fac001*<a class="code" href="group__module__radlw__kgbnn.html#ga8d73bb6971c872e15a24a81d3917167e">absa</a>(ig,id001) + fac011*<a class="code" href="group__module__radlw__kgbnn.html#ga8d73bb6971c872e15a24a81d3917167e">absa</a>(ig,id011)    &amp;</div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;     &amp;              +  fac101*<a class="code" href="group__module__radlw__kgbnn.html#ga8d73bb6971c872e15a24a81d3917167e">absa</a>(ig,id101) + fac111*<a class="code" href="group__module__radlw__kgbnn.html#ga8d73bb6971c872e15a24a81d3917167e">absa</a>(ig,id111)    &amp;</div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;     &amp;              +  fac201*<a class="code" href="group__module__radlw__kgbnn.html#ga8d73bb6971c872e15a24a81d3917167e">absa</a>(ig,id201) + fac211*<a class="code" href="group__module__radlw__kgbnn.html#ga8d73bb6971c872e15a24a81d3917167e">absa</a>(ig,id211))</div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;</div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;          taug(ns04+ig,k) = tau_major + tau_major1 + tauself + taufor</div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;</div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;          fracs(ns04+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#gace1d87742e2c543d9b0662e1c7d2b624">fracrefa</a>(ig,jpl) + fpl                     &amp;</div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;     &amp;                     * (<a class="code" href="group__module__radlw__kgbnn.html#gace1d87742e2c543d9b0662e1c7d2b624">fracrefa</a>(ig,jplp) - <a class="code" href="group__module__radlw__kgbnn.html#gace1d87742e2c543d9b0662e1c7d2b624">fracrefa</a>(ig,jpl))</div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;<span class="keywordflow">        enddo</span>     <span class="comment">! end do_k_loop</span></div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;<span class="keywordflow">      enddo</span>   <span class="comment">! end do_ig_loop</span></div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;</div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;</div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;        speccomb = colamt(k,3) + rfrate(k,6,1)*colamt(k,2)</div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;        specparm = colamt(k,3) / speccomb</div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;        specmult = 4.0 * min(specparm, oneminus)</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(4) + js</div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;        speccomb1 = colamt(k,3) + rfrate(k,6,2)*colamt(k,2)</div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;        specparm1 = colamt(k,3) / speccomb1</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;        specmult1 = 4.0 * min(specparm1, oneminus)</div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;        js1 = 1 + int(specmult1)</div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;        fs1 = mod(specmult1, f_one)</div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(4) + js1</div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;</div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;        speccomb_planck = colamt(k,3) + refrat_planck_b*colamt(k,2)</div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;        specparm_planck = colamt(k,3) / speccomb_planck</div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;        specmult_planck = 4.0 * min(specparm_planck, oneminus)</div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;        jpl = 1 + int(specmult_planck)</div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;        fpl = mod(specmult_planck, f_one)</div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;        jplp = jpl + 1</div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;</div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;        id000 = ind0</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;        id010 = ind0 + 5</div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;        id100 = ind0 + 1</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;        id110 = ind0 + 6</div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;        id001 = ind1</div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;        id011 = ind1 + 5</div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;        id101 = ind1 + 1</div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;        id111 = ind1 + 6</div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;</div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;        fk0 = f_one - fs</div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;        fk1 = fs</div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;        fac000 = fk0*fac00(k)</div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;        fac010 = fk0*fac10(k)</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;        fac100 = fk1*fac00(k)</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;        fac110 = fk1*fac10(k)</div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;        fk0 = f_one - fs1</div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;        fk1 = fs1</div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;        fac001 = fk0*fac01(k)</div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;        fac011 = fk0*fac11(k)</div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;        fac101 = fk1*fac01(k)</div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;        fac111 = fk1*fac11(k)</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;</div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng04</div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;          tau_major =  speccomb                                         &amp;</div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;     &amp;              * (fac000*<a class="code" href="group__module__radlw__kgbnn.html#gaaacc55911b42c67396b5cdc4318e0d5f">absb</a>(ig,id000) + fac010*<a class="code" href="group__module__radlw__kgbnn.html#gaaacc55911b42c67396b5cdc4318e0d5f">absb</a>(ig,id010)    &amp;</div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;     &amp;              +  fac100*<a class="code" href="group__module__radlw__kgbnn.html#gaaacc55911b42c67396b5cdc4318e0d5f">absb</a>(ig,id100) + fac110*<a class="code" href="group__module__radlw__kgbnn.html#gaaacc55911b42c67396b5cdc4318e0d5f">absb</a>(ig,id110))</div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;          tau_major1 = speccomb1                                        &amp;</div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;     &amp;              * (fac001*<a class="code" href="group__module__radlw__kgbnn.html#gaaacc55911b42c67396b5cdc4318e0d5f">absb</a>(ig,id001) + fac011*<a class="code" href="group__module__radlw__kgbnn.html#gaaacc55911b42c67396b5cdc4318e0d5f">absb</a>(ig,id011)    &amp;</div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;     &amp;              +  fac101*<a class="code" href="group__module__radlw__kgbnn.html#gaaacc55911b42c67396b5cdc4318e0d5f">absb</a>(ig,id101) + fac111*<a class="code" href="group__module__radlw__kgbnn.html#gaaacc55911b42c67396b5cdc4318e0d5f">absb</a>(ig,id111))</div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;</div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;          taug(ns04+ig,k) =  tau_major + tau_major1</div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;</div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;          fracs(ns04+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#gae8d5d56d09dfbe06d918c6b098e3fddf">fracrefb</a>(ig,jpl) + fpl                     &amp;</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;     &amp;                     * (<a class="code" href="group__module__radlw__kgbnn.html#gae8d5d56d09dfbe06d918c6b098e3fddf">fracrefb</a>(ig,jplp) - <a class="code" href="group__module__radlw__kgbnn.html#gae8d5d56d09dfbe06d918c6b098e3fddf">fracrefb</a>(ig,jpl))</div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;</div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;<span class="comment">!  --- ...  empirical modification to code to improve stratospheric cooling rates</span></div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;<span class="comment">!           for co2. revised to apply weighting for g-point reduction in this band.</span></div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;</div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;        taug(ns04+ 8,k) = taug(ns04+ 8,k) * 0.92</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;        taug(ns04+ 9,k) = taug(ns04+ 9,k) * 0.88</div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;        taug(ns04+10,k) = taug(ns04+10,k) * 1.07</div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;        taug(ns04+11,k) = taug(ns04+11,k) * 1.1</div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;        taug(ns04+12,k) = taug(ns04+12,k) * 0.99</div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;        taug(ns04+13,k) = taug(ns04+13,k) * 0.88</div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;        taug(ns04+14,k) = taug(ns04+14,k) * 0.943</div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;</div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#ae69174bcf1a87dc7a5baffac69797d07">taugb04</a></div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#a92653ffcd20ff247a00eaf3339cba6df">taugb05</a></div><div class="line"><a name="l04604"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#a92653ffcd20ff247a00eaf3339cba6df"> 4604</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;</div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;<span class="comment">!     band 5:  700-820 cm-1 (low key - h2o,co2; low minor - o3, ccl4)  !</span></div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;<span class="comment">!                           (high key - o3,co2)                        !</span></div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;</div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb05.html">module_radlw_kgb05</a></div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;</div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;<span class="comment">!  ---  locals: </span></div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind1, inds, indsp, indf, indfp, indm, indmp,  &amp;</div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;     &amp;       id000, id010, id100, id110, id200, id210, jmo3, jmo3p,     &amp;</div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;     &amp;       id001, id011, id101, id111, id201, id211, jpl, jplp,       &amp;</div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;     &amp;       ig, js, js1</div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;</div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>  :: tauself, taufor, o3m1, o3m2, abso3,     &amp;</div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;     &amp;      speccomb,       specparm,       specmult,       fs,         &amp;</div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;     &amp;      speccomb1,      specparm1,      specmult1,      fs1,        &amp;</div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;     &amp;      speccomb_mo3,   specparm_mo3,   specmult_mo3,   fmo3,       &amp;</div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;     &amp;      speccomb_planck,specparm_planck,specmult_planck,fpl,        &amp;</div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;     &amp;      refrat_planck_a, refrat_planck_b, refrat_m_a,               &amp;</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;     &amp;      fac000, fac100, fac200, fac010, fac110, fac210,             &amp;</div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;     &amp;      fac001, fac101, fac201, fac011, fac111, fac211,             &amp;</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;     &amp;      p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21</div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;<span class="comment">!  --- ...  minor gas mapping level :</span></div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;<span class="comment">!     lower - o3, p = 317.34 mbar, t = 240.77 k</span></div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;<span class="comment">!     lower - ccl4</span></div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;<span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;<span class="comment">!           fraction in lower/upper atmosphere.</span></div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;</div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;      refrat_planck_a = chi_mls(1,5)/chi_mls(2,5)      <span class="comment">! P = 473.420 mb</span></div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;      refrat_planck_b = chi_mls(3,43)/chi_mls(2,43)    <span class="comment">! P = 0.2369  mb</span></div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;      refrat_m_a = chi_mls(1,7)/chi_mls(2,7)           <span class="comment">! P = 317.348 mb</span></div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;</div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;        speccomb = colamt(k,1) + rfrate(k,1,1)*colamt(k,2)</div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;        specparm = colamt(k,1) / speccomb</div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;        specmult = 8.0 * min(specparm, oneminus)</div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(5) + js</div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;</div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;        speccomb1 = colamt(k,1) + rfrate(k,1,2)*colamt(k,2)</div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;        specparm1 = colamt(k,1) / speccomb1</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;        specmult1 = 8.0 * min(specparm1, oneminus)</div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;        js1 = 1 + int(specmult1)</div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;        fs1 = mod(specmult1, f_one)</div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(5) + js1</div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;        speccomb_mo3 = colamt(k,1) + refrat_m_a*colamt(k,2)</div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;        specparm_mo3 = colamt(k,1) / speccomb_mo3</div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;        specmult_mo3 = 8.0 * min(specparm_mo3, oneminus)</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;        jmo3 = 1 + int(specmult_mo3)</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;        fmo3 = mod(specmult_mo3, f_one)</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,2)</div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;        specparm_planck = colamt(k,1) / speccomb_planck</div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;        jpl = 1 + int(specmult_planck)</div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;        fpl = mod(specmult_planck, f_one)</div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;        inds = indself(k)</div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;        jplp  = jpl  + 1</div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;        jmo3p = jmo3 + 1</div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;          p0   = fs - f_one</div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;          p40  = p0**4</div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;          fk00 = p40</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;          id000 = ind0</div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;          id200 = ind0 + 2</div><div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;          id210 = ind0 +11</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;          p0   = -fs</div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;          p40  = p0**4</div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;          fk00 = p40</div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;</div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;          id000 = ind0 + 1</div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;          id010 = ind0 +10</div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;          id100 = ind0</div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;          id110 = ind0 + 9</div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;          id200 = ind0 - 1</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;          id210 = ind0 + 8</div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;          fk00 = f_one - fs</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;          fk10 = fs</div><div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;          fk20 = f_zero</div><div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;</div><div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;          id000 = ind0</div><div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;          id200 = ind0</div><div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;          id210 = ind0</div><div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;</div><div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;        fac000 = fk00 * fac00(k)</div><div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;        fac100 = fk10 * fac00(k)</div><div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;        fac200 = fk20 * fac00(k)</div><div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;        fac010 = fk00 * fac10(k)</div><div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;        fac110 = fk10 * fac10(k)</div><div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;        fac210 = fk20 * fac10(k)</div><div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;</div><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;          p1   = fs1 - f_one</div><div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;          p41  = p1**4</div><div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;          fk01 = p41</div><div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;</div><div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;          id001 = ind1</div><div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;          id201 = ind1 + 2</div><div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;          id211 = ind1 +11</div><div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;          p1   = -fs1</div><div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;          p41  = p1**4</div><div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;          fk01 = p41</div><div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;</div><div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;          id001 = ind1 + 1</div><div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;          id011 = ind1 +10</div><div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;          id101 = ind1</div><div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;          id111 = ind1 + 9</div><div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;          id201 = ind1 - 1</div><div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;          id211 = ind1 + 8</div><div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;          fk01 = f_one - fs1</div><div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;          fk11 = fs1</div><div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;          fk21 = f_zero</div><div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;</div><div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;          id001 = ind1</div><div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;          id201 = ind1</div><div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;          id211 = ind1</div><div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;</div><div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;        fac001 = fk01 * fac01(k)</div><div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;        fac101 = fk11 * fac01(k)</div><div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;        fac201 = fk21 * fac01(k)</div><div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;        fac011 = fk01 * fac11(k)</div><div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;        fac111 = fk11 * fac11(k)</div><div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;        fac211 = fk21 * fac11(k)</div><div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;</div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng05</div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;          tauself = selffac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga3c727eabe159c88fca912f33a2b91943">selfref</a>(ig,inds) + selffrac(k)        &amp;</div><div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga3c727eabe159c88fca912f33a2b91943">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#ga3c727eabe159c88fca912f33a2b91943">selfref</a>(ig,inds)))</div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga6ff0c311db14b41c9bdf1170164adc3a">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga6ff0c311db14b41c9bdf1170164adc3a">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#ga6ff0c311db14b41c9bdf1170164adc3a">forref</a>(ig,indf)))</div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;          o3m1    = ka_mo3(ig,jmo3,indm) + fmo3                         &amp;</div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;     &amp;            * (ka_mo3(ig,jmo3p,indm) -  ka_mo3(ig,jmo3,indm))</div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;          o3m2    = ka_mo3(ig,jmo3,indmp) + fmo3                        &amp;</div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;     &amp;            * (ka_mo3(ig,jmo3p,indmp) - ka_mo3(ig,jmo3,indmp))</div><div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;          abso3   = o3m1 + minorfrac(k)*(o3m2 - o3m1)</div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;</div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;          taug(ns05+ig,k) = speccomb                                    &amp;</div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;     &amp;            * (fac000*<a class="code" href="group__module__radlw__kgbnn.html#ga30ce809b40dd99b3219996ac8f023274">absa</a>(ig,id000) + fac010*<a class="code" href="group__module__radlw__kgbnn.html#ga30ce809b40dd99b3219996ac8f023274">absa</a>(ig,id010)      &amp;</div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;     &amp;            +  fac100*<a class="code" href="group__module__radlw__kgbnn.html#ga30ce809b40dd99b3219996ac8f023274">absa</a>(ig,id100) + fac110*<a class="code" href="group__module__radlw__kgbnn.html#ga30ce809b40dd99b3219996ac8f023274">absa</a>(ig,id110)      &amp;</div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;     &amp;            +  fac200*<a class="code" href="group__module__radlw__kgbnn.html#ga30ce809b40dd99b3219996ac8f023274">absa</a>(ig,id200) + fac210*<a class="code" href="group__module__radlw__kgbnn.html#ga30ce809b40dd99b3219996ac8f023274">absa</a>(ig,id210))     &amp;</div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;     &amp;            +     speccomb1                                       &amp;</div><div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;     &amp;            * (fac001*<a class="code" href="group__module__radlw__kgbnn.html#ga30ce809b40dd99b3219996ac8f023274">absa</a>(ig,id001) + fac011*<a class="code" href="group__module__radlw__kgbnn.html#ga30ce809b40dd99b3219996ac8f023274">absa</a>(ig,id011)      &amp;</div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;     &amp;            +  fac101*<a class="code" href="group__module__radlw__kgbnn.html#ga30ce809b40dd99b3219996ac8f023274">absa</a>(ig,id101) + fac111*<a class="code" href="group__module__radlw__kgbnn.html#ga30ce809b40dd99b3219996ac8f023274">absa</a>(ig,id111)      &amp;</div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;     &amp;            +  fac201*<a class="code" href="group__module__radlw__kgbnn.html#ga30ce809b40dd99b3219996ac8f023274">absa</a>(ig,id201) + fac211*<a class="code" href="group__module__radlw__kgbnn.html#ga30ce809b40dd99b3219996ac8f023274">absa</a>(ig,id211))     &amp;</div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;     &amp;            + tauself + taufor+abso3*colamt(k,3)+wx(k,1)*<a class="code" href="group__module__radlw__kgbnn.html#ga15c6b3bfa9d8cbf20099dd4f364444b5">ccl4</a>(ig)</div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;</div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;          fracs(ns05+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga335fd60e59154f47724d2e25fdf0a5fb">fracrefa</a>(ig,jpl) + fpl                     &amp;</div><div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;     &amp;                     * (<a class="code" href="group__module__radlw__kgbnn.html#ga335fd60e59154f47724d2e25fdf0a5fb">fracrefa</a>(ig,jplp) - <a class="code" href="group__module__radlw__kgbnn.html#ga335fd60e59154f47724d2e25fdf0a5fb">fracrefa</a>(ig,jpl))</div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;</div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;</div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;        speccomb = colamt(k,3) + rfrate(k,6,1)*colamt(k,2)</div><div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;        specparm = colamt(k,3) / speccomb</div><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;        specmult = 4.0 * min(specparm, oneminus)</div><div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(5) + js</div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;</div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;        speccomb1 = colamt(k,3) + rfrate(k,6,2)*colamt(k,2)</div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;        specparm1 = colamt(k,3) / speccomb1</div><div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;        specmult1 = 4.0 * min(specparm1, oneminus)</div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;        js1 = 1 + int(specmult1)</div><div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;        fs1 = mod(specmult1, f_one)</div><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(5) + js1</div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;</div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;        speccomb_planck = colamt(k,3) + refrat_planck_b*colamt(k,2)</div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;        specparm_planck = colamt(k,3) / speccomb_planck</div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;        specmult_planck = 4.0 * min(specparm_planck, oneminus)</div><div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;        jpl = 1 + int(specmult_planck)</div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;        fpl = mod(specmult_planck, f_one)</div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;        jplp= jpl + 1</div><div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;</div><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;        id000 = ind0</div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;        id010 = ind0 + 5</div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;        id100 = ind0 + 1</div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;        id110 = ind0 + 6</div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;        id001 = ind1</div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;        id011 = ind1 + 5</div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;        id101 = ind1 + 1</div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;        id111 = ind1 + 6</div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;</div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;        fk00 = f_one - fs</div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;        fk10 = fs</div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;</div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;        fk01 = f_one - fs1</div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;        fk11 = fs1</div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;</div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;        fac000 = fk00 * fac00(k)</div><div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;        fac010 = fk00 * fac10(k)</div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;        fac100 = fk10 * fac00(k)</div><div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;        fac110 = fk10 * fac10(k)</div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;</div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;        fac001 = fk01 * fac01(k)</div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;        fac011 = fk01 * fac11(k)</div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;        fac101 = fk11 * fac01(k)</div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;        fac111 = fk11 * fac11(k)</div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;</div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng05</div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;          taug(ns05+ig,k) = speccomb                                    &amp;</div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;     &amp;                * (fac000*<a class="code" href="group__module__radlw__kgbnn.html#gaebc667b0569824bba455e822eaea6112">absb</a>(ig,id000) + fac010*<a class="code" href="group__module__radlw__kgbnn.html#gaebc667b0569824bba455e822eaea6112">absb</a>(ig,id010)  &amp;</div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;     &amp;                +  fac100*<a class="code" href="group__module__radlw__kgbnn.html#gaebc667b0569824bba455e822eaea6112">absb</a>(ig,id100) + fac110*<a class="code" href="group__module__radlw__kgbnn.html#gaebc667b0569824bba455e822eaea6112">absb</a>(ig,id110)) &amp;</div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;     &amp;                +     speccomb1                                   &amp;</div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;     &amp;                * (fac001*<a class="code" href="group__module__radlw__kgbnn.html#gaebc667b0569824bba455e822eaea6112">absb</a>(ig,id001) + fac011*<a class="code" href="group__module__radlw__kgbnn.html#gaebc667b0569824bba455e822eaea6112">absb</a>(ig,id011)  &amp;</div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;     &amp;                +  fac101*<a class="code" href="group__module__radlw__kgbnn.html#gaebc667b0569824bba455e822eaea6112">absb</a>(ig,id101) + fac111*<a class="code" href="group__module__radlw__kgbnn.html#gaebc667b0569824bba455e822eaea6112">absb</a>(ig,id111)) &amp;</div><div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;     &amp;                + wx(k,1) * <a class="code" href="group__module__radlw__kgbnn.html#ga15c6b3bfa9d8cbf20099dd4f364444b5">ccl4</a>(ig)</div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;</div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;          fracs(ns05+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#gaf7b1fd9c6b966e03a226dd8cbc058670">fracrefb</a>(ig,jpl) + fpl                     &amp;</div><div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;     &amp;                     * (<a class="code" href="group__module__radlw__kgbnn.html#gaf7b1fd9c6b966e03a226dd8cbc058670">fracrefb</a>(ig,jplp) - <a class="code" href="group__module__radlw__kgbnn.html#gaf7b1fd9c6b966e03a226dd8cbc058670">fracrefb</a>(ig,jpl))</div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;</div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#a92653ffcd20ff247a00eaf3339cba6df">taugb05</a></div><div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;</div><div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#a7190d415614aa35deefacff1041d4719">taugb06</a></div><div class="line"><a name="l04869"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#a7190d415614aa35deefacff1041d4719"> 4869</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;</div><div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;<span class="comment">!     band 6:  820-980 cm-1 (low key - h2o; low minor - co2)           !</span></div><div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;<span class="comment">!                           (high key - none; high minor - cfc11, cfc12)</span></div><div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;</div><div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb06.html">module_radlw_kgb06</a></div><div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;</div><div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;<span class="comment">!  ---  locals: </span></div><div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div><div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;     &amp;       indm, indmp, ig</div><div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;</div><div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: ratco2, adjfac, adjcolco2, tauself,      &amp;</div><div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;     &amp;      taufor, absco2, temp</div><div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;<span class="comment">!  --- ...  minor gas mapping level:</span></div><div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;<span class="comment">!     lower - co2, p = 706.2720 mb, t = 294.2 k</span></div><div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;<span class="comment">!     upper - cfc11, cfc12</span></div><div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;</div><div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;</div><div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(6) + 1</div><div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(6) + 1</div><div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;</div><div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;        inds = indself(k)</div><div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;</div><div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;<span class="comment">!  --- ...  in atmospheres where the amount of co2 is too great to be considered</span></div><div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;<span class="comment">!           a minor species, adjust the column amount of co2 by an empirical factor</span></div><div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;<span class="comment">!           to obtain the proper contribution.</span></div><div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;</div><div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;        temp   = coldry(k) * chi_mls(2,jp(k)+1)</div><div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;        ratco2 = colamt(k,2) / temp</div><div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;        <span class="keywordflow">if</span> (ratco2 &gt; 3.0) <span class="keywordflow">then</span></div><div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;          adjfac = 2.0 + (ratco2-2.0)**0.77</div><div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;          adjcolco2 = adjfac * temp</div><div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;          adjcolco2 = colamt(k,2)</div><div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;</div><div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng06</div><div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;          tauself = selffac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga98901725947a4477924a47af5e67277e">selfref</a>(ig,inds) + selffrac(k)        &amp;</div><div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga98901725947a4477924a47af5e67277e">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#ga98901725947a4477924a47af5e67277e">selfref</a>(ig,inds)))</div><div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga6a0467b666bc75f90ae58fa4f58f07f0">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga6a0467b666bc75f90ae58fa4f58f07f0">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#ga6a0467b666bc75f90ae58fa4f58f07f0">forref</a>(ig,indf)))</div><div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;          absco2  = <a class="code" href="group__module__radlw__kgbnn.html#gadb5dab732383b82e89f1048ab5150c23">ka_mco2</a>(ig,indm) + minorfrac(k)                     &amp;</div><div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gadb5dab732383b82e89f1048ab5150c23">ka_mco2</a>(ig,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#gadb5dab732383b82e89f1048ab5150c23">ka_mco2</a>(ig,indm))</div><div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;</div><div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;          taug(ns06+ig,k) = colamt(k,1)                                 &amp;</div><div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;     &amp;            * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga21bd40309855c89a64b88be171bfde59">absa</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga21bd40309855c89a64b88be171bfde59">absa</a>(ig,ind0p)   &amp;</div><div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;     &amp;            +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga21bd40309855c89a64b88be171bfde59">absa</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga21bd40309855c89a64b88be171bfde59">absa</a>(ig,ind1p))  &amp;</div><div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;     &amp;            +  tauself + taufor + adjcolco2*absco2                &amp;</div><div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;     &amp;            +  wx(k,2)*<a class="code" href="group__module__radlw__kgbnn.html#ga8b0813723ba69b1afbe2552f6b730267">cfc11adj</a>(ig) + wx(k,3)*cfc12(ig)</div><div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;</div><div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;          fracs(ns06+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga1354ecbc5f07cd763847333e680c686a">fracrefa</a>(ig)</div><div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;</div><div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;<span class="comment">!           nothing important goes on above laytrop in this band.</span></div><div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;</div><div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng06</div><div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;          taug(ns06+ig,k) = wx(k,2)*<a class="code" href="group__module__radlw__kgbnn.html#ga8b0813723ba69b1afbe2552f6b730267">cfc11adj</a>(ig) + wx(k,3)*cfc12(ig)</div><div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;</div><div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;          fracs(ns06+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga1354ecbc5f07cd763847333e680c686a">fracrefa</a>(ig)</div><div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;</div><div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#a7190d415614aa35deefacff1041d4719">taugb06</a></div><div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;</div><div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#a2208d86ae0712a0ca426bbe96de825bc">taugb07</a></div><div class="line"><a name="l04956"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#a2208d86ae0712a0ca426bbe96de825bc"> 4956</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;</div><div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;<span class="comment">!     band 7:  980-1080 cm-1 (low key - h2o,o3; low minor - co2)       !</span></div><div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;<span class="comment">!                            (high key - o3; high minor - co2)         !</span></div><div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;</div><div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb07.html">module_radlw_kgb07</a></div><div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;</div><div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div><div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;     &amp;       id000, id010, id100, id110, id200, id210, indm, indmp,     &amp;</div><div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;     &amp;       id001, id011, id101, id111, id201, id211, jmco2, jmco2p,   &amp;</div><div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;     &amp;       jpl, jplp, ig, js, js1</div><div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;</div><div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tauself, taufor, co2m1, co2m2, absco2,   &amp;</div><div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;     &amp;      speccomb,       specparm,       specmult,       fs,         &amp;</div><div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;     &amp;      speccomb1,      specparm1,      specmult1,      fs1,        &amp;</div><div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;     &amp;      speccomb_mco2,  specparm_mco2,  specmult_mco2,  fmco2,      &amp;</div><div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;     &amp;      speccomb_planck,specparm_planck,specmult_planck,fpl,        &amp;</div><div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;     &amp;      refrat_planck_a, refrat_m_a, ratco2, adjfac, adjcolco2,     &amp;</div><div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;     &amp;      fac000, fac100, fac200, fac010, fac110, fac210,             &amp;</div><div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;     &amp;      fac001, fac101, fac201, fac011, fac111, fac211,             &amp;</div><div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;     &amp;      p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21, temp</div><div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;<span class="comment">!  --- ...  minor gas mapping level :</span></div><div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;<span class="comment">!     lower - co2, p = 706.2620 mbar, t= 278.94 k</span></div><div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;<span class="comment">!     upper - co2, p = 12.9350 mbar, t = 234.01 k</span></div><div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;</div><div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;<span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div><div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;<span class="comment">!           fraction in lower atmosphere.</span></div><div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;</div><div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;      refrat_planck_a = chi_mls(1,3)/chi_mls(3,3)     <span class="comment">! P = 706.2620 mb</span></div><div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;      refrat_m_a = chi_mls(1,3)/chi_mls(3,3)          <span class="comment">! P = 706.2720 mb</span></div><div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;</div><div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;</div><div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;        speccomb = colamt(k,1) + rfrate(k,2,1)*colamt(k,3)</div><div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;        specparm = colamt(k,1) / speccomb</div><div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;        specmult = 8.0 * min(specparm, oneminus)</div><div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(7) + js</div><div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;</div><div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;        speccomb1 = colamt(k,1) + rfrate(k,2,2)*colamt(k,3)</div><div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;        specparm1 = colamt(k,1) / speccomb1</div><div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;        specmult1 = 8.0 * min(specparm1, oneminus)</div><div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;        js1 = 1 + int(specmult1)</div><div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;        fs1 = mod(specmult1, f_one)</div><div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(7) + js1</div><div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;</div><div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;        speccomb_mco2 = colamt(k,1) + refrat_m_a*colamt(k,3)</div><div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;        specparm_mco2 = colamt(k,1) / speccomb_mco2</div><div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;        specmult_mco2 = 8.0 * min(specparm_mco2, oneminus)</div><div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;        jmco2 = 1 + int(specmult_mco2)</div><div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;        fmco2 = mod(specmult_mco2, f_one)</div><div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;</div><div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,3)</div><div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;        specparm_planck = colamt(k,1) / speccomb_planck</div><div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div><div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;        jpl = 1 + int(specmult_planck)</div><div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;        fpl = mod(specmult_planck, f_one)</div><div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;</div><div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;        inds = indself(k)</div><div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;        jplp  = jpl  + 1</div><div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;        jmco2p= jmco2+ 1</div><div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;</div><div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;<span class="comment">!  --- ...  in atmospheres where the amount of CO2 is too great to be considered</span></div><div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;<span class="comment">!           a minor species, adjust the column amount of CO2 by an empirical factor</span></div><div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;<span class="comment">!           to obtain the proper contribution.</span></div><div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;</div><div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;        temp   = coldry(k) * chi_mls(2,jp(k)+1)</div><div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;        ratco2 = colamt(k,2) / temp</div><div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;        <span class="keywordflow">if</span> (ratco2 &gt; 3.0) <span class="keywordflow">then</span></div><div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;          adjfac = 3.0 + (ratco2-3.0)**0.79</div><div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;          adjcolco2 = adjfac * temp</div><div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;          adjcolco2 = colamt(k,2)</div><div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;</div><div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;          p0 = fs - f_one</div><div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;          p40 = p0**4</div><div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;          fk00 = p40</div><div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;</div><div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;          id000 = ind0</div><div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;          id200 = ind0 + 2</div><div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;          id210 = ind0 +11</div><div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;          p0 = -fs</div><div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;          p40 = p0**4</div><div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;          fk00 = p40</div><div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;</div><div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;          id000 = ind0 + 1</div><div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;          id010 = ind0 +10</div><div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;          id100 = ind0</div><div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;          id110 = ind0 + 9</div><div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;          id200 = ind0 - 1</div><div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;          id210 = ind0 + 8</div><div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;          fk00 = f_one - fs</div><div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;          fk10 = fs</div><div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;          fk20 = f_zero</div><div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;</div><div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;          id000 = ind0</div><div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;          id200 = ind0</div><div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;          id210 = ind0</div><div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;</div><div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;        fac000 = fk00 * fac00(k)</div><div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;        fac100 = fk10 * fac00(k)</div><div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;        fac200 = fk20 * fac00(k)</div><div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;        fac010 = fk00 * fac10(k)</div><div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;        fac110 = fk10 * fac10(k)</div><div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;        fac210 = fk20 * fac10(k)</div><div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;</div><div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;          p1 = fs1 - f_one</div><div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;          p41 = p1**4</div><div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;          fk01 = p41</div><div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;</div><div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;          id001 = ind1</div><div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;          id201 = ind1 + 2</div><div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;          id211 = ind1 +11</div><div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;          p1 = -fs1</div><div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;          p41 = p1**4</div><div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;          fk01 = p41</div><div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;</div><div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;          id001 = ind1 + 1</div><div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;          id011 = ind1 +10</div><div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;          id101 = ind1</div><div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;          id111 = ind1 + 9</div><div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;          id201 = ind1 - 1</div><div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;          id211 = ind1 + 8</div><div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;          fk01 = f_one - fs1</div><div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;          fk11 = fs1</div><div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;          fk21 = f_zero</div><div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;</div><div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;          id001 = ind1</div><div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;          id201 = ind1</div><div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;          id211 = ind1</div><div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;</div><div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;        fac001 = fk01 * fac01(k)</div><div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;        fac101 = fk11 * fac01(k)</div><div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;        fac201 = fk21 * fac01(k)</div><div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;        fac011 = fk01 * fac11(k)</div><div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;        fac111 = fk11 * fac11(k)</div><div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;        fac211 = fk21 * fac11(k)</div><div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;</div><div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng07</div><div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;          tauself = selffac(k)* (<a class="code" href="group__module__radlw__kgbnn.html#gaaf6d41f390a0465af92756b9c3e6c558">selfref</a>(ig,inds) + selffrac(k)         &amp;</div><div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gaaf6d41f390a0465af92756b9c3e6c558">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#gaaf6d41f390a0465af92756b9c3e6c558">selfref</a>(ig,inds)))</div><div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;     &amp;            * (forref(ig,indfp) - forref(ig,indf))) </div><div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;          co2m1   = <a class="code" href="group__module__radlw__kgbnn.html#ga3fdad494f3d3fcf9306da6a81d97bd43">ka_mco2</a>(ig,jmco2,indm) + fmco2                      &amp;</div><div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga3fdad494f3d3fcf9306da6a81d97bd43">ka_mco2</a>(ig,jmco2p,indm) - <a class="code" href="group__module__radlw__kgbnn.html#ga3fdad494f3d3fcf9306da6a81d97bd43">ka_mco2</a>(ig,jmco2,indm))</div><div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;          co2m2   = <a class="code" href="group__module__radlw__kgbnn.html#ga3fdad494f3d3fcf9306da6a81d97bd43">ka_mco2</a>(ig,jmco2,indmp) + fmco2                     &amp;</div><div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga3fdad494f3d3fcf9306da6a81d97bd43">ka_mco2</a>(ig,jmco2p,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#ga3fdad494f3d3fcf9306da6a81d97bd43">ka_mco2</a>(ig,jmco2,indmp))</div><div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;          absco2  = co2m1 + minorfrac(k) * (co2m2 - co2m1)</div><div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;</div><div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;          taug(ns07+ig,k) = speccomb                                    &amp;</div><div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;     &amp;                * (fac000*<a class="code" href="group__module__radlw__kgbnn.html#gaf106cf054f7496a092ceb0c399753a36">absa</a>(ig,id000) + fac010*<a class="code" href="group__module__radlw__kgbnn.html#gaf106cf054f7496a092ceb0c399753a36">absa</a>(ig,id010)  &amp;</div><div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;     &amp;                +  fac100*<a class="code" href="group__module__radlw__kgbnn.html#gaf106cf054f7496a092ceb0c399753a36">absa</a>(ig,id100) + fac110*<a class="code" href="group__module__radlw__kgbnn.html#gaf106cf054f7496a092ceb0c399753a36">absa</a>(ig,id110)  &amp;</div><div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;     &amp;                +  fac200*<a class="code" href="group__module__radlw__kgbnn.html#gaf106cf054f7496a092ceb0c399753a36">absa</a>(ig,id200) + fac210*<a class="code" href="group__module__radlw__kgbnn.html#gaf106cf054f7496a092ceb0c399753a36">absa</a>(ig,id210)) &amp;</div><div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;     &amp;                +     speccomb1                                   &amp;</div><div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;     &amp;                * (fac001*<a class="code" href="group__module__radlw__kgbnn.html#gaf106cf054f7496a092ceb0c399753a36">absa</a>(ig,id001) + fac011*<a class="code" href="group__module__radlw__kgbnn.html#gaf106cf054f7496a092ceb0c399753a36">absa</a>(ig,id011)  &amp;</div><div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;     &amp;                +  fac101*<a class="code" href="group__module__radlw__kgbnn.html#gaf106cf054f7496a092ceb0c399753a36">absa</a>(ig,id101) + fac111*<a class="code" href="group__module__radlw__kgbnn.html#gaf106cf054f7496a092ceb0c399753a36">absa</a>(ig,id111)  &amp;</div><div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;     &amp;                +  fac201*<a class="code" href="group__module__radlw__kgbnn.html#gaf106cf054f7496a092ceb0c399753a36">absa</a>(ig,id201) + fac211*<a class="code" href="group__module__radlw__kgbnn.html#gaf106cf054f7496a092ceb0c399753a36">absa</a>(ig,id211)) &amp;</div><div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;     &amp;                + tauself + taufor + adjcolco2*absco2</div><div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;</div><div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;          fracs(ns07+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga07f2a4a0f1152a65aed68623f14a9ae4">fracrefa</a>(ig,jpl) + fpl                     &amp;</div><div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;     &amp;                     * (<a class="code" href="group__module__radlw__kgbnn.html#ga07f2a4a0f1152a65aed68623f14a9ae4">fracrefa</a>(ig,jplp) - <a class="code" href="group__module__radlw__kgbnn.html#ga07f2a4a0f1152a65aed68623f14a9ae4">fracrefa</a>(ig,jpl))</div><div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;</div><div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;</div><div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;<span class="comment">!  --- ...  in atmospheres where the amount of co2 is too great to be considered</span></div><div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;<span class="comment">!           a minor species, adjust the column amount of co2 by an empirical factor</span></div><div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;<span class="comment">!           to obtain the proper contribution.</span></div><div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;</div><div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;        temp   = coldry(k) * chi_mls(2,jp(k)+1)</div><div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;        ratco2 = colamt(k,2) / temp</div><div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;        <span class="keywordflow">if</span> (ratco2 &gt; 3.0) <span class="keywordflow">then</span></div><div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;          adjfac = 2.0 + (ratco2-2.0)**0.79</div><div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;          adjcolco2 = adjfac * temp</div><div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;          adjcolco2 = colamt(k,2)</div><div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;</div><div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(7) + 1</div><div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(7) + 1</div><div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;</div><div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;</div><div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng07</div><div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;          absco2 = <a class="code" href="group__module__radlw__kgbnn.html#ga2dcfbe76332d559cda48c7ba065ab349">kb_mco2</a>(ig,indm) + minorfrac(k)                      &amp;</div><div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;     &amp;           * (<a class="code" href="group__module__radlw__kgbnn.html#ga2dcfbe76332d559cda48c7ba065ab349">kb_mco2</a>(ig,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#ga2dcfbe76332d559cda48c7ba065ab349">kb_mco2</a>(ig,indm))</div><div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;</div><div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;          taug(ns07+ig,k) = colamt(k,3)                                 &amp;</div><div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;     &amp;            * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#gab0478438e9bbe64401aa492510f8d4bb">absb</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#gab0478438e9bbe64401aa492510f8d4bb">absb</a>(ig,ind0p)   &amp;</div><div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;     &amp;            +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#gab0478438e9bbe64401aa492510f8d4bb">absb</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#gab0478438e9bbe64401aa492510f8d4bb">absb</a>(ig,ind1p))  &amp;</div><div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;     &amp;            + adjcolco2 * absco2</div><div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;</div><div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;          fracs(ns07+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#gaa16eb60406e5a298e380b55af528791a">fracrefb</a>(ig)</div><div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;</div><div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;<span class="comment">!  --- ...  empirical modification to code to improve stratospheric cooling rates</span></div><div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;<span class="comment">!           for o3.  revised to apply weighting for g-point reduction in this band.</span></div><div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;</div><div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;        taug(ns07+ 6,k) = taug(ns07+ 6,k) * 0.92</div><div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;        taug(ns07+ 7,k) = taug(ns07+ 7,k) * 0.88</div><div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;        taug(ns07+ 8,k) = taug(ns07+ 8,k) * 1.07</div><div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;        taug(ns07+ 9,k) = taug(ns07+ 9,k) * 1.1</div><div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;        taug(ns07+10,k) = taug(ns07+10,k) * 0.99</div><div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;        taug(ns07+11,k) = taug(ns07+11,k) * 0.855</div><div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;</div><div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#a2208d86ae0712a0ca426bbe96de825bc">taugb07</a></div><div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;</div><div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#a1447d5bda5b521d27171e61881684183">taugb08</a></div><div class="line"><a name="l05219"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#a1447d5bda5b521d27171e61881684183"> 5219</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;</div><div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;<span class="comment">!     band 8:  1080-1180 cm-1 (low key - h2o; low minor - co2,o3,n2o)  !</span></div><div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;<span class="comment">!                             (high key - o3; high minor - co2, n2o)   !</span></div><div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;</div><div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb08.html">module_radlw_kgb08</a></div><div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;</div><div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div><div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;     &amp;       indm, indmp, ig</div><div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;</div><div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tauself, taufor, absco2, abso3, absn2o,  &amp;</div><div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;     &amp;      ratco2, adjfac, adjcolco2, temp</div><div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;<span class="comment">!  --- ...  minor gas mapping level:</span></div><div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;<span class="comment">!     lower - co2, p = 1053.63 mb, t = 294.2 k</span></div><div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;<span class="comment">!     lower - o3,  p = 317.348 mb, t = 240.77 k</span></div><div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;<span class="comment">!     lower - n2o, p = 706.2720 mb, t= 278.94 k</span></div><div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;<span class="comment">!     lower - cfc12,cfc11</span></div><div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;<span class="comment">!     upper - co2, p = 35.1632 mb, t = 223.28 k</span></div><div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;<span class="comment">!     upper - n2o, p = 8.716e-2 mb, t = 226.03 k</span></div><div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;</div><div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;</div><div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(8) + 1</div><div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(8) + 1</div><div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;</div><div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;        inds = indself(k)</div><div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;</div><div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;<span class="comment">!  --- ...  in atmospheres where the amount of co2 is too great to be considered</span></div><div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;<span class="comment">!           a minor species, adjust the column amount of co2 by an empirical factor</span></div><div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;<span class="comment">!           to obtain the proper contribution.</span></div><div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;</div><div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;        temp   = coldry(k) * chi_mls(2,jp(k)+1)</div><div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;        ratco2 = colamt(k,2) / temp</div><div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;        <span class="keywordflow">if</span> (ratco2 &gt; 3.0) <span class="keywordflow">then</span></div><div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;          adjfac = 2.0 + (ratco2-2.0)**0.65</div><div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;          adjcolco2 = adjfac * temp</div><div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;          adjcolco2 = colamt(k,2)</div><div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;</div><div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng08</div><div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;          tauself = selffac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga2c38561d26f86f7ae515b433843c4e5d">selfref</a>(ig,inds) + selffrac(k)        &amp;</div><div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga2c38561d26f86f7ae515b433843c4e5d">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#ga2c38561d26f86f7ae515b433843c4e5d">selfref</a>(ig,inds)))</div><div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga8427ec5170f6a61a008a8580be6fe5ec">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga8427ec5170f6a61a008a8580be6fe5ec">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#ga8427ec5170f6a61a008a8580be6fe5ec">forref</a>(ig,indf)))</div><div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;          absco2  = (<a class="code" href="group__module__radlw__kgbnn.html#ga0fcd13503b3253ec6aab0aa52056f634">ka_mco2</a>(ig,indm) + minorfrac(k)                    &amp;</div><div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga0fcd13503b3253ec6aab0aa52056f634">ka_mco2</a>(ig,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#ga0fcd13503b3253ec6aab0aa52056f634">ka_mco2</a>(ig,indm)))</div><div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;          abso3   = (<a class="code" href="group__module__radlw__kgbnn.html#ga7dec65e880c278f44419c1ae01490eae">ka_mo3</a>(ig,indm) + minorfrac(k)                     &amp;</div><div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga7dec65e880c278f44419c1ae01490eae">ka_mo3</a>(ig,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#ga7dec65e880c278f44419c1ae01490eae">ka_mo3</a>(ig,indm)))</div><div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;          absn2o  = (<a class="code" href="group__module__radlw__kgbnn.html#ga61949dc331e9a58d4f2a31b625481795">ka_mn2o</a>(ig,indm) + minorfrac(k)                    &amp;</div><div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga61949dc331e9a58d4f2a31b625481795">ka_mn2o</a>(ig,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#ga61949dc331e9a58d4f2a31b625481795">ka_mn2o</a>(ig,indm)))</div><div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;</div><div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;          taug(ns08+ig,k) = colamt(k,1)                                 &amp;</div><div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;     &amp;            * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#gaba1018958264bbc6fbf7f190fea91fa5">absa</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#gaba1018958264bbc6fbf7f190fea91fa5">absa</a>(ig,ind0p)   &amp;</div><div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;     &amp;            +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#gaba1018958264bbc6fbf7f190fea91fa5">absa</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#gaba1018958264bbc6fbf7f190fea91fa5">absa</a>(ig,ind1p))  &amp;</div><div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;     &amp;            + tauself+taufor + adjcolco2*absco2                   &amp;</div><div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;     &amp;            + colamt(k,3)*abso3 + colamt(k,4)*absn2o              &amp;</div><div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;     &amp;            + wx(k,3)*<a class="code" href="group__module__radlw__kgbnn.html#ga010239f14788bc1ed9953133e30a62fd">cfc12</a>(ig) + wx(k,4)*<a class="code" href="group__module__radlw__kgbnn.html#ga38a3ce7d8f3db6b732511cf78ef735db">cfc22adj</a>(ig)</div><div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;</div><div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;          fracs(ns08+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#gad1a59ffb362cd72537df9c1916c07621">fracrefa</a>(ig)</div><div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;</div><div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;</div><div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(8) + 1</div><div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(8) + 1</div><div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;</div><div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;</div><div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;<span class="comment">!  --- ...  in atmospheres where the amount of co2 is too great to be considered</span></div><div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;<span class="comment">!           a minor species, adjust the column amount of co2 by an empirical factor</span></div><div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;<span class="comment">!           to obtain the proper contribution.</span></div><div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;</div><div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;        temp   = coldry(k) * chi_mls(2,jp(k)+1)</div><div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;        ratco2 = colamt(k,2) / temp</div><div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;        <span class="keywordflow">if</span> (ratco2 &gt; 3.0) <span class="keywordflow">then</span></div><div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;          adjfac = 2.0 + (ratco2-2.0)**0.65</div><div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;          adjcolco2 = adjfac * temp</div><div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;          adjcolco2 = colamt(k,2)</div><div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;</div><div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng08</div><div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;          absco2 = (<a class="code" href="group__module__radlw__kgbnn.html#ga9a85770aee1b88b9323d9466c1772ec4">kb_mco2</a>(ig,indm) + minorfrac(k)                     &amp;</div><div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;     &amp;           * (<a class="code" href="group__module__radlw__kgbnn.html#ga9a85770aee1b88b9323d9466c1772ec4">kb_mco2</a>(ig,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#ga9a85770aee1b88b9323d9466c1772ec4">kb_mco2</a>(ig,indm)))</div><div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;          absn2o = (<a class="code" href="group__module__radlw__kgbnn.html#ga9a8e2f789421acc307e37b03478efb4b">kb_mn2o</a>(ig,indm) + minorfrac(k)                     &amp;</div><div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;     &amp;           * (<a class="code" href="group__module__radlw__kgbnn.html#ga9a8e2f789421acc307e37b03478efb4b">kb_mn2o</a>(ig,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#ga9a8e2f789421acc307e37b03478efb4b">kb_mn2o</a>(ig,indm)))</div><div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;</div><div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;          taug(ns08+ig,k) = colamt(k,3)                                 &amp;</div><div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;     &amp;           * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga23d4352fcafb0394d723e2f080a84ece">absb</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga23d4352fcafb0394d723e2f080a84ece">absb</a>(ig,ind0p)    &amp;</div><div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;     &amp;           +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga23d4352fcafb0394d723e2f080a84ece">absb</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga23d4352fcafb0394d723e2f080a84ece">absb</a>(ig,ind1p))   &amp;</div><div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;     &amp;           + adjcolco2*absco2 + colamt(k,4)*absn2o                &amp;</div><div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;     &amp;           + wx(k,3)*<a class="code" href="group__module__radlw__kgbnn.html#ga010239f14788bc1ed9953133e30a62fd">cfc12</a>(ig) + wx(k,4)*<a class="code" href="group__module__radlw__kgbnn.html#ga38a3ce7d8f3db6b732511cf78ef735db">cfc22adj</a>(ig)</div><div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;</div><div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;          fracs(ns08+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga0ae7e4c01034a2b95c03b041537b962e">fracrefb</a>(ig)</div><div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;</div><div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#a1447d5bda5b521d27171e61881684183">taugb08</a></div><div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;</div><div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#a889abbaaa2d421c0c3dc820e2004414d">taugb09</a></div><div class="line"><a name="l05344"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#a889abbaaa2d421c0c3dc820e2004414d"> 5344</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;</div><div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;<span class="comment">!     band 9:  1180-1390 cm-1 (low key - h2o,ch4; low minor - n2o)     !</span></div><div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;<span class="comment">!                             (high key - ch4; high minor - n2o)       !</span></div><div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;</div><div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb09.html">module_radlw_kgb09</a></div><div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;</div><div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div><div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;     &amp;       id000, id010, id100, id110, id200, id210, indm, indmp,     &amp;</div><div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;     &amp;       id001, id011, id101, id111, id201, id211, jmn2o, jmn2op,   &amp;</div><div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;     &amp;       jpl, jplp, ig, js, js1</div><div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;</div><div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tauself, taufor, n2om1, n2om2, absn2o,   &amp;</div><div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;     &amp;       speccomb,       specparm,       specmult,       fs,        &amp;</div><div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;     &amp;       speccomb1,      specparm1,      specmult1,      fs1,       &amp;</div><div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;     &amp;       speccomb_mn2o,  specparm_mn2o,  specmult_mn2o,  fmn2o,     &amp;</div><div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;     &amp;       speccomb_planck,specparm_planck,specmult_planck,fpl,       &amp;</div><div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;     &amp;       refrat_planck_a, refrat_m_a, ratn2o, adjfac, adjcoln2o,    &amp;</div><div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;     &amp;       fac000, fac100, fac200, fac010, fac110, fac210,            &amp;</div><div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;     &amp;       fac001, fac101, fac201, fac011, fac111, fac211,            &amp;</div><div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;     &amp;       p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21, temp</div><div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;<span class="comment">!  --- ...  minor gas mapping level :</span></div><div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;<span class="comment">!     lower - n2o, p = 706.272 mbar, t = 278.94 k</span></div><div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;<span class="comment">!     upper - n2o, p = 95.58 mbar, t = 215.7 k</span></div><div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;</div><div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;<span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div><div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;<span class="comment">!           fraction in lower/upper atmosphere.</span></div><div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;</div><div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;      refrat_planck_a = chi_mls(1,9)/chi_mls(6,9)       <span class="comment">! P = 212 mb</span></div><div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;      refrat_m_a = chi_mls(1,3)/chi_mls(6,3)            <span class="comment">! P = 706.272 mb</span></div><div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;</div><div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;</div><div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;        speccomb = colamt(k,1) + rfrate(k,4,1)*colamt(k,5)</div><div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;        specparm = colamt(k,1) / speccomb</div><div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;        specmult = 8.0 * min(specparm, oneminus)</div><div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(9) + js</div><div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;</div><div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;        speccomb1 = colamt(k,1) + rfrate(k,4,2)*colamt(k,5)</div><div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;        specparm1 = colamt(k,1) / speccomb1</div><div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;        specmult1 = 8.0 * min(specparm1, oneminus)</div><div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;        js1 = 1 + int(specmult1)</div><div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;        fs1 = mod(specmult1, f_one)</div><div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(9) + js1</div><div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;</div><div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;        speccomb_mn2o = colamt(k,1) + refrat_m_a*colamt(k,5)</div><div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;        specparm_mn2o = colamt(k,1) / speccomb_mn2o</div><div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;        specmult_mn2o = 8.0 * min(specparm_mn2o, oneminus)</div><div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;        jmn2o = 1 + int(specmult_mn2o)</div><div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;        fmn2o = mod(specmult_mn2o, f_one)</div><div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;</div><div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,5)</div><div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;        specparm_planck = colamt(k,1) / speccomb_planck</div><div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div><div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;        jpl = 1 + int(specmult_planck)</div><div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;        fpl = mod(specmult_planck, f_one)</div><div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;</div><div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;        inds = indself(k)</div><div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;        jplp  = jpl  + 1</div><div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;        jmn2op= jmn2o+ 1</div><div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;</div><div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;<span class="comment">!  --- ...  in atmospheres where the amount of n2o is too great to be considered</span></div><div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;<span class="comment">!           a minor species, adjust the column amount of n2o by an empirical factor</span></div><div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;<span class="comment">!           to obtain the proper contribution.</span></div><div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;</div><div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;        temp   = coldry(k) * chi_mls(4,jp(k)+1)</div><div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;        ratn2o = colamt(k,4) / temp</div><div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;        <span class="keywordflow">if</span> (ratn2o &gt; 1.5) <span class="keywordflow">then</span></div><div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;          adjfac = 0.5 + (ratn2o-0.5)**0.65</div><div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;          adjcoln2o = adjfac * temp</div><div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;          adjcoln2o = colamt(k,4)</div><div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;</div><div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;          p0 = fs - f_one</div><div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;          p40 = p0**4</div><div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;          fk00 = p40</div><div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;</div><div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;          id000 = ind0</div><div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;          id200 = ind0 + 2</div><div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;          id210 = ind0 +11</div><div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;          p0 = -fs</div><div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;          p40 = p0**4</div><div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;          fk00 = p40</div><div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;</div><div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;          id000 = ind0 + 1</div><div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;          id010 = ind0 +10</div><div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;          id100 = ind0</div><div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;          id110 = ind0 + 9</div><div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;          id200 = ind0 - 1</div><div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;          id210 = ind0 + 8</div><div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;          fk00 = f_one - fs</div><div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;          fk10 = fs</div><div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;          fk20 = f_zero</div><div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;</div><div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;          id000 = ind0</div><div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;          id200 = ind0</div><div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;          id210 = ind0</div><div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;</div><div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;        fac000 = fk00 * fac00(k)</div><div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;        fac100 = fk10 * fac00(k)</div><div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;        fac200 = fk20 * fac00(k)</div><div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;        fac010 = fk00 * fac10(k)</div><div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;        fac110 = fk10 * fac10(k)</div><div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;        fac210 = fk20 * fac10(k)</div><div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;</div><div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;          p1 = fs1 - f_one</div><div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;          p41 = p1**4</div><div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;          fk01 = p41</div><div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;</div><div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;          id001 = ind1</div><div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;          id201 = ind1 + 2</div><div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;          id211 = ind1 +11</div><div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;          p1 = -fs1</div><div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;          p41 = p1**4</div><div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;          fk01 = p41</div><div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;</div><div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;          id001 = ind1 + 1</div><div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;          id011 = ind1 +10</div><div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;          id101 = ind1</div><div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;          id111 = ind1 + 9</div><div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;          id201 = ind1 - 1</div><div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;          id211 = ind1 + 8</div><div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;          fk01 = f_one - fs1</div><div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;          fk11 = fs1</div><div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;          fk21 = f_zero</div><div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;</div><div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;          id001 = ind1</div><div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;          id201 = ind1</div><div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;          id211 = ind1</div><div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;</div><div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;        fac001 = fk01 * fac01(k)</div><div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;        fac101 = fk11 * fac01(k)</div><div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;        fac201 = fk21 * fac01(k)</div><div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;        fac011 = fk01 * fac11(k)</div><div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;        fac111 = fk11 * fac11(k)</div><div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;        fac211 = fk21 * fac11(k)</div><div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;</div><div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng09</div><div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;          tauself = selffac(k)* (<a class="code" href="group__module__radlw__kgbnn.html#ga1c65e91a215060738292d0ca5a8f38a2">selfref</a>(ig,inds) + selffrac(k)         &amp;</div><div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga1c65e91a215060738292d0ca5a8f38a2">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#ga1c65e91a215060738292d0ca5a8f38a2">selfref</a>(ig,inds)))</div><div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga72a8c0879636dba20e2a8a35ba79f681">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga72a8c0879636dba20e2a8a35ba79f681">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#ga72a8c0879636dba20e2a8a35ba79f681">forref</a>(ig,indf))) </div><div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;          n2om1   = <a class="code" href="group__module__radlw__kgbnn.html#ga37d98e8066c5995060a2a8451b45705f">ka_mn2o</a>(ig,jmn2o,indm) + fmn2o                      &amp;</div><div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga37d98e8066c5995060a2a8451b45705f">ka_mn2o</a>(ig,jmn2op,indm) - <a class="code" href="group__module__radlw__kgbnn.html#ga37d98e8066c5995060a2a8451b45705f">ka_mn2o</a>(ig,jmn2o,indm))</div><div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;          n2om2   = <a class="code" href="group__module__radlw__kgbnn.html#ga37d98e8066c5995060a2a8451b45705f">ka_mn2o</a>(ig,jmn2o,indmp) + fmn2o                     &amp;</div><div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga37d98e8066c5995060a2a8451b45705f">ka_mn2o</a>(ig,jmn2op,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#ga37d98e8066c5995060a2a8451b45705f">ka_mn2o</a>(ig,jmn2o,indmp))</div><div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;          absn2o  = n2om1 + minorfrac(k) * (n2om2 - n2om1)</div><div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;</div><div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;          taug(ns09+ig,k) = speccomb                                    &amp;</div><div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;     &amp;                * (fac000*<a class="code" href="group__module__radlw__kgbnn.html#ga7a8726efe46fac4d6cce55ca357199ab">absa</a>(ig,id000) + fac010*<a class="code" href="group__module__radlw__kgbnn.html#ga7a8726efe46fac4d6cce55ca357199ab">absa</a>(ig,id010)  &amp;</div><div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;     &amp;                +  fac100*<a class="code" href="group__module__radlw__kgbnn.html#ga7a8726efe46fac4d6cce55ca357199ab">absa</a>(ig,id100) + fac110*<a class="code" href="group__module__radlw__kgbnn.html#ga7a8726efe46fac4d6cce55ca357199ab">absa</a>(ig,id110)  &amp;</div><div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;     &amp;                +  fac200*<a class="code" href="group__module__radlw__kgbnn.html#ga7a8726efe46fac4d6cce55ca357199ab">absa</a>(ig,id200) + fac210*<a class="code" href="group__module__radlw__kgbnn.html#ga7a8726efe46fac4d6cce55ca357199ab">absa</a>(ig,id210)) &amp;</div><div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;     &amp;                +     speccomb1                                   &amp;</div><div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;     &amp;                * (fac001*<a class="code" href="group__module__radlw__kgbnn.html#ga7a8726efe46fac4d6cce55ca357199ab">absa</a>(ig,id001) + fac011*<a class="code" href="group__module__radlw__kgbnn.html#ga7a8726efe46fac4d6cce55ca357199ab">absa</a>(ig,id011)  &amp;</div><div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;     &amp;                +  fac101*<a class="code" href="group__module__radlw__kgbnn.html#ga7a8726efe46fac4d6cce55ca357199ab">absa</a>(ig,id101) + fac111*<a class="code" href="group__module__radlw__kgbnn.html#ga7a8726efe46fac4d6cce55ca357199ab">absa</a>(ig,id111)  &amp;</div><div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;     &amp;                +  fac201*<a class="code" href="group__module__radlw__kgbnn.html#ga7a8726efe46fac4d6cce55ca357199ab">absa</a>(ig,id201) + fac211*<a class="code" href="group__module__radlw__kgbnn.html#ga7a8726efe46fac4d6cce55ca357199ab">absa</a>(ig,id211)) &amp;</div><div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;     &amp;                + tauself + taufor + adjcoln2o*absn2o            </div><div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;</div><div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;          fracs(ns09+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#gace3d3e2731609f7ea50eb798bd212f3b">fracrefa</a>(ig,jpl) + fpl                     &amp;</div><div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;     &amp;                     * (<a class="code" href="group__module__radlw__kgbnn.html#gace3d3e2731609f7ea50eb798bd212f3b">fracrefa</a>(ig,jplp) - <a class="code" href="group__module__radlw__kgbnn.html#gace3d3e2731609f7ea50eb798bd212f3b">fracrefa</a>(ig,jpl))</div><div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;</div><div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;</div><div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(9) + 1</div><div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(9) + 1</div><div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;</div><div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;</div><div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;<span class="comment">!  --- ...  in atmospheres where the amount of n2o is too great to be considered</span></div><div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;<span class="comment">!           a minor species, adjust the column amount of n2o by an empirical factor</span></div><div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;<span class="comment">!           to obtain the proper contribution.</span></div><div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;</div><div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;        temp   = coldry(k) * chi_mls(4,jp(k)+1)</div><div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;        ratn2o = colamt(k,4) / temp</div><div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;        <span class="keywordflow">if</span> (ratn2o &gt; 1.5) <span class="keywordflow">then</span></div><div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;          adjfac = 0.5 + (ratn2o - 0.5)**0.65</div><div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;          adjcoln2o = adjfac * temp</div><div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;          adjcoln2o = colamt(k,4)</div><div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;</div><div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng09</div><div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;          absn2o = <a class="code" href="group__module__radlw__kgbnn.html#ga79326139db789012d47c4750917c2cdb">kb_mn2o</a>(ig,indm) + minorfrac(k)                      &amp;</div><div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;     &amp;           * (<a class="code" href="group__module__radlw__kgbnn.html#ga79326139db789012d47c4750917c2cdb">kb_mn2o</a>(ig,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#ga79326139db789012d47c4750917c2cdb">kb_mn2o</a>(ig,indm))</div><div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;</div><div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;          taug(ns09+ig,k) = colamt(k,5)                                 &amp;</div><div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;     &amp;           * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#gadb2110a245d9f01b3fd1ab058c883003">absb</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#gadb2110a245d9f01b3fd1ab058c883003">absb</a>(ig,ind0p)    &amp;</div><div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;     &amp;           +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#gadb2110a245d9f01b3fd1ab058c883003">absb</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#gadb2110a245d9f01b3fd1ab058c883003">absb</a>(ig,ind1p))   &amp;</div><div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;     &amp;           + adjcoln2o*absn2o</div><div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;</div><div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;          fracs(ns09+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga26476f00fe13c1c81d3ae0cf8e43c90b">fracrefb</a>(ig)</div><div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;</div><div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#a889abbaaa2d421c0c3dc820e2004414d">taugb09</a></div><div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;</div><div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#a74c1cb8390daff1e5ce5e863c50b7873">taugb10</a></div><div class="line"><a name="l05594"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#a74c1cb8390daff1e5ce5e863c50b7873"> 5594</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;</div><div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;<span class="comment">!     band 10:  1390-1480 cm-1 (low key - h2o; high key - h2o)         !</span></div><div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;</div><div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb10.html">module_radlw_kgb10</a></div><div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;</div><div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div><div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;     &amp;       ig</div><div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;</div><div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tauself, taufor</div><div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;</div><div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(10) + 1</div><div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(10) + 1</div><div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;</div><div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;        inds = indself(k)</div><div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;</div><div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng10</div><div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;          tauself = selffac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga48247dea283a611ebe57dd1c164dda69">selfref</a>(ig,inds) + selffrac(k)        &amp;</div><div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga48247dea283a611ebe57dd1c164dda69">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#ga48247dea283a611ebe57dd1c164dda69">selfref</a>(ig,inds)))</div><div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#gaf70e39048d571053790289549dd8333a">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gaf70e39048d571053790289549dd8333a">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#gaf70e39048d571053790289549dd8333a">forref</a>(ig,indf))) </div><div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;</div><div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;          taug(ns10+ig,k) = colamt(k,1)                                 &amp;</div><div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;     &amp;            * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga14f18538f77c1a3d651e36acf90baa19">absa</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga14f18538f77c1a3d651e36acf90baa19">absa</a>(ig,ind0p)   &amp;</div><div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;     &amp;            +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga14f18538f77c1a3d651e36acf90baa19">absa</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga14f18538f77c1a3d651e36acf90baa19">absa</a>(ig,ind1p))  &amp;</div><div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;     &amp;            + tauself + taufor</div><div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;</div><div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;          fracs(ns10+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#gaa8bbfdaf370e12ae26d2ee3c464bdbc2">fracrefa</a>(ig)</div><div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;</div><div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;</div><div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(10) + 1</div><div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(10) + 1</div><div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;</div><div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;</div><div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng10</div><div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;          taufor = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#gaf70e39048d571053790289549dd8333a">forref</a>(ig,indf) + forfrac(k)            &amp;</div><div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;     &amp;           * (<a class="code" href="group__module__radlw__kgbnn.html#gaf70e39048d571053790289549dd8333a">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#gaf70e39048d571053790289549dd8333a">forref</a>(ig,indf)))</div><div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;</div><div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;          taug(ns10+ig,k) = colamt(k,1)                                 &amp;</div><div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;     &amp;            * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#gaf1e2252355a3002080be21ce37d45c3a">absb</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#gaf1e2252355a3002080be21ce37d45c3a">absb</a>(ig,ind0p)   &amp;</div><div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;     &amp;            +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#gaf1e2252355a3002080be21ce37d45c3a">absb</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#gaf1e2252355a3002080be21ce37d45c3a">absb</a>(ig,ind1p))  &amp;</div><div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;     &amp;            + taufor</div><div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;</div><div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;          fracs(ns10+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga07d5bac00d30f1ab873a0542b28d7e83">fracrefb</a>(ig)</div><div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;</div><div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#a74c1cb8390daff1e5ce5e863c50b7873">taugb10</a></div><div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;</div><div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#a573fd5b3580d6bbf5bfa2f01ee547034">taugb11</a></div><div class="line"><a name="l05670"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#a573fd5b3580d6bbf5bfa2f01ee547034"> 5670</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;</div><div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;<span class="comment">!     band 11:  1480-1800 cm-1 (low - h2o; low minor - o2)             !</span></div><div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;<span class="comment">!                              (high key - h2o; high minor - o2)       !</span></div><div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;</div><div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb11.html">module_radlw_kgb11</a></div><div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;</div><div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div><div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;     &amp;       indm, indmp, ig</div><div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;</div><div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: scaleo2, tauself, taufor, tauo2</div><div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160;<span class="comment">!  --- ...  minor gas mapping level :</span></div><div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;<span class="comment">!     lower - o2, p = 706.2720 mbar, t = 278.94 k</span></div><div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;<span class="comment">!     upper - o2, p = 4.758820 mbarm t = 250.85 k</span></div><div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;</div><div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160;</div><div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(11) + 1</div><div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160;        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(11) + 1</div><div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;</div><div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;        inds = indself(k)</div><div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;</div><div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;        scaleo2 = colamt(k,6) * scaleminor(k)</div><div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160;</div><div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng11</div><div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;          tauself = selffac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#gac98edefcce668d56c3aadc241863741f">selfref</a>(ig,inds) + selffrac(k)        &amp;</div><div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gac98edefcce668d56c3aadc241863741f">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#gac98edefcce668d56c3aadc241863741f">selfref</a>(ig,inds)))</div><div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga9239d06fcd3fca0f13302c1ae4eb5a60">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga9239d06fcd3fca0f13302c1ae4eb5a60">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#ga9239d06fcd3fca0f13302c1ae4eb5a60">forref</a>(ig,indf)))</div><div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;          tauo2   = scaleo2 * (<a class="code" href="group__module__radlw__kgbnn.html#ga8791eb290525c0d08fefa33ca23569c8">ka_mo2</a>(ig,indm) + minorfrac(k)           &amp;</div><div class="line"><a name="l05714"></a><span class="lineno"> 5714</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga8791eb290525c0d08fefa33ca23569c8">ka_mo2</a>(ig,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#ga8791eb290525c0d08fefa33ca23569c8">ka_mo2</a>(ig,indm)))</div><div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160;</div><div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;          taug(ns11+ig,k) = colamt(k,1)                                 &amp;</div><div class="line"><a name="l05717"></a><span class="lineno"> 5717</span>&#160;     &amp;            * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga7ac883387aa86a635c9aea011c55a1d5">absa</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga7ac883387aa86a635c9aea011c55a1d5">absa</a>(ig,ind0p)   &amp;</div><div class="line"><a name="l05718"></a><span class="lineno"> 5718</span>&#160;     &amp;            +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga7ac883387aa86a635c9aea011c55a1d5">absa</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#ga7ac883387aa86a635c9aea011c55a1d5">absa</a>(ig,ind1p))  &amp;</div><div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;     &amp;            + tauself + taufor + tauo2</div><div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;</div><div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;          fracs(ns11+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga5bf6552fb9c1e7c35729b2aea885306e">fracrefa</a>(ig)</div><div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;</div><div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;</div><div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160;        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(11) + 1</div><div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160;        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(11) + 1</div><div class="line"><a name="l05730"></a><span class="lineno"> 5730</span>&#160;</div><div class="line"><a name="l05731"></a><span class="lineno"> 5731</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l05732"></a><span class="lineno"> 5732</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l05733"></a><span class="lineno"> 5733</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l05734"></a><span class="lineno"> 5734</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;</div><div class="line"><a name="l05738"></a><span class="lineno"> 5738</span>&#160;        scaleo2 = colamt(k,6) * scaleminor(k)</div><div class="line"><a name="l05739"></a><span class="lineno"> 5739</span>&#160;</div><div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng11</div><div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;          taufor = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga9239d06fcd3fca0f13302c1ae4eb5a60">forref</a>(ig,indf) + forfrac(k)            &amp;</div><div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160;     &amp;           * (<a class="code" href="group__module__radlw__kgbnn.html#ga9239d06fcd3fca0f13302c1ae4eb5a60">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#ga9239d06fcd3fca0f13302c1ae4eb5a60">forref</a>(ig,indf))) </div><div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;          tauo2  = scaleo2 * (<a class="code" href="group__module__radlw__kgbnn.html#gaebc48e152bb90794b6d0b426f6c5f9e4">kb_mo2</a>(ig,indm) + minorfrac(k)            &amp;</div><div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160;     &amp;           * (<a class="code" href="group__module__radlw__kgbnn.html#gaebc48e152bb90794b6d0b426f6c5f9e4">kb_mo2</a>(ig,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#gaebc48e152bb90794b6d0b426f6c5f9e4">kb_mo2</a>(ig,indm)))</div><div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;</div><div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;          taug(ns11+ig,k) = colamt(k,1)                                 &amp;</div><div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;     &amp;            * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#gacf37465675961812e07616e42b137d70">absb</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#gacf37465675961812e07616e42b137d70">absb</a>(ig,ind0p)   &amp;</div><div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160;     &amp;            +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#gacf37465675961812e07616e42b137d70">absb</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#gacf37465675961812e07616e42b137d70">absb</a>(ig,ind1p))  &amp;</div><div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;     &amp;            + taufor + tauo2</div><div class="line"><a name="l05750"></a><span class="lineno"> 5750</span>&#160;</div><div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160;          fracs(ns11+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga0a89a2686ebc70a2c0d8577b89384a56">fracrefb</a>(ig)</div><div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;</div><div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l05756"></a><span class="lineno"> 5756</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#a573fd5b3580d6bbf5bfa2f01ee547034">taugb11</a></div><div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160;</div><div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#ae56eaa9e3b897ca235d4d6b271cc1e47">taugb12</a></div><div class="line"><a name="l05762"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#ae56eaa9e3b897ca235d4d6b271cc1e47"> 5762</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;</div><div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160;<span class="comment">!     band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)         !</span></div><div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160;</div><div class="line"><a name="l05768"></a><span class="lineno"> 5768</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb12.html">module_radlw_kgb12</a></div><div class="line"><a name="l05769"></a><span class="lineno"> 5769</span>&#160;</div><div class="line"><a name="l05770"></a><span class="lineno"> 5770</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind1, inds, indsp, indf, indfp, jpl, jplp,    &amp;</div><div class="line"><a name="l05772"></a><span class="lineno"> 5772</span>&#160;     &amp;       id000, id010, id100, id110, id200, id210, ig, js, js1,     &amp;</div><div class="line"><a name="l05773"></a><span class="lineno"> 5773</span>&#160;     &amp;       id001, id011, id101, id111, id201, id211</div><div class="line"><a name="l05774"></a><span class="lineno"> 5774</span>&#160;</div><div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tauself, taufor, refrat_planck_a,        &amp;</div><div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;     &amp;       speccomb,       specparm,       specmult,       fs,        &amp;</div><div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160;     &amp;       speccomb1,      specparm1,      specmult1,      fs1,       &amp;</div><div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;     &amp;       speccomb_planck,specparm_planck,specmult_planck,fpl,       &amp;</div><div class="line"><a name="l05779"></a><span class="lineno"> 5779</span>&#160;     &amp;       fac000, fac100, fac200, fac010, fac110, fac210,            &amp;</div><div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;     &amp;       fac001, fac101, fac201, fac011, fac111, fac211,            &amp;</div><div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;     &amp;       p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21</div><div class="line"><a name="l05782"></a><span class="lineno"> 5782</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;<span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div><div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;<span class="comment">!           fraction in lower/upper atmosphere.</span></div><div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160;</div><div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;      refrat_planck_a = chi_mls(1,10)/chi_mls(2,10)      <span class="comment">! P =   174.164 mb</span></div><div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160;</div><div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l05791"></a><span class="lineno"> 5791</span>&#160;</div><div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l05793"></a><span class="lineno"> 5793</span>&#160;        speccomb = colamt(k,1) + rfrate(k,1,1)*colamt(k,2)</div><div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160;        specparm = colamt(k,1) / speccomb</div><div class="line"><a name="l05795"></a><span class="lineno"> 5795</span>&#160;        specmult = 8.0 * min(specparm, oneminus)</div><div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l05798"></a><span class="lineno"> 5798</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(12) + js</div><div class="line"><a name="l05799"></a><span class="lineno"> 5799</span>&#160;</div><div class="line"><a name="l05800"></a><span class="lineno"> 5800</span>&#160;        speccomb1 = colamt(k,1) + rfrate(k,1,2)*colamt(k,2)</div><div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;        specparm1 = colamt(k,1) / speccomb1</div><div class="line"><a name="l05802"></a><span class="lineno"> 5802</span>&#160;        specmult1 = 8.0 * min(specparm1, oneminus)</div><div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;        js1 = 1 + int(specmult1)</div><div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160;        fs1 = mod(specmult1, f_one)</div><div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(12) + js1</div><div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160;</div><div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,2)</div><div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;        specparm_planck = colamt(k,1) / speccomb_planck</div><div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160;        <span class="keywordflow">if</span> (specparm_planck &gt;= oneminus) specparm_planck=oneminus</div><div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160;        specmult_planck = 8.0 * specparm_planck</div><div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;        jpl = 1 + int(specmult_planck)</div><div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160;        fpl = mod(specmult_planck, f_one)</div><div class="line"><a name="l05813"></a><span class="lineno"> 5813</span>&#160;</div><div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;        inds = indself(k)</div><div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l05817"></a><span class="lineno"> 5817</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160;        jplp  = jpl  + 1</div><div class="line"><a name="l05819"></a><span class="lineno"> 5819</span>&#160;</div><div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;          p0 = fs - f_one</div><div class="line"><a name="l05822"></a><span class="lineno"> 5822</span>&#160;          p40 = p0**4</div><div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;          fk00 = p40</div><div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160;</div><div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;          id000 = ind0</div><div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l05829"></a><span class="lineno"> 5829</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;          id200 = ind0 + 2</div><div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160;          id210 = ind0 +11</div><div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;          p0 = -fs</div><div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;          p40 = p0**4</div><div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160;          fk00 = p40</div><div class="line"><a name="l05837"></a><span class="lineno"> 5837</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l05838"></a><span class="lineno"> 5838</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l05839"></a><span class="lineno"> 5839</span>&#160;</div><div class="line"><a name="l05840"></a><span class="lineno"> 5840</span>&#160;          id000 = ind0 + 1</div><div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160;          id010 = ind0 +10</div><div class="line"><a name="l05842"></a><span class="lineno"> 5842</span>&#160;          id100 = ind0</div><div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160;          id110 = ind0 + 9</div><div class="line"><a name="l05844"></a><span class="lineno"> 5844</span>&#160;          id200 = ind0 - 1</div><div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;          id210 = ind0 + 8</div><div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;          fk00 = f_one - fs</div><div class="line"><a name="l05848"></a><span class="lineno"> 5848</span>&#160;          fk10 = fs</div><div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160;          fk20 = f_zero</div><div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;</div><div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;          id000 = ind0</div><div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l05855"></a><span class="lineno"> 5855</span>&#160;          id200 = ind0</div><div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160;          id210 = ind0</div><div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160;</div><div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;        fac000 = fk00 * fac00(k)</div><div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160;        fac100 = fk10 * fac00(k)</div><div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;        fac200 = fk20 * fac00(k)</div><div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;        fac010 = fk00 * fac10(k)</div><div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;        fac110 = fk10 * fac10(k)</div><div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;        fac210 = fk20 * fac10(k)</div><div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;</div><div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;          p1 = fs1 - f_one</div><div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;          p41 = p1**4</div><div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;          fk01 = p41</div><div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;</div><div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;          id001 = ind1</div><div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;          id201 = ind1 + 2</div><div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;          id211 = ind1 +11</div><div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160;          p1 = -fs1</div><div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;          p41 = p1**4</div><div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;          fk01 = p41</div><div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160;</div><div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;          id001 = ind1 + 1</div><div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;          id011 = ind1 +10</div><div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;          id101 = ind1</div><div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;          id111 = ind1 + 9</div><div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160;          id201 = ind1 - 1</div><div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;          id211 = ind1 + 8</div><div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;          fk01 = f_one - fs1</div><div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;          fk11 = fs1</div><div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;          fk21 = f_zero</div><div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;</div><div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;          id001 = ind1</div><div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160;          id201 = ind1</div><div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;          id211 = ind1</div><div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160;</div><div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;        fac001 = fk01 * fac01(k)</div><div class="line"><a name="l05906"></a><span class="lineno"> 5906</span>&#160;        fac101 = fk11 * fac01(k)</div><div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160;        fac201 = fk21 * fac01(k)</div><div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160;        fac011 = fk01 * fac11(k)</div><div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;        fac111 = fk11 * fac11(k)</div><div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;        fac211 = fk21 * fac11(k)</div><div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160;</div><div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng12</div><div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;          tauself = selffac(k)* (<a class="code" href="group__module__radlw__kgbnn.html#ga8aaf83ec7a08a244fd1e5396c9fd9b1d">selfref</a>(ig,inds) + selffrac(k)         &amp;</div><div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga8aaf83ec7a08a244fd1e5396c9fd9b1d">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#ga8aaf83ec7a08a244fd1e5396c9fd9b1d">selfref</a>(ig,inds)))</div><div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga97dac0d0e010441171e09e317e5aeee8">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga97dac0d0e010441171e09e317e5aeee8">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#ga97dac0d0e010441171e09e317e5aeee8">forref</a>(ig,indf))) </div><div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;</div><div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;          taug(ns12+ig,k) = speccomb                                    &amp;</div><div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;     &amp;                * (fac000*<a class="code" href="group__module__radlw__kgbnn.html#ga7600bfa19dde3b47d8479f5766ee0c93">absa</a>(ig,id000) + fac010*<a class="code" href="group__module__radlw__kgbnn.html#ga7600bfa19dde3b47d8479f5766ee0c93">absa</a>(ig,id010)  &amp;</div><div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;     &amp;                +  fac100*<a class="code" href="group__module__radlw__kgbnn.html#ga7600bfa19dde3b47d8479f5766ee0c93">absa</a>(ig,id100) + fac110*<a class="code" href="group__module__radlw__kgbnn.html#ga7600bfa19dde3b47d8479f5766ee0c93">absa</a>(ig,id110)  &amp;</div><div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160;     &amp;                +  fac200*<a class="code" href="group__module__radlw__kgbnn.html#ga7600bfa19dde3b47d8479f5766ee0c93">absa</a>(ig,id200) + fac210*<a class="code" href="group__module__radlw__kgbnn.html#ga7600bfa19dde3b47d8479f5766ee0c93">absa</a>(ig,id210)) &amp;</div><div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;     &amp;                +     speccomb1                                   &amp;</div><div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;     &amp;                * (fac001*<a class="code" href="group__module__radlw__kgbnn.html#ga7600bfa19dde3b47d8479f5766ee0c93">absa</a>(ig,id001) + fac011*<a class="code" href="group__module__radlw__kgbnn.html#ga7600bfa19dde3b47d8479f5766ee0c93">absa</a>(ig,id011)  &amp;</div><div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;     &amp;                +  fac101*<a class="code" href="group__module__radlw__kgbnn.html#ga7600bfa19dde3b47d8479f5766ee0c93">absa</a>(ig,id101) + fac111*<a class="code" href="group__module__radlw__kgbnn.html#ga7600bfa19dde3b47d8479f5766ee0c93">absa</a>(ig,id111)  &amp;</div><div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;     &amp;                +  fac201*<a class="code" href="group__module__radlw__kgbnn.html#ga7600bfa19dde3b47d8479f5766ee0c93">absa</a>(ig,id201) + fac211*<a class="code" href="group__module__radlw__kgbnn.html#ga7600bfa19dde3b47d8479f5766ee0c93">absa</a>(ig,id211)) &amp;</div><div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160;     &amp;                + tauself + taufor</div><div class="line"><a name="l05927"></a><span class="lineno"> 5927</span>&#160;</div><div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;          fracs(ns12+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga58ff4f54c11eb12f7ab5157823981b16">fracrefa</a>(ig,jpl) + fpl                     &amp;</div><div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;     &amp;                     *(<a class="code" href="group__module__radlw__kgbnn.html#ga58ff4f54c11eb12f7ab5157823981b16">fracrefa</a>(ig,jplp) - <a class="code" href="group__module__radlw__kgbnn.html#ga58ff4f54c11eb12f7ab5157823981b16">fracrefa</a>(ig,jpl))</div><div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;</div><div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l05934"></a><span class="lineno"> 5934</span>&#160;</div><div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l05936"></a><span class="lineno"> 5936</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng12</div><div class="line"><a name="l05937"></a><span class="lineno"> 5937</span>&#160;          taug(ns12+ig,k) = f_zero</div><div class="line"><a name="l05938"></a><span class="lineno"> 5938</span>&#160;          fracs(ns12+ig,k) = f_zero</div><div class="line"><a name="l05939"></a><span class="lineno"> 5939</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l05940"></a><span class="lineno"> 5940</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160;</div><div class="line"><a name="l05942"></a><span class="lineno"> 5942</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#ae56eaa9e3b897ca235d4d6b271cc1e47">taugb12</a></div><div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l05945"></a><span class="lineno"> 5945</span>&#160;</div><div class="line"><a name="l05947"></a><span class="lineno"> 5947</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l05948"></a><span class="lineno"> 5948</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#a2ac7254d2dcff516e8e44b8b679302c0">taugb13</a></div><div class="line"><a name="l05949"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#a2ac7254d2dcff516e8e44b8b679302c0"> 5949</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l05950"></a><span class="lineno"> 5950</span>&#160;</div><div class="line"><a name="l05951"></a><span class="lineno"> 5951</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05952"></a><span class="lineno"> 5952</span>&#160;<span class="comment">!     band 13:  2080-2250 cm-1 (low key-h2o,n2o; high minor-o3 minor)  !</span></div><div class="line"><a name="l05953"></a><span class="lineno"> 5953</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l05954"></a><span class="lineno"> 5954</span>&#160;</div><div class="line"><a name="l05955"></a><span class="lineno"> 5955</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb13.html">module_radlw_kgb13</a></div><div class="line"><a name="l05956"></a><span class="lineno"> 5956</span>&#160;</div><div class="line"><a name="l05957"></a><span class="lineno"> 5957</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l05958"></a><span class="lineno"> 5958</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind1, inds, indsp, indf, indfp, indm, indmp,  &amp;</div><div class="line"><a name="l05959"></a><span class="lineno"> 5959</span>&#160;     &amp;       id000, id010, id100, id110, id200, id210, jmco2, jpl,      &amp;</div><div class="line"><a name="l05960"></a><span class="lineno"> 5960</span>&#160;     &amp;       id001, id011, id101, id111, id201, id211, jmco2p, jplp,    &amp;</div><div class="line"><a name="l05961"></a><span class="lineno"> 5961</span>&#160;     &amp;       jmco, jmcop, ig, js, js1</div><div class="line"><a name="l05962"></a><span class="lineno"> 5962</span>&#160;</div><div class="line"><a name="l05963"></a><span class="lineno"> 5963</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tauself, taufor, co2m1, co2m2, absco2,   &amp;</div><div class="line"><a name="l05964"></a><span class="lineno"> 5964</span>&#160;     &amp;       speccomb,       specparm,       specmult,       fs,        &amp;</div><div class="line"><a name="l05965"></a><span class="lineno"> 5965</span>&#160;     &amp;       speccomb1,      specparm1,      specmult1,      fs1,       &amp;</div><div class="line"><a name="l05966"></a><span class="lineno"> 5966</span>&#160;     &amp;       speccomb_mco2,  specparm_mco2,  specmult_mco2,  fmco2,     &amp;</div><div class="line"><a name="l05967"></a><span class="lineno"> 5967</span>&#160;     &amp;       speccomb_mco,   specparm_mco,   specmult_mco,   fmco,      &amp;</div><div class="line"><a name="l05968"></a><span class="lineno"> 5968</span>&#160;     &amp;       speccomb_planck,specparm_planck,specmult_planck,fpl,       &amp;</div><div class="line"><a name="l05969"></a><span class="lineno"> 5969</span>&#160;     &amp;       refrat_planck_a, refrat_m_a, refrat_m_a3, ratco2,          &amp;</div><div class="line"><a name="l05970"></a><span class="lineno"> 5970</span>&#160;     &amp;       adjfac, adjcolco2, com1, com2, absco, abso3,               &amp;</div><div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;     &amp;       fac000, fac100, fac200, fac010, fac110, fac210,            &amp;</div><div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;     &amp;       fac001, fac101, fac201, fac011, fac111, fac211,            &amp;</div><div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;     &amp;       p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21, temp</div><div class="line"><a name="l05974"></a><span class="lineno"> 5974</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05975"></a><span class="lineno"> 5975</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;<span class="comment">!  --- ...  minor gas mapping levels :</span></div><div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160;<span class="comment">!     lower - co2, p = 1053.63 mb, t = 294.2 k</span></div><div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160;<span class="comment">!     lower - co, p = 706 mb, t = 278.94 k</span></div><div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;<span class="comment">!     upper - o3, p = 95.5835 mb, t = 215.7 k</span></div><div class="line"><a name="l05981"></a><span class="lineno"> 5981</span>&#160;</div><div class="line"><a name="l05982"></a><span class="lineno"> 5982</span>&#160;<span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div><div class="line"><a name="l05983"></a><span class="lineno"> 5983</span>&#160;<span class="comment">!           fraction in lower/upper atmosphere.</span></div><div class="line"><a name="l05984"></a><span class="lineno"> 5984</span>&#160;</div><div class="line"><a name="l05985"></a><span class="lineno"> 5985</span>&#160;      refrat_planck_a = chi_mls(1,5)/chi_mls(4,5)        <span class="comment">! P = 473.420 mb (Level 5)</span></div><div class="line"><a name="l05986"></a><span class="lineno"> 5986</span>&#160;      refrat_m_a = chi_mls(1,1)/chi_mls(4,1)             <span class="comment">! P = 1053. (Level 1)</span></div><div class="line"><a name="l05987"></a><span class="lineno"> 5987</span>&#160;      refrat_m_a3 = chi_mls(1,3)/chi_mls(4,3)            <span class="comment">! P = 706. (Level 3)</span></div><div class="line"><a name="l05988"></a><span class="lineno"> 5988</span>&#160;</div><div class="line"><a name="l05989"></a><span class="lineno"> 5989</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l05990"></a><span class="lineno"> 5990</span>&#160;</div><div class="line"><a name="l05991"></a><span class="lineno"> 5991</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l05992"></a><span class="lineno"> 5992</span>&#160;        speccomb = colamt(k,1) + rfrate(k,3,1)*colamt(k,4)</div><div class="line"><a name="l05993"></a><span class="lineno"> 5993</span>&#160;        specparm = colamt(k,1) / speccomb</div><div class="line"><a name="l05994"></a><span class="lineno"> 5994</span>&#160;        specmult = 8.0 * min(specparm, oneminus)</div><div class="line"><a name="l05995"></a><span class="lineno"> 5995</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l05996"></a><span class="lineno"> 5996</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l05997"></a><span class="lineno"> 5997</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(13) + js</div><div class="line"><a name="l05998"></a><span class="lineno"> 5998</span>&#160;</div><div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;        speccomb1 = colamt(k,1) + rfrate(k,3,2)*colamt(k,4)</div><div class="line"><a name="l06000"></a><span class="lineno"> 6000</span>&#160;        specparm1 = colamt(k,1) / speccomb1</div><div class="line"><a name="l06001"></a><span class="lineno"> 6001</span>&#160;        specmult1 = 8.0 * min(specparm1, oneminus)</div><div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160;        js1 = 1 + int(specmult1)</div><div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;        fs1 = mod(specmult1, f_one)</div><div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160;        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(13) + js1</div><div class="line"><a name="l06005"></a><span class="lineno"> 6005</span>&#160;</div><div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160;        speccomb_mco2 = colamt(k,1) + refrat_m_a*colamt(k,4)</div><div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;        specparm_mco2 = colamt(k,1) / speccomb_mco2</div><div class="line"><a name="l06008"></a><span class="lineno"> 6008</span>&#160;        specmult_mco2 = 8.0 * min(specparm_mco2, oneminus)</div><div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160;        jmco2 = 1 + int(specmult_mco2)</div><div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160;        fmco2 = mod(specmult_mco2, f_one)</div><div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;</div><div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;<span class="comment">!  --- ...  in atmospheres where the amount of co2 is too great to be considered</span></div><div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160;<span class="comment">!           a minor species, adjust the column amount of co2 by an empirical factor</span></div><div class="line"><a name="l06014"></a><span class="lineno"> 6014</span>&#160;<span class="comment">!           to obtain the proper contribution.</span></div><div class="line"><a name="l06015"></a><span class="lineno"> 6015</span>&#160;</div><div class="line"><a name="l06016"></a><span class="lineno"> 6016</span>&#160;        speccomb_mco = colamt(k,1) + refrat_m_a3*colamt(k,4)</div><div class="line"><a name="l06017"></a><span class="lineno"> 6017</span>&#160;        specparm_mco = colamt(k,1) / speccomb_mco</div><div class="line"><a name="l06018"></a><span class="lineno"> 6018</span>&#160;        specmult_mco = 8.0 * min(specparm_mco, oneminus)</div><div class="line"><a name="l06019"></a><span class="lineno"> 6019</span>&#160;        jmco = 1 + int(specmult_mco)</div><div class="line"><a name="l06020"></a><span class="lineno"> 6020</span>&#160;        fmco = mod(specmult_mco, f_one)</div><div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160;</div><div class="line"><a name="l06022"></a><span class="lineno"> 6022</span>&#160;        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,4)</div><div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160;        specparm_planck = colamt(k,1) / speccomb_planck</div><div class="line"><a name="l06024"></a><span class="lineno"> 6024</span>&#160;        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div><div class="line"><a name="l06025"></a><span class="lineno"> 6025</span>&#160;        jpl = 1 + int(specmult_planck)</div><div class="line"><a name="l06026"></a><span class="lineno"> 6026</span>&#160;        fpl = mod(specmult_planck, f_one)</div><div class="line"><a name="l06027"></a><span class="lineno"> 6027</span>&#160;</div><div class="line"><a name="l06028"></a><span class="lineno"> 6028</span>&#160;        inds = indself(k)</div><div class="line"><a name="l06029"></a><span class="lineno"> 6029</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l06030"></a><span class="lineno"> 6030</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l06031"></a><span class="lineno"> 6031</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l06032"></a><span class="lineno"> 6032</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l06033"></a><span class="lineno"> 6033</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l06034"></a><span class="lineno"> 6034</span>&#160;        jplp  = jpl  + 1</div><div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160;        jmco2p= jmco2+ 1</div><div class="line"><a name="l06036"></a><span class="lineno"> 6036</span>&#160;        jmcop = jmco + 1</div><div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160;</div><div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;<span class="comment">!  --- ...  in atmospheres where the amount of co2 is too great to be considered</span></div><div class="line"><a name="l06039"></a><span class="lineno"> 6039</span>&#160;<span class="comment">!           a minor species, adjust the column amount of co2 by an empirical factor</span></div><div class="line"><a name="l06040"></a><span class="lineno"> 6040</span>&#160;<span class="comment">!           to obtain the proper contribution.</span></div><div class="line"><a name="l06041"></a><span class="lineno"> 6041</span>&#160;</div><div class="line"><a name="l06042"></a><span class="lineno"> 6042</span>&#160;        temp   = coldry(k) * 3.55e-4</div><div class="line"><a name="l06043"></a><span class="lineno"> 6043</span>&#160;        ratco2 = colamt(k,2) / temp</div><div class="line"><a name="l06044"></a><span class="lineno"> 6044</span>&#160;        <span class="keywordflow">if</span> (ratco2 &gt; 3.0) <span class="keywordflow">then</span></div><div class="line"><a name="l06045"></a><span class="lineno"> 6045</span>&#160;          adjfac = 2.0 + (ratco2-2.0)**0.68</div><div class="line"><a name="l06046"></a><span class="lineno"> 6046</span>&#160;          adjcolco2 = adjfac * temp</div><div class="line"><a name="l06047"></a><span class="lineno"> 6047</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l06048"></a><span class="lineno"> 6048</span>&#160;          adjcolco2 = colamt(k,2)</div><div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160;</div><div class="line"><a name="l06051"></a><span class="lineno"> 6051</span>&#160;        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l06052"></a><span class="lineno"> 6052</span>&#160;          p0 = fs - f_one</div><div class="line"><a name="l06053"></a><span class="lineno"> 6053</span>&#160;          p40 = p0**4</div><div class="line"><a name="l06054"></a><span class="lineno"> 6054</span>&#160;          fk00 = p40</div><div class="line"><a name="l06055"></a><span class="lineno"> 6055</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l06056"></a><span class="lineno"> 6056</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l06057"></a><span class="lineno"> 6057</span>&#160;</div><div class="line"><a name="l06058"></a><span class="lineno"> 6058</span>&#160;          id000 = ind0</div><div class="line"><a name="l06059"></a><span class="lineno"> 6059</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l06061"></a><span class="lineno"> 6061</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;          id200 = ind0 + 2</div><div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;          id210 = ind0 +11</div><div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l06065"></a><span class="lineno"> 6065</span>&#160;          p0 = -fs</div><div class="line"><a name="l06066"></a><span class="lineno"> 6066</span>&#160;          p40 = p0**4</div><div class="line"><a name="l06067"></a><span class="lineno"> 6067</span>&#160;          fk00 = p40</div><div class="line"><a name="l06068"></a><span class="lineno"> 6068</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l06069"></a><span class="lineno"> 6069</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l06070"></a><span class="lineno"> 6070</span>&#160;</div><div class="line"><a name="l06071"></a><span class="lineno"> 6071</span>&#160;          id000 = ind0 + 1</div><div class="line"><a name="l06072"></a><span class="lineno"> 6072</span>&#160;          id010 = ind0 +10</div><div class="line"><a name="l06073"></a><span class="lineno"> 6073</span>&#160;          id100 = ind0</div><div class="line"><a name="l06074"></a><span class="lineno"> 6074</span>&#160;          id110 = ind0 + 9</div><div class="line"><a name="l06075"></a><span class="lineno"> 6075</span>&#160;          id200 = ind0 - 1</div><div class="line"><a name="l06076"></a><span class="lineno"> 6076</span>&#160;          id210 = ind0 + 8</div><div class="line"><a name="l06077"></a><span class="lineno"> 6077</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l06078"></a><span class="lineno"> 6078</span>&#160;          fk00 = f_one - fs</div><div class="line"><a name="l06079"></a><span class="lineno"> 6079</span>&#160;          fk10 = fs</div><div class="line"><a name="l06080"></a><span class="lineno"> 6080</span>&#160;          fk20 = f_zero</div><div class="line"><a name="l06081"></a><span class="lineno"> 6081</span>&#160;</div><div class="line"><a name="l06082"></a><span class="lineno"> 6082</span>&#160;          id000 = ind0</div><div class="line"><a name="l06083"></a><span class="lineno"> 6083</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l06084"></a><span class="lineno"> 6084</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l06085"></a><span class="lineno"> 6085</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l06086"></a><span class="lineno"> 6086</span>&#160;          id200 = ind0</div><div class="line"><a name="l06087"></a><span class="lineno"> 6087</span>&#160;          id210 = ind0</div><div class="line"><a name="l06088"></a><span class="lineno"> 6088</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l06089"></a><span class="lineno"> 6089</span>&#160;</div><div class="line"><a name="l06090"></a><span class="lineno"> 6090</span>&#160;        fac000 = fk00 * fac00(k)</div><div class="line"><a name="l06091"></a><span class="lineno"> 6091</span>&#160;        fac100 = fk10 * fac00(k)</div><div class="line"><a name="l06092"></a><span class="lineno"> 6092</span>&#160;        fac200 = fk20 * fac00(k)</div><div class="line"><a name="l06093"></a><span class="lineno"> 6093</span>&#160;        fac010 = fk00 * fac10(k)</div><div class="line"><a name="l06094"></a><span class="lineno"> 6094</span>&#160;        fac110 = fk10 * fac10(k)</div><div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160;        fac210 = fk20 * fac10(k)</div><div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160;</div><div class="line"><a name="l06097"></a><span class="lineno"> 6097</span>&#160;        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;          p1 = fs1 - f_one</div><div class="line"><a name="l06099"></a><span class="lineno"> 6099</span>&#160;          p41 = p1**4</div><div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160;          fk01 = p41</div><div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;</div><div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160;          id001 = ind1</div><div class="line"><a name="l06105"></a><span class="lineno"> 6105</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l06108"></a><span class="lineno"> 6108</span>&#160;          id201 = ind1 + 2</div><div class="line"><a name="l06109"></a><span class="lineno"> 6109</span>&#160;          id211 = ind1 +11</div><div class="line"><a name="l06110"></a><span class="lineno"> 6110</span>&#160;        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l06111"></a><span class="lineno"> 6111</span>&#160;          p1 = -fs1</div><div class="line"><a name="l06112"></a><span class="lineno"> 6112</span>&#160;          p41 = p1**4</div><div class="line"><a name="l06113"></a><span class="lineno"> 6113</span>&#160;          fk01 = p41</div><div class="line"><a name="l06114"></a><span class="lineno"> 6114</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l06115"></a><span class="lineno"> 6115</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l06116"></a><span class="lineno"> 6116</span>&#160;</div><div class="line"><a name="l06117"></a><span class="lineno"> 6117</span>&#160;          id001 = ind1 + 1</div><div class="line"><a name="l06118"></a><span class="lineno"> 6118</span>&#160;          id011 = ind1 +10</div><div class="line"><a name="l06119"></a><span class="lineno"> 6119</span>&#160;          id101 = ind1</div><div class="line"><a name="l06120"></a><span class="lineno"> 6120</span>&#160;          id111 = ind1 + 9</div><div class="line"><a name="l06121"></a><span class="lineno"> 6121</span>&#160;          id201 = ind1 - 1</div><div class="line"><a name="l06122"></a><span class="lineno"> 6122</span>&#160;          id211 = ind1 + 8</div><div class="line"><a name="l06123"></a><span class="lineno"> 6123</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l06124"></a><span class="lineno"> 6124</span>&#160;          fk01 = f_one - fs1</div><div class="line"><a name="l06125"></a><span class="lineno"> 6125</span>&#160;          fk11 = fs1</div><div class="line"><a name="l06126"></a><span class="lineno"> 6126</span>&#160;          fk21 = f_zero</div><div class="line"><a name="l06127"></a><span class="lineno"> 6127</span>&#160;</div><div class="line"><a name="l06128"></a><span class="lineno"> 6128</span>&#160;          id001 = ind1</div><div class="line"><a name="l06129"></a><span class="lineno"> 6129</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l06130"></a><span class="lineno"> 6130</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l06131"></a><span class="lineno"> 6131</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l06132"></a><span class="lineno"> 6132</span>&#160;          id201 = ind1</div><div class="line"><a name="l06133"></a><span class="lineno"> 6133</span>&#160;          id211 = ind1</div><div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;</div><div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160;        fac001 = fk01 * fac01(k)</div><div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160;        fac101 = fk11 * fac01(k)</div><div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;        fac201 = fk21 * fac01(k)</div><div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160;        fac011 = fk01 * fac11(k)</div><div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160;        fac111 = fk11 * fac11(k)</div><div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;        fac211 = fk21 * fac11(k)</div><div class="line"><a name="l06142"></a><span class="lineno"> 6142</span>&#160;</div><div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng13</div><div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160;          tauself = selffac(k)* (<a class="code" href="group__module__radlw__kgbnn.html#gac8f58bba6aa4b72ffd01f78e60d0831f">selfref</a>(ig,inds) + selffrac(k)         &amp;</div><div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gac8f58bba6aa4b72ffd01f78e60d0831f">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#gac8f58bba6aa4b72ffd01f78e60d0831f">selfref</a>(ig,inds)))</div><div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga93c6546ef5f8cbfc4f63de29e1ba2452">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga93c6546ef5f8cbfc4f63de29e1ba2452">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#ga93c6546ef5f8cbfc4f63de29e1ba2452">forref</a>(ig,indf))) </div><div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160;          co2m1   = <a class="code" href="group__module__radlw__kgbnn.html#ga523a0bc861ea861869f59b7bd007ff50">ka_mco2</a>(ig,jmco2,indm) + fmco2                      &amp;</div><div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga523a0bc861ea861869f59b7bd007ff50">ka_mco2</a>(ig,jmco2p,indm) - <a class="code" href="group__module__radlw__kgbnn.html#ga523a0bc861ea861869f59b7bd007ff50">ka_mco2</a>(ig,jmco2,indm))</div><div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160;          co2m2   = <a class="code" href="group__module__radlw__kgbnn.html#ga523a0bc861ea861869f59b7bd007ff50">ka_mco2</a>(ig,jmco2,indmp) + fmco2                     &amp;</div><div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga523a0bc861ea861869f59b7bd007ff50">ka_mco2</a>(ig,jmco2p,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#ga523a0bc861ea861869f59b7bd007ff50">ka_mco2</a>(ig,jmco2,indmp))</div><div class="line"><a name="l06152"></a><span class="lineno"> 6152</span>&#160;          absco2  = co2m1 + minorfrac(k) * (co2m2 - co2m1)</div><div class="line"><a name="l06153"></a><span class="lineno"> 6153</span>&#160;          com1    = ka_mco(ig,jmco,indm) + fmco                         &amp;</div><div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;     &amp;            * (ka_mco(ig,jmcop,indm) - ka_mco(ig,jmco,indm))</div><div class="line"><a name="l06155"></a><span class="lineno"> 6155</span>&#160;          com2    = ka_mco(ig,jmco,indmp) + fmco                        &amp;</div><div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;     &amp;            * (ka_mco(ig,jmcop,indmp) - ka_mco(ig,jmco,indmp))</div><div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;          absco   = com1 + minorfrac(k) * (com2 - com1)</div><div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160;</div><div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;          taug(ns13+ig,k) = speccomb                                    &amp;</div><div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;     &amp;                * (fac000*<a class="code" href="group__module__radlw__kgbnn.html#ga22ce8d48ac3dceae1d52e80097fc2689">absa</a>(ig,id000) + fac010*<a class="code" href="group__module__radlw__kgbnn.html#ga22ce8d48ac3dceae1d52e80097fc2689">absa</a>(ig,id010)  &amp;</div><div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160;     &amp;                +  fac100*<a class="code" href="group__module__radlw__kgbnn.html#ga22ce8d48ac3dceae1d52e80097fc2689">absa</a>(ig,id100) + fac110*<a class="code" href="group__module__radlw__kgbnn.html#ga22ce8d48ac3dceae1d52e80097fc2689">absa</a>(ig,id110)  &amp;</div><div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160;     &amp;                +  fac200*<a class="code" href="group__module__radlw__kgbnn.html#ga22ce8d48ac3dceae1d52e80097fc2689">absa</a>(ig,id200) + fac210*<a class="code" href="group__module__radlw__kgbnn.html#ga22ce8d48ac3dceae1d52e80097fc2689">absa</a>(ig,id210)) &amp;</div><div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;     &amp;                +     speccomb1                                   &amp;</div><div class="line"><a name="l06164"></a><span class="lineno"> 6164</span>&#160;     &amp;                * (fac001*<a class="code" href="group__module__radlw__kgbnn.html#ga22ce8d48ac3dceae1d52e80097fc2689">absa</a>(ig,id001) + fac011*<a class="code" href="group__module__radlw__kgbnn.html#ga22ce8d48ac3dceae1d52e80097fc2689">absa</a>(ig,id011)  &amp;</div><div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160;     &amp;                +  fac101*<a class="code" href="group__module__radlw__kgbnn.html#ga22ce8d48ac3dceae1d52e80097fc2689">absa</a>(ig,id101) + fac111*<a class="code" href="group__module__radlw__kgbnn.html#ga22ce8d48ac3dceae1d52e80097fc2689">absa</a>(ig,id111)  &amp;</div><div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;     &amp;                +  fac201*<a class="code" href="group__module__radlw__kgbnn.html#ga22ce8d48ac3dceae1d52e80097fc2689">absa</a>(ig,id201) + fac211*<a class="code" href="group__module__radlw__kgbnn.html#ga22ce8d48ac3dceae1d52e80097fc2689">absa</a>(ig,id211)) &amp;</div><div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;     &amp;                + tauself + taufor + adjcolco2*absco2             &amp;</div><div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;     &amp;                + colamt(k,7)*absco</div><div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;</div><div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;          fracs(ns13+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga82aed8a05cd528b287e336f7ff8fcebb">fracrefa</a>(ig,jpl) + fpl                     &amp;</div><div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160;     &amp;                     * (<a class="code" href="group__module__radlw__kgbnn.html#ga82aed8a05cd528b287e336f7ff8fcebb">fracrefa</a>(ig,jplp) - <a class="code" href="group__module__radlw__kgbnn.html#ga82aed8a05cd528b287e336f7ff8fcebb">fracrefa</a>(ig,jpl))</div><div class="line"><a name="l06172"></a><span class="lineno"> 6172</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l06173"></a><span class="lineno"> 6173</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l06174"></a><span class="lineno"> 6174</span>&#160;</div><div class="line"><a name="l06175"></a><span class="lineno"> 6175</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l06176"></a><span class="lineno"> 6176</span>&#160;</div><div class="line"><a name="l06177"></a><span class="lineno"> 6177</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l06178"></a><span class="lineno"> 6178</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l06179"></a><span class="lineno"> 6179</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l06180"></a><span class="lineno"> 6180</span>&#160;</div><div class="line"><a name="l06181"></a><span class="lineno"> 6181</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng13</div><div class="line"><a name="l06182"></a><span class="lineno"> 6182</span>&#160;          abso3 = kb_mo3(ig,indm) + minorfrac(k)                        &amp;</div><div class="line"><a name="l06183"></a><span class="lineno"> 6183</span>&#160;     &amp;          * (kb_mo3(ig,indmp) - kb_mo3(ig,indm))</div><div class="line"><a name="l06184"></a><span class="lineno"> 6184</span>&#160;</div><div class="line"><a name="l06185"></a><span class="lineno"> 6185</span>&#160;          taug(ns13+ig,k) = colamt(k,3)*abso3</div><div class="line"><a name="l06186"></a><span class="lineno"> 6186</span>&#160;</div><div class="line"><a name="l06187"></a><span class="lineno"> 6187</span>&#160;          fracs(ns13+ig,k) =  <a class="code" href="group__module__radlw__kgbnn.html#ga92d45aee9dab62549ea8821eae7422dd">fracrefb</a>(ig)</div><div class="line"><a name="l06188"></a><span class="lineno"> 6188</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l06189"></a><span class="lineno"> 6189</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l06190"></a><span class="lineno"> 6190</span>&#160;</div><div class="line"><a name="l06191"></a><span class="lineno"> 6191</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l06192"></a><span class="lineno"> 6192</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#a2ac7254d2dcff516e8e44b8b679302c0">taugb13</a></div><div class="line"><a name="l06193"></a><span class="lineno"> 6193</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l06194"></a><span class="lineno"> 6194</span>&#160;</div><div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#a26140cbe1a3d6119b56cf5c2d539670e">taugb14</a></div><div class="line"><a name="l06198"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#a26140cbe1a3d6119b56cf5c2d539670e"> 6198</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;</div><div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;<span class="comment">!     band 14:  2250-2380 cm-1 (low - co2; high - co2)                 !</span></div><div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l06203"></a><span class="lineno"> 6203</span>&#160;</div><div class="line"><a name="l06204"></a><span class="lineno"> 6204</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb14.html">module_radlw_kgb14</a></div><div class="line"><a name="l06205"></a><span class="lineno"> 6205</span>&#160;</div><div class="line"><a name="l06206"></a><span class="lineno"> 6206</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l06207"></a><span class="lineno"> 6207</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div><div class="line"><a name="l06208"></a><span class="lineno"> 6208</span>&#160;     &amp;       ig</div><div class="line"><a name="l06209"></a><span class="lineno"> 6209</span>&#160;</div><div class="line"><a name="l06210"></a><span class="lineno"> 6210</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tauself, taufor</div><div class="line"><a name="l06211"></a><span class="lineno"> 6211</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l06212"></a><span class="lineno"> 6212</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l06213"></a><span class="lineno"> 6213</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l06214"></a><span class="lineno"> 6214</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l06215"></a><span class="lineno"> 6215</span>&#160;</div><div class="line"><a name="l06216"></a><span class="lineno"> 6216</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l06217"></a><span class="lineno"> 6217</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(14) + 1</div><div class="line"><a name="l06218"></a><span class="lineno"> 6218</span>&#160;        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(14) + 1</div><div class="line"><a name="l06219"></a><span class="lineno"> 6219</span>&#160;</div><div class="line"><a name="l06220"></a><span class="lineno"> 6220</span>&#160;        inds = indself(k)</div><div class="line"><a name="l06221"></a><span class="lineno"> 6221</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l06222"></a><span class="lineno"> 6222</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l06223"></a><span class="lineno"> 6223</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l06224"></a><span class="lineno"> 6224</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l06225"></a><span class="lineno"> 6225</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l06226"></a><span class="lineno"> 6226</span>&#160;</div><div class="line"><a name="l06227"></a><span class="lineno"> 6227</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng14</div><div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;          tauself = selffac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga0e390a41b1c9e2ece765d65774060bca">selfref</a>(ig,inds) + selffrac(k)        &amp;</div><div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga0e390a41b1c9e2ece765d65774060bca">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#ga0e390a41b1c9e2ece765d65774060bca">selfref</a>(ig,inds)))</div><div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga8478067cb8a07a02b56c09fa3c73eb67">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l06231"></a><span class="lineno"> 6231</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga8478067cb8a07a02b56c09fa3c73eb67">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#ga8478067cb8a07a02b56c09fa3c73eb67">forref</a>(ig,indf))) </div><div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;</div><div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;          taug(ns14+ig,k) = colamt(k,2)                                 &amp;</div><div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;     &amp;            * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#gab57cb029ede27280bc99641f39ab3a81">absa</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#gab57cb029ede27280bc99641f39ab3a81">absa</a>(ig,ind0p)   &amp;</div><div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;     &amp;            +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#gab57cb029ede27280bc99641f39ab3a81">absa</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#gab57cb029ede27280bc99641f39ab3a81">absa</a>(ig,ind1p))  &amp;</div><div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;     &amp;            + tauself + taufor</div><div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;</div><div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;          fracs(ns14+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#gae1e7065b9ea30b36a3665ad594545e9b">fracrefa</a>(ig)</div><div class="line"><a name="l06239"></a><span class="lineno"> 6239</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160;</div><div class="line"><a name="l06242"></a><span class="lineno"> 6242</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;</div><div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160;        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(14) + 1</div><div class="line"><a name="l06246"></a><span class="lineno"> 6246</span>&#160;        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(14) + 1</div><div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;</div><div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;</div><div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng14</div><div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;          taug(ns14+ig,k) = colamt(k,2)                                 &amp;</div><div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;     &amp;             * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#gaa7a122319c49f3c1e8d51d21771cb63d">absb</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#gaa7a122319c49f3c1e8d51d21771cb63d">absb</a>(ig,ind0p)  &amp;</div><div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;     &amp;             +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#gaa7a122319c49f3c1e8d51d21771cb63d">absb</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#gaa7a122319c49f3c1e8d51d21771cb63d">absb</a>(ig,ind1p))</div><div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160;</div><div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160;          fracs(ns14+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga13a211bf8a903d0720fa72ac90e4fc3f">fracrefb</a>(ig)</div><div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l06258"></a><span class="lineno"> 6258</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160;</div><div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#a26140cbe1a3d6119b56cf5c2d539670e">taugb14</a></div><div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;</div><div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#a93b5c0ae0525697ffffb6228581a301c">taugb15</a></div><div class="line"><a name="l06268"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#a93b5c0ae0525697ffffb6228581a301c"> 6268</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;</div><div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160;<span class="comment">!     band 15:  2380-2600 cm-1 (low - n2o,co2; low minor - n2)         !</span></div><div class="line"><a name="l06272"></a><span class="lineno"> 6272</span>&#160;<span class="comment">!                              (high - nothing)                        !</span></div><div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;</div><div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb15.html">module_radlw_kgb15</a></div><div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;</div><div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind1, inds, indsp, indf, indfp, indm, indmp,  &amp;</div><div class="line"><a name="l06279"></a><span class="lineno"> 6279</span>&#160;     &amp;       id000, id010, id100, id110, id200, id210, jpl, jplp,       &amp;</div><div class="line"><a name="l06280"></a><span class="lineno"> 6280</span>&#160;     &amp;       id001, id011, id101, id111, id201, id211, jmn2, jmn2p,     &amp;</div><div class="line"><a name="l06281"></a><span class="lineno"> 6281</span>&#160;     &amp;       ig, js, js1</div><div class="line"><a name="l06282"></a><span class="lineno"> 6282</span>&#160;</div><div class="line"><a name="l06283"></a><span class="lineno"> 6283</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: scalen2, tauself, taufor,                &amp;</div><div class="line"><a name="l06284"></a><span class="lineno"> 6284</span>&#160;     &amp;       speccomb,       specparm,       specmult,       fs,        &amp;</div><div class="line"><a name="l06285"></a><span class="lineno"> 6285</span>&#160;     &amp;       speccomb1,      specparm1,      specmult1,      fs1,       &amp;</div><div class="line"><a name="l06286"></a><span class="lineno"> 6286</span>&#160;     &amp;       speccomb_mn2,   specparm_mn2,   specmult_mn2,   fmn2,      &amp;</div><div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;     &amp;       speccomb_planck,specparm_planck,specmult_planck,fpl,       &amp;</div><div class="line"><a name="l06288"></a><span class="lineno"> 6288</span>&#160;     &amp;       refrat_planck_a, refrat_m_a, n2m1, n2m2, taun2,            &amp;</div><div class="line"><a name="l06289"></a><span class="lineno"> 6289</span>&#160;     &amp;       fac000, fac100, fac200, fac010, fac110, fac210,            &amp;</div><div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;     &amp;       fac001, fac101, fac201, fac011, fac111, fac211,            &amp;</div><div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;     &amp;       p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21</div><div class="line"><a name="l06292"></a><span class="lineno"> 6292</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l06294"></a><span class="lineno"> 6294</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;<span class="comment">!  --- ...  minor gas mapping level :</span></div><div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160;<span class="comment">!     lower - nitrogen continuum, P = 1053., T = 294.</span></div><div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;</div><div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;<span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div><div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;<span class="comment">!           fraction in lower atmosphere.</span></div><div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;</div><div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;      refrat_planck_a = chi_mls(4,1)/chi_mls(2,1)      <span class="comment">! P = 1053. mb (Level 1)</span></div><div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;      refrat_m_a = chi_mls(4,1)/chi_mls(2,1)           <span class="comment">! P = 1053. mb</span></div><div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;</div><div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;</div><div class="line"><a name="l06306"></a><span class="lineno"> 6306</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;        speccomb = colamt(k,4) + rfrate(k,5,1)*colamt(k,2)</div><div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;        specparm = colamt(k,4) / speccomb</div><div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;        specmult = 8.0 * min(specparm, oneminus)</div><div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(15) + js</div><div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;</div><div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;        speccomb1 = colamt(k,4) + rfrate(k,5,2)*colamt(k,2)</div><div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;        specparm1 = colamt(k,4) / speccomb1</div><div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160;        specmult1 = 8.0 * min(specparm1, oneminus)</div><div class="line"><a name="l06317"></a><span class="lineno"> 6317</span>&#160;        js1 = 1 + int(specmult1)</div><div class="line"><a name="l06318"></a><span class="lineno"> 6318</span>&#160;        fs1 = mod(specmult1, f_one)</div><div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(15) + js1</div><div class="line"><a name="l06320"></a><span class="lineno"> 6320</span>&#160;</div><div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;        speccomb_mn2 = colamt(k,4) + refrat_m_a*colamt(k,2)</div><div class="line"><a name="l06322"></a><span class="lineno"> 6322</span>&#160;        specparm_mn2 = colamt(k,4) / speccomb_mn2</div><div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;        specmult_mn2 = 8.0 * min(specparm_mn2, oneminus)</div><div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;        jmn2 = 1 + int(specmult_mn2)</div><div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;        fmn2 = mod(specmult_mn2, f_one)</div><div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;</div><div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160;        speccomb_planck = colamt(k,4) + refrat_planck_a*colamt(k,2)</div><div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;        specparm_planck = colamt(k,4) / speccomb_planck</div><div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160;        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div><div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160;        jpl = 1 + int(specmult_planck)</div><div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;        fpl = mod(specmult_planck, f_one)</div><div class="line"><a name="l06332"></a><span class="lineno"> 6332</span>&#160;</div><div class="line"><a name="l06333"></a><span class="lineno"> 6333</span>&#160;        scalen2 = colbrd(k) * scaleminor(k)</div><div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;</div><div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160;        inds = indself(k)</div><div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160;        indm = indminor(k)</div><div class="line"><a name="l06338"></a><span class="lineno"> 6338</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l06339"></a><span class="lineno"> 6339</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l06340"></a><span class="lineno"> 6340</span>&#160;        indmp = indm + 1</div><div class="line"><a name="l06341"></a><span class="lineno"> 6341</span>&#160;        jplp  = jpl  + 1</div><div class="line"><a name="l06342"></a><span class="lineno"> 6342</span>&#160;        jmn2p = jmn2 + 1</div><div class="line"><a name="l06343"></a><span class="lineno"> 6343</span>&#160;</div><div class="line"><a name="l06344"></a><span class="lineno"> 6344</span>&#160;        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l06345"></a><span class="lineno"> 6345</span>&#160;          p0 = fs - f_one</div><div class="line"><a name="l06346"></a><span class="lineno"> 6346</span>&#160;          p40 = p0**4</div><div class="line"><a name="l06347"></a><span class="lineno"> 6347</span>&#160;          fk00 = p40</div><div class="line"><a name="l06348"></a><span class="lineno"> 6348</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160;</div><div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;          id000 = ind0</div><div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l06355"></a><span class="lineno"> 6355</span>&#160;          id200 = ind0 + 2</div><div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160;          id210 = ind0 +11</div><div class="line"><a name="l06357"></a><span class="lineno"> 6357</span>&#160;        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160;          p0 = -fs</div><div class="line"><a name="l06359"></a><span class="lineno"> 6359</span>&#160;          p40 = p0**4</div><div class="line"><a name="l06360"></a><span class="lineno"> 6360</span>&#160;          fk00 = p40</div><div class="line"><a name="l06361"></a><span class="lineno"> 6361</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l06362"></a><span class="lineno"> 6362</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l06363"></a><span class="lineno"> 6363</span>&#160;</div><div class="line"><a name="l06364"></a><span class="lineno"> 6364</span>&#160;          id000 = ind0 + 1</div><div class="line"><a name="l06365"></a><span class="lineno"> 6365</span>&#160;          id010 = ind0 +10</div><div class="line"><a name="l06366"></a><span class="lineno"> 6366</span>&#160;          id100 = ind0</div><div class="line"><a name="l06367"></a><span class="lineno"> 6367</span>&#160;          id110 = ind0 + 9</div><div class="line"><a name="l06368"></a><span class="lineno"> 6368</span>&#160;          id200 = ind0 - 1</div><div class="line"><a name="l06369"></a><span class="lineno"> 6369</span>&#160;          id210 = ind0 + 8</div><div class="line"><a name="l06370"></a><span class="lineno"> 6370</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l06371"></a><span class="lineno"> 6371</span>&#160;          fk00 = f_one - fs</div><div class="line"><a name="l06372"></a><span class="lineno"> 6372</span>&#160;          fk10 = fs</div><div class="line"><a name="l06373"></a><span class="lineno"> 6373</span>&#160;          fk20 = f_zero</div><div class="line"><a name="l06374"></a><span class="lineno"> 6374</span>&#160;</div><div class="line"><a name="l06375"></a><span class="lineno"> 6375</span>&#160;          id000 = ind0</div><div class="line"><a name="l06376"></a><span class="lineno"> 6376</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l06377"></a><span class="lineno"> 6377</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l06378"></a><span class="lineno"> 6378</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l06379"></a><span class="lineno"> 6379</span>&#160;          id200 = ind0</div><div class="line"><a name="l06380"></a><span class="lineno"> 6380</span>&#160;          id210 = ind0</div><div class="line"><a name="l06381"></a><span class="lineno"> 6381</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l06382"></a><span class="lineno"> 6382</span>&#160;</div><div class="line"><a name="l06383"></a><span class="lineno"> 6383</span>&#160;        fac000 = fk00 * fac00(k)</div><div class="line"><a name="l06384"></a><span class="lineno"> 6384</span>&#160;        fac100 = fk10 * fac00(k)</div><div class="line"><a name="l06385"></a><span class="lineno"> 6385</span>&#160;        fac200 = fk20 * fac00(k)</div><div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;        fac010 = fk00 * fac10(k)</div><div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;        fac110 = fk10 * fac10(k)</div><div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160;        fac210 = fk20 * fac10(k)</div><div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;</div><div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;          p1 = fs1 - f_one</div><div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;          p41 = p1**4</div><div class="line"><a name="l06393"></a><span class="lineno"> 6393</span>&#160;          fk01 = p41</div><div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160;</div><div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160;          id001 = ind1</div><div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;          id201 = ind1 + 2</div><div class="line"><a name="l06402"></a><span class="lineno"> 6402</span>&#160;          id211 = ind1 +11</div><div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160;        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;          p1 = -fs1</div><div class="line"><a name="l06405"></a><span class="lineno"> 6405</span>&#160;          p41 = p1**4</div><div class="line"><a name="l06406"></a><span class="lineno"> 6406</span>&#160;          fk01 = p41</div><div class="line"><a name="l06407"></a><span class="lineno"> 6407</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l06408"></a><span class="lineno"> 6408</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l06409"></a><span class="lineno"> 6409</span>&#160;</div><div class="line"><a name="l06410"></a><span class="lineno"> 6410</span>&#160;          id001 = ind1 + 1</div><div class="line"><a name="l06411"></a><span class="lineno"> 6411</span>&#160;          id011 = ind1 +10</div><div class="line"><a name="l06412"></a><span class="lineno"> 6412</span>&#160;          id101 = ind1</div><div class="line"><a name="l06413"></a><span class="lineno"> 6413</span>&#160;          id111 = ind1 + 9</div><div class="line"><a name="l06414"></a><span class="lineno"> 6414</span>&#160;          id201 = ind1 - 1</div><div class="line"><a name="l06415"></a><span class="lineno"> 6415</span>&#160;          id211 = ind1 + 8</div><div class="line"><a name="l06416"></a><span class="lineno"> 6416</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l06417"></a><span class="lineno"> 6417</span>&#160;          fk01 = f_one - fs1</div><div class="line"><a name="l06418"></a><span class="lineno"> 6418</span>&#160;          fk11 = fs1</div><div class="line"><a name="l06419"></a><span class="lineno"> 6419</span>&#160;          fk21 = f_zero</div><div class="line"><a name="l06420"></a><span class="lineno"> 6420</span>&#160;</div><div class="line"><a name="l06421"></a><span class="lineno"> 6421</span>&#160;          id001 = ind1</div><div class="line"><a name="l06422"></a><span class="lineno"> 6422</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l06423"></a><span class="lineno"> 6423</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l06424"></a><span class="lineno"> 6424</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l06425"></a><span class="lineno"> 6425</span>&#160;          id201 = ind1</div><div class="line"><a name="l06426"></a><span class="lineno"> 6426</span>&#160;          id211 = ind1</div><div class="line"><a name="l06427"></a><span class="lineno"> 6427</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l06428"></a><span class="lineno"> 6428</span>&#160;</div><div class="line"><a name="l06429"></a><span class="lineno"> 6429</span>&#160;        fac001 = fk01 * fac01(k)</div><div class="line"><a name="l06430"></a><span class="lineno"> 6430</span>&#160;        fac101 = fk11 * fac01(k)</div><div class="line"><a name="l06431"></a><span class="lineno"> 6431</span>&#160;        fac201 = fk21 * fac01(k)</div><div class="line"><a name="l06432"></a><span class="lineno"> 6432</span>&#160;        fac011 = fk01 * fac11(k)</div><div class="line"><a name="l06433"></a><span class="lineno"> 6433</span>&#160;        fac111 = fk11 * fac11(k)</div><div class="line"><a name="l06434"></a><span class="lineno"> 6434</span>&#160;        fac211 = fk21 * fac11(k)</div><div class="line"><a name="l06435"></a><span class="lineno"> 6435</span>&#160;</div><div class="line"><a name="l06436"></a><span class="lineno"> 6436</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng15</div><div class="line"><a name="l06437"></a><span class="lineno"> 6437</span>&#160;          tauself = selffac(k)* (<a class="code" href="group__module__radlw__kgbnn.html#ga1d14e9b2e607f2022d84c6fc0cd27c4e">selfref</a>(ig,inds) + selffrac(k)         &amp;</div><div class="line"><a name="l06438"></a><span class="lineno"> 6438</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga1d14e9b2e607f2022d84c6fc0cd27c4e">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#ga1d14e9b2e607f2022d84c6fc0cd27c4e">selfref</a>(ig,inds)))</div><div class="line"><a name="l06439"></a><span class="lineno"> 6439</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#gada70146d20f89f059141aa4cf58a0894">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l06440"></a><span class="lineno"> 6440</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gada70146d20f89f059141aa4cf58a0894">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#gada70146d20f89f059141aa4cf58a0894">forref</a>(ig,indf))) </div><div class="line"><a name="l06441"></a><span class="lineno"> 6441</span>&#160;          n2m1    = <a class="code" href="group__module__radlw__kgbnn.html#gaff32d89fe8fef50ff79136cc7aa50526">ka_mn2</a>(ig,jmn2,indm) + fmn2                         &amp;</div><div class="line"><a name="l06442"></a><span class="lineno"> 6442</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gaff32d89fe8fef50ff79136cc7aa50526">ka_mn2</a>(ig,jmn2p,indm) - <a class="code" href="group__module__radlw__kgbnn.html#gaff32d89fe8fef50ff79136cc7aa50526">ka_mn2</a>(ig,jmn2,indm))</div><div class="line"><a name="l06443"></a><span class="lineno"> 6443</span>&#160;          n2m2    = <a class="code" href="group__module__radlw__kgbnn.html#gaff32d89fe8fef50ff79136cc7aa50526">ka_mn2</a>(ig,jmn2,indmp) + fmn2                        &amp;</div><div class="line"><a name="l06444"></a><span class="lineno"> 6444</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gaff32d89fe8fef50ff79136cc7aa50526">ka_mn2</a>(ig,jmn2p,indmp) - <a class="code" href="group__module__radlw__kgbnn.html#gaff32d89fe8fef50ff79136cc7aa50526">ka_mn2</a>(ig,jmn2,indmp))</div><div class="line"><a name="l06445"></a><span class="lineno"> 6445</span>&#160;          taun2   = scalen2 * (n2m1 + minorfrac(k) * (n2m2 - n2m1))</div><div class="line"><a name="l06446"></a><span class="lineno"> 6446</span>&#160;</div><div class="line"><a name="l06447"></a><span class="lineno"> 6447</span>&#160;          taug(ns15+ig,k) = speccomb                                    &amp;</div><div class="line"><a name="l06448"></a><span class="lineno"> 6448</span>&#160;     &amp;                * (fac000*<a class="code" href="group__module__radlw__kgbnn.html#gaa6412ac501e2afed3d1b64b0cdcdab9e">absa</a>(ig,id000) + fac010*<a class="code" href="group__module__radlw__kgbnn.html#gaa6412ac501e2afed3d1b64b0cdcdab9e">absa</a>(ig,id010)  &amp;</div><div class="line"><a name="l06449"></a><span class="lineno"> 6449</span>&#160;     &amp;                +  fac100*<a class="code" href="group__module__radlw__kgbnn.html#gaa6412ac501e2afed3d1b64b0cdcdab9e">absa</a>(ig,id100) + fac110*<a class="code" href="group__module__radlw__kgbnn.html#gaa6412ac501e2afed3d1b64b0cdcdab9e">absa</a>(ig,id110)  &amp;</div><div class="line"><a name="l06450"></a><span class="lineno"> 6450</span>&#160;     &amp;                +  fac200*<a class="code" href="group__module__radlw__kgbnn.html#gaa6412ac501e2afed3d1b64b0cdcdab9e">absa</a>(ig,id200) + fac210*<a class="code" href="group__module__radlw__kgbnn.html#gaa6412ac501e2afed3d1b64b0cdcdab9e">absa</a>(ig,id210)) &amp;</div><div class="line"><a name="l06451"></a><span class="lineno"> 6451</span>&#160;     &amp;                +     speccomb1                                   &amp;</div><div class="line"><a name="l06452"></a><span class="lineno"> 6452</span>&#160;     &amp;                * (fac001*<a class="code" href="group__module__radlw__kgbnn.html#gaa6412ac501e2afed3d1b64b0cdcdab9e">absa</a>(ig,id001) + fac011*<a class="code" href="group__module__radlw__kgbnn.html#gaa6412ac501e2afed3d1b64b0cdcdab9e">absa</a>(ig,id011)  &amp;</div><div class="line"><a name="l06453"></a><span class="lineno"> 6453</span>&#160;     &amp;                +  fac101*<a class="code" href="group__module__radlw__kgbnn.html#gaa6412ac501e2afed3d1b64b0cdcdab9e">absa</a>(ig,id101) + fac111*<a class="code" href="group__module__radlw__kgbnn.html#gaa6412ac501e2afed3d1b64b0cdcdab9e">absa</a>(ig,id111)  &amp;</div><div class="line"><a name="l06454"></a><span class="lineno"> 6454</span>&#160;     &amp;                +  fac201*<a class="code" href="group__module__radlw__kgbnn.html#gaa6412ac501e2afed3d1b64b0cdcdab9e">absa</a>(ig,id201) + fac211*<a class="code" href="group__module__radlw__kgbnn.html#gaa6412ac501e2afed3d1b64b0cdcdab9e">absa</a>(ig,id211)) &amp;</div><div class="line"><a name="l06455"></a><span class="lineno"> 6455</span>&#160;     &amp;                + tauself + taufor + taun2</div><div class="line"><a name="l06456"></a><span class="lineno"> 6456</span>&#160;</div><div class="line"><a name="l06457"></a><span class="lineno"> 6457</span>&#160;          fracs(ns15+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga4b5c5f6fd9ea806843adf78ec1b43cd2">fracrefa</a>(ig,jpl) + fpl                     &amp;</div><div class="line"><a name="l06458"></a><span class="lineno"> 6458</span>&#160;     &amp;                     * (<a class="code" href="group__module__radlw__kgbnn.html#ga4b5c5f6fd9ea806843adf78ec1b43cd2">fracrefa</a>(ig,jplp) - <a class="code" href="group__module__radlw__kgbnn.html#ga4b5c5f6fd9ea806843adf78ec1b43cd2">fracrefa</a>(ig,jpl))</div><div class="line"><a name="l06459"></a><span class="lineno"> 6459</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l06460"></a><span class="lineno"> 6460</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l06461"></a><span class="lineno"> 6461</span>&#160;</div><div class="line"><a name="l06462"></a><span class="lineno"> 6462</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l06463"></a><span class="lineno"> 6463</span>&#160;</div><div class="line"><a name="l06464"></a><span class="lineno"> 6464</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l06465"></a><span class="lineno"> 6465</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng15</div><div class="line"><a name="l06466"></a><span class="lineno"> 6466</span>&#160;          taug(ns15+ig,k) = f_zero</div><div class="line"><a name="l06467"></a><span class="lineno"> 6467</span>&#160;</div><div class="line"><a name="l06468"></a><span class="lineno"> 6468</span>&#160;          fracs(ns15+ig,k) = f_zero</div><div class="line"><a name="l06469"></a><span class="lineno"> 6469</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l06470"></a><span class="lineno"> 6470</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l06471"></a><span class="lineno"> 6471</span>&#160;</div><div class="line"><a name="l06472"></a><span class="lineno"> 6472</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l06473"></a><span class="lineno"> 6473</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#a93b5c0ae0525697ffffb6228581a301c">taugb15</a></div><div class="line"><a name="l06474"></a><span class="lineno"> 6474</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l06475"></a><span class="lineno"> 6475</span>&#160;</div><div class="line"><a name="l06477"></a><span class="lineno"> 6477</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l06478"></a><span class="lineno"> 6478</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="radlw__main_8f.html#a942ce0031745cd1b3b4ebc3915970554">taugb16</a></div><div class="line"><a name="l06479"></a><span class="lineno"><a class="line" href="radlw__main_8f.html#a942ce0031745cd1b3b4ebc3915970554"> 6479</a></span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l06480"></a><span class="lineno"> 6480</span>&#160;</div><div class="line"><a name="l06481"></a><span class="lineno"> 6481</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l06482"></a><span class="lineno"> 6482</span>&#160;<span class="comment">!     band 16:  2600-3250 cm-1 (low key- h2o,ch4; high key - ch4)      !</span></div><div class="line"><a name="l06483"></a><span class="lineno"> 6483</span>&#160;<span class="comment">!  ------------------------------------------------------------------  !</span></div><div class="line"><a name="l06484"></a><span class="lineno"> 6484</span>&#160;</div><div class="line"><a name="l06485"></a><span class="lineno"> 6485</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__kgb16.html">module_radlw_kgb16</a></div><div class="line"><a name="l06486"></a><span class="lineno"> 6486</span>&#160;</div><div class="line"><a name="l06487"></a><span class="lineno"> 6487</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l06488"></a><span class="lineno"> 6488</span>&#160;      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div><div class="line"><a name="l06489"></a><span class="lineno"> 6489</span>&#160;     &amp;       id000, id010, id100, id110, id200, id210, jpl, jplp,       &amp;</div><div class="line"><a name="l06490"></a><span class="lineno"> 6490</span>&#160;     &amp;       id001, id011, id101, id111, id201, id211, ig, js, js1</div><div class="line"><a name="l06491"></a><span class="lineno"> 6491</span>&#160;</div><div class="line"><a name="l06492"></a><span class="lineno"> 6492</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: tauself, taufor, refrat_planck_a,        &amp;</div><div class="line"><a name="l06493"></a><span class="lineno"> 6493</span>&#160;     &amp;       speccomb,       specparm,       specmult,       fs,        &amp;</div><div class="line"><a name="l06494"></a><span class="lineno"> 6494</span>&#160;     &amp;       speccomb1,      specparm1,      specmult1,      fs1,       &amp;</div><div class="line"><a name="l06495"></a><span class="lineno"> 6495</span>&#160;     &amp;       speccomb_planck,specparm_planck,specmult_planck,fpl,       &amp;</div><div class="line"><a name="l06496"></a><span class="lineno"> 6496</span>&#160;     &amp;       fac000, fac100, fac200, fac010, fac110, fac210,            &amp;</div><div class="line"><a name="l06497"></a><span class="lineno"> 6497</span>&#160;     &amp;       fac001, fac101, fac201, fac011, fac111, fac211,            &amp;</div><div class="line"><a name="l06498"></a><span class="lineno"> 6498</span>&#160;     &amp;       p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21</div><div class="line"><a name="l06499"></a><span class="lineno"> 6499</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l06500"></a><span class="lineno"> 6500</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l06501"></a><span class="lineno"> 6501</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l06502"></a><span class="lineno"> 6502</span>&#160;<span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div><div class="line"><a name="l06503"></a><span class="lineno"> 6503</span>&#160;<span class="comment">!           fraction in lower atmosphere.</span></div><div class="line"><a name="l06504"></a><span class="lineno"> 6504</span>&#160;</div><div class="line"><a name="l06505"></a><span class="lineno"> 6505</span>&#160;      refrat_planck_a = chi_mls(1,6)/chi_mls(6,6)        <span class="comment">! P = 387. mb (Level 6)</span></div><div class="line"><a name="l06506"></a><span class="lineno"> 6506</span>&#160;</div><div class="line"><a name="l06507"></a><span class="lineno"> 6507</span>&#160;<span class="comment">!  --- ...  lower atmosphere loop</span></div><div class="line"><a name="l06508"></a><span class="lineno"> 6508</span>&#160;</div><div class="line"><a name="l06509"></a><span class="lineno"> 6509</span>&#160;      <span class="keywordflow">do</span> k = 1, laytrop</div><div class="line"><a name="l06510"></a><span class="lineno"> 6510</span>&#160;        speccomb = colamt(k,1) + rfrate(k,4,1)*colamt(k,5)</div><div class="line"><a name="l06511"></a><span class="lineno"> 6511</span>&#160;        specparm = colamt(k,1) / speccomb</div><div class="line"><a name="l06512"></a><span class="lineno"> 6512</span>&#160;        specmult = 8.0 * min(specparm, oneminus)</div><div class="line"><a name="l06513"></a><span class="lineno"> 6513</span>&#160;        js = 1 + int(specmult)</div><div class="line"><a name="l06514"></a><span class="lineno"> 6514</span>&#160;        fs = mod(specmult, f_one)</div><div class="line"><a name="l06515"></a><span class="lineno"> 6515</span>&#160;        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(16) + js</div><div class="line"><a name="l06516"></a><span class="lineno"> 6516</span>&#160;</div><div class="line"><a name="l06517"></a><span class="lineno"> 6517</span>&#160;        speccomb1 = colamt(k,1) + rfrate(k,4,2)*colamt(k,5)</div><div class="line"><a name="l06518"></a><span class="lineno"> 6518</span>&#160;        specparm1 = colamt(k,1) / speccomb1</div><div class="line"><a name="l06519"></a><span class="lineno"> 6519</span>&#160;        specmult1 = 8.0 * min(specparm1, oneminus)</div><div class="line"><a name="l06520"></a><span class="lineno"> 6520</span>&#160;        js1 = 1 + int(specmult1)</div><div class="line"><a name="l06521"></a><span class="lineno"> 6521</span>&#160;        fs1 = mod(specmult1, f_one)</div><div class="line"><a name="l06522"></a><span class="lineno"> 6522</span>&#160;        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(16) + js1</div><div class="line"><a name="l06523"></a><span class="lineno"> 6523</span>&#160;</div><div class="line"><a name="l06524"></a><span class="lineno"> 6524</span>&#160;        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,5)</div><div class="line"><a name="l06525"></a><span class="lineno"> 6525</span>&#160;        specparm_planck = colamt(k,1) / speccomb_planck</div><div class="line"><a name="l06526"></a><span class="lineno"> 6526</span>&#160;        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div><div class="line"><a name="l06527"></a><span class="lineno"> 6527</span>&#160;        jpl = 1 + int(specmult_planck)</div><div class="line"><a name="l06528"></a><span class="lineno"> 6528</span>&#160;        fpl = mod(specmult_planck, f_one)</div><div class="line"><a name="l06529"></a><span class="lineno"> 6529</span>&#160;</div><div class="line"><a name="l06530"></a><span class="lineno"> 6530</span>&#160;        inds = indself(k)</div><div class="line"><a name="l06531"></a><span class="lineno"> 6531</span>&#160;        indf = indfor(k)</div><div class="line"><a name="l06532"></a><span class="lineno"> 6532</span>&#160;        indsp = inds + 1</div><div class="line"><a name="l06533"></a><span class="lineno"> 6533</span>&#160;        indfp = indf + 1</div><div class="line"><a name="l06534"></a><span class="lineno"> 6534</span>&#160;        jplp  = jpl  + 1</div><div class="line"><a name="l06535"></a><span class="lineno"> 6535</span>&#160;</div><div class="line"><a name="l06536"></a><span class="lineno"> 6536</span>&#160;        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l06537"></a><span class="lineno"> 6537</span>&#160;          p0 = fs - f_one</div><div class="line"><a name="l06538"></a><span class="lineno"> 6538</span>&#160;          p40 = p0**4</div><div class="line"><a name="l06539"></a><span class="lineno"> 6539</span>&#160;          fk00 = p40</div><div class="line"><a name="l06540"></a><span class="lineno"> 6540</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l06541"></a><span class="lineno"> 6541</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l06542"></a><span class="lineno"> 6542</span>&#160;</div><div class="line"><a name="l06543"></a><span class="lineno"> 6543</span>&#160;          id000 = ind0</div><div class="line"><a name="l06544"></a><span class="lineno"> 6544</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l06545"></a><span class="lineno"> 6545</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l06546"></a><span class="lineno"> 6546</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l06547"></a><span class="lineno"> 6547</span>&#160;          id200 = ind0 + 2</div><div class="line"><a name="l06548"></a><span class="lineno"> 6548</span>&#160;          id210 = ind0 +11</div><div class="line"><a name="l06549"></a><span class="lineno"> 6549</span>&#160;        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l06550"></a><span class="lineno"> 6550</span>&#160;          p0 = -fs</div><div class="line"><a name="l06551"></a><span class="lineno"> 6551</span>&#160;          p40 = p0**4</div><div class="line"><a name="l06552"></a><span class="lineno"> 6552</span>&#160;          fk00 = p40</div><div class="line"><a name="l06553"></a><span class="lineno"> 6553</span>&#160;          fk10 = f_one - p0 - 2.0*p40</div><div class="line"><a name="l06554"></a><span class="lineno"> 6554</span>&#160;          fk20 = p0 + p40</div><div class="line"><a name="l06555"></a><span class="lineno"> 6555</span>&#160;</div><div class="line"><a name="l06556"></a><span class="lineno"> 6556</span>&#160;          id000 = ind0 + 1</div><div class="line"><a name="l06557"></a><span class="lineno"> 6557</span>&#160;          id010 = ind0 +10</div><div class="line"><a name="l06558"></a><span class="lineno"> 6558</span>&#160;          id100 = ind0</div><div class="line"><a name="l06559"></a><span class="lineno"> 6559</span>&#160;          id110 = ind0 + 9</div><div class="line"><a name="l06560"></a><span class="lineno"> 6560</span>&#160;          id200 = ind0 - 1</div><div class="line"><a name="l06561"></a><span class="lineno"> 6561</span>&#160;          id210 = ind0 + 8</div><div class="line"><a name="l06562"></a><span class="lineno"> 6562</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l06563"></a><span class="lineno"> 6563</span>&#160;          fk00 = f_one - fs</div><div class="line"><a name="l06564"></a><span class="lineno"> 6564</span>&#160;          fk10 = fs</div><div class="line"><a name="l06565"></a><span class="lineno"> 6565</span>&#160;          fk20 = f_zero</div><div class="line"><a name="l06566"></a><span class="lineno"> 6566</span>&#160;</div><div class="line"><a name="l06567"></a><span class="lineno"> 6567</span>&#160;          id000 = ind0</div><div class="line"><a name="l06568"></a><span class="lineno"> 6568</span>&#160;          id010 = ind0 + 9</div><div class="line"><a name="l06569"></a><span class="lineno"> 6569</span>&#160;          id100 = ind0 + 1</div><div class="line"><a name="l06570"></a><span class="lineno"> 6570</span>&#160;          id110 = ind0 +10</div><div class="line"><a name="l06571"></a><span class="lineno"> 6571</span>&#160;          id200 = ind0</div><div class="line"><a name="l06572"></a><span class="lineno"> 6572</span>&#160;          id210 = ind0</div><div class="line"><a name="l06573"></a><span class="lineno"> 6573</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l06574"></a><span class="lineno"> 6574</span>&#160;</div><div class="line"><a name="l06575"></a><span class="lineno"> 6575</span>&#160;        fac000 = fk00 * fac00(k)</div><div class="line"><a name="l06576"></a><span class="lineno"> 6576</span>&#160;        fac100 = fk10 * fac00(k)</div><div class="line"><a name="l06577"></a><span class="lineno"> 6577</span>&#160;        fac200 = fk20 * fac00(k)</div><div class="line"><a name="l06578"></a><span class="lineno"> 6578</span>&#160;        fac010 = fk00 * fac10(k)</div><div class="line"><a name="l06579"></a><span class="lineno"> 6579</span>&#160;        fac110 = fk10 * fac10(k)</div><div class="line"><a name="l06580"></a><span class="lineno"> 6580</span>&#160;        fac210 = fk20 * fac10(k)</div><div class="line"><a name="l06581"></a><span class="lineno"> 6581</span>&#160;</div><div class="line"><a name="l06582"></a><span class="lineno"> 6582</span>&#160;        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div><div class="line"><a name="l06583"></a><span class="lineno"> 6583</span>&#160;          p1 = fs1 - f_one</div><div class="line"><a name="l06584"></a><span class="lineno"> 6584</span>&#160;          p41 = p1**4</div><div class="line"><a name="l06585"></a><span class="lineno"> 6585</span>&#160;          fk01 = p41</div><div class="line"><a name="l06586"></a><span class="lineno"> 6586</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l06587"></a><span class="lineno"> 6587</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l06588"></a><span class="lineno"> 6588</span>&#160;</div><div class="line"><a name="l06589"></a><span class="lineno"> 6589</span>&#160;          id001 = ind1</div><div class="line"><a name="l06590"></a><span class="lineno"> 6590</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l06591"></a><span class="lineno"> 6591</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l06592"></a><span class="lineno"> 6592</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l06593"></a><span class="lineno"> 6593</span>&#160;          id201 = ind1 + 2</div><div class="line"><a name="l06594"></a><span class="lineno"> 6594</span>&#160;          id211 = ind1 +11</div><div class="line"><a name="l06595"></a><span class="lineno"> 6595</span>&#160;        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div><div class="line"><a name="l06596"></a><span class="lineno"> 6596</span>&#160;          p1 = -fs1</div><div class="line"><a name="l06597"></a><span class="lineno"> 6597</span>&#160;          p41 = p1**4</div><div class="line"><a name="l06598"></a><span class="lineno"> 6598</span>&#160;          fk01 = p41</div><div class="line"><a name="l06599"></a><span class="lineno"> 6599</span>&#160;          fk11 = f_one - p1 - 2.0*p41</div><div class="line"><a name="l06600"></a><span class="lineno"> 6600</span>&#160;          fk21 = p1 + p41</div><div class="line"><a name="l06601"></a><span class="lineno"> 6601</span>&#160;</div><div class="line"><a name="l06602"></a><span class="lineno"> 6602</span>&#160;          id001 = ind1 + 1</div><div class="line"><a name="l06603"></a><span class="lineno"> 6603</span>&#160;          id011 = ind1 +10</div><div class="line"><a name="l06604"></a><span class="lineno"> 6604</span>&#160;          id101 = ind1</div><div class="line"><a name="l06605"></a><span class="lineno"> 6605</span>&#160;          id111 = ind1 + 9</div><div class="line"><a name="l06606"></a><span class="lineno"> 6606</span>&#160;          id201 = ind1 - 1</div><div class="line"><a name="l06607"></a><span class="lineno"> 6607</span>&#160;          id211 = ind1 + 8</div><div class="line"><a name="l06608"></a><span class="lineno"> 6608</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l06609"></a><span class="lineno"> 6609</span>&#160;          fk01 = f_one - fs1</div><div class="line"><a name="l06610"></a><span class="lineno"> 6610</span>&#160;          fk11 = fs1</div><div class="line"><a name="l06611"></a><span class="lineno"> 6611</span>&#160;          fk21 = f_zero</div><div class="line"><a name="l06612"></a><span class="lineno"> 6612</span>&#160;</div><div class="line"><a name="l06613"></a><span class="lineno"> 6613</span>&#160;          id001 = ind1</div><div class="line"><a name="l06614"></a><span class="lineno"> 6614</span>&#160;          id011 = ind1 + 9</div><div class="line"><a name="l06615"></a><span class="lineno"> 6615</span>&#160;          id101 = ind1 + 1</div><div class="line"><a name="l06616"></a><span class="lineno"> 6616</span>&#160;          id111 = ind1 +10</div><div class="line"><a name="l06617"></a><span class="lineno"> 6617</span>&#160;          id201 = ind1</div><div class="line"><a name="l06618"></a><span class="lineno"> 6618</span>&#160;          id211 = ind1</div><div class="line"><a name="l06619"></a><span class="lineno"> 6619</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l06620"></a><span class="lineno"> 6620</span>&#160;</div><div class="line"><a name="l06621"></a><span class="lineno"> 6621</span>&#160;        fac001 = fk01 * fac01(k)</div><div class="line"><a name="l06622"></a><span class="lineno"> 6622</span>&#160;        fac101 = fk11 * fac01(k)</div><div class="line"><a name="l06623"></a><span class="lineno"> 6623</span>&#160;        fac201 = fk21 * fac01(k)</div><div class="line"><a name="l06624"></a><span class="lineno"> 6624</span>&#160;        fac011 = fk01 * fac11(k)</div><div class="line"><a name="l06625"></a><span class="lineno"> 6625</span>&#160;        fac111 = fk11 * fac11(k)</div><div class="line"><a name="l06626"></a><span class="lineno"> 6626</span>&#160;        fac211 = fk21 * fac11(k)</div><div class="line"><a name="l06627"></a><span class="lineno"> 6627</span>&#160;</div><div class="line"><a name="l06628"></a><span class="lineno"> 6628</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng16</div><div class="line"><a name="l06629"></a><span class="lineno"> 6629</span>&#160;          tauself = selffac(k)* (<a class="code" href="group__module__radlw__kgbnn.html#gafaa2554e1161bd6c983ce630d39d703a">selfref</a>(ig,inds) + selffrac(k)         &amp;</div><div class="line"><a name="l06630"></a><span class="lineno"> 6630</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#gafaa2554e1161bd6c983ce630d39d703a">selfref</a>(ig,indsp) - <a class="code" href="group__module__radlw__kgbnn.html#gafaa2554e1161bd6c983ce630d39d703a">selfref</a>(ig,inds)))</div><div class="line"><a name="l06631"></a><span class="lineno"> 6631</span>&#160;          taufor  = forfac(k) * (<a class="code" href="group__module__radlw__kgbnn.html#ga4402ed68e18459813a6c9ede5d6ba9cc">forref</a>(ig,indf) + forfrac(k)           &amp;</div><div class="line"><a name="l06632"></a><span class="lineno"> 6632</span>&#160;     &amp;            * (<a class="code" href="group__module__radlw__kgbnn.html#ga4402ed68e18459813a6c9ede5d6ba9cc">forref</a>(ig,indfp) - <a class="code" href="group__module__radlw__kgbnn.html#ga4402ed68e18459813a6c9ede5d6ba9cc">forref</a>(ig,indf))) </div><div class="line"><a name="l06633"></a><span class="lineno"> 6633</span>&#160;</div><div class="line"><a name="l06634"></a><span class="lineno"> 6634</span>&#160;          taug(ns16+ig,k) = speccomb                                    &amp;</div><div class="line"><a name="l06635"></a><span class="lineno"> 6635</span>&#160;     &amp;                * (fac000*<a class="code" href="group__module__radlw__kgbnn.html#ga2734b420b7e8e8393a8bf1b595a3cf09">absa</a>(ig,id000) + fac010*<a class="code" href="group__module__radlw__kgbnn.html#ga2734b420b7e8e8393a8bf1b595a3cf09">absa</a>(ig,id010)  &amp;</div><div class="line"><a name="l06636"></a><span class="lineno"> 6636</span>&#160;     &amp;                +  fac100*<a class="code" href="group__module__radlw__kgbnn.html#ga2734b420b7e8e8393a8bf1b595a3cf09">absa</a>(ig,id100) + fac110*<a class="code" href="group__module__radlw__kgbnn.html#ga2734b420b7e8e8393a8bf1b595a3cf09">absa</a>(ig,id110)  &amp;</div><div class="line"><a name="l06637"></a><span class="lineno"> 6637</span>&#160;     &amp;                +  fac200*<a class="code" href="group__module__radlw__kgbnn.html#ga2734b420b7e8e8393a8bf1b595a3cf09">absa</a>(ig,id200) + fac210*<a class="code" href="group__module__radlw__kgbnn.html#ga2734b420b7e8e8393a8bf1b595a3cf09">absa</a>(ig,id210)) &amp;</div><div class="line"><a name="l06638"></a><span class="lineno"> 6638</span>&#160;     &amp;                +     speccomb1                                   &amp;</div><div class="line"><a name="l06639"></a><span class="lineno"> 6639</span>&#160;     &amp;                * (fac001*<a class="code" href="group__module__radlw__kgbnn.html#ga2734b420b7e8e8393a8bf1b595a3cf09">absa</a>(ig,id001) + fac011*<a class="code" href="group__module__radlw__kgbnn.html#ga2734b420b7e8e8393a8bf1b595a3cf09">absa</a>(ig,id011)  &amp;</div><div class="line"><a name="l06640"></a><span class="lineno"> 6640</span>&#160;     &amp;                +  fac101*<a class="code" href="group__module__radlw__kgbnn.html#ga2734b420b7e8e8393a8bf1b595a3cf09">absa</a>(ig,id101) + fac111*<a class="code" href="group__module__radlw__kgbnn.html#ga2734b420b7e8e8393a8bf1b595a3cf09">absa</a>(ig,id111)  &amp;</div><div class="line"><a name="l06641"></a><span class="lineno"> 6641</span>&#160;     &amp;                +  fac201*<a class="code" href="group__module__radlw__kgbnn.html#ga2734b420b7e8e8393a8bf1b595a3cf09">absa</a>(ig,id201) + fac211*<a class="code" href="group__module__radlw__kgbnn.html#ga2734b420b7e8e8393a8bf1b595a3cf09">absa</a>(ig,id211)) &amp;</div><div class="line"><a name="l06642"></a><span class="lineno"> 6642</span>&#160;     &amp;                + tauself + taufor</div><div class="line"><a name="l06643"></a><span class="lineno"> 6643</span>&#160;</div><div class="line"><a name="l06644"></a><span class="lineno"> 6644</span>&#160;          fracs(ns16+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#ga355dcc9f6f4955ab3d7ee0a22005c8ba">fracrefa</a>(ig,jpl) + fpl                     &amp;</div><div class="line"><a name="l06645"></a><span class="lineno"> 6645</span>&#160;     &amp;                     * (<a class="code" href="group__module__radlw__kgbnn.html#ga355dcc9f6f4955ab3d7ee0a22005c8ba">fracrefa</a>(ig,jplp) - <a class="code" href="group__module__radlw__kgbnn.html#ga355dcc9f6f4955ab3d7ee0a22005c8ba">fracrefa</a>(ig,jpl))</div><div class="line"><a name="l06646"></a><span class="lineno"> 6646</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l06647"></a><span class="lineno"> 6647</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l06648"></a><span class="lineno"> 6648</span>&#160;</div><div class="line"><a name="l06649"></a><span class="lineno"> 6649</span>&#160;<span class="comment">!  --- ...  upper atmosphere loop</span></div><div class="line"><a name="l06650"></a><span class="lineno"> 6650</span>&#160;</div><div class="line"><a name="l06651"></a><span class="lineno"> 6651</span>&#160;      <span class="keywordflow">do</span> k = laytrop+1, nlay</div><div class="line"><a name="l06652"></a><span class="lineno"> 6652</span>&#160;        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(16) + 1</div><div class="line"><a name="l06653"></a><span class="lineno"> 6653</span>&#160;        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(16) + 1</div><div class="line"><a name="l06654"></a><span class="lineno"> 6654</span>&#160;</div><div class="line"><a name="l06655"></a><span class="lineno"> 6655</span>&#160;        ind0p = ind0 + 1</div><div class="line"><a name="l06656"></a><span class="lineno"> 6656</span>&#160;        ind1p = ind1 + 1</div><div class="line"><a name="l06657"></a><span class="lineno"> 6657</span>&#160;</div><div class="line"><a name="l06658"></a><span class="lineno"> 6658</span>&#160;        <span class="keywordflow">do</span> ig = 1, ng16</div><div class="line"><a name="l06659"></a><span class="lineno"> 6659</span>&#160;          taug(ns16+ig,k) = colamt(k,5)                                 &amp;</div><div class="line"><a name="l06660"></a><span class="lineno"> 6660</span>&#160;     &amp;           * (fac00(k)*<a class="code" href="group__module__radlw__kgbnn.html#gae856b42252b71d4d588ea5e19e871cac">absb</a>(ig,ind0) + fac10(k)*<a class="code" href="group__module__radlw__kgbnn.html#gae856b42252b71d4d588ea5e19e871cac">absb</a>(ig,ind0p)    &amp;</div><div class="line"><a name="l06661"></a><span class="lineno"> 6661</span>&#160;     &amp;           +  fac01(k)*<a class="code" href="group__module__radlw__kgbnn.html#gae856b42252b71d4d588ea5e19e871cac">absb</a>(ig,ind1) + fac11(k)*<a class="code" href="group__module__radlw__kgbnn.html#gae856b42252b71d4d588ea5e19e871cac">absb</a>(ig,ind1p))</div><div class="line"><a name="l06662"></a><span class="lineno"> 6662</span>&#160;</div><div class="line"><a name="l06663"></a><span class="lineno"> 6663</span>&#160;          fracs(ns16+ig,k) = <a class="code" href="group__module__radlw__kgbnn.html#gab93affafac8e2bb182982133a6449de4">fracrefb</a>(ig)</div><div class="line"><a name="l06664"></a><span class="lineno"> 6664</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l06665"></a><span class="lineno"> 6665</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l06666"></a><span class="lineno"> 6666</span>&#160;</div><div class="line"><a name="l06667"></a><span class="lineno"> 6667</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l06668"></a><span class="lineno"> 6668</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="radlw__main_8f.html#a942ce0031745cd1b3b4ebc3915970554">taugb16</a></div><div class="line"><a name="l06669"></a><span class="lineno"> 6669</span>&#160;<span class="comment">! ----------------------------------</span></div><div class="line"><a name="l06670"></a><span class="lineno"> 6670</span>&#160;</div><div class="line"><a name="l06671"></a><span class="lineno"> 6671</span>&#160;<span class="comment">! ..................................</span></div><div class="line"><a name="l06672"></a><span class="lineno"> 6672</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radlw__main.html#gab09f986fb87e796a30c889086c92aeb1">taumol</a></div><div class="line"><a name="l06673"></a><span class="lineno"> 6673</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l06674"></a><span class="lineno"> 6674</span>&#160;</div><div class="line"><a name="l06675"></a><span class="lineno"> 6675</span>&#160;</div><div class="line"><a name="l06676"></a><span class="lineno"> 6676</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l06677"></a><span class="lineno"> 6677</span>&#160;<span class="comment">!........................................!</span></div><div class="line"><a name="l06678"></a><span class="lineno"> 6678</span>&#160;<span class="keyword">      end module </span>module_radlw_main       <span class="comment">!</span></div><div class="line"><a name="l06679"></a><span class="lineno"> 6679</span>&#160;<span class="comment">!========================================!</span></div><div class="line"><a name="l06680"></a><span class="lineno"> 6680</span>&#160;</div><div class="line"><a name="l06681"></a><span class="lineno"> 6681</span>&#160;<span class="comment">!! @}</span></div><div class="ttc" id="group__module__radlw__kgbnn_html_ga79326139db789012d47c4750917c2cdb"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga79326139db789012d47c4750917c2cdb">module_radlw_kgb09::kb_mn2o</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng09, mmn09), public kb_mn2o</div><div class="ttdoc">the array kb_mxxx contains the absorption coefficient for a minor species at the NG09=12 chosen g-val...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l25659">radlw_datatb.f:25659</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga0fcd13503b3253ec6aab0aa52056f634"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga0fcd13503b3253ec6aab0aa52056f634">module_radlw_kgb08::ka_mco2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng08, mmc08), public ka_mco2</div><div class="ttdoc">minor gas mapping level:lower - co2, p = 1053.63 mb, t = 294.2 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24839">radlw_datatb.f:24839</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb12_html"><div class="ttname"><a href="namespacemodule__radlw__kgb12.html">module_radlw_kgb12</a></div><div class="ttdoc">This module sets up absorption coefficients for band 12: 1800-2080 cm-1 (low - h2o, co2; high - /) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l29420">radlw_datatb.f:29420</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga26476f00fe13c1c81d3ae0cf8e43c90b"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga26476f00fe13c1c81d3ae0cf8e43c90b">module_radlw_kgb09::fracrefb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng09), public fracrefb</div><div class="ttdoc">planck fraction mapping level : p 3.20e-2 mb, t = 197.92 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l25638">radlw_datatb.f:25638</a></div></div>
<div class="ttc" id="namespacemodule__radlw__parameters_html_a05fe17fe932ce62a3ae2c6c564584321"><div class="ttname"><a href="namespacemodule__radlw__parameters.html#a05fe17fe932ce62a3ae2c6c564584321">module_radlw_parameters::ngptlw</a></div><div class="ttdeci">integer, parameter ngptlw</div><div class="ttdoc">num of total g-points </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00113">radlw_param.f:113</a></div></div>
<div class="ttc" id="structmodule__radlw__parameters_1_1sfcflw__type_html"><div class="ttname"><a href="structmodule__radlw__parameters_1_1sfcflw__type.html">module_radlw_parameters::sfcflw_type</a></div><div class="ttdoc">Define type construct for radiation fluxes at surface. </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00084">radlw_param.f:84</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gab0478438e9bbe64401aa492510f8d4bb"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gab0478438e9bbe64401aa492510f8d4bb">module_radlw_kgb07::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng07, msb07), public absb</div><div class="ttdoc">the array absb(NG07,235) = kb(NG07,5,13:59) contains absorption coefs at the NG07=12 chosen g-values ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l22175">radlw_datatb.f:22175</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaa6412ac501e2afed3d1b64b0cdcdab9e"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaa6412ac501e2afed3d1b64b0cdcdab9e">module_radlw_kgb15::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng15, msa15), public absa</div><div class="ttdoc">the array absa(NG15,585) = ka(NG15,9,5,13) contains absorption coefs at the NG15=2 g-intervals for a ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l31661">radlw_datatb.f:31661</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaf7b1fd9c6b966e03a226dd8cbc058670"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaf7b1fd9c6b966e03a226dd8cbc058670">module_radlw_kgb05::fracrefb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng05, mbf05), public fracrefb</div><div class="ttdoc">planck fraction mapping level : p = 0.2369280 mbar, t = 253.60 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l15441">radlw_datatb.f:15441</a></div></div>
<div class="ttc" id="radlw__main_8f_html_a74c1cb8390daff1e5ce5e863c50b7873"><div class="ttname"><a href="radlw__main_8f.html#a74c1cb8390daff1e5ce5e863c50b7873">taugb10</a></div><div class="ttdeci">subroutine taugb10</div><div class="ttdoc">Band 10: 1390-1480 cm-1 (low key - h2o; high key - h2o) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l05594">radlw_main.f:5594</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga696b91ef86ccbda17df10f770797cafa"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga696b91ef86ccbda17df10f770797cafa">module_radlw_kgb04::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng04, msf04), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l10232">radlw_datatb.f:10232</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga1d14e9b2e607f2022d84c6fc0cd27c4e"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga1d14e9b2e607f2022d84c6fc0cd27c4e">module_radlw_kgb15::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng15, msf15), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l31675">radlw_datatb.f:31675</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga21bd40309855c89a64b88be171bfde59"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga21bd40309855c89a64b88be171bfde59">module_radlw_kgb06::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng06, msa06), public absa</div><div class="ttdoc">the array absa(NG06,65) = ka(NG06,5,13) contains absorption coefs at the NG06=8 g-intervals for a ran...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l21898">radlw_datatb.f:21898</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga7dec65e880c278f44419c1ae01490eae"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga7dec65e880c278f44419c1ae01490eae">module_radlw_kgb08::ka_mo3</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng08, mmc08), public ka_mo3</div><div class="ttdoc">minor gas mapping level:lower - o3, p = 317.348 mb, t = 240.77 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24836">radlw_datatb.f:24836</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga23d4352fcafb0394d723e2f080a84ece"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga23d4352fcafb0394d723e2f080a84ece">module_radlw_kgb08::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng08, msb08), public absb</div><div class="ttdoc">the array absb(NG08,235) = kb(NG08,5,13:59) contains absorption coefs at the NG08=8 chosen g-values f...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24820">radlw_datatb.f:24820</a></div></div>
<div class="ttc" id="group__module__radlw__main_html_gaf20db29eaadab298ccd8b6bf489a53f4"><div class="ttname"><a href="group__module__radlw__main.html#gaf20db29eaadab298ccd8b6bf489a53f4">module_radlw_main::lwrad</a></div><div class="ttdeci">subroutine, public lwrad(plyr, plvl, tlyr, tlvl, qlyr, olyr, gasvmr, clouds, icseed, aerosols, sfemis, sfgtmp, npts, nlay, nlp1, lprnt, hlwc, topflx, sfcflx, HLW0, HLWB, FLXPRF)</div><div class="ttdoc">This subroutine is the main LW radiation routine. </div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l00463">radlw_main.f:463</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gace3d3e2731609f7ea50eb798bd212f3b"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gace3d3e2731609f7ea50eb798bd212f3b">module_radlw_kgb09::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng09, maf09), public fracrefa</div><div class="ttdoc">planck fractions mapping level : p=212.7250 mb, t = 223.06 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l25635">radlw_datatb.f:25635</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb15_html"><div class="ttname"><a href="namespacemodule__radlw__kgb15.html">module_radlw_kgb15</a></div><div class="ttdoc">This module sets up absorption coefficients for band 15: 2380-2600 cm-1 (low - n2o, co2; high - /) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l31624">radlw_datatb.f:31624</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga8d73bb6971c872e15a24a81d3917167e"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga8d73bb6971c872e15a24a81d3917167e">module_radlw_kgb04::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng04, msa04), public absa</div><div class="ttdoc">the array absa(NG04,585) = ka(NG04,9,5,13) contains absorption coefs at the NG04=14 g-intervals for a...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l10208">radlw_datatb.f:10208</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga14c7cc68b26c0ab1fdfda6faa2d485d5"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga14c7cc68b26c0ab1fdfda6faa2d485d5">module_radlw_kgb01::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng01, msf01), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l01665">radlw_datatb.f:1665</a></div></div>
<div class="ttc" id="namespacemodule__radlw__cldprlw_html_a57896538226e9184c3750440d9f62166"><div class="ttname"><a href="namespacemodule__radlw__cldprlw.html#a57896538226e9184c3750440d9f62166">module_radlw_cldprlw::absliq1</a></div><div class="ttdeci">real(kind=kind_phys), dimension(58, nbands) absliq1</div><div class="ttdoc">Hu and Stamnes method  . the liquid water absorption coefficients are listed for a range of effective...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l00966">radlw_datatb.f:966</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga14f18538f77c1a3d651e36acf90baa19"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga14f18538f77c1a3d651e36acf90baa19">module_radlw_kgb10::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng10, msa10), public absa</div><div class="ttdoc">the array absa(NG10,65) = ka(NG10,5,13) contains absorption coefs at the NG10=6 chosen g-values for a...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28276">radlw_datatb.f:28276</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga26e901a002e789933c5c9b622f3a0932"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga26e901a002e789933c5c9b622f3a0932">module_radlw_kgb03::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng03, maf03), public fracrefa</div><div class="ttdoc">planck fraction mapping level: p=212.7250 mbar, t = 223.06 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l03363">radlw_datatb.f:3363</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga7ac883387aa86a635c9aea011c55a1d5"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga7ac883387aa86a635c9aea011c55a1d5">module_radlw_kgb11::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng11, msa11), public absa</div><div class="ttdoc">the array absa(NG11,65) = ka(NG11,5,13) contains absorption coefs at the NG11=8 chosen g-values for a...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28753">radlw_datatb.f:28753</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gac8f58bba6aa4b72ffd01f78e60d0831f"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gac8f58bba6aa4b72ffd01f78e60d0831f">module_radlw_kgb13::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng13, msf13), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l30544">radlw_datatb.f:30544</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga7a8726efe46fac4d6cce55ca357199ab"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga7a8726efe46fac4d6cce55ca357199ab">module_radlw_kgb09::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng09, msa09), public absa</div><div class="ttdoc">the array absa(NG09,585) = ka(NG09,9,5,13) contains absorption coefs at the NG09=12 g-intervals for a...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l25613">radlw_datatb.f:25613</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb06_html"><div class="ttname"><a href="namespacemodule__radlw__kgb06.html">module_radlw_kgb06</a></div><div class="ttdoc">This module sets up absorption coefficients for band 06: 820-980 cm-1 (low - h2o; high - /) ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l21860">radlw_datatb.f:21860</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga355dcc9f6f4955ab3d7ee0a22005c8ba"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga355dcc9f6f4955ab3d7ee0a22005c8ba">module_radlw_kgb16::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng16, maf16), public fracrefa</div><div class="ttdoc">planck fraction mapping level: p = 387.6100 mbar, t = 250.17 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l32096">radlw_datatb.f:32096</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gae1e7065b9ea30b36a3665ad594545e9b"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gae1e7065b9ea30b36a3665ad594545e9b">module_radlw_kgb14::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng14), public fracrefa</div><div class="ttdoc">planck fraction mapping level : p = 142.5940 mb, t = 215.70 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l31459">radlw_datatb.f:31459</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaa16eb60406e5a298e380b55af528791a"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaa16eb60406e5a298e380b55af528791a">module_radlw_kgb07::fracrefb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng07), public fracrefb</div><div class="ttdoc">planck data fraction mapping level : p=95.58 mbar, t= 215.70 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l22188">radlw_datatb.f:22188</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga07d5bac00d30f1ab873a0542b28d7e83"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga07d5bac00d30f1ab873a0542b28d7e83">module_radlw_kgb10::fracrefb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng10), public fracrefb</div><div class="ttdoc">planck fraction mapping level : p = 95.58350 mb, t = 215.70 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28308">radlw_datatb.f:28308</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga92d45aee9dab62549ea8821eae7422dd"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga92d45aee9dab62549ea8821eae7422dd">module_radlw_kgb13::fracrefb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng13), public fracrefb</div><div class="ttdoc">planck fraction mapping level : p=4.758820 mb, t = 250.85 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l30550">radlw_datatb.f:30550</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga72a8c0879636dba20e2a8a35ba79f681"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga72a8c0879636dba20e2a8a35ba79f681">module_radlw_kgb09::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng09, mfr09), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l25596">radlw_datatb.f:25596</a></div></div>
<div class="ttc" id="group__module__radlw__main_html_ga1445abd529b76abe7ffb80e843d9fafc"><div class="ttname"><a href="group__module__radlw__main.html#ga1445abd529b76abe7ffb80e843d9fafc">module_radlw_main::rtrnmc</a></div><div class="ttdeci">subroutine rtrnmc(semiss, delp, cldfmc, taucld, tautot, pklay, pklev, fracs, secdif, nlay, nlp1, totuflux, totdflux, htr, totuclfl, totdclfl, htrcl, htrb)</div><div class="ttdoc">This subroutine computes the upward/downward radiative fluxes, and heating rates for both clear or cl...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l03271">radlw_main.f:3271</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga15c6b3bfa9d8cbf20099dd4f364444b5"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga15c6b3bfa9d8cbf20099dd4f364444b5">module_radlw_kgb05::ccl4</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng05), public ccl4</div><div class="ttdoc">minor gas (o3, ccl4) mapping level : p = 317.34 mbar, t = 240.77 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l15446">radlw_datatb.f:15446</a></div></div>
<div class="ttc" id="radlw__main_8f_html_a93b5c0ae0525697ffffb6228581a301c"><div class="ttname"><a href="radlw__main_8f.html#a93b5c0ae0525697ffffb6228581a301c">taugb15</a></div><div class="ttdeci">subroutine taugb15</div><div class="ttdoc">Band 15: 2380-2600 cm-1 (low - n2o,co2; low minor - n2) (high - nothing) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l06268">radlw_main.f:6268</a></div></div>
<div class="ttc" id="namespacemodule__radlw__cldprlw_html_ad2238686c0e6d1c5d74bcfdde1542e1d"><div class="ttname"><a href="namespacemodule__radlw__cldprlw.html#ad2238686c0e6d1c5d74bcfdde1542e1d">module_radlw_cldprlw::absice2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(43, nbands) absice2</div><div class="ttdoc">for iflagice =2, absice2 are the ice water absorption coefficients used for streamer method...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l01219">radlw_datatb.f:1219</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaaacc55911b42c67396b5cdc4318e0d5f"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaaacc55911b42c67396b5cdc4318e0d5f">module_radlw_kgb04::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng04, msb04), public absb</div><div class="ttdoc">the array absb(NG04,1175) = kb(NG04,5,5,13:59) contains absorption coefs at the NG04=14 g-intervals f...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l10225">radlw_datatb.f:10225</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga8427ec5170f6a61a008a8580be6fe5ec"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga8427ec5170f6a61a008a8580be6fe5ec">module_radlw_kgb08::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng08, mfr08), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24796">radlw_datatb.f:24796</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga8478067cb8a07a02b56c09fa3c73eb67"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga8478067cb8a07a02b56c09fa3c73eb67">module_radlw_kgb14::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng14, mfr14), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l31456">radlw_datatb.f:31456</a></div></div>
<div class="ttc" id="namespacemodule__radlw__parameters_html_a5817221936731c6ee6443da6a64e934e"><div class="ttname"><a href="namespacemodule__radlw__parameters.html#a5817221936731c6ee6443da6a64e934e">module_radlw_parameters::maxxsec</a></div><div class="ttdeci">integer, parameter maxxsec</div><div class="ttdoc">num of halocarbon gasees </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00119">radlw_param.f:119</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb09_html"><div class="ttname"><a href="namespacemodule__radlw__kgb09.html">module_radlw_kgb09</a></div><div class="ttdoc">This module sets up absorption coefficients for band 09: 1180-1390 cm-1 (low - h2o, ch4; high - ch4) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l25566">radlw_datatb.f:25566</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga38a3ce7d8f3db6b732511cf78ef735db"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga38a3ce7d8f3db6b732511cf78ef735db">module_radlw_kgb08::cfc22adj</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng08), public cfc22adj</div><div class="ttdoc">original cfc22 is multiplied by 1.485 to account for the 780-850 cm-1 and 1290-1335 cm-1 bands...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24855">radlw_datatb.f:24855</a></div></div>
<div class="ttc" id="group__module__radlw__main_html_gab09f986fb87e796a30c889086c92aeb1"><div class="ttname"><a href="group__module__radlw__main.html#gab09f986fb87e796a30c889086c92aeb1">module_radlw_main::taumol</a></div><div class="ttdeci">subroutine taumol(laytrop, pavel, coldry, colamt, colbrd, wx, tauaer, rfrate, fac00, fac01, fac10, fac11, jp, jt, jt1, selffac, selffrac, indself, forfac, forfrac, indfor, minorfrac, scaleminor, scaleminorn2, indminor, nlay, fracs, tautot)</div><div class="ttdoc">This subroutine contains optical depths developed for the rapid radiative transfer model...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l03688">radlw_main.f:3688</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb11_html"><div class="ttname"><a href="namespacemodule__radlw__kgb11.html">module_radlw_kgb11</a></div><div class="ttdoc">This module sets up absorption coefficients for band 11: 1480-1800 cm-1 (low - h2o; high - h2o) ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28720">radlw_datatb.f:28720</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gabdaefe1c38d8bfcac5ef9b878fac77cb"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gabdaefe1c38d8bfcac5ef9b878fac77cb">module_radlw_kgb01::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng01, msb01), public absb</div><div class="ttdoc">the array absb(NG01,235) = kb(NG01,5,13:59) contains absorption coefs at the NG01=10 chosen g-values ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l01658">radlw_datatb.f:1658</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga6ff0c311db14b41c9bdf1170164adc3a"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga6ff0c311db14b41c9bdf1170164adc3a">module_radlw_kgb05::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng05, mfr05), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l15394">radlw_datatb.f:15394</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga37d98e8066c5995060a2a8451b45705f"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga37d98e8066c5995060a2a8451b45705f">module_radlw_kgb09::ka_mn2o</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng09, maf09, mmn09), public ka_mn2o</div><div class="ttdoc">the array ka_mxxx contains the absorption coefficient for a minor species at the 16 chosen g-values f...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l25651">radlw_datatb.f:25651</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga19b6a3893965817e82c77bee1de536cd"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga19b6a3893965817e82c77bee1de536cd">module_radlw_kgb01::fracrefb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng01), public fracrefb</div><div class="ttdoc">planck fraction mapping level: p = 212.7250 mbar, t = 223.06 k these planck fractions were calculated...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l01680">radlw_datatb.f:1680</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gafaa2554e1161bd6c983ce630d39d703a"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gafaa2554e1161bd6c983ce630d39d703a">module_radlw_kgb16::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng16, msf16), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l32093">radlw_datatb.f:32093</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga010239f14788bc1ed9953133e30a62fd"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga010239f14788bc1ed9953133e30a62fd">module_radlw_kgb08::cfc12</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng08), public cfc12</div><div class="ttdoc">minor gas mapping level:lower - cfc12 </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24845">radlw_datatb.f:24845</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaf1d33a7362e73bf40ef592bc9863b612"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaf1d33a7362e73bf40ef592bc9863b612">module_radlw_kgb03::fracrefb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng03, mbf03), public fracrefb</div><div class="ttdoc">planck fraction mapping level: p = 95.8 mbar, t = 215.7 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l03366">radlw_datatb.f:3366</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaba1018958264bbc6fbf7f190fea91fa5"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaba1018958264bbc6fbf7f190fea91fa5">module_radlw_kgb08::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng08, msa08), public absa</div><div class="ttdoc">the array absa(NG08,65) = ka(NG08,5,13) contains absorption coefs at the NG08=8 g-intervals for a ran...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24808">radlw_datatb.f:24808</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga46db893d4456b2d867130bb208cb2206"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga46db893d4456b2d867130bb208cb2206">module_radlw_kgb02::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng02, msa02), public absa</div><div class="ttdoc">the array absa(NG02,65) = ka(NG02,5,13) contains absorption coefs at the NG02=12 chosen g-values for ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l02458">radlw_datatb.f:2458</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb02_html"><div class="ttname"><a href="namespacemodule__radlw__kgb02.html">module_radlw_kgb02</a></div><div class="ttdoc">This module sets up absorption coefficients for band 02: 250-500 cm-1 (low - h2o; high - h2o) ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l02428">radlw_datatb.f:2428</a></div></div>
<div class="ttc" id="radlw__main_8f_html_a942ce0031745cd1b3b4ebc3915970554"><div class="ttname"><a href="radlw__main_8f.html#a942ce0031745cd1b3b4ebc3915970554">taugb16</a></div><div class="ttdeci">subroutine taugb16</div><div class="ttdoc">Band 16: 2600-3250 cm-1 (low key- h2o,ch4; high key - ch4) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l06479">radlw_main.f:6479</a></div></div>
<div class="ttc" id="namespacemodule__radlw__cldprlw_html_a04bff194fec27e0586ab1b4770319882"><div class="ttname"><a href="namespacemodule__radlw__cldprlw.html#a04bff194fec27e0586ab1b4770319882">module_radlw_cldprlw::absrain</a></div><div class="ttdeci">real(kind=kind_phys), parameter absrain</div><div class="ttdoc">absrain is the rain drop absorption coefficient  . </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l00945">radlw_datatb.f:945</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga9239d06fcd3fca0f13302c1ae4eb5a60"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga9239d06fcd3fca0f13302c1ae4eb5a60">module_radlw_kgb11::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng11, mfr11), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28779">radlw_datatb.f:28779</a></div></div>
<div class="ttc" id="structmodule__radlw__parameters_1_1proflw__type_html"><div class="ttname"><a href="structmodule__radlw__parameters_1_1proflw__type.html">module_radlw_parameters::proflw_type</a></div><div class="ttdoc">Define type construct for optional radiation flux profiles. </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00097">radlw_param.f:97</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gab57cb029ede27280bc99641f39ab3a81"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gab57cb029ede27280bc99641f39ab3a81">module_radlw_kgb14::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng14, msa14), public absa</div><div class="ttdoc">the array absa(NG14,65) = ka(NG14,5,13) contains absorption coefs at the NG14=2 chosen g-values for a...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l31430">radlw_datatb.f:31430</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gadb2110a245d9f01b3fd1ab058c883003"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gadb2110a245d9f01b3fd1ab058c883003">module_radlw_kgb09::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng09, msb09), public absb</div><div class="ttdoc">the array absb(NG09,235) = kb(NG09,5,13:59) contains absorption coefs at the NG09=12 chosen g-values ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l25625">radlw_datatb.f:25625</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gadb5dab732383b82e89f1048ab5150c23"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gadb5dab732383b82e89f1048ab5150c23">module_radlw_kgb06::ka_mco2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng06, mmc06), public ka_mco2</div><div class="ttdoc">the array kao_mxx contains the absorption coefficient for a minor species at the NG06=8 chosen g-valu...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l21916">radlw_datatb.f:21916</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gacf37465675961812e07616e42b137d70"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gacf37465675961812e07616e42b137d70">module_radlw_kgb11::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng11, msb11), public absb</div><div class="ttdoc">the array absb(NG11,235) = kb(NG11,5,13:59) contains absorption coefs at the NG11=8 chosen g-values f...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28765">radlw_datatb.f:28765</a></div></div>
<div class="ttc" id="namespacemodule__radlw__cldprlw_html_a9e8ebd81d5d62c2be4c006a595493aed"><div class="ttname"><a href="namespacemodule__radlw__cldprlw.html#a9e8ebd81d5d62c2be4c006a595493aed">module_radlw_cldprlw::ipat</a></div><div class="ttdeci">integer, dimension(nbands) ipat</div><div class="ttdoc">ipat is bands index for ebert&amp;curry ice cloud (for iflagice=1) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l00939">radlw_datatb.f:939</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb05_html"><div class="ttname"><a href="namespacemodule__radlw__kgb05.html">module_radlw_kgb05</a></div><div class="ttdoc">This module sets up absorption coefficients for band 05: 700-820 cm-1 (low - h2o, co2; high - co2...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l15362">radlw_datatb.f:15362</a></div></div>
<div class="ttc" id="radlw__main_8f_html_a2ac7254d2dcff516e8e44b8b679302c0"><div class="ttname"><a href="radlw__main_8f.html#a2ac7254d2dcff516e8e44b8b679302c0">taugb13</a></div><div class="ttdeci">subroutine taugb13</div><div class="ttdoc">Band 13: 2080-2250 cm-1 (low key-h2o,n2o; high minor-o3 minor) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l05949">radlw_main.f:5949</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga13a211bf8a903d0720fa72ac90e4fc3f"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga13a211bf8a903d0720fa72ac90e4fc3f">module_radlw_kgb14::fracrefb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng14), public fracrefb</div><div class="ttdoc">planck fraction mapping level : p = 4.758820mb, t = 250.85 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l31462">radlw_datatb.f:31462</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gae8d5d56d09dfbe06d918c6b098e3fddf"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gae8d5d56d09dfbe06d918c6b098e3fddf">module_radlw_kgb04::fracrefb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng04, mbf04), public fracrefb</div><div class="ttdoc">planck fraction mapping level : p = 95.58350 mb, t = 215.70 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l10238">radlw_datatb.f:10238</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaf6db1580bd4a8b037cdd3e14765e2c83"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaf6db1580bd4a8b037cdd3e14765e2c83">module_radlw_kgb02::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng02), public fracrefa</div><div class="ttdoc">planck fraction mapping level: p = 1053.630 mbar, t = 294.2 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l02487">radlw_datatb.f:2487</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaa2442e663e83b222648a86a34cd6631c"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaa2442e663e83b222648a86a34cd6631c">module_radlw_kgb03::kb_mn2o</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng03, mbf03, mmn03), public kb_mn2o</div><div class="ttdoc">the array kb_mxxx contains the absorption coefficient for a minor species at the NG03=16 chosen g-val...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l03390">radlw_datatb.f:3390</a></div></div>
<div class="ttc" id="namespacemodule__radlw__cldprlw_html_a4bcd58c6a7e9abdfbb8f8ec7d925d143"><div class="ttname"><a href="namespacemodule__radlw__cldprlw.html#a4bcd58c6a7e9abdfbb8f8ec7d925d143">module_radlw_cldprlw::abssnow0</a></div><div class="ttdeci">real(kind=kind_phys), parameter abssnow0</div><div class="ttdoc">abssnow0 is the snow flake absorption coefficient (micron), fu coeff </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l00948">radlw_datatb.f:948</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga9a85770aee1b88b9323d9466c1772ec4"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga9a85770aee1b88b9323d9466c1772ec4">module_radlw_kgb08::kb_mco2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng08, mmc08), public kb_mco2</div><div class="ttdoc">minor gas mapping level:upper - co2, p = 35.1632 mb, t = 223.28 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24842">radlw_datatb.f:24842</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gacdbe767d50d503c4a89d4042dd0dee8e"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gacdbe767d50d503c4a89d4042dd0dee8e">module_radlw_kgb01::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng01, msa01), public absa</div><div class="ttdoc">the array absa(NG01,65) = ka(NG01,5,13) contains absorption coefs at the NG01=10 chosen g-values for ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l01646">radlw_datatb.f:1646</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga3fdad494f3d3fcf9306da6a81d97bd43"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga3fdad494f3d3fcf9306da6a81d97bd43">module_radlw_kgb07::ka_mco2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng07, maf07, mmc07), public ka_mco2</div><div class="ttdoc">the array ka_mxxx contains the absorption coefficient for a minor species at the NG07=12 chosen g-val...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l22200">radlw_datatb.f:22200</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga8aaf83ec7a08a244fd1e5396c9fd9b1d"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga8aaf83ec7a08a244fd1e5396c9fd9b1d">module_radlw_kgb12::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng12, msf12), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l29470">radlw_datatb.f:29470</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaa84ba66e0a3cc018b03bd13c9c21e133"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaa84ba66e0a3cc018b03bd13c9c21e133">module_radlw_kgb03::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng03, msb03), public absb</div><div class="ttdoc">the array absb(NG03,1175) = kb(NG03,5,5,13:59) contains absorption coefs at the NG03=16 g-intervals f...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l03353">radlw_datatb.f:3353</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga0ae7e4c01034a2b95c03b041537b962e"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga0ae7e4c01034a2b95c03b041537b962e">module_radlw_kgb08::fracrefb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng08), public fracrefb</div><div class="ttdoc">planck fraction mapping level : p=95.5835 mb, t= 215.7 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24833">radlw_datatb.f:24833</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaeedda30c8d2bd7c9e7124c6445c8c20e"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaeedda30c8d2bd7c9e7124c6445c8c20e">module_radlw_kgb02::fracrefb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng02), public fracrefb</div><div class="ttdoc">planck fraction mapping level: p = 3.206e-2 mb, t = 197.92 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l02490">radlw_datatb.f:2490</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga8791eb290525c0d08fefa33ca23569c8"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga8791eb290525c0d08fefa33ca23569c8">module_radlw_kgb11::ka_mo2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng11, mmo11), public ka_mo2</div><div class="ttdoc">the array ka_mxx contains the absorption coefficient for a minor species at the NG11=8 chosen g-value...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28793">radlw_datatb.f:28793</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga97dac0d0e010441171e09e317e5aeee8"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga97dac0d0e010441171e09e317e5aeee8">module_radlw_kgb12::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng12, mfr12), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l29463">radlw_datatb.f:29463</a></div></div>
<div class="ttc" id="namespacemodule__radlw__ref_html"><div class="ttname"><a href="namespacemodule__radlw__ref.html">module_radlw_ref</a></div><div class="ttdoc">This module contains reference temperature and pressure. </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l00750">radlw_datatb.f:750</a></div></div>
<div class="ttc" id="radlw__main_8f_html_a1447d5bda5b521d27171e61881684183"><div class="ttname"><a href="radlw__main_8f.html#a1447d5bda5b521d27171e61881684183">taugb08</a></div><div class="ttdeci">subroutine taugb08</div><div class="ttdoc">Band 8: 1080-1180 cm-1 (low key - h2o; low minor - co2,o3,n2o) (high key - o3; high minor - co2...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l05219">radlw_main.f:5219</a></div></div>
<div class="ttc" id="namespacemodule__radlw__avplank_html_a40c3d6831ec6d7dbdb31254226c8f861"><div class="ttname"><a href="namespacemodule__radlw__avplank.html#a40c3d6831ec6d7dbdb31254226c8f861">module_radlw_avplank::totplnk</a></div><div class="ttdeci">real(kind=kind_phys), dimension(nplnk, nbands), public totplnk</div><div class="ttdoc">plank flux data </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l00078">radlw_datatb.f:78</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gada70146d20f89f059141aa4cf58a0894"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gada70146d20f89f059141aa4cf58a0894">module_radlw_kgb15::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng15, mfr15), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l31668">radlw_datatb.f:31668</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb14_html"><div class="ttname"><a href="namespacemodule__radlw__kgb14.html">module_radlw_kgb14</a></div><div class="ttdoc">This module sets up absorption coefficients for band 14: 2250-2380 cm-1 (low - co2; high - co2) ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l31399">radlw_datatb.f:31399</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga1354ecbc5f07cd763847333e680c686a"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga1354ecbc5f07cd763847333e680c686a">module_radlw_kgb06::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng06), public fracrefa</div><div class="ttdoc">planck fraction mapping level : p = 473.4280 mb, t = 259.83 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l21901">radlw_datatb.f:21901</a></div></div>
<div class="ttc" id="group__module__radlw__main_html_gab002119955eb2b82f16352459180f5ed"><div class="ttname"><a href="group__module__radlw__main.html#gab002119955eb2b82f16352459180f5ed">module_radlw_main::rtrn</a></div><div class="ttdeci">subroutine rtrn(semiss, delp, cldfrc, taucld, tautot, pklay, pklev, fracs, secdif, nlay, nlp1, totuflux, totdflux, htr, totuclfl, totdclfl, htrcl, htrb)</div><div class="ttdoc">This subroutine computes the upward/downward radiative fluxes, and heating rates for both clear or cl...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l02295">radlw_main.f:2295</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga0e390a41b1c9e2ece765d65774060bca"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga0e390a41b1c9e2ece765d65774060bca">module_radlw_kgb14::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng14, msf14), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l31449">radlw_datatb.f:31449</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gacf34f9255586c9ed5ac5370db5b63c14"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gacf34f9255586c9ed5ac5370db5b63c14">module_radlw_kgb02::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng02, msb02), public absb</div><div class="ttdoc">the array absb(NG02,235) = kb(NG02,5,13:59) contains absorption coefs at the NG02=12 chosen g-values ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l02470">radlw_datatb.f:2470</a></div></div>
<div class="ttc" id="namespacemodule__radlw__cldprlw_html_a3aa04541d0b809367f88ef8aa0eafdbb"><div class="ttname"><a href="namespacemodule__radlw__cldprlw.html#a3aa04541d0b809367f88ef8aa0eafdbb">module_radlw_cldprlw::absice3</a></div><div class="ttdeci">real(kind=kind_phys), dimension(46, nbands) absice3</div><div class="ttdoc">for iflagice = 3, absice3 are the ice water absorption coefficients used for fu parameterization. particle size 5 - 140 micron in increments of 3 microns. units = m2/g. hexagonal ice particle parameterization absorption units (abs coef/iwc):  </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l01403">radlw_datatb.f:1403</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga3c727eabe159c88fca912f33a2b91943"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga3c727eabe159c88fca912f33a2b91943">module_radlw_kgb05::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng05, msf05), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l15435">radlw_datatb.f:15435</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga8b0813723ba69b1afbe2552f6b730267"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga8b0813723ba69b1afbe2552f6b730267">module_radlw_kgb06::cfc11adj</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng06), public cfc11adj</div><div class="ttdoc">lower - co2, p = 706.2720 mb, t = 294.2 k upper - cfc11, cfc12 original cfc11 is multiplied by 1...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l21924">radlw_datatb.f:21924</a></div></div>
<div class="ttc" id="radlw__main_8f_html_ae56eaa9e3b897ca235d4d6b271cc1e47"><div class="ttname"><a href="radlw__main_8f.html#ae56eaa9e3b897ca235d4d6b271cc1e47">taugb12</a></div><div class="ttdeci">subroutine taugb12</div><div class="ttdoc">Band 12: 1800-2080 cm-1 (low - h2o,co2; high - nothing) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l05762">radlw_main.f:5762</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga0a89a2686ebc70a2c0d8577b89384a56"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga0a89a2686ebc70a2c0d8577b89384a56">module_radlw_kgb11::fracrefb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng11), public fracrefb</div><div class="ttdoc">planck fraction mapping level : p=0.353 mb, t = 262.11 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28785">radlw_datatb.f:28785</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb01_html"><div class="ttname"><a href="namespacemodule__radlw__kgb01.html">module_radlw_kgb01</a></div><div class="ttdoc">This module sets up absorption coefficients for band 01: 10-250 cm-1 (low - h2o; high - h2o) ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l01614">radlw_datatb.f:1614</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga335fd60e59154f47724d2e25fdf0a5fb"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga335fd60e59154f47724d2e25fdf0a5fb">module_radlw_kgb05::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng05, maf05), public fracrefa</div><div class="ttdoc">planck fraction mapping level : p = 473.42 mb, t = 259.83 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l15438">radlw_datatb.f:15438</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga2c38561d26f86f7ae515b433843c4e5d"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga2c38561d26f86f7ae515b433843c4e5d">module_radlw_kgb08::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng08, msf08), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24827">radlw_datatb.f:24827</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga22ce8d48ac3dceae1d52e80097fc2689"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga22ce8d48ac3dceae1d52e80097fc2689">module_radlw_kgb13::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng13, msa13), public absa</div><div class="ttdoc">the array absa(NG13,585) = ka(NG13,9,5,13) contains absorption coefs at the NG13=4 g-intervals for a ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l30530">radlw_datatb.f:30530</a></div></div>
<div class="ttc" id="namespacemodule__radlw__parameters_html_a61ae33b9db5bac9962f72e2a0db3c0e4"><div class="ttname"><a href="namespacemodule__radlw__parameters.html#a61ae33b9db5bac9962f72e2a0db3c0e4">module_radlw_parameters::ntbl</a></div><div class="ttdeci">integer, parameter ntbl</div><div class="ttdoc">lookup table dimension </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00115">radlw_param.f:115</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaddb071e93b4ff49ba1f1c4d102e275f1"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaddb071e93b4ff49ba1f1c4d102e275f1">module_radlw_kgb02::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng02, msf02), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l02477">radlw_datatb.f:2477</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaff32d89fe8fef50ff79136cc7aa50526"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaff32d89fe8fef50ff79136cc7aa50526">module_radlw_kgb15::ka_mn2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng15, maf15, mmn15), public ka_mn2</div><div class="ttdoc">the array ka_mxx contains the absorption coefficient for a minor species at the NG15=2 chosen g-value...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l31690">radlw_datatb.f:31690</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga0bca660247ac37483cd55c6936056631"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga0bca660247ac37483cd55c6936056631">module_radlw_kgb01::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng01), public fracrefa</div><div class="ttdoc">planck fraction mapping level: p = 212.7250 mbar, t = 223.06 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l01675">radlw_datatb.f:1675</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga2dcfbe76332d559cda48c7ba065ab349"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga2dcfbe76332d559cda48c7ba065ab349">module_radlw_kgb07::kb_mco2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng07, mmc07), public kb_mco2</div><div class="ttdoc">the array kb_mxxx contains absorption coefficient for a minor species at the NG07=12 chosen g-values ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l22208">radlw_datatb.f:22208</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga4402ed68e18459813a6c9ede5d6ba9cc"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga4402ed68e18459813a6c9ede5d6ba9cc">module_radlw_kgb16::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng16, mfr16), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l32057">radlw_datatb.f:32057</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb08_html"><div class="ttname"><a href="namespacemodule__radlw__kgb08.html">module_radlw_kgb08</a></div><div class="ttdoc">This module sets up absorption coefficients for band 08: 1080-1180 cm-1 (low - h2o; high - o3) ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24769">radlw_datatb.f:24769</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gace1d87742e2c543d9b0662e1c7d2b624"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gace1d87742e2c543d9b0662e1c7d2b624">module_radlw_kgb04::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng04, maf04), public fracrefa</div><div class="ttdoc">planck fraction mapping level: p=212.7250 mbar, t = 223.06 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l10235">radlw_datatb.f:10235</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga30ce809b40dd99b3219996ac8f023274"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga30ce809b40dd99b3219996ac8f023274">module_radlw_kgb05::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng05, msa05), public absa</div><div class="ttdoc">the array absa(NG05,585) = ka(NG05,9,5,13) contains absorption coefs at the NG05=16 g-intervals for a...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l15411">radlw_datatb.f:15411</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga93c6546ef5f8cbfc4f63de29e1ba2452"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga93c6546ef5f8cbfc4f63de29e1ba2452">module_radlw_kgb13::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng13, mfr13), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l30537">radlw_datatb.f:30537</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb10_html"><div class="ttname"><a href="namespacemodule__radlw__kgb10.html">module_radlw_kgb10</a></div><div class="ttdoc">This module sets up absorption coefficients for band 10: 1390-1480 cm-1 (low - h2o; high - h2o) ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28245">radlw_datatb.f:28245</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga1c65e91a215060738292d0ca5a8f38a2"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga1c65e91a215060738292d0ca5a8f38a2">module_radlw_kgb09::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng09, msf09), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l25632">radlw_datatb.f:25632</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga07f2a4a0f1152a65aed68623f14a9ae4"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga07f2a4a0f1152a65aed68623f14a9ae4">module_radlw_kgb07::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng07, maf07), public fracrefa</div><div class="ttdoc">planck fraction mapping level : p = 706.27 mb, t = 278.94 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l22185">radlw_datatb.f:22185</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gad1a59ffb362cd72537df9c1916c07621"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gad1a59ffb362cd72537df9c1916c07621">module_radlw_kgb08::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng08), public fracrefa</div><div class="ttdoc">planck fraction mapping level : p=473.4280 mb, t = 259.83 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24830">radlw_datatb.f:24830</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gac65fd4afedbd4bfa2c87c5e4f060a1d4"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gac65fd4afedbd4bfa2c87c5e4f060a1d4">module_radlw_kgb03::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng03, msa03), public absa</div><div class="ttdoc">the array absa(NG03,585) = ka(NG03,9,5,13) contains absorption coefs at the NG03=16 g-intervals for a...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l03336">radlw_datatb.f:3336</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga48247dea283a611ebe57dd1c164dda69"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga48247dea283a611ebe57dd1c164dda69">module_radlw_kgb10::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng10, msf10), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28295">radlw_datatb.f:28295</a></div></div>
<div class="ttc" id="radlw__main_8f_html_ae69174bcf1a87dc7a5baffac69797d07"><div class="ttname"><a href="radlw__main_8f.html#ae69174bcf1a87dc7a5baffac69797d07">taugb04</a></div><div class="ttdeci">subroutine taugb04</div><div class="ttdoc">Band 4: 630-700 cm-1 (low key - h2o,co2; high key - o3,co2) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l04359">radlw_main.f:4359</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga6a0467b666bc75f90ae58fa4f58f07f0"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga6a0467b666bc75f90ae58fa4f58f07f0">module_radlw_kgb06::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng06, mfr06), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l21885">radlw_datatb.f:21885</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga9a8e2f789421acc307e37b03478efb4b"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga9a8e2f789421acc307e37b03478efb4b">module_radlw_kgb08::kb_mn2o</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng08, mmc08), public kb_mn2o</div><div class="ttdoc">minor gas mapping level:upper - n2o, p = 8.716e-2 mb, t = 226.03 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24851">radlw_datatb.f:24851</a></div></div>
<div class="ttc" id="namespacemodule__radlw__parameters_html"><div class="ttname"><a href="namespacemodule__radlw__parameters.html">module_radlw_parameters</a></div><div class="ttdoc">This module contains LW band parameters set up. </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00064">radlw_param.f:64</a></div></div>
<div class="ttc" id="structmodule__radlw__parameters_1_1topflw__type_html"><div class="ttname"><a href="structmodule__radlw__parameters_1_1topflw__type.html">module_radlw_parameters::topflw_type</a></div><div class="ttdoc">Define type construct for radiation fluxes at toa. </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00075">radlw_param.f:75</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gacd70a32f88808dc40c39edee5b76adbe"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gacd70a32f88808dc40c39edee5b76adbe">module_radlw_kgb01::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng01, mfr01), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l01672">radlw_datatb.f:1672</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaaf6d41f390a0465af92756b9c3e6c558"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaaf6d41f390a0465af92756b9c3e6c558">module_radlw_kgb07::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng07, msf07), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l22182">radlw_datatb.f:22182</a></div></div>
<div class="ttc" id="group__module__radlw__main_html_ga6bfdea656cc7e1f773ffcc797e072e91"><div class="ttname"><a href="group__module__radlw__main.html#ga6bfdea656cc7e1f773ffcc797e072e91">module_radlw_main::cldprop</a></div><div class="ttdeci">subroutine cldprop(cfrac, cliqp, reliq, cicep, reice, cdat1, cdat2, cdat3, cdat4, nlay, nlp1, ipseed, cldfmc, taucld)</div><div class="ttdoc">This subroutine computes the cloud optical depth(s) for each cloudy layer and g-point interval...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l01497">radlw_main.f:1497</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb13_html"><div class="ttname"><a href="namespacemodule__radlw__kgb13.html">module_radlw_kgb13</a></div><div class="ttdoc">This module sets up absorption coefficients for band 13: 2080-2250 cm-1 (low - h2o, n2o; high - /) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l30492">radlw_datatb.f:30492</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gac98edefcce668d56c3aadc241863741f"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gac98edefcce668d56c3aadc241863741f">module_radlw_kgb11::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng11, msf11), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28772">radlw_datatb.f:28772</a></div></div>
<div class="ttc" id="group__module__radlw__main_html_gaa9569479682c83b26584b7e9ee6841fa"><div class="ttname"><a href="group__module__radlw__main.html#gaa9569479682c83b26584b7e9ee6841fa">module_radlw_main::rlwinit</a></div><div class="ttdeci">subroutine, public rlwinit(me)</div><div class="ttdoc">This subroutine performs calculations necessary for the initialization of the longwave model...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l01269">radlw_main.f:1269</a></div></div>
<div class="ttc" id="radlw__main_8f_html_a2208d86ae0712a0ca426bbe96de825bc"><div class="ttname"><a href="radlw__main_8f.html#a2208d86ae0712a0ca426bbe96de825bc">taugb07</a></div><div class="ttdeci">subroutine taugb07</div><div class="ttdoc">Band 7: 980-1080 cm-1 (low key - h2o,o3; low minor - co2) (high key - o3; high minor - co2) ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l04956">radlw_main.f:4956</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga523a0bc861ea861869f59b7bd007ff50"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga523a0bc861ea861869f59b7bd007ff50">module_radlw_kgb13::ka_mco2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng13, maf13, mmo13), public ka_mco2</div><div class="ttdoc">the array ka_mxxx contains the absorption coefficient for a minor species at the NG13=4 chosen g-valu...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l30562">radlw_datatb.f:30562</a></div></div>
<div class="ttc" id="namespacemodule__radlw__parameters_html_a86288e4bbe3d6962505488790ff42bfa"><div class="ttname"><a href="namespacemodule__radlw__parameters.html#a86288e4bbe3d6962505488790ff42bfa">module_radlw_parameters::nrates</a></div><div class="ttdeci">integer, parameter nrates</div><div class="ttdoc">num of ref rates of binary species </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00121">radlw_param.f:121</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga2734b420b7e8e8393a8bf1b595a3cf09"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga2734b420b7e8e8393a8bf1b595a3cf09">module_radlw_kgb16::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng16, msa16), public absa</div><div class="ttdoc">the array absa(NG16,585) = ka(NG16,9,5,13) contains absorption coefs at the NG16=2 g-intervals for a ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l32074">radlw_datatb.f:32074</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb04_html"><div class="ttname"><a href="namespacemodule__radlw__kgb04.html">module_radlw_kgb04</a></div><div class="ttdoc">This module sets up absorption coefficients for band 04: 630-700 cm-1 (low - h2o, co2; high - co2...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l10161">radlw_datatb.f:10161</a></div></div>
<div class="ttc" id="group__module__radlw__main_html_ga9318778651bca6ec1f1776da6c21dfda"><div class="ttname"><a href="group__module__radlw__main.html#ga9318778651bca6ec1f1776da6c21dfda">module_radlw_main::mcica_subcol</a></div><div class="ttdeci">subroutine mcica_subcol(cldf, nlay, ipseed, lcloudy)</div><div class="ttdoc">This suroutine computes sub-colum cloud profile flag array. </div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l01804">radlw_main.f:1804</a></div></div>
<div class="ttc" id="namespacemodule__radlw__cldprlw_html_a3b86ff9d6791d95170d3b3ab61cd8291"><div class="ttname"><a href="namespacemodule__radlw__cldprlw.html#a3b86ff9d6791d95170d3b3ab61cd8291">module_radlw_cldprlw::absice1</a></div><div class="ttdeci">real(kind=kind_phys), dimension(2, 5) absice1</div><div class="ttdoc">for iflagice = 1, absice1 are the ice water absorption coefficients used for ebert and curry method  ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l01209">radlw_datatb.f:1209</a></div></div>
<div class="ttc" id="group__module__radlw__main_html_ga8d4a6fecb4ad25468e91661a79d4ca20"><div class="ttname"><a href="group__module__radlw__main.html#ga8d4a6fecb4ad25468e91661a79d4ca20">module_radlw_main::rtrnmr</a></div><div class="ttdeci">subroutine rtrnmr(semiss, delp, cldfrc, taucld, tautot, pklay, pklev, fracs, secdif, nlay, nlp1, totuflux, totdflux, htr, totuclfl, totdclfl, htrcl, htrb)</div><div class="ttdoc">This subroutine computes the upward/downward radiative fluxes, and heating rates for both clear or cl...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l02678">radlw_main.f:2678</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaa8bbfdaf370e12ae26d2ee3c464bdbc2"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaa8bbfdaf370e12ae26d2ee3c464bdbc2">module_radlw_kgb10::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng10), public fracrefa</div><div class="ttdoc">planck fraction mapping level : p = 212.7250, t = 223.06 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28305">radlw_datatb.f:28305</a></div></div>
<div class="ttc" id="radlw__main_8f_html_a889abbaaa2d421c0c3dc820e2004414d"><div class="ttname"><a href="radlw__main_8f.html#a889abbaaa2d421c0c3dc820e2004414d">taugb09</a></div><div class="ttdeci">subroutine taugb09</div><div class="ttdoc">Band 9: 1180-1390 cm-1 (low key - h2o,ch4; low minor - n2o) (high key - ch4; high minor - n2o) ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l05344">radlw_main.f:5344</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaa7a122319c49f3c1e8d51d21771cb63d"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaa7a122319c49f3c1e8d51d21771cb63d">module_radlw_kgb14::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng14, msb14), public absb</div><div class="ttdoc">the array absb(NG14,235) = kb(NG14,5,13:59) contains absorption coefs at the NG14=2 chosen g-values f...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l31442">radlw_datatb.f:31442</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga7600bfa19dde3b47d8479f5766ee0c93"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga7600bfa19dde3b47d8479f5766ee0c93">module_radlw_kgb12::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng12, msa12), public absa</div><div class="ttdoc">the array absa(NG12,585) = ka(NG12,9,5,13) contains absorption coefs at the NG12=8 g-intervals for a ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l29456">radlw_datatb.f:29456</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga61949dc331e9a58d4f2a31b625481795"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga61949dc331e9a58d4f2a31b625481795">module_radlw_kgb08::ka_mn2o</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng08, mmc08), public ka_mn2o</div><div class="ttdoc">minor gas mapping level:lower - n2o, p = 706.2720 mb, t= 278.94 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l24848">radlw_datatb.f:24848</a></div></div>
<div class="ttc" id="radlw__main_8f_html_a573fd5b3580d6bbf5bfa2f01ee547034"><div class="ttname"><a href="radlw__main_8f.html#a573fd5b3580d6bbf5bfa2f01ee547034">taugb11</a></div><div class="ttdeci">subroutine taugb11</div><div class="ttdoc">Band 11: 1480-1800 cm-1 (low - h2o; low minor - o2) (high key - h2o; high minor - o2) ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l05670">radlw_main.f:5670</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaf106cf054f7496a092ceb0c399753a36"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaf106cf054f7496a092ceb0c399753a36">module_radlw_kgb07::absa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng07, msa07), public absa</div><div class="ttdoc">the array absa(NG07,585) = ka(NG07,9,5,13) contains absorption coefs at the NG07=12 g-intervals for a...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l22163">radlw_datatb.f:22163</a></div></div>
<div class="ttc" id="radlw__main_8f_html_a926415cb51870dda9a90883e01a2ee38"><div class="ttname"><a href="radlw__main_8f.html#a926415cb51870dda9a90883e01a2ee38">taugb02</a></div><div class="ttdeci">subroutine taugb02</div><div class="ttdoc">Band 2: 350-500 cm-1 (low key - h2o; high key - h2o) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l03974">radlw_main.f:3974</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb07_html"><div class="ttname"><a href="namespacemodule__radlw__kgb07.html">module_radlw_kgb07</a></div><div class="ttdoc">This module sets up absorption coefficients for band 07: 980-1080 cm-1 (low - h2o, o3; high - o3) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l22121">radlw_datatb.f:22121</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga6bb40d898660e6dfc056d3efe1d0c544"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga6bb40d898660e6dfc056d3efe1d0c544">module_radlw_kgb03::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng03, msf03), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l03360">radlw_datatb.f:3360</a></div></div>
<div class="ttc" id="radlw__main_8f_html_a45e39b507d1fc031c80d9c7f06905d4a"><div class="ttname"><a href="radlw__main_8f.html#a45e39b507d1fc031c80d9c7f06905d4a">taugb03</a></div><div class="ttdeci">subroutine taugb03</div><div class="ttdoc">Band 3: 500-630 cm-1 (low key - h2o,co2; low minor - n2o); (high key - h2o,co2; high minor - n2o) ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l04052">radlw_main.f:4052</a></div></div>
<div class="ttc" id="radlw__main_8f_html_a26140cbe1a3d6119b56cf5c2d539670e"><div class="ttname"><a href="radlw__main_8f.html#a26140cbe1a3d6119b56cf5c2d539670e">taugb14</a></div><div class="ttdeci">subroutine taugb14</div><div class="ttdoc">Band 14: 2250-2380 cm-1 (low - co2; high - co2) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l06198">radlw_main.f:6198</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gae856b42252b71d4d588ea5e19e871cac"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gae856b42252b71d4d588ea5e19e871cac">module_radlw_kgb16::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng16, msb16), public absb</div><div class="ttdoc">the array absb(NG16,235) = kb(NG16,5,13:59) contains absorption coefs at the NG16=2 chosen g-values f...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l32086">radlw_datatb.f:32086</a></div></div>
<div class="ttc" id="radlw__main_8f_html_a92653ffcd20ff247a00eaf3339cba6df"><div class="ttname"><a href="radlw__main_8f.html#a92653ffcd20ff247a00eaf3339cba6df">taugb05</a></div><div class="ttdeci">subroutine taugb05</div><div class="ttdoc">Band 5: 700-820 cm-1 (low key - h2o,co2; low minor - o3, ccl4) (high key - o3,co2) ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l04604">radlw_main.f:4604</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaf70e39048d571053790289549dd8333a"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaf70e39048d571053790289549dd8333a">module_radlw_kgb10::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng10, mfr10), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28302">radlw_datatb.f:28302</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gab93affafac8e2bb182982133a6449de4"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gab93affafac8e2bb182982133a6449de4">module_radlw_kgb16::fracrefb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng16), public fracrefb</div><div class="ttdoc">planck fraction mapping level : p=95.58350 mb, t = 215.70 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l32099">radlw_datatb.f:32099</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaebc667b0569824bba455e822eaea6112"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaebc667b0569824bba455e822eaea6112">module_radlw_kgb05::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng05, msb05), public absb</div><div class="ttdoc">the array absb(NG05,1175) = kb(NG05,5,5,13:59) contains absorption coefs at the NG05=16 g-intervals f...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l15428">radlw_datatb.f:15428</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga5bf6552fb9c1e7c35729b2aea885306e"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga5bf6552fb9c1e7c35729b2aea885306e">module_radlw_kgb11::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng11), public fracrefa</div><div class="ttdoc">planck fraction mapping level : p=1053.63 mb, t= 294.2 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28782">radlw_datatb.f:28782</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb16_html"><div class="ttname"><a href="namespacemodule__radlw__kgb16.html">module_radlw_kgb16</a></div><div class="ttdoc">This module sets up absorption coefficients for band 16: 2600-3000 cm-1 (low - h2o, ch4; high - /) </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l32030">radlw_datatb.f:32030</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaf6f3d7a0ab6858eab9d4d3e2d2d68031"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaf6f3d7a0ab6858eab9d4d3e2d2d68031">module_radlw_kgb02::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng02, mfr02), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l02484">radlw_datatb.f:2484</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga4b5c5f6fd9ea806843adf78ec1b43cd2"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga4b5c5f6fd9ea806843adf78ec1b43cd2">module_radlw_kgb15::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng15, maf15), public fracrefa</div><div class="ttdoc">planck fraction mapping level : p = 1053. mb, t = 294.2 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l31678">radlw_datatb.f:31678</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga98901725947a4477924a47af5e67277e"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga98901725947a4477924a47af5e67277e">module_radlw_kgb06::selfref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng06, msf06), public selfref</div><div class="ttdoc">the array selfref contains the coefficient of the water vapor self-continuum (including the energy te...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l21908">radlw_datatb.f:21908</a></div></div>
<div class="ttc" id="group__module__radlw__main_html_gaeb7b74288cf87988c14bf6e24a2039ae"><div class="ttname"><a href="group__module__radlw__main.html#gaeb7b74288cf87988c14bf6e24a2039ae">module_radlw_main::setcoef</a></div><div class="ttdeci">subroutine setcoef(pavel, tavel, tz, stemp, h2ovmr, colamt, coldry, colbrd, nlay, nlp1, laytrop, pklay, pklev, jp, jt, jt1, rfrate, fac00, fac01, fac10, fac11, selffac, selffrac, indself, forfac, forfrac, indfor, minorfrac, scaleminor, scaleminorn2, indminor)</div><div class="ttdoc">This subroutine computes various coefficients needed in radiative transfer calculations. </div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l02004">radlw_main.f:2004</a></div></div>
<div class="ttc" id="radlw__main_8f_html_a7190d415614aa35deefacff1041d4719"><div class="ttname"><a href="radlw__main_8f.html#a7190d415614aa35deefacff1041d4719">taugb06</a></div><div class="ttdeci">subroutine taugb06</div><div class="ttdoc">Band 6: 820-980 cm-1 (low key - h2o; low minor - co2) (high key - none; high minor - cfc11...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l04869">radlw_main.f:4869</a></div></div>
<div class="ttc" id="namespacemodule__radlw__cldprlw_html"><div class="ttname"><a href="namespacemodule__radlw__cldprlw.html">module_radlw_cldprlw</a></div><div class="ttdoc">This module contains cloud property coefficients. </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l00928">radlw_datatb.f:928</a></div></div>
<div class="ttc" id="namespacemodule__radlw__parameters_html_a01330b4ad09907f2db51cb516ed21033"><div class="ttname"><a href="namespacemodule__radlw__parameters.html#a01330b4ad09907f2db51cb516ed21033">module_radlw_parameters::maxgas</a></div><div class="ttdeci">integer, parameter maxgas</div><div class="ttdoc">max num of absorbing gases </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00117">radlw_param.f:117</a></div></div>
<div class="ttc" id="namespacemodule__radlw__kgb03_html"><div class="ttname"><a href="namespacemodule__radlw__kgb03.html">module_radlw_kgb03</a></div><div class="ttdoc">This module sets up absorption coefficients for band 03: 500-630 cm-1 (low - h2o, co2; high - h2o...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l03286">radlw_datatb.f:3286</a></div></div>
<div class="ttc" id="group__module__radlw__main_html_ga001d1bcd17533f7f920f859ff9a4e60f"><div class="ttname"><a href="group__module__radlw__main.html#ga001d1bcd17533f7f920f859ff9a4e60f">taugb01</a></div><div class="ttdeci">subroutine taugb01</div><div class="ttdoc">band 1: 10-350 cm-1 (low key - h2o; low minor - n2); (high key - h2o; high minor - n2) ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l03867">radlw_main.f:3867</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga82aed8a05cd528b287e336f7ff8fcebb"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga82aed8a05cd528b287e336f7ff8fcebb">module_radlw_kgb13::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng13, maf13), public fracrefa</div><div class="ttdoc">planck fraction mapping level : p=473.4280 mb, t = 259.83 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l30547">radlw_datatb.f:30547</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga58ff4f54c11eb12f7ab5157823981b16"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga58ff4f54c11eb12f7ab5157823981b16">module_radlw_kgb12::fracrefa</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng12, maf12), public fracrefa</div><div class="ttdoc">planck fraction mapping level : p = 174.1640 mbar, t= 215.78 k </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l29473">radlw_datatb.f:29473</a></div></div>
<div class="ttc" id="namespacemodule__radlw__avplank_html"><div class="ttname"><a href="namespacemodule__radlw__avplank.html">module_radlw_avplank</a></div><div class="ttdoc">This module contains plank flux data. </div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l00067">radlw_datatb.f:67</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gafcc55fa81ba6369b56d29db2342c2e6a"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gafcc55fa81ba6369b56d29db2342c2e6a">module_radlw_kgb03::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng03, mfr03), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l03319">radlw_datatb.f:3319</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaebc48e152bb90794b6d0b426f6c5f9e4"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaebc48e152bb90794b6d0b426f6c5f9e4">module_radlw_kgb11::kb_mo2</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng11, mmo11), public kb_mo2</div><div class="ttdoc">the array kb_mxx contains the absorption coefficient for a minor species at the NG11=8 chosen g-value...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28801">radlw_datatb.f:28801</a></div></div>
<div class="ttc" id="namespacemodule__radlw__parameters_html_a48e11b992a80595d71c92f7c9bfbe19c"><div class="ttname"><a href="namespacemodule__radlw__parameters.html#a48e11b992a80595d71c92f7c9bfbe19c">module_radlw_parameters::nbands</a></div><div class="ttdeci">integer, parameter nbands</div><div class="ttdoc">num of total spectral bands </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00111">radlw_param.f:111</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaeeba4e0a8fc97c557e1127b4d5d1bd94"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaeeba4e0a8fc97c557e1127b4d5d1bd94">module_radlw_kgb03::ka_mn2o</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng03, maf03, mmn03), public ka_mn2o</div><div class="ttdoc">the array ka_mxxx(NG03,9,19) contains the absorption coefficient for a minor species at the NG03=16 c...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l03378">radlw_datatb.f:3378</a></div></div>
<div class="ttc" id="namespacemodule__radlw__parameters_html_a2c571bd14c9b7982a7968976858c7547"><div class="ttname"><a href="namespacemodule__radlw__parameters.html#a2c571bd14c9b7982a7968976858c7547">module_radlw_parameters::ngb</a></div><div class="ttdeci">integer, dimension(ngptlw) ngb</div><div class="ttdoc">band indices for each g-point </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00142">radlw_param.f:142</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_ga816fd065291a92c13d026d38a708479b"><div class="ttname"><a href="group__module__radlw__kgbnn.html#ga816fd065291a92c13d026d38a708479b">module_radlw_kgb04::forref</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng04, mfr04), public forref</div><div class="ttdoc">the array forref contains the coefficient of the water vapor foreign-continuum (including the energy ...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l10191">radlw_datatb.f:10191</a></div></div>
<div class="ttc" id="group__module__radlw__kgbnn_html_gaf1e2252355a3002080be21ce37d45c3a"><div class="ttname"><a href="group__module__radlw__kgbnn.html#gaf1e2252355a3002080be21ce37d45c3a">module_radlw_kgb10::absb</a></div><div class="ttdeci">real(kind=kind_phys), dimension(ng10, msb10), public absb</div><div class="ttdoc">the array absb(NG10,235) = kb(NG10,5,13:59) contains absorption coefs at the NG10=6 chosen g-values f...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__datatb_8f_source.html#l28288">radlw_datatb.f:28288</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="radlw__main_8f.html">radlw_main.f</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
